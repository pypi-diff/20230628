# Comparing `tmp/odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0-py3-none-any.whl.zip` & `tmp/odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,44 +1,44 @@
-Zip file size: 120063 bytes, number of entries: 42
--rw-r--r--  2.0 unx     3530 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/README.rst
--rw-r--r--  2.0 unx       66 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/__init__.py
--rw-r--r--  2.0 unx      798 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/__manifest__.py
--rw-r--r--  2.0 unx       83 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/actions/__init__.py
--rw-r--r--  2.0 unx     1778 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/actions/data.py
--rw-r--r--  2.0 unx     5541 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/actions/message.py
--rw-r--r--  2.0 unx     3019 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/actions/schema.py
--rw-r--r--  2.0 unx      471 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/actions/search.py
--rw-r--r--  2.0 unx      329 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/data/shopfloor_scenario_data.xml
--rw-r--r--  2.0 unx      420 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/demo/shopfloor_app_demo.xml
--rw-r--r--  2.0 unx      563 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/demo/shopfloor_menu_demo.xml
--rw-r--r--  2.0 unx      140 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/demo/shopfloor_profile_demo.xml
--rw-r--r--  2.0 unx     1472 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/docs/delivery_shipment_diag_seq.plantuml
--rw-r--r--  2.0 unx    71530 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/docs/delivery_shipment_diag_seq.png
--rw-r--r--  2.0 unx     3297 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/docs/oca_logo.png
--rw-r--r--  2.0 unx     7661 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/i18n/es_AR.po
--rw-r--r--  2.0 unx     6147 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/i18n/pt_BR.po
--rw-r--r--  2.0 unx     6075 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/i18n/shopfloor_delivery_shipment.pot
--rw-r--r--  2.0 unx       29 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/models/__init__.py
--rw-r--r--  2.0 unx      879 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/models/shopfloor_menu.py
--rw-r--r--  2.0 unx      166 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx       50 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/readme/CREDITS.rst
--rw-r--r--  2.0 unx       77 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx       32 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/services/__init__.py
--rw-r--r--  2.0 unx    36638 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/services/delivery_shipment.py
--rw-r--r--  2.0 unx     9455 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/static/description/icon.png
--rw-r--r--  2.0 unx    13386 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/static/description/index.html
--rw-r--r--  2.0 unx      461 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/tests/__init__.py
--rw-r--r--  2.0 unx     5443 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_base.py
--rw-r--r--  2.0 unx     6893 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_loading_list.py
--rw-r--r--  2.0 unx     2480 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_dock.py
--rw-r--r--  2.0 unx    10666 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_lot.py
--rw-r--r--  2.0 unx     7113 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_package.py
--rw-r--r--  2.0 unx    10892 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_picking.py
--rw-r--r--  2.0 unx    11477 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_product.py
--rw-r--r--  2.0 unx     2713 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_unload.py
--rw-r--r--  2.0 unx     6888 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_validate.py
--rw-r--r--  2.0 unx      825 b- defN 23-Jan-05 17:39 odoo/addons/shopfloor_delivery_shipment/views/shopfloor_menu.xml
--rw-r--r--  2.0 unx     4218 b- defN 23-Jan-05 17:39 odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jan-05 17:39 odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Jan-05 17:39 odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     5171 b- defN 23-Jan-05 17:39 odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/RECORD
-42 files, 248969 bytes uncompressed, 111145 bytes compressed:  55.4%
+Zip file size: 120481 bytes, number of entries: 42
+-rw-r--r--  2.0 unx     3530 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/README.rst
+-rw-r--r--  2.0 unx       66 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/__init__.py
+-rw-r--r--  2.0 unx      798 b- defN 23-Jun-28 11:44 odoo/addons/shopfloor_delivery_shipment/__manifest__.py
+-rw-r--r--  2.0 unx       83 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/actions/__init__.py
+-rw-r--r--  2.0 unx     1946 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/actions/data.py
+-rw-r--r--  2.0 unx     5541 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/actions/message.py
+-rw-r--r--  2.0 unx     3745 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/actions/schema.py
+-rw-r--r--  2.0 unx      471 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/actions/search.py
+-rw-r--r--  2.0 unx      329 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/data/shopfloor_scenario_data.xml
+-rw-r--r--  2.0 unx      420 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/demo/shopfloor_app_demo.xml
+-rw-r--r--  2.0 unx      563 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/demo/shopfloor_menu_demo.xml
+-rw-r--r--  2.0 unx      140 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/demo/shopfloor_profile_demo.xml
+-rw-r--r--  2.0 unx     1472 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/docs/delivery_shipment_diag_seq.plantuml
+-rw-r--r--  2.0 unx    71530 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/docs/delivery_shipment_diag_seq.png
+-rw-r--r--  2.0 unx     3297 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/docs/oca_logo.png
+-rw-r--r--  2.0 unx     7661 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/i18n/es_AR.po
+-rw-r--r--  2.0 unx     6147 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/i18n/pt_BR.po
+-rw-r--r--  2.0 unx     6075 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/i18n/shopfloor_delivery_shipment.pot
+-rw-r--r--  2.0 unx       29 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/models/__init__.py
+-rw-r--r--  2.0 unx      879 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/models/shopfloor_menu.py
+-rw-r--r--  2.0 unx      166 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx       50 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/readme/CREDITS.rst
+-rw-r--r--  2.0 unx       77 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx       32 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/services/__init__.py
+-rw-r--r--  2.0 unx    37527 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/services/delivery_shipment.py
+-rw-r--r--  2.0 unx     9455 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/static/description/icon.png
+-rw-r--r--  2.0 unx    13386 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/static/description/index.html
+-rw-r--r--  2.0 unx      461 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/tests/__init__.py
+-rw-r--r--  2.0 unx     5706 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_base.py
+-rw-r--r--  2.0 unx     6893 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_loading_list.py
+-rw-r--r--  2.0 unx     3436 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_dock.py
+-rw-r--r--  2.0 unx    10666 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_lot.py
+-rw-r--r--  2.0 unx     7113 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_package.py
+-rw-r--r--  2.0 unx    10892 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_picking.py
+-rw-r--r--  2.0 unx    11477 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_product.py
+-rw-r--r--  2.0 unx     2713 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_unload.py
+-rw-r--r--  2.0 unx     6888 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_validate.py
+-rw-r--r--  2.0 unx      825 b- defN 23-Jun-28 11:43 odoo/addons/shopfloor_delivery_shipment/views/shopfloor_menu.xml
+-rw-r--r--  2.0 unx     4218 b- defN 23-Jun-28 11:44 odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jun-28 11:44 odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Jun-28 11:44 odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     5171 b- defN 23-Jun-28 11:44 odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/RECORD
+42 files, 251971 bytes uncompressed, 111563 bytes compressed:  55.7%
```

## zipnote {}

```diff
@@ -108,20 +108,20 @@
 
 Filename: odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_validate.py
 Comment: 
 
 Filename: odoo/addons/shopfloor_delivery_shipment/views/shopfloor_menu.xml
 Comment: 
 
-Filename: odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/METADATA
+Filename: odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/WHEEL
+Filename: odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/top_level.txt
+Filename: odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/RECORD
+Filename: odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/shopfloor_delivery_shipment/__manifest__.py

```diff
@@ -1,13 +1,13 @@
 # Copyright 2021 Camptocamp SA
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl)
 {
     "name": "Shopfloor - Delivery with shipment advice",
     "summary": "Manage delivery process with shipment advices",
-    "version": "14.0.1.2.0",
+    "version": "14.0.1.3.0",
     "development_status": "Alpha",
     "category": "Inventory",
     "website": "https://github.com/OCA/wms",
     "author": "Camptocamp, Odoo Community Association (OCA)",
     "maintainers": ["sebalix", "TDu"],
     "license": "AGPL-3",
     "application": False,
```

## odoo/addons/shopfloor_delivery_shipment/actions/data.py

```diff
@@ -49,11 +49,15 @@
     def pickings_loaded(self, record, **kw):
         return self.picking_loaded(record, multi=True)
 
     @property
     def _picking_loaded_parser(self):
         return self._picking_parser + [
             "loaded_progress_f",
+            "loaded_packages_progress_f",
+            "loaded_move_lines_progress_f",
             "loaded_progress",
+            "loaded_packages_progress",
+            "loaded_move_lines_progress",
             "is_fully_loaded_in_shipment:is_fully_loaded",
             "is_partially_loaded_in_shipment:is_partially_loaded",
         ]
```

## odoo/addons/shopfloor_delivery_shipment/actions/schema.py

```diff
@@ -24,19 +24,39 @@
         schema.update(
             {
                 "loaded_progress_f": {
                     "type": "float",
                     "nullable": False,
                     "required": True,
                 },
+                "loaded_packages_progress_f": {
+                    "type": "float",
+                    "nullable": False,
+                    "required": True,
+                },
+                "loaded_move_lines_progress_f": {
+                    "type": "float",
+                    "nullable": False,
+                    "required": True,
+                },
                 "loaded_progress": {
                     "type": "string",
                     "nullable": False,
                     "required": True,
                 },
+                "loaded_packages_progress": {
+                    "type": "string",
+                    "nullable": False,
+                    "required": True,
+                },
+                "loaded_move_lines_progress": {
+                    "type": "string",
+                    "nullable": False,
+                    "required": True,
+                },
                 "is_fully_loaded": {
                     "type": "boolean",
                     "nullable": False,
                     "required": True,
                 },
                 "is_partially_loaded": {
                     "type": "boolean",
```

## odoo/addons/shopfloor_delivery_shipment/services/delivery_shipment.py

```diff
@@ -416,15 +416,21 @@
     def _response_for_scan_document(self, shipment_advice, picking=None, message=None):
         data = {
             "shipment_advice": self.data.shipment_advice(shipment_advice),
         }
         if picking:
             data.update(
                 picking=self.data.picking(picking),
-                content=self._data_for_content_to_load(shipment_advice, picking),
+                content=self._data_for_content_to_load_from_picking(
+                    shipment_advice, picking
+                ),
+            )
+        else:
+            data.update(
+                content=self._data_for_content_to_load_from_pickings(shipment_advice),
             )
         return self._response(next_state="scan_document", data=data, message=message)
 
     def _response_for_loading_list(self, shipment_advice, message=None):
         data = {
             "shipment_advice": self.data.shipment_advice(shipment_advice),
             "lading": self._data_for_lading(shipment_advice),
@@ -455,35 +461,76 @@
         data = {
             "shipment_advice": self.data.shipment_advice(shipment_advice),
             "lading": self._data_for_lading_summary(shipment_advice),
             "on_dock": self._data_for_on_dock_summary(shipment_advice),
         }
         return self._response(next_state="validate", data=data, message=message)
 
-    def _data_for_content_to_load(self, shipment_advice, picking):
-        """Return a tuple list of dictionaries where keys are source locations
+    def _data_for_content_to_load_from_pickings(self, shipment_advice):
+        """Return goods to load from transfers partially loaded in a shipment.
+
+        It returns a dict where keys are source locations and values are
+        dictionaries listing package_levels and move_lines that remain to load
+        from transfers partially loaded in a shipment.
+
+        E.g:
+            {
+                "SRC_LOCATION1": {
+                    "package_levels": [{PKG_LEVEL_DATA}, ...],
+                    "move_lines": [{MOVE_LINE_DATA}, ...],
+                },
+                "SRC_LOCATION2": {
+                    ...
+                },
+            }
+        """
+        domain = self._find_move_lines_domain(shipment_advice)
+        # Restrict to lines not loaded
+        domain.insert(0, ("shipment_advice_id", "=", False))
+        # Find lines to load from partially loaded transfers if the shipment
+        # is not planned.
+        if not shipment_advice.planned_move_ids:
+            all_lines_to_load = self.env["stock.move.line"].search(domain)
+            all_pickings = all_lines_to_load.picking_id
+            loaded_lines = self.env["stock.move.line"].search(
+                [
+                    ("picking_id", "in", all_pickings.ids),
+                    ("id", "not in", all_lines_to_load.ids),
+                    ("shipment_advice_id", "!=", False),
+                ]
+            )
+            pickings_partially_loaded = loaded_lines.picking_id
+            domain += [("picking_id", "in", pickings_partially_loaded.ids)]
+        move_lines = self.env["stock.move.line"].search(domain)
+        return self._prepare_data_for_content(move_lines)
+
+    def _data_for_content_to_load_from_picking(self, shipment_advice, picking):
+        """Return a dictionary where keys are source locations
         and values are dictionaries listing package_levels and move_lines
         loaded or to load.
 
         E.g:
             {
                 "SRC_LOCATION1": {
                     "package_levels": [{PKG_LEVEL_DATA}, ...],
                     "move_lines": [{MOVE_LINE_DATA}, ...],
                 },
                 "SRC_LOCATION2": {
                     ...
                 },
             }
         """
-        data = collections.OrderedDict()
         # Grab move lines to sort, restricted to the current delivery
         move_lines = self._find_move_lines_to_process_from_picking(
             shipment_advice, picking
         )
+        return self._prepare_data_for_content(move_lines)
+
+    def _prepare_data_for_content(self, move_lines):
+        data = collections.OrderedDict()
         package_level_ids = []
         # Sort and group move lines by source location and prepare the data
         for move_line in move_lines.sorted(lambda ml: ml.location_id.name):
             location_data = data.setdefault(move_line.location_id.name, {})
             if move_line.package_level_id:
                 pl_data = location_data.setdefault("package_levels", [])
                 if move_line.package_level_id.id in package_level_ids:
@@ -590,42 +637,17 @@
         return moves.move_line_ids.filtered(
             lambda ml: not ml.shipment_advice_id
             or shipment_advice & ml.shipment_advice_id
         )
 
     def _find_move_lines_domain(self, shipment_advice):
         """Returns the base domain to look for move lines for a given shipment."""
-        domain = [
-            ("state", "in", ("assigned", "partially_available")),
-            ("picking_code", "=", "outgoing"),
-            ("picking_id.picking_type_id", "in", self.picking_types.ids),
-            "|",
-            ("shipment_advice_id", "=", False),
-            ("shipment_advice_id", "=", shipment_advice.id),
-        ]
-        # Shipment with planned content, restrict the search to it
-        if shipment_advice.planned_move_ids:
-            domain.append(("move_id.shipment_advice_id", "=", shipment_advice.id))
-        # Shipment without planned content, search for all unplanned moves
-        else:
-            domain.append(("move_id.shipment_advice_id", "=", False))
-            # Restrict to shipment carrier delivery types (providers)
-            if shipment_advice.carrier_ids:
-                domain.extend(
-                    [
-                        "|",
-                        (
-                            "picking_id.carrier_id.delivery_type",
-                            "in",
-                            shipment_advice.carrier_ids.mapped("delivery_type"),
-                        ),
-                        ("picking_id.carrier_id", "=", False),
-                    ]
-                )
-        return domain
+        return shipment_advice.with_context(
+            shipment_picking_type_ids=self.picking_types.ids
+        )._find_move_lines_domain()  # Defined in `shipment_advice`
 
     def _find_move_lines_from_package(self, shipment_advice, package):
         """Returns the move line corresponding to `package` for the given shipment."""
         domain = self._find_move_lines_domain(shipment_advice)
         # FIXME should we check also result package here?
         domain.append(("package_id", "=", package.id))
         return self.env["stock.move.line"].search(domain)
```

## odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_base.py

```diff
@@ -99,24 +99,28 @@
             "confirmation_required": confirmation_required,
         }
         self.assert_response(
             response, next_state="scan_dock", data=data, message=message
         )
 
     def assert_response_scan_document(
-        self, response, shipment_advice, picking=None, message=None
+        self, response, shipment_advice, picking=None, lines_to_load=None, message=None
     ):
+        content = self.service._data_for_content_to_load_from_pickings(shipment_advice)
         data = {
             "shipment_advice": self._data_for_shipment_advice(shipment_advice),
+            "content": content,
         }
         if picking:
             data["picking"] = self.service.data.picking(picking)
-            data["content"] = self.service._data_for_content_to_load(
+            data["content"] = self.service._data_for_content_to_load_from_picking(
                 shipment_advice, picking
             )
+        if lines_to_load:
+            data["content"] = self.service._prepare_data_for_content(lines_to_load)
         self.assert_response(
             response,
             next_state="scan_document",
             data=data,
             message=message,
         )
```

## odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_dock.py

```diff
@@ -54,7 +54,31 @@
     def test_scan_dock_without_planned_content_ok(self):
         self.shipment.action_confirm()
         self.shipment.action_in_progress()
         response = self.service.dispatch(
             "scan_dock", params={"barcode": self.dock.barcode}
         )
         self.assert_response_scan_document(response, self.shipment)
+
+    def test_scan_dock_with_partially_loaded_transfers(self):
+        package_level = self.picking1.package_level_ids
+        scanned_package = package_level.package_id
+        # Load partially a transfer
+        self.shipment.action_confirm()
+        self.shipment.action_in_progress()
+        response = self.service.dispatch(
+            "scan_document",
+            params={
+                "shipment_advice_id": self.shipment.id,
+                "barcode": scanned_package.name,
+            },
+        )
+        # Scan the dock to check the content to load among partially loaded transfers
+        response = self.service.dispatch(
+            "scan_dock", params={"barcode": self.dock.barcode}
+        )
+        lines_to_load = self.picking1.move_line_ids.filtered(
+            lambda l: l.package_id != scanned_package
+        )
+        self.assert_response_scan_document(
+            response, self.shipment, lines_to_load=lines_to_load
+        )
```

## Comparing `odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/METADATA` & `odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo14-addon-shopfloor-delivery-shipment
-Version: 14.0.1.2.0
+Version: 14.0.1.3.0
 Summary: Manage delivery process with shipment advices
 Home-page: https://github.com/OCA/wms
 Author: Camptocamp, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
```

## Comparing `odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/RECORD` & `odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/RECORD`

 * *Files 9% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 odoo/addons/shopfloor_delivery_shipment/README.rst,sha256=18X7we2ixQsRmSNAtlOQKrarg9NaogIG6ZHf1kjm9_o,3530
 odoo/addons/shopfloor_delivery_shipment/__init__.py,sha256=tl4zYJfl6P_lNxq21AU5Fp9fXCta2TZi0LWY7VOnVaA,66
-odoo/addons/shopfloor_delivery_shipment/__manifest__.py,sha256=M2REkmQZNtCz171SamQl-y7e9p25jQ_3sOCw5_DMXjs,798
+odoo/addons/shopfloor_delivery_shipment/__manifest__.py,sha256=nis7AC_LVR-CWk55HkPfGZTE2FsvVx6bxgZlhnQeGCM,798
 odoo/addons/shopfloor_delivery_shipment/actions/__init__.py,sha256=w2HuwP3UaixJXF2SPv97lqyXWyfUh1TaZeO3HHCmFb4,83
-odoo/addons/shopfloor_delivery_shipment/actions/data.py,sha256=4LJdpMzryxYlfQdAxlTwOCFafKnd9QaFMWj-h-MTn6U,1778
+odoo/addons/shopfloor_delivery_shipment/actions/data.py,sha256=J_n-Y7XQ-B_JSM_fxyzRGyk2bxsg9MuzuRsgW9T6cSk,1946
 odoo/addons/shopfloor_delivery_shipment/actions/message.py,sha256=yass3WFAVwybDvzP0-fZ_hK6URyUJSRpyti0N269b6M,5541
-odoo/addons/shopfloor_delivery_shipment/actions/schema.py,sha256=raih-LOOAxJejCBZSy0Pp2d3POXy0jDPJrb0ie51d8o,3019
+odoo/addons/shopfloor_delivery_shipment/actions/schema.py,sha256=wxg2EzqFOvH1GIUjayczweY1t4aPNrhxhwTeuNK67pA,3745
 odoo/addons/shopfloor_delivery_shipment/actions/search.py,sha256=cgddOIpmnCVZ0Bu3LqMXgfZzhHLWyPrqrLECws8YCuw,471
 odoo/addons/shopfloor_delivery_shipment/data/shopfloor_scenario_data.xml,sha256=HjTou6anOfs4utXp5ajdOEOBPBOJ_6fG3ir-Zl34eY4,329
 odoo/addons/shopfloor_delivery_shipment/demo/shopfloor_app_demo.xml,sha256=tqAzRijIm0KCfyIuaKH8wYIUDJR_uNQ_i4HLX5wPSgY,420
 odoo/addons/shopfloor_delivery_shipment/demo/shopfloor_menu_demo.xml,sha256=xChPGJDYaCPR5Dp4eYuuUn09nfDuLmpRqWQP9u616hE,563
 odoo/addons/shopfloor_delivery_shipment/demo/shopfloor_profile_demo.xml,sha256=3K9xsGbO1IsBwDgcn8xU_5OJKgnPzlNXV2khfl-cUuY,140
 odoo/addons/shopfloor_delivery_shipment/docs/delivery_shipment_diag_seq.plantuml,sha256=SqtWpkhFkECWLvNh2zAS4D8uTd2AbrfYgmySL2sjVmU,1472
 odoo/addons/shopfloor_delivery_shipment/docs/delivery_shipment_diag_seq.png,sha256=c4tl6a_vQVSaaGX1DCftbECNvEhUOyh6F9Ep1QPcrrE,71530
@@ -18,25 +18,25 @@
 odoo/addons/shopfloor_delivery_shipment/i18n/shopfloor_delivery_shipment.pot,sha256=aZjg-8IHaWBBIiojMndPNK2Liw9t5UWZbqjTuJaDVSc,6075
 odoo/addons/shopfloor_delivery_shipment/models/__init__.py,sha256=77HbicTBayh5mfyyU5oySGB0acR0Y2y65Bd3k2NL8ME,29
 odoo/addons/shopfloor_delivery_shipment/models/shopfloor_menu.py,sha256=sqah2mwEMWZAVpnXa1FADS6_vNcCbnukiFQe7NIJ6mk,879
 odoo/addons/shopfloor_delivery_shipment/readme/CONTRIBUTORS.rst,sha256=1sWUjtr5tx_S0fpT-lh83Ba__WU7XruMeSsZjfQ57jg,166
 odoo/addons/shopfloor_delivery_shipment/readme/CREDITS.rst,sha256=-JppA6kiiAVqptoc7ytAB6vOqf_0W5uJrZLh70XGE3w,50
 odoo/addons/shopfloor_delivery_shipment/readme/DESCRIPTION.rst,sha256=MkAPH_uaTw9qme6gOvEazXhylZLgvE91fdFdL960ByI,77
 odoo/addons/shopfloor_delivery_shipment/services/__init__.py,sha256=1_rJvRPWxNBbVl0yjnMxbkMD16bdQQXCk7vuGsSv0xU,32
-odoo/addons/shopfloor_delivery_shipment/services/delivery_shipment.py,sha256=eVnJAHWJrEUzir7JfWqJJ7PKNDBMAayuWXqBAGdGnpQ,36638
+odoo/addons/shopfloor_delivery_shipment/services/delivery_shipment.py,sha256=YybGw0kZKmZoMDc60Z2BprOKmbtdzhm292wk7J52Q28,37527
 odoo/addons/shopfloor_delivery_shipment/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
 odoo/addons/shopfloor_delivery_shipment/static/description/index.html,sha256=_HS-6aEIBuYzAcQ-Au4keDKH7ptuBwNiULdbR5SpMN8,13386
 odoo/addons/shopfloor_delivery_shipment/tests/__init__.py,sha256=UDfsIBuHZYkklJ2zv2BKqDadu_4Ow99m0do-8dWj81U,461
-odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_base.py,sha256=l5mrvPsEmCXrcCFbrHX1YE8CrzLUuytAHRM3d0MNHCc,5443
+odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_base.py,sha256=Z9JiLePqlUAdVNzGsawvJc2EtOA2F7eUopOzKhE0qn8,5706
 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_loading_list.py,sha256=p8ALsyTLn8HSv5zVfRv1WgLagycbIRO7NGfShvrYhNw,6893
-odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_dock.py,sha256=wyoMqnmckvOrEqb_U7A1NEkryiMT98uE984Pty09EKI,2480
+odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_dock.py,sha256=2Ds2zIzDp_hWGB3_Gtd4mnPjqwImZdAsruMprq0dKbE,3436
 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_lot.py,sha256=jmik_9THPUnj65vn3NRX4xejmLInMFK3Lihor1pb9O4,10666
 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_package.py,sha256=F41JvbYVjXbHGGh4YoM-G13RAoqUNNasmGIoB6MxvXg,7113
 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_picking.py,sha256=QITI3JaGmrH75FrsZplRcCTY5qmXJMtiXT9sEmHIfzg,10892
 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_scan_document_product.py,sha256=BD76tw7zk6psTMCkICxogudJ6by3HoDm08mWtsK8dsY,11477
 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_unload.py,sha256=JiJCWigGKObY61-7sHo4jcD2wv8N2x40fSWYlgSEdMk,2713
 odoo/addons/shopfloor_delivery_shipment/tests/test_delivery_shipment_validate.py,sha256=Hofr_XirtwyVOcDo5vB0gUwxSYX9CD5qTh1UzAwgLjE,6888
 odoo/addons/shopfloor_delivery_shipment/views/shopfloor_menu.xml,sha256=bRt7IZQ5pecps7PkKGnrC7Y7TLv71uypx1F9NN8L0tc,825
-odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/METADATA,sha256=FYo3zBuF_IdsFSNk5sPwWhT55v7qJ90Xij70DNRfE8Q,4218
-odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo14_addon_shopfloor_delivery_shipment-14.0.1.2.0.dist-info/RECORD,,
+odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/METADATA,sha256=ByQXaV_w3iU0UNCwzxaigL8aHW6R8J2woPDtJuU884s,4218
+odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo14_addon_shopfloor_delivery_shipment-14.0.1.3.0.dist-info/RECORD,,
```

