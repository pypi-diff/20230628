# Comparing `tmp/deepchem-2.7.2.dev20230627173354.tar.gz` & `tmp/deepchem-2.7.2.dev20230627202443.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "deepchem-2.7.2.dev20230627173354.tar", last modified: Tue Jun 27 17:33:55 2023, max compression
+gzip compressed data, was "deepchem-2.7.2.dev20230627202443.tar", last modified: Tue Jun 27 20:24:44 2023, max compression
```

## Comparing `deepchem-2.7.2.dev20230627173354.tar` & `deepchem-2.7.2.dev20230627202443.tar`

### file list

```diff
@@ -1,297 +1,297 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.256784 deepchem-2.7.2.dev20230627173354/
--rwxr-xr-x   0 runner    (1001) docker     (123)     1047 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-06-27 17:33:55.256784 deepchem-2.7.2.dev20230627173354/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     7124 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.228784 deepchem-2.7.2.dev20230627173354/deepchem/
--rw-r--r--   0 runner    (1001) docker     (123)      373 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.232784 deepchem-2.7.2.dev20230627173354/deepchem/data/
--rw-r--r--   0 runner    (1001) docker     (123)      939 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    67894 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/data/data_loader.py
--rw-r--r--   0 runner    (1001) docker     (123)   118009 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/data/datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     7256 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/data/pytorch_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    12606 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/data/supports.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.232784 deepchem-2.7.2.dev20230627173354/deepchem/dock/
--rw-r--r--   0 runner    (1001) docker     (123)      297 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/dock/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4910 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/dock/binding_pocket.py
--rw-r--r--   0 runner    (1001) docker     (123)     6105 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/dock/docking.py
--rw-r--r--   0 runner    (1001) docker     (123)    19576 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/dock/pose_generation.py
--rw-r--r--   0 runner    (1001) docker     (123)     6917 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/dock/pose_scoring.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.232784 deepchem-2.7.2.dev20230627173354/deepchem/feat/
--rw-r--r--   0 runner    (1001) docker     (123)     4457 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7335 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/atomic_conformation.py
--rw-r--r--   0 runner    (1001) docker     (123)    19458 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/base_classes.py
--rw-r--r--   0 runner    (1001) docker     (123)     1904 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/bert_tokenizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     4368 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/binding_pocket_features.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.232784 deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)     1400 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    12898 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py
--rw-r--r--   0 runner    (1001) docker     (123)    10769 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/contact_fingerprints.py
--rw-r--r--   0 runner    (1001) docker     (123)    27676 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/grid_featurizers.py
--rw-r--r--   0 runner    (1001) docker     (123)    20248 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    11465 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/splif_fingerprints.py
--rw-r--r--   0 runner    (1001) docker     (123)    11743 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/dft_data.py
--rw-r--r--   0 runner    (1001) docker     (123)    22111 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/graph_data.py
--rw-r--r--   0 runner    (1001) docker     (123)    38890 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/graph_features.py
--rw-r--r--   0 runner    (1001) docker     (123)     1396 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/huggingface_featurizer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.232784 deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)      489 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7539 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/cgcnn_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3508 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/element_property_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     3232 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/elemnet_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    28058 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/lcnn_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3823 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/sine_coulomb_matrix.py
--rw-r--r--   0 runner    (1001) docker     (123)    14808 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/mol_graphs.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.236784 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2884 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/atomic_coordinates.py
--rw-r--r--   0 runner    (1001) docker     (123)     2376 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py
--rw-r--r--   0 runner    (1001) docker     (123)     6488 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/circular_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     9448 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/conformer_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    10925 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/coulomb_matrices.py
--rw-r--r--   0 runner    (1001) docker     (123)    19123 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     7507 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/grover_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2046 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     8401 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/mat_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     7587 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)    20381 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     9346 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/molgan_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2835 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/mordred_descriptors.py
--rw-r--r--   0 runner    (1001) docker     (123)     6359 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/one_hot_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py
--rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/raw_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     9855 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/rdkit_descriptors.py
--rw-r--r--   0 runner    (1001) docker     (123)     7280 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/smiles_to_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     5433 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/smiles_to_seq.py
--rw-r--r--   0 runner    (1001) docker     (123)     4313 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/snap_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3448 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     3909 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/reaction_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2326 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/roberta_tokenizer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.236784 deepchem-2.7.2.dev20230627173354/deepchem/feat/sequence_featurizers/
--rw-r--r--   0 runner    (1001) docker     (123)      112 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/sequence_featurizers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3383 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py
--rw-r--r--   0 runner    (1001) docker     (123)    11383 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/smiles_tokenizer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.236784 deepchem-2.7.2.dev20230627173354/deepchem/feat/vocabulary_builders/
--rw-r--r--   0 runner    (1001) docker     (123)      278 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/vocabulary_builders/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    17291 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/vocabulary_builders/grover_vocab.py
--rw-r--r--   0 runner    (1001) docker     (123)     2315 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/vocabulary_builders/hf_vocab.py
--rw-r--r--   0 runner    (1001) docker     (123)     1116 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/feat/vocabulary_builders/vocabulary_builder.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.236784 deepchem-2.7.2.dev20230627173354/deepchem/hyper/
--rw-r--r--   0 runner    (1001) docker     (123)      260 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/hyper/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5702 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/hyper/base_classes.py
--rw-r--r--   0 runner    (1001) docker     (123)    17151 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/hyper/gaussian_process.py
--rw-r--r--   0 runner    (1001) docker     (123)    10208 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/hyper/grid_search.py
--rw-r--r--   0 runner    (1001) docker     (123)    12427 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/hyper/random_search.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.236784 deepchem-2.7.2.dev20230627173354/deepchem/metalearning/
--rw-r--r--   0 runner    (1001) docker     (123)      118 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/metalearning/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    10539 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/metalearning/maml.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.236784 deepchem-2.7.2.dev20230627173354/deepchem/metrics/
--rw-r--r--   0 runner    (1001) docker     (123)     2015 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/metrics/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7715 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/metrics/genomic_metrics.py
--rw-r--r--   0 runner    (1001) docker     (123)    31620 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/metrics/metric.py
--rw-r--r--   0 runner    (1001) docker     (123)     6533 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/metrics/score_function.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.240784 deepchem-2.7.2.dev20230627173354/deepchem/models/
--rw-r--r--   0 runner    (1001) docker     (123)     4780 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/IRV.py
--rw-r--r--   0 runner    (1001) docker     (123)     4420 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    13833 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/atomic_conv.py
--rw-r--r--   0 runner    (1001) docker     (123)     4414 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/callbacks.py
--rw-r--r--   0 runner    (1001) docker     (123)    17354 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/chemnet_layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    15504 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/chemnet_models.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.240784 deepchem-2.7.2.dev20230627173354/deepchem/models/dft/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/dft/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9553 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/dft/dftxc.py
--rw-r--r--   0 runner    (1001) docker     (123)     9576 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/dft/nnxc.py
--rw-r--r--   0 runner    (1001) docker     (123)     4664 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/dft/scf.py
--rw-r--r--   0 runner    (1001) docker     (123)    23457 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/fcnet.py
--rw-r--r--   0 runner    (1001) docker     (123)    24548 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/gan.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.240784 deepchem-2.7.2.dev20230627173354/deepchem/models/gbdt_models/
--rw-r--r--   0 runner    (1001) docker     (123)       75 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/gbdt_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5921 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/gbdt_models/gbdt_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    57408 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/graph_models.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.240784 deepchem-2.7.2.dev20230627173354/deepchem/models/jax_models/
--rw-r--r--   0 runner    (1001) docker     (123)      133 2023-06-27 17:33:43.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/jax_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    28179 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/jax_models/jax_model.py
--rw-r--r--   0 runner    (1001) docker     (123)     3408 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/jax_models/layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    17070 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/jax_models/pinns_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    56522 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/keras_model.py
--rw-r--r--   0 runner    (1001) docker     (123)   144759 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/layers.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.240784 deepchem-2.7.2.dev20230627173354/deepchem/models/lightning/
--rw-r--r--   0 runner    (1001) docker     (123)      181 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/lightning/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1742 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/lightning/dc_lightning_dataset_module.py
--rw-r--r--   0 runner    (1001) docker     (123)     2447 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/lightning/dc_lightning_module.py
--rw-r--r--   0 runner    (1001) docker     (123)    61903 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/losses.py
--rw-r--r--   0 runner    (1001) docker     (123)     8256 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/models.py
--rw-r--r--   0 runner    (1001) docker     (123)    14135 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/molgan.py
--rw-r--r--   0 runner    (1001) docker     (123)     5437 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/multitask.py
--rw-r--r--   0 runner    (1001) docker     (123)    10975 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/normalizing_flows.py
--rw-r--r--   0 runner    (1001) docker     (123)    26871 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/optimizers.py
--rw-r--r--   0 runner    (1001) docker     (123)    13095 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/progressive_multitask.py
--rw-r--r--   0 runner    (1001) docker     (123)    17830 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/robust_multitask.py
--rw-r--r--   0 runner    (1001) docker     (123)     4546 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/scscore.py
--rw-r--r--   0 runner    (1001) docker     (123)    25969 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/seqtoseq.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.240784 deepchem-2.7.2.dev20230627173354/deepchem/models/sklearn_models/
--rw-r--r--   0 runner    (1001) docker     (123)       87 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/sklearn_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5679 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/sklearn_models/sklearn_model.py
--rw-r--r--   0 runner    (1001) docker     (123)    10552 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/text_cnn.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.244784 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/
--rw-r--r--   0 runner    (1001) docker     (123)     2221 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3633 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/attention.py
--rw-r--r--   0 runner    (1001) docker     (123)    12226 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/attentivefp.py
--rw-r--r--   0 runner    (1001) docker     (123)    14455 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/cgcnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     5571 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/chemberta.py
--rw-r--r--   0 runner    (1001) docker     (123)     9543 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/cnn.py
--rw-r--r--   0 runner    (1001) docker     (123)    31166 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/dmpnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     7143 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/ferminet.py
--rw-r--r--   0 runner    (1001) docker     (123)    15845 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/gat.py
--rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/gcn.py
--rw-r--r--   0 runner    (1001) docker     (123)    51159 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/gnn.py
--rw-r--r--   0 runner    (1001) docker     (123)    25005 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/gnn3d.py
--rw-r--r--   0 runner    (1001) docker     (123)    38126 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/grover.py
--rw-r--r--   0 runner    (1001) docker     (123)    38432 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/grover_layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    22942 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/hf_models.py
--rw-r--r--   0 runner    (1001) docker     (123)    30077 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/infograph.py
--rw-r--r--   0 runner    (1001) docker     (123)    19215 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/kfac_optimizer.py
--rw-r--r--   0 runner    (1001) docker     (123)   121865 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/layers.py
--rw-r--r--   0 runner    (1001) docker     (123)    18575 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/lcnn.py
--rw-r--r--   0 runner    (1001) docker     (123)    17126 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/mat.py
--rw-r--r--   0 runner    (1001) docker     (123)    11170 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/megnet.py
--rw-r--r--   0 runner    (1001) docker     (123)    18122 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/modular.py
--rw-r--r--   0 runner    (1001) docker     (123)    12074 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/mpnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     4165 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/normalizing_flows_pytorch.py
--rw-r--r--   0 runner    (1001) docker     (123)    12297 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/pagtn.py
--rw-r--r--   0 runner    (1001) docker     (123)    23019 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/pna_gnn.py
--rw-r--r--   0 runner    (1001) docker     (123)     3528 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/readout.py
--rw-r--r--   0 runner    (1001) docker     (123)    52726 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/torch_model.py
--rw-r--r--   0 runner    (1001) docker     (123)     5249 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/models/wandblogger.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.244784 deepchem-2.7.2.dev20230627173354/deepchem/molnet/
--rw-r--r--   0 runner    (1001) docker     (123)     3339 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    11668 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/check_availability.py
--rw-r--r--   0 runner    (1001) docker     (123)     1845 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/defaults.py
--rw-r--r--   0 runner    (1001) docker     (123)    14702 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/dnasim.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.248784 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5375 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/bace_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    14202 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/bace_features.py
--rw-r--r--   0 runner    (1001) docker     (123)     5785 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/bbbc_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3604 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/bbbp_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2623 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/cell_counting_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4188 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/chembl25_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3706 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/chembl_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    10252 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/chembl_tasks.py
--rw-r--r--   0 runner    (1001) docker     (123)     2625 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/clearance_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4245 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/clintox_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3507 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/delaney_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6957 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/factors_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3523 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/freesolv_dataset.py
--rw-r--r--   0 runner    (1001) docker     (123)     3496 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/hiv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3437 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/hopv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2734 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/hppb_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6379 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/kaggle_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)   165414 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/kaggle_features.py
--rw-r--r--   0 runner    (1001) docker     (123)     8104 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/kinase_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3318 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/lipo_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     9165 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/load_dataset_template.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.248784 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4705 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py
--rw-r--r--   0 runner    (1001) docker     (123)     4474 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/load_bandgap.py
--rw-r--r--   0 runner    (1001) docker     (123)     4646 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py
--rw-r--r--   0 runner    (1001) docker     (123)     4589 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py
--rw-r--r--   0 runner    (1001) docker     (123)     4516 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/load_perovskite.py
--rw-r--r--   0 runner    (1001) docker     (123)     8680 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/molnet_loader.py
--rw-r--r--   0 runner    (1001) docker     (123)     3631 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/muv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3290 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/nci_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6927 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/pcba_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     8586 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/pdbbind_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2549 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/ppb_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4800 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/qm7_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     5045 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/qm8_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     5697 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/qm9_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3567 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/sampl_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     4640 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/sider_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3140 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/sweetlead_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2687 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/thermosol_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     3530 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/tox21_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)    18900 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/toxcast_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     7662 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/uspto_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6623 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/uv_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     2036 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/uv_tasks.py
--rw-r--r--   0 runner    (1001) docker     (123)     6895 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/zinc15_datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     5319 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/preset_hyper_parameters.py
--rw-r--r--   0 runner    (1001) docker     (123)    13549 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/run_benchmark.py
--rw-r--r--   0 runner    (1001) docker     (123)     4874 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/run_benchmark_low_data.py
--rw-r--r--   0 runner    (1001) docker     (123)    36564 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/molnet/run_benchmark_models.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.252784 deepchem-2.7.2.dev20230627173354/deepchem/rl/
--rw-r--r--   0 runner    (1001) docker     (123)     9312 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/rl/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    23102 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/rl/a2c.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.252784 deepchem-2.7.2.dev20230627173354/deepchem/rl/envs/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/rl/envs/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1773 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/rl/envs/test_tictactoe.py
--rw-r--r--   0 runner    (1001) docker     (123)     3632 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/rl/envs/tictactoe.py
--rw-r--r--   0 runner    (1001) docker     (123)    25262 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/rl/ppo.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.252784 deepchem-2.7.2.dev20230627173354/deepchem/splits/
--rw-r--r--   0 runner    (1001) docker     (123)     1384 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/splits/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    63895 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/splits/splitters.py
--rw-r--r--   0 runner    (1001) docker     (123)     4017 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/splits/task_splitter.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.252784 deepchem-2.7.2.dev20230627173354/deepchem/trans/
--rw-r--r--   0 runner    (1001) docker     (123)     1255 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/trans/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6571 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/trans/duplicate.py
--rw-r--r--   0 runner    (1001) docker     (123)    91191 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/trans/transformers.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.256784 deepchem-2.7.2.dev20230627173354/deepchem/utils/
--rw-r--r--   0 runner    (1001) docker     (123)     6141 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    10069 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/conformers.py
--rw-r--r--   0 runner    (1001) docker     (123)    13294 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/coordinate_box_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    20923 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/data_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     1840 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/debug_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3041 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/dftutils.py
--rw-r--r--   0 runner    (1001) docker     (123)    10476 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/docking_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    13528 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/electron_sampler.py
--rw-r--r--   0 runner    (1001) docker     (123)    19454 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/evaluate.py
--rw-r--r--   0 runner    (1001) docker     (123)     6134 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/fake_data_generator.py
--rw-r--r--   0 runner    (1001) docker     (123)    13312 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/fragment_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3903 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/genomics_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     8259 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/geometry_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     6033 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/graph_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     6554 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/grover.py
--rw-r--r--   0 runner    (1001) docker     (123)     3644 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/hash_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    19262 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/molecule_feature_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    17713 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/noncovalent_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    11749 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/pdbqt_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     4341 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/pytorch_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    65672 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/rdkit_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      552 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/save.py
--rw-r--r--   0 runner    (1001) docker     (123)     6815 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/sequence_utils.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.256784 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     6598 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_coordinate_box_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      788 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_data_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      896 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_dftutils.py
--rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_docking_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3309 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_electron_sampler.py
--rw-r--r--   0 runner    (1001) docker     (123)    12977 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_evaluate.py
--rw-r--r--   0 runner    (1001) docker     (123)     2481 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_fake_data_generator.py
--rw-r--r--   0 runner    (1001) docker     (123)     2610 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_fragment_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     4684 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_generator_evaluator.py
--rw-r--r--   0 runner    (1001) docker     (123)     1956 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_genomics_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3296 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_geometry_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      866 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_graph_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     1523 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_grover.py
--rw-r--r--   0 runner    (1001) docker     (123)     1476 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_hash_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     9115 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_molecule_feature_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     6251 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_noncovalent_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3922 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_pdbqt_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     1577 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_pytorch_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     9005 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_rdkit_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_sequence_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      386 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_updated_scipy.py
--rw-r--r--   0 runner    (1001) docker     (123)     2859 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_voxel_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)      919 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/typing.py
--rw-r--r--   0 runner    (1001) docker     (123)     1113 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/vina_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     7797 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/deepchem/utils/voxel_utils.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 17:33:55.228784 deepchem-2.7.2.dev20230627173354/deepchem.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-06-27 17:33:55.000000 deepchem-2.7.2.dev20230627173354/deepchem.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    10711 2023-06-27 17:33:55.000000 deepchem-2.7.2.dev20230627173354/deepchem.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-06-27 17:33:55.000000 deepchem-2.7.2.dev20230627173354/deepchem.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)      249 2023-06-27 17:33:55.000000 deepchem-2.7.2.dev20230627173354/deepchem.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        9 2023-06-27 17:33:55.000000 deepchem-2.7.2.dev20230627173354/deepchem.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (123)      701 2023-06-27 17:33:55.256784 deepchem-2.7.2.dev20230627173354/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     2670 2023-06-27 17:33:44.000000 deepchem-2.7.2.dev20230627173354/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.131404 deepchem-2.7.2.dev20230627202443/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1047 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-06-27 20:24:44.131404 deepchem-2.7.2.dev20230627202443/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     7124 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.083404 deepchem-2.7.2.dev20230627202443/deepchem/
+-rw-r--r--   0 runner    (1001) docker     (123)      373 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.087405 deepchem-2.7.2.dev20230627202443/deepchem/data/
+-rw-r--r--   0 runner    (1001) docker     (123)      939 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    67894 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/data/data_loader.py
+-rw-r--r--   0 runner    (1001) docker     (123)   118009 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/data/datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7256 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/data/pytorch_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12606 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/data/supports.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.087405 deepchem-2.7.2.dev20230627202443/deepchem/dock/
+-rw-r--r--   0 runner    (1001) docker     (123)      297 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/dock/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4910 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/dock/binding_pocket.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6105 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/dock/docking.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19576 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/dock/pose_generation.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6917 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/dock/pose_scoring.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.091405 deepchem-2.7.2.dev20230627202443/deepchem/feat/
+-rw-r--r--   0 runner    (1001) docker     (123)     4457 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7335 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/atomic_conformation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19458 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/base_classes.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1904 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/bert_tokenizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4368 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/binding_pocket_features.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.091405 deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)     1400 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12898 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10769 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/contact_fingerprints.py
+-rw-r--r--   0 runner    (1001) docker     (123)    27676 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/grid_featurizers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20248 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11465 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/splif_fingerprints.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11743 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/dft_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22111 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/graph_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    38890 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/graph_features.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1396 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/huggingface_featurizer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.091405 deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)      489 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7539 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/cgcnn_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3508 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/element_property_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3232 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/elemnet_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28058 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/lcnn_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3823 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/sine_coulomb_matrix.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14808 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/mol_graphs.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.095404 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2884 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/atomic_coordinates.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2376 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6488 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/circular_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9448 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/conformer_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10925 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/coulomb_matrices.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19123 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7507 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/grover_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2046 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8401 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/mat_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7587 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20381 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9346 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/molgan_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2835 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/mordred_descriptors.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6359 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/one_hot_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1687 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/raw_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9855 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/rdkit_descriptors.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7280 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/smiles_to_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5433 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/smiles_to_seq.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4313 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/snap_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3448 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3909 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/reaction_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2326 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/roberta_tokenizer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.095404 deepchem-2.7.2.dev20230627202443/deepchem/feat/sequence_featurizers/
+-rw-r--r--   0 runner    (1001) docker     (123)      112 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/sequence_featurizers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3383 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11383 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/smiles_tokenizer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.095404 deepchem-2.7.2.dev20230627202443/deepchem/feat/vocabulary_builders/
+-rw-r--r--   0 runner    (1001) docker     (123)      278 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/vocabulary_builders/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17291 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/vocabulary_builders/grover_vocab.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2315 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/vocabulary_builders/hf_vocab.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1116 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/feat/vocabulary_builders/vocabulary_builder.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.099404 deepchem-2.7.2.dev20230627202443/deepchem/hyper/
+-rw-r--r--   0 runner    (1001) docker     (123)      260 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/hyper/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5702 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/hyper/base_classes.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17151 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/hyper/gaussian_process.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10208 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/hyper/grid_search.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12427 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/hyper/random_search.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.099404 deepchem-2.7.2.dev20230627202443/deepchem/metalearning/
+-rw-r--r--   0 runner    (1001) docker     (123)      118 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/metalearning/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10539 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/metalearning/maml.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.099404 deepchem-2.7.2.dev20230627202443/deepchem/metrics/
+-rw-r--r--   0 runner    (1001) docker     (123)     2015 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/metrics/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7715 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/metrics/genomic_metrics.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31620 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/metrics/metric.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6533 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/metrics/score_function.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.103405 deepchem-2.7.2.dev20230627202443/deepchem/models/
+-rw-r--r--   0 runner    (1001) docker     (123)     4780 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/IRV.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4420 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13833 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/atomic_conv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4414 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/callbacks.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17354 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/chemnet_layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15504 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/chemnet_models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.103405 deepchem-2.7.2.dev20230627202443/deepchem/models/dft/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/dft/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9553 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/dft/dftxc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9576 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/dft/nnxc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4664 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/dft/scf.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23457 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/fcnet.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24548 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/gan.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.103405 deepchem-2.7.2.dev20230627202443/deepchem/models/gbdt_models/
+-rw-r--r--   0 runner    (1001) docker     (123)       75 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/gbdt_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5921 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/gbdt_models/gbdt_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    57408 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/graph_models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.103405 deepchem-2.7.2.dev20230627202443/deepchem/models/jax_models/
+-rw-r--r--   0 runner    (1001) docker     (123)      133 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/jax_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28179 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/jax_models/jax_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3408 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/jax_models/layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17070 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/jax_models/pinns_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    56522 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/keras_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)   144759 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/layers.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.107405 deepchem-2.7.2.dev20230627202443/deepchem/models/lightning/
+-rw-r--r--   0 runner    (1001) docker     (123)      181 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/lightning/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1742 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/lightning/dc_lightning_dataset_module.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2447 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/lightning/dc_lightning_module.py
+-rw-r--r--   0 runner    (1001) docker     (123)    61903 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/losses.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8256 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/models.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14135 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/molgan.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5437 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/multitask.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10975 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/normalizing_flows.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26871 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/optimizers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13095 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/progressive_multitask.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17830 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/robust_multitask.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4546 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/scscore.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25969 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/seqtoseq.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.107405 deepchem-2.7.2.dev20230627202443/deepchem/models/sklearn_models/
+-rw-r--r--   0 runner    (1001) docker     (123)       87 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/sklearn_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5679 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/sklearn_models/sklearn_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10552 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/text_cnn.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.111405 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/
+-rw-r--r--   0 runner    (1001) docker     (123)     2233 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3633 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/attention.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12226 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/attentivefp.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14455 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/cgcnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5571 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/chemberta.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9543 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/cnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    31166 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/dmpnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7143 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/ferminet.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15845 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/gat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14944 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/gcn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    51159 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/gnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25005 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/gnn3d.py
+-rw-r--r--   0 runner    (1001) docker     (123)    38126 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/grover.py
+-rw-r--r--   0 runner    (1001) docker     (123)    38432 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/grover_layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22942 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/hf_models.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30077 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/infograph.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19215 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/kfac_optimizer.py
+-rw-r--r--   0 runner    (1001) docker     (123)   135736 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/layers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18575 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/lcnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17126 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/mat.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11170 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/megnet.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18122 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/modular.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12074 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/mpnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4165 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/normalizing_flows_pytorch.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12297 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/pagtn.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23019 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/pna_gnn.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3528 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/readout.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52726 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/torch_model.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5249 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/models/wandblogger.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.111405 deepchem-2.7.2.dev20230627202443/deepchem/molnet/
+-rw-r--r--   0 runner    (1001) docker     (123)     3339 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11668 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/check_availability.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1845 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/defaults.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14702 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/dnasim.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.119405 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5375 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/bace_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14202 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/bace_features.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5785 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/bbbc_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3604 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/bbbp_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2623 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/cell_counting_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4188 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/chembl25_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3706 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/chembl_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10252 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/chembl_tasks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2625 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/clearance_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4245 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/clintox_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3507 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/delaney_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6957 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/factors_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3523 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/freesolv_dataset.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3496 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/hiv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3437 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/hopv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2734 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/hppb_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6379 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/kaggle_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)   165414 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/kaggle_features.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8104 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/kinase_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3318 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/lipo_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9165 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/load_dataset_template.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.119405 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4705 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4474 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/load_bandgap.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4646 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4589 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4516 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/load_perovskite.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8680 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/molnet_loader.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3631 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/muv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3290 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/nci_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6927 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/pcba_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8586 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/pdbbind_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2549 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/ppb_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4800 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/qm7_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5045 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/qm8_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5697 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/qm9_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3567 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/sampl_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4640 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/sider_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3140 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/sweetlead_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2687 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/thermosol_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3530 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/tox21_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18900 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/toxcast_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7662 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/uspto_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6623 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/uv_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2036 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/uv_tasks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6895 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/zinc15_datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5319 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/preset_hyper_parameters.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13549 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/run_benchmark.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4874 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/run_benchmark_low_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)    36564 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/molnet/run_benchmark_models.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.119405 deepchem-2.7.2.dev20230627202443/deepchem/rl/
+-rw-r--r--   0 runner    (1001) docker     (123)     9312 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/rl/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23102 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/rl/a2c.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.119405 deepchem-2.7.2.dev20230627202443/deepchem/rl/envs/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/rl/envs/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1773 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/rl/envs/test_tictactoe.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3632 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/rl/envs/tictactoe.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25262 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/rl/ppo.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.123405 deepchem-2.7.2.dev20230627202443/deepchem/splits/
+-rw-r--r--   0 runner    (1001) docker     (123)     1384 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/splits/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    63895 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/splits/splitters.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4017 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/splits/task_splitter.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.123405 deepchem-2.7.2.dev20230627202443/deepchem/trans/
+-rw-r--r--   0 runner    (1001) docker     (123)     1255 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/trans/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6571 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/trans/duplicate.py
+-rw-r--r--   0 runner    (1001) docker     (123)    91191 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/trans/transformers.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.127405 deepchem-2.7.2.dev20230627202443/deepchem/utils/
+-rw-r--r--   0 runner    (1001) docker     (123)     6141 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10069 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/conformers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13294 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/coordinate_box_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20923 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/data_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1840 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/debug_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3041 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/dftutils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10476 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/docking_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13528 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/electron_sampler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19454 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/evaluate.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6134 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/fake_data_generator.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13312 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/fragment_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3903 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/genomics_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8259 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/geometry_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6033 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/graph_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6554 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/grover.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3644 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/hash_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19262 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/molecule_feature_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17713 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/noncovalent_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11749 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/pdbqt_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4341 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/pytorch_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65672 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/rdkit_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      552 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/save.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6815 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/sequence_utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.131404 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6598 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_coordinate_box_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      788 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_data_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      896 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_dftutils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_docking_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3309 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_electron_sampler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12977 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_evaluate.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2481 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_fake_data_generator.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2610 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_fragment_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4684 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_generator_evaluator.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1956 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_genomics_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3296 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_geometry_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      866 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_graph_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1523 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_grover.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1476 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_hash_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9115 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_molecule_feature_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6251 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_noncovalent_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3922 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_pdbqt_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1577 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_pytorch_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9005 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_rdkit_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2388 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_sequence_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      386 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_updated_scipy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2859 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_voxel_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)      919 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/typing.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1113 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/vina_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7797 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/deepchem/utils/voxel_utils.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-27 20:24:44.087405 deepchem-2.7.2.dev20230627202443/deepchem.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     1072 2023-06-27 20:24:44.000000 deepchem-2.7.2.dev20230627202443/deepchem.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    10711 2023-06-27 20:24:44.000000 deepchem-2.7.2.dev20230627202443/deepchem.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-06-27 20:24:44.000000 deepchem-2.7.2.dev20230627202443/deepchem.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      249 2023-06-27 20:24:44.000000 deepchem-2.7.2.dev20230627202443/deepchem.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        9 2023-06-27 20:24:44.000000 deepchem-2.7.2.dev20230627202443/deepchem.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      701 2023-06-27 20:24:44.131404 deepchem-2.7.2.dev20230627202443/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     2670 2023-06-27 20:24:31.000000 deepchem-2.7.2.dev20230627202443/setup.py
```

### Comparing `deepchem-2.7.2.dev20230627173354/LICENSE` & `deepchem-2.7.2.dev20230627202443/LICENSE`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/PKG-INFO` & `deepchem-2.7.2.dev20230627202443/PKG-INFO`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: deepchem
-Version: 2.7.2.dev20230627173354
+Version: 2.7.2.dev20230627202443
 Summary: Deep learning models for drug discovery,         quantum chemistry, and the life sciences.
 Home-page: https://github.com/deepchem/deepchem
 Maintainer: DeepChem contributors
 License: MIT
 Project-URL: Documentation, https://deepchem.readthedocs.io/en/latest/
 Project-URL: Source, https://github.com/deepchem/deepchem
 Keywords: deepchem,chemistry,biology,materials-science,life-science,drug-discovery
```

### Comparing `deepchem-2.7.2.dev20230627173354/README.md` & `deepchem-2.7.2.dev20230627202443/README.md`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/data/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/data/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/data/data_loader.py` & `deepchem-2.7.2.dev20230627202443/deepchem/data/data_loader.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/data/datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/data/datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/data/pytorch_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/data/pytorch_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/data/supports.py` & `deepchem-2.7.2.dev20230627202443/deepchem/data/supports.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/dock/binding_pocket.py` & `deepchem-2.7.2.dev20230627202443/deepchem/dock/binding_pocket.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/dock/docking.py` & `deepchem-2.7.2.dev20230627202443/deepchem/dock/docking.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/dock/pose_generation.py` & `deepchem-2.7.2.dev20230627202443/deepchem/dock/pose_generation.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/dock/pose_scoring.py` & `deepchem-2.7.2.dev20230627202443/deepchem/dock/pose_scoring.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/atomic_conformation.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/atomic_conformation.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/base_classes.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/base_classes.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/bert_tokenizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/bert_tokenizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/binding_pocket_features.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/binding_pocket_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/complex_atomic_coordinates.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/contact_fingerprints.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/contact_fingerprints.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/grid_featurizers.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/grid_featurizers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/rdkit_grid_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/complex_featurizers/splif_fingerprints.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/complex_featurizers/splif_fingerprints.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/dft_data.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/dft_data.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/graph_data.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/graph_data.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/graph_features.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/graph_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/huggingface_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/huggingface_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/cgcnn_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/cgcnn_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/element_property_fingerprint.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/element_property_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/elemnet_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/elemnet_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/lcnn_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/lcnn_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/material_featurizers/sine_coulomb_matrix.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/material_featurizers/sine_coulomb_matrix.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/mol_graphs.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/mol_graphs.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/atomic_coordinates.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/atomic_coordinates.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/bp_symmetry_function_input.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/circular_fingerprint.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/circular_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/conformer_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/conformer_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/coulomb_matrices.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/coulomb_matrices.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/dmpnn_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/grover_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/grover_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/maccs_keys_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/mat_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/mat_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/mol2vec_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/mol_graph_conv_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/molgan_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/molgan_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/mordred_descriptors.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/mordred_descriptors.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/one_hot_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/one_hot_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/pubchem_fingerprint.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/raw_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/raw_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/rdkit_descriptors.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/rdkit_descriptors.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/smiles_to_image.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/smiles_to_image.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/smiles_to_seq.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/smiles_to_seq.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/snap_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/snap_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/molecule_featurizers/sparse_matrix_one_hot_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/reaction_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/reaction_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/roberta_tokenizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/roberta_tokenizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/sequence_featurizers/position_frequency_matrix_featurizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/smiles_tokenizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/smiles_tokenizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/vocabulary_builders/grover_vocab.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/vocabulary_builders/grover_vocab.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/vocabulary_builders/hf_vocab.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/vocabulary_builders/hf_vocab.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/feat/vocabulary_builders/vocabulary_builder.py` & `deepchem-2.7.2.dev20230627202443/deepchem/feat/vocabulary_builders/vocabulary_builder.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/hyper/base_classes.py` & `deepchem-2.7.2.dev20230627202443/deepchem/hyper/base_classes.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/hyper/gaussian_process.py` & `deepchem-2.7.2.dev20230627202443/deepchem/hyper/gaussian_process.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/hyper/grid_search.py` & `deepchem-2.7.2.dev20230627202443/deepchem/hyper/grid_search.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/hyper/random_search.py` & `deepchem-2.7.2.dev20230627202443/deepchem/hyper/random_search.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/metalearning/maml.py` & `deepchem-2.7.2.dev20230627202443/deepchem/metalearning/maml.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/metrics/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/metrics/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/metrics/genomic_metrics.py` & `deepchem-2.7.2.dev20230627202443/deepchem/metrics/genomic_metrics.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/metrics/metric.py` & `deepchem-2.7.2.dev20230627202443/deepchem/metrics/metric.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/metrics/score_function.py` & `deepchem-2.7.2.dev20230627202443/deepchem/metrics/score_function.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/IRV.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/IRV.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/atomic_conv.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/atomic_conv.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/callbacks.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/callbacks.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/chemnet_layers.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/chemnet_layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/chemnet_models.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/chemnet_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/dft/dftxc.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/dft/dftxc.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/dft/nnxc.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/dft/nnxc.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/dft/scf.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/dft/scf.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/fcnet.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/fcnet.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/gan.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/gan.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/gbdt_models/gbdt_model.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/gbdt_models/gbdt_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/graph_models.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/graph_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/jax_models/jax_model.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/jax_models/jax_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/jax_models/layers.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/jax_models/layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/jax_models/pinns_model.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/jax_models/pinns_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/keras_model.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/keras_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/layers.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/lightning/dc_lightning_dataset_module.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/lightning/dc_lightning_dataset_module.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/lightning/dc_lightning_module.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/lightning/dc_lightning_module.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/losses.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/losses.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/models.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/molgan.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/molgan.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/multitask.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/multitask.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/normalizing_flows.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/normalizing_flows.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/optimizers.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/optimizers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/progressive_multitask.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/progressive_multitask.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/robust_multitask.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/robust_multitask.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/scscore.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/scscore.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/seqtoseq.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/seqtoseq.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/sklearn_models/sklearn_model.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/sklearn_models/sklearn_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/text_cnn.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/text_cnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/__init__.py`

 * *Files 5% similar despite different names*

```diff
@@ -12,15 +12,15 @@
 from deepchem.models.torch_models.infograph import InfoGraphStar, InfoGraphStarModel, InfoGraphEncoder, GINEncoder, InfoGraph, InfoGraphModel, InfoGraphEncoder
 from deepchem.models.torch_models.mpnn import MPNN, MPNNModel
 from deepchem.models.torch_models.lcnn import LCNN, LCNNModel
 from deepchem.models.torch_models.pagtn import Pagtn, PagtnModel
 from deepchem.models.torch_models.mat import MAT, MATModel
 from deepchem.models.torch_models.megnet import MEGNetModel
 from deepchem.models.torch_models.normalizing_flows_pytorch import NormalizingFlow
-from deepchem.models.torch_models.layers import MultilayerPerceptron, CNNModule, CombineMeanStd, WeightedLinearCombo, AtomicConvolution, NeighborList, SetGather, EdgeNetwork
+from deepchem.models.torch_models.layers import MultilayerPerceptron, CNNModule, CombineMeanStd, WeightedLinearCombo, AtomicConvolution, NeighborList, SetGather, EdgeNetwork, WeaveLayer
 from deepchem.models.torch_models.cnn import CNN
 from deepchem.models.torch_models.attention import ScaledDotProductAttention, SelfAttention
 from deepchem.models.torch_models.grover import GroverModel, GroverPretrain, GroverFinetune
 from deepchem.models.torch_models.readout import GroverReadout
 try:
     from deepchem.models.torch_models.dmpnn import DMPNN, DMPNNModel
     from deepchem.models.torch_models.gnn import GNN, GNNHead, GNNModular
```

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/attention.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/attention.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/attentivefp.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/attentivefp.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/cgcnn.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/cgcnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/chemberta.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/chemberta.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/cnn.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/cnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/dmpnn.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/dmpnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/ferminet.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/ferminet.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/gat.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/gat.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/gcn.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/gcn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/gnn.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/gnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/gnn3d.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/gnn3d.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/grover.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/grover.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/grover_layers.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/grover_layers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/hf_models.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/hf_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/infograph.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/infograph.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/kfac_optimizer.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/kfac_optimizer.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/layers.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/layers.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,7617 +1,8484 @@
 00000000: 696d 706f 7274 206d 6174 680a 696d 706f  import math.impo
 00000010: 7274 206e 756d 7079 2061 7320 6e70 0a66  rt numpy as np.f
 00000020: 726f 6d20 7479 7069 6e67 2069 6d70 6f72  rom typing impor
 00000030: 7420 416e 792c 2054 7570 6c65 2c20 4f70  t Any, Tuple, Op
 00000040: 7469 6f6e 616c 2c20 5365 7175 656e 6365  tional, Sequence
 00000050: 2c20 4c69 7374 2c20 556e 696f 6e2c 2043  , List, Union, C
-00000060: 616c 6c61 626c 650a 6672 6f6d 2063 6f6c  allable.from col
-00000070: 6c65 6374 696f 6e73 2e61 6263 2069 6d70  lections.abc imp
-00000080: 6f72 7420 5365 7175 656e 6365 2061 7320  ort Sequence as 
-00000090: 5365 7175 656e 6365 436f 6c6c 6563 7469  SequenceCollecti
-000000a0: 6f6e 0a74 7279 3a0a 2020 2020 696d 706f  on.try:.    impo
-000000b0: 7274 2074 6f72 6368 0a20 2020 2066 726f  rt torch.    fro
-000000c0: 6d20 746f 7263 6820 696d 706f 7274 2054  m torch import T
-000000d0: 656e 736f 720a 2020 2020 696d 706f 7274  ensor.    import
-000000e0: 2074 6f72 6368 2e6e 6e20 6173 206e 6e0a   torch.nn as nn.
-000000f0: 2020 2020 696d 706f 7274 2074 6f72 6368      import torch
-00000100: 2e6e 6e2e 6675 6e63 7469 6f6e 616c 2061  .nn.functional a
-00000110: 7320 460a 6578 6365 7074 204d 6f64 756c  s F.except Modul
-00000120: 654e 6f74 466f 756e 6445 7272 6f72 3a0a  eNotFoundError:.
-00000130: 2020 2020 7261 6973 6520 496d 706f 7274      raise Import
-00000140: 4572 726f 7228 2754 6865 7365 2063 6c61  Error('These cla
-00000150: 7373 6573 2072 6571 7569 7265 2050 7954  sses require PyT
-00000160: 6f72 6368 2074 6f20 6265 2069 6e73 7461  orch to be insta
-00000170: 6c6c 6564 2e27 290a 0a74 7279 3a0a 2020  lled.')..try:.  
-00000180: 2020 6672 6f6d 2074 6f72 6368 5f67 656f    from torch_geo
-00000190: 6d65 7472 6963 2e75 7469 6c73 2069 6d70  metric.utils imp
-000001a0: 6f72 7420 7363 6174 7465 720a 6578 6365  ort scatter.exce
-000001b0: 7074 204d 6f64 756c 654e 6f74 466f 756e  pt ModuleNotFoun
-000001c0: 6445 7272 6f72 3a0a 2020 2020 7061 7373  dError:.    pass
-000001d0: 0a0a 6672 6f6d 2064 6565 7063 6865 6d2e  ..from deepchem.
-000001e0: 7574 696c 732e 7479 7069 6e67 2069 6d70  utils.typing imp
-000001f0: 6f72 7420 4f6e 654f 724d 616e 792c 2041  ort OneOrMany, A
-00000200: 6374 6976 6174 696f 6e46 6e2c 2041 7272  ctivationFn, Arr
-00000210: 6179 4c69 6b65 0a66 726f 6d20 6465 6570  ayLike.from deep
-00000220: 6368 656d 2e75 7469 6c73 2e70 7974 6f72  chem.utils.pytor
-00000230: 6368 5f75 7469 6c73 2069 6d70 6f72 7420  ch_utils import 
-00000240: 6765 745f 6163 7469 7661 7469 6f6e 2c20  get_activation, 
-00000250: 7365 676d 656e 745f 7375 6d0a 6672 6f6d  segment_sum.from
-00000260: 2074 6f72 6368 2e6e 6e20 696d 706f 7274   torch.nn import
-00000270: 2069 6e69 7420 6173 2069 6e69 7469 616c   init as initial
-00000280: 697a 6572 730a 0a0a 636c 6173 7320 4d75  izers...class Mu
-00000290: 6c74 696c 6179 6572 5065 7263 6570 7472  ltilayerPerceptr
-000002a0: 6f6e 286e 6e2e 4d6f 6475 6c65 293a 0a20  on(nn.Module):. 
-000002b0: 2020 2022 2222 4120 7369 6d70 6c65 2066     """A simple f
-000002c0: 756c 6c79 2063 6f6e 6e65 6374 6564 2066  ully connected f
-000002d0: 6565 642d 666f 7277 6172 6420 6e65 7477  eed-forward netw
-000002e0: 6f72 6b2c 206f 7468 6572 7769 7365 206b  ork, otherwise k
-000002f0: 6e6f 776e 2061 7320 6120 6d75 6c74 696c  nown as a multil
-00000300: 6179 6572 2070 6572 6365 7074 726f 6e20  ayer perceptron 
-00000310: 284d 4c50 292e 0a0a 2020 2020 4578 616d  (MLP)...    Exam
-00000320: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
-00000330: 2d0a 2020 2020 3e3e 3e20 6d6f 6465 6c20  -.    >>> model 
-00000340: 3d20 4d75 6c74 696c 6179 6572 5065 7263  = MultilayerPerc
-00000350: 6570 7472 6f6e 2864 5f69 6e70 7574 3d31  eptron(d_input=1
-00000360: 302c 2064 5f68 6964 6465 6e3d 2832 2c33  0, d_hidden=(2,3
-00000370: 292c 2064 5f6f 7574 7075 743d 322c 2064  ), d_output=2, d
-00000380: 726f 706f 7574 3d30 2e30 2c20 6163 7469  ropout=0.0, acti
-00000390: 7661 7469 6f6e 5f66 6e3d 2772 656c 7527  vation_fn='relu'
-000003a0: 290a 2020 2020 3e3e 3e20 7820 3d20 746f  ).    >>> x = to
-000003b0: 7263 682e 6f6e 6573 2832 2c20 3130 290a  rch.ones(2, 10).
-000003c0: 2020 2020 3e3e 3e20 6f75 7420 3d20 6d6f      >>> out = mo
-000003d0: 6465 6c28 7829 0a20 2020 203e 3e3e 2070  del(x).    >>> p
-000003e0: 7269 6e74 286f 7574 2e73 6861 7065 290a  rint(out.shape).
-000003f0: 2020 2020 746f 7263 682e 5369 7a65 285b      torch.Size([
-00000400: 322c 2032 5d29 0a20 2020 2022 2222 0a0a  2, 2]).    """..
-00000410: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00000420: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
-00000430: 2020 2020 2020 2020 645f 696e 7075 743a          d_input:
-00000440: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
-00000450: 2020 2020 2020 2064 5f6f 7574 7075 743a         d_output:
-00000460: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
-00000470: 2020 2020 2020 2064 5f68 6964 6465 6e3a         d_hidden:
-00000480: 204f 7074 696f 6e61 6c5b 7475 706c 655d   Optional[tuple]
-00000490: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-000004a0: 2020 2020 2020 2020 2020 6472 6f70 6f75            dropou
-000004b0: 743a 2066 6c6f 6174 203d 2030 2e30 2c0a  t: float = 0.0,.
-000004c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000004d0: 2062 6174 6368 5f6e 6f72 6d3a 2062 6f6f   batch_norm: boo
-000004e0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-000004f0: 2020 2020 2020 2020 2020 2020 6261 7463              batc
-00000500: 685f 6e6f 726d 5f6d 6f6d 656e 7475 6d3a  h_norm_momentum:
-00000510: 2066 6c6f 6174 203d 2030 2e31 2c0a 2020   float = 0.1,.  
-00000520: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00000530: 6374 6976 6174 696f 6e5f 666e 3a20 556e  ctivation_fn: Un
-00000540: 696f 6e5b 4361 6c6c 6162 6c65 2c20 7374  ion[Callable, st
-00000550: 725d 203d 2027 7265 6c75 272c 0a20 2020  r] = 'relu',.   
-00000560: 2020 2020 2020 2020 2020 2020 2020 736b                sk
-00000570: 6970 5f63 6f6e 6e65 6374 696f 6e3a 2062  ip_connection: b
-00000580: 6f6f 6c20 3d20 4661 6c73 6529 3a0a 2020  ool = False):.  
-00000590: 2020 2020 2020 2222 2249 6e69 7469 616c        """Initial
-000005a0: 697a 6520 7468 6520 6d6f 6465 6c2e 0a0a  ize the model...
-000005b0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-000005c0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-000005d0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 645f  -----.        d_
-000005e0: 696e 7075 743a 2069 6e74 0a20 2020 2020  input: int.     
-000005f0: 2020 2020 2020 2074 6865 2064 696d 656e         the dimen
-00000600: 7369 6f6e 206f 6620 7468 6520 696e 7075  sion of the inpu
-00000610: 7420 6c61 7965 720a 2020 2020 2020 2020  t layer.        
-00000620: 645f 6f75 7470 7574 3a20 696e 740a 2020  d_output: int.  
-00000630: 2020 2020 2020 2020 2020 7468 6520 6469            the di
-00000640: 6d65 6e73 696f 6e20 6f66 2074 6865 206f  mension of the o
-00000650: 7574 7075 7420 6c61 7965 720a 2020 2020  utput layer.    
-00000660: 2020 2020 645f 6869 6464 656e 3a20 7475      d_hidden: tu
-00000670: 706c 650a 2020 2020 2020 2020 2020 2020  ple.            
-00000680: 7468 6520 6469 6d65 6e73 696f 6e73 206f  the dimensions o
-00000690: 6620 7468 6520 6869 6464 656e 206c 6179  f the hidden lay
-000006a0: 6572 730a 2020 2020 2020 2020 6472 6f70  ers.        drop
-000006b0: 6f75 743a 2066 6c6f 6174 0a20 2020 2020  out: float.     
-000006c0: 2020 2020 2020 2074 6865 2064 726f 706f         the dropo
-000006d0: 7574 2070 726f 6261 6269 6c69 7479 0a20  ut probability. 
-000006e0: 2020 2020 2020 2062 6174 6368 5f6e 6f72         batch_nor
-000006f0: 6d3a 2062 6f6f 6c0a 2020 2020 2020 2020  m: bool.        
-00000700: 2020 2020 7768 6574 6865 7220 746f 2075      whether to u
-00000710: 7365 2062 6174 6368 206e 6f72 6d61 6c69  se batch normali
-00000720: 7a61 7469 6f6e 0a20 2020 2020 2020 2062  zation.        b
-00000730: 6174 6368 5f6e 6f72 6d5f 6d6f 6d65 6e74  atch_norm_moment
-00000740: 756d 3a20 666c 6f61 740a 2020 2020 2020  um: float.      
-00000750: 2020 2020 2020 7468 6520 6d6f 6d65 6e74        the moment
-00000760: 756d 2066 6f72 2062 6174 6368 206e 6f72  um for batch nor
-00000770: 6d61 6c69 7a61 7469 6f6e 0a20 2020 2020  malization.     
-00000780: 2020 2061 6374 6976 6174 696f 6e5f 666e     activation_fn
-00000790: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
-000007a0: 2020 7468 6520 6163 7469 7661 7469 6f6e    the activation
-000007b0: 2066 756e 6374 696f 6e20 746f 2075 7365   function to use
-000007c0: 2069 6e20 7468 6520 6869 6464 656e 206c   in the hidden l
-000007d0: 6179 6572 730a 2020 2020 2020 2020 736b  ayers.        sk
-000007e0: 6970 5f63 6f6e 6e65 6374 696f 6e3a 2062  ip_connection: b
-000007f0: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
-00000800: 7768 6574 6865 7220 746f 2061 6464 2061  whether to add a
-00000810: 2073 6b69 7020 636f 6e6e 6563 7469 6f6e   skip connection
-00000820: 2066 726f 6d20 7468 6520 696e 7075 7420   from the input 
-00000830: 746f 2074 6865 206f 7574 7075 740a 2020  to the output.  
-00000840: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00000850: 2020 7375 7065 7228 4d75 6c74 696c 6179    super(Multilay
-00000860: 6572 5065 7263 6570 7472 6f6e 2c20 7365  erPerceptron, se
-00000870: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a20  lf).__init__(). 
-00000880: 2020 2020 2020 2073 656c 662e 645f 696e         self.d_in
-00000890: 7075 7420 3d20 645f 696e 7075 740a 2020  put = d_input.  
-000008a0: 2020 2020 2020 7365 6c66 2e64 5f68 6964        self.d_hid
-000008b0: 6465 6e20 3d20 645f 6869 6464 656e 0a20  den = d_hidden. 
-000008c0: 2020 2020 2020 2073 656c 662e 645f 6f75         self.d_ou
-000008d0: 7470 7574 203d 2064 5f6f 7574 7075 740a  tput = d_output.
-000008e0: 2020 2020 2020 2020 7365 6c66 2e64 726f          self.dro
-000008f0: 706f 7574 203d 206e 6e2e 4472 6f70 6f75  pout = nn.Dropou
-00000900: 7428 6472 6f70 6f75 7429 0a20 2020 2020  t(dropout).     
-00000910: 2020 2073 656c 662e 6261 7463 685f 6e6f     self.batch_no
-00000920: 726d 203d 2062 6174 6368 5f6e 6f72 6d0a  rm = batch_norm.
-00000930: 2020 2020 2020 2020 7365 6c66 2e62 6174          self.bat
-00000940: 6368 5f6e 6f72 6d5f 6d6f 6d65 6e74 756d  ch_norm_momentum
-00000950: 203d 2062 6174 6368 5f6e 6f72 6d5f 6d6f   = batch_norm_mo
-00000960: 6d65 6e74 756d 0a20 2020 2020 2020 2073  mentum.        s
-00000970: 656c 662e 6163 7469 7661 7469 6f6e 5f66  elf.activation_f
-00000980: 6e20 3d20 6765 745f 6163 7469 7661 7469  n = get_activati
-00000990: 6f6e 2861 6374 6976 6174 696f 6e5f 666e  on(activation_fn
-000009a0: 290a 2020 2020 2020 2020 7365 6c66 2e6d  ).        self.m
-000009b0: 6f64 656c 203d 206e 6e2e 5365 7175 656e  odel = nn.Sequen
-000009c0: 7469 616c 282a 7365 6c66 2e62 7569 6c64  tial(*self.build
-000009d0: 5f6c 6179 6572 7328 2929 0a20 2020 2020  _layers()).     
-000009e0: 2020 2073 656c 662e 736b 6970 203d 206e     self.skip = n
-000009f0: 6e2e 4c69 6e65 6172 2864 5f69 6e70 7574  n.Linear(d_input
-00000a00: 2c20 645f 6f75 7470 7574 2920 6966 2073  , d_output) if s
-00000a10: 6b69 705f 636f 6e6e 6563 7469 6f6e 2065  kip_connection e
-00000a20: 6c73 6520 4e6f 6e65 0a0a 2020 2020 6465  lse None..    de
-00000a30: 6620 6275 696c 645f 6c61 7965 7273 2873  f build_layers(s
-00000a40: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00000a50: 220a 2020 2020 2020 2020 4275 696c 6420  ".        Build 
-00000a60: 7468 6520 6c61 7965 7273 206f 6620 7468  the layers of th
-00000a70: 6520 6d6f 6465 6c2c 2069 7465 7261 7469  e model, iterati
-00000a80: 6e67 2074 6872 6f75 6768 2074 6865 2068  ng through the h
-00000a90: 6964 6465 6e20 6469 6d65 6e73 696f 6e73  idden dimensions
-00000aa0: 2074 6f20 7072 6f64 7563 6520 6120 6c69   to produce a li
-00000ab0: 7374 206f 6620 6c61 7965 7273 2e0a 2020  st of layers..  
-00000ac0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00000ad0: 2020 206c 6179 6572 5f6c 6973 7420 3d20     layer_list = 
-00000ae0: 5b5d 0a20 2020 2020 2020 206c 6179 6572  [].        layer
-00000af0: 5f64 696d 203d 2073 656c 662e 645f 696e  _dim = self.d_in
-00000b00: 7075 740a 2020 2020 2020 2020 6966 2073  put.        if s
-00000b10: 656c 662e 645f 6869 6464 656e 2069 7320  elf.d_hidden is 
-00000b20: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00000b30: 2020 2020 2020 666f 7220 6420 696e 2073        for d in s
-00000b40: 656c 662e 645f 6869 6464 656e 3a0a 2020  elf.d_hidden:.  
-00000b50: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00000b60: 7965 725f 6c69 7374 2e61 7070 656e 6428  yer_list.append(
-00000b70: 6e6e 2e4c 696e 6561 7228 6c61 7965 725f  nn.Linear(layer_
-00000b80: 6469 6d2c 2064 2929 0a20 2020 2020 2020  dim, d)).       
-00000b90: 2020 2020 2020 2020 206c 6179 6572 5f6c           layer_l
-00000ba0: 6973 742e 6170 7065 6e64 2873 656c 662e  ist.append(self.
-00000bb0: 6472 6f70 6f75 7429 0a20 2020 2020 2020  dropout).       
-00000bc0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00000bd0: 2e62 6174 6368 5f6e 6f72 6d3a 0a20 2020  .batch_norm:.   
-00000be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000bf0: 206c 6179 6572 5f6c 6973 742e 6170 7065   layer_list.appe
-00000c00: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
-00000c10: 2020 2020 2020 2020 2020 2020 6e6e 2e42              nn.B
-00000c20: 6174 6368 4e6f 726d 3164 2864 2c20 6d6f  atchNorm1d(d, mo
-00000c30: 6d65 6e74 756d 3d73 656c 662e 6261 7463  mentum=self.batc
-00000c40: 685f 6e6f 726d 5f6d 6f6d 656e 7475 6d29  h_norm_momentum)
-00000c50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00000c60: 2020 6c61 7965 725f 6469 6d20 3d20 640a    layer_dim = d.
-00000c70: 2020 2020 2020 2020 6c61 7965 725f 6c69          layer_li
-00000c80: 7374 2e61 7070 656e 6428 6e6e 2e4c 696e  st.append(nn.Lin
-00000c90: 6561 7228 6c61 7965 725f 6469 6d2c 2073  ear(layer_dim, s
-00000ca0: 656c 662e 645f 6f75 7470 7574 2929 0a20  elf.d_output)). 
-00000cb0: 2020 2020 2020 2072 6574 7572 6e20 6c61         return la
-00000cc0: 7965 725f 6c69 7374 0a0a 2020 2020 6465  yer_list..    de
-00000cd0: 6620 666f 7277 6172 6428 7365 6c66 2c20  f forward(self, 
-00000ce0: 783a 2054 656e 736f 7229 202d 3e20 5465  x: Tensor) -> Te
-00000cf0: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
-00000d00: 2246 6f72 7761 7264 2070 6173 7320 6f66  "Forward pass of
-00000d10: 2074 6865 206d 6f64 656c 2e22 2222 0a20   the model.""". 
-00000d20: 2020 2020 2020 2069 6e70 7574 203d 2078         input = x
-00000d30: 0a20 2020 2020 2020 2066 6f72 206c 6179  .        for lay
-00000d40: 6572 2069 6e20 7365 6c66 2e6d 6f64 656c  er in self.model
-00000d50: 3a0a 2020 2020 2020 2020 2020 2020 7820  :.            x 
-00000d60: 3d20 6c61 7965 7228 7829 0a20 2020 2020  = layer(x).     
-00000d70: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00000d80: 616e 6365 286c 6179 6572 2c20 6e6e 2e4c  ance(layer, nn.L
-00000d90: 696e 6561 7229 3a0a 2020 2020 2020 2020  inear):.        
-00000da0: 2020 2020 2020 2020 7820 3d20 7365 6c66          x = self
-00000db0: 2e61 6374 6976 6174 696f 6e5f 666e 280a  .activation_fn(.
-00000dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000dd0: 2020 2020 780a 2020 2020 2020 2020 2020      x.          
-00000de0: 2020 2020 2020 2920 2023 2044 6f6e 6520        )  # Done 
-00000df0: 6265 6361 7573 6520 6163 7469 7661 7469  because activati
-00000e00: 6f6e 5f66 6e20 7265 7475 726e 7320 6120  on_fn returns a 
-00000e10: 746f 7263 682e 6e6e 2e66 756e 6374 696f  torch.nn.functio
-00000e20: 6e61 6c0a 2020 2020 2020 2020 6966 2073  nal.        if s
-00000e30: 656c 662e 736b 6970 2069 7320 6e6f 7420  elf.skip is not 
-00000e40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00000e50: 2020 7265 7475 726e 2078 202b 2073 656c    return x + sel
-00000e60: 662e 736b 6970 2869 6e70 7574 290a 2020  f.skip(input).  
-00000e70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00000e80: 2020 2020 2020 2020 7265 7475 726e 2078          return x
-00000e90: 0a0a 0a63 6c61 7373 2043 4e4e 4d6f 6475  ...class CNNModu
-00000ea0: 6c65 286e 6e2e 4d6f 6475 6c65 293a 0a20  le(nn.Module):. 
-00000eb0: 2020 2022 2222 4120 312c 2032 2c20 6f72     """A 1, 2, or
-00000ec0: 2033 2064 696d 656e 7369 6f6e 616c 2063   3 dimensional c
-00000ed0: 6f6e 766f 6c75 7469 6f6e 616c 206e 6574  onvolutional net
-00000ee0: 776f 726b 2066 6f72 2065 6974 6865 7220  work for either 
-00000ef0: 7265 6772 6573 7369 6f6e 206f 7220 636c  regression or cl
-00000f00: 6173 7369 6669 6361 7469 6f6e 2e0a 2020  assification..  
-00000f10: 2020 5468 6520 6e65 7477 6f72 6b20 636f    The network co
-00000f20: 6e73 6973 7473 206f 6620 7468 6520 666f  nsists of the fo
-00000f30: 6c6c 6f77 696e 6720 7365 7175 656e 6365  llowing sequence
-00000f40: 206f 6620 6c61 7965 7273 3a0a 2020 2020   of layers:.    
-00000f50: 2d20 4120 636f 6e66 6967 7572 6162 6c65  - A configurable
-00000f60: 206e 756d 6265 7220 6f66 2063 6f6e 766f   number of convo
-00000f70: 6c75 7469 6f6e 616c 206c 6179 6572 730a  lutional layers.
-00000f80: 2020 2020 2d20 4120 676c 6f62 616c 2070      - A global p
-00000f90: 6f6f 6c69 6e67 206c 6179 6572 2028 6569  ooling layer (ei
-00000fa0: 7468 6572 206d 6178 2070 6f6f 6c20 6f72  ther max pool or
-00000fb0: 2061 7665 7261 6765 2070 6f6f 6c29 0a20   average pool). 
-00000fc0: 2020 202d 2041 2066 696e 616c 2066 756c     - A final ful
-00000fd0: 6c79 2063 6f6e 6e65 6374 6564 206c 6179  ly connected lay
-00000fe0: 6572 2074 6f20 636f 6d70 7574 6520 7468  er to compute th
-00000ff0: 6520 6f75 7470 7574 0a20 2020 2049 7420  e output.    It 
-00001000: 6f70 7469 6f6e 616c 6c79 2063 616e 2063  optionally can c
-00001010: 6f6d 706f 7365 2074 6865 206d 6f64 656c  ompose the model
-00001020: 2066 726f 6d20 7072 652d 6163 7469 7661   from pre-activa
-00001030: 7469 6f6e 2072 6573 6964 7561 6c20 626c  tion residual bl
-00001040: 6f63 6b73 2c20 6173 0a20 2020 2064 6573  ocks, as.    des
-00001050: 6372 6962 6564 2069 6e20 6874 7470 733a  cribed in https:
-00001060: 2f2f 6172 7869 762e 6f72 672f 6162 732f  //arxiv.org/abs/
-00001070: 3136 3033 2e30 3530 3237 2c20 7261 7468  1603.05027, rath
-00001080: 6572 2074 6861 6e20 6120 7369 6d70 6c65  er than a simple
-00001090: 2073 7461 636b 206f 660a 2020 2020 636f   stack of.    co
-000010a0: 6e76 6f6c 7574 696f 6e20 6c61 7965 7273  nvolution layers
-000010b0: 2e20 2054 6869 7320 6f66 7465 6e20 6c65  .  This often le
-000010c0: 6164 7320 746f 2065 6173 6965 7220 7472  ads to easier tr
-000010d0: 6169 6e69 6e67 2c20 6573 7065 6369 616c  aining, especial
-000010e0: 6c79 2077 6865 6e20 7573 696e 6720 610a  ly when using a.
-000010f0: 2020 2020 6c61 7267 6520 6e75 6d62 6572      large number
-00001100: 206f 6620 6c61 7965 7273 2e20 204e 6f74   of layers.  Not
-00001110: 6520 7468 6174 2072 6573 6964 7561 6c20  e that residual 
-00001120: 626c 6f63 6b73 2063 616e 206f 6e6c 7920  blocks can only 
-00001130: 6265 2075 7365 6420 7768 656e 0a20 2020  be used when.   
-00001140: 2073 7563 6365 7373 6976 6520 6c61 7965   successive laye
-00001150: 7273 2068 6176 6520 7468 6520 7361 6d65  rs have the same
-00001160: 206f 7574 7075 7420 7368 6170 652e 2020   output shape.  
-00001170: 5768 6572 6576 6572 2074 6865 206f 7574  Wherever the out
-00001180: 7075 7420 7368 6170 6520 6368 616e 6765  put shape change
-00001190: 732c 2061 0a20 2020 2073 696d 706c 6520  s, a.    simple 
-000011a0: 636f 6e76 6f6c 7574 696f 6e20 6c61 7965  convolution laye
-000011b0: 7220 7769 6c6c 2062 6520 7573 6564 2065  r will be used e
-000011c0: 7665 6e20 6966 2072 6573 6964 7561 6c3d  ven if residual=
-000011d0: 5472 7565 2e0a 2020 2020 4578 616d 706c  True..    Exampl
-000011e0: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
-000011f0: 2020 2020 3e3e 3e20 6d6f 6465 6c20 3d20      >>> model = 
-00001200: 434e 4e4d 6f64 756c 6528 6e5f 7461 736b  CNNModule(n_task
-00001210: 733d 352c 206e 5f66 6561 7475 7265 733d  s=5, n_features=
-00001220: 382c 2064 696d 733d 322c 206c 6179 6572  8, dims=2, layer
-00001230: 5f66 696c 7465 7273 3d5b 332c 382c 382c  _filters=[3,8,8,
-00001240: 3136 5d2c 206b 6572 6e65 6c5f 7369 7a65  16], kernel_size
-00001250: 3d33 2c20 6e5f 636c 6173 7365 7320 3d20  =3, n_classes = 
-00001260: 372c 206d 6f64 653d 2763 6c61 7373 6966  7, mode='classif
-00001270: 6963 6174 696f 6e27 2c20 756e 6365 7274  ication', uncert
-00001280: 6169 6e74 793d 4661 6c73 652c 2070 6164  ainty=False, pad
-00001290: 6469 6e67 3d27 7361 6d65 2729 0a20 2020  ding='same').   
-000012a0: 203e 3e3e 2078 203d 2074 6f72 6368 2e6f   >>> x = torch.o
-000012b0: 6e65 7328 322c 2032 3234 2c20 3232 342c  nes(2, 224, 224,
-000012c0: 2038 290a 2020 2020 3e3e 3e20 7820 3d20   8).    >>> x = 
-000012d0: 6d6f 6465 6c28 7829 0a20 2020 203e 3e3e  model(x).    >>>
-000012e0: 2066 6f72 2074 656e 736f 7220 696e 2078   for tensor in x
-000012f0: 3a0a 2020 2020 2e2e 2e20 2020 2070 7269  :.    ...    pri
-00001300: 6e74 2874 656e 736f 722e 7368 6170 6529  nt(tensor.shape)
-00001310: 0a20 2020 2074 6f72 6368 2e53 697a 6528  .    torch.Size(
-00001320: 5b32 2c20 352c 2037 5d29 0a20 2020 2074  [2, 5, 7]).    t
-00001330: 6f72 6368 2e53 697a 6528 5b32 2c20 352c  orch.Size([2, 5,
-00001340: 2037 5d29 0a20 2020 2022 2222 0a0a 2020   7]).    """..  
-00001350: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00001360: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00001370: 2020 2020 2020 6e5f 7461 736b 733a 2069        n_tasks: i
-00001380: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-00001390: 2020 2020 206e 5f66 6561 7475 7265 733a       n_features:
-000013a0: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
-000013b0: 2020 2020 2020 2064 696d 733a 2069 6e74         dims: int
-000013c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000013d0: 2020 206c 6179 6572 5f66 696c 7465 7273     layer_filters
-000013e0: 3a20 4c69 7374 5b69 6e74 5d20 3d20 5b31  : List[int] = [1
-000013f0: 3030 5d2c 0a20 2020 2020 2020 2020 2020  00],.           
-00001400: 2020 2020 2020 6b65 726e 656c 5f73 697a        kernel_siz
-00001410: 653a 204f 6e65 4f72 4d61 6e79 5b69 6e74  e: OneOrMany[int
-00001420: 5d20 3d20 352c 0a20 2020 2020 2020 2020  ] = 5,.         
-00001430: 2020 2020 2020 2020 7374 7269 6465 733a          strides:
-00001440: 204f 6e65 4f72 4d61 6e79 5b69 6e74 5d20   OneOrMany[int] 
-00001450: 3d20 312c 0a20 2020 2020 2020 2020 2020  = 1,.           
-00001460: 2020 2020 2020 7765 6967 6874 5f69 6e69        weight_ini
-00001470: 745f 7374 6464 6576 733a 204f 6e65 4f72  t_stddevs: OneOr
-00001480: 4d61 6e79 5b66 6c6f 6174 5d20 3d20 302e  Many[float] = 0.
-00001490: 3032 2c0a 2020 2020 2020 2020 2020 2020  02,.            
-000014a0: 2020 2020 2062 6961 735f 696e 6974 5f63       bias_init_c
-000014b0: 6f6e 7374 733a 204f 6e65 4f72 4d61 6e79  onsts: OneOrMany
-000014c0: 5b66 6c6f 6174 5d20 3d20 312e 302c 0a20  [float] = 1.0,. 
-000014d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014e0: 6472 6f70 6f75 7473 3a20 4f6e 654f 724d  dropouts: OneOrM
-000014f0: 616e 795b 666c 6f61 745d 203d 2030 2e35  any[float] = 0.5
-00001500: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001510: 2020 2061 6374 6976 6174 696f 6e5f 666e     activation_fn
-00001520: 733a 204f 6e65 4f72 4d61 6e79 5b41 6374  s: OneOrMany[Act
-00001530: 6976 6174 696f 6e46 6e5d 203d 2027 7265  ivationFn] = 're
-00001540: 6c75 272c 0a20 2020 2020 2020 2020 2020  lu',.           
-00001550: 2020 2020 2020 706f 6f6c 5f74 7970 653a        pool_type:
-00001560: 2073 7472 203d 2027 6d61 7827 2c0a 2020   str = 'max',.  
-00001570: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00001580: 6f64 653a 2073 7472 203d 2027 636c 6173  ode: str = 'clas
-00001590: 7369 6669 6361 7469 6f6e 272c 0a20 2020  sification',.   
-000015a0: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
-000015b0: 636c 6173 7365 733a 2069 6e74 203d 2032  classes: int = 2
-000015c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000015d0: 2020 2075 6e63 6572 7461 696e 7479 3a20     uncertainty: 
-000015e0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-000015f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00001600: 6573 6964 7561 6c3a 2062 6f6f 6c20 3d20  esidual: bool = 
-00001610: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-00001620: 2020 2020 2020 2020 7061 6464 696e 673a          padding:
-00001630: 2055 6e69 6f6e 5b69 6e74 2c20 7374 725d   Union[int, str]
-00001640: 203d 2027 7661 6c69 6427 2920 2d3e 204e   = 'valid') -> N
-00001650: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00001660: 4372 6561 7465 2061 2043 4e4e 2e0a 0a20  Create a CNN... 
-00001670: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00001680: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00001690: 2d2d 2d2d 0a20 2020 2020 2020 206e 5f74  ----.        n_t
-000016a0: 6173 6b73 3a20 696e 740a 2020 2020 2020  asks: int.      
-000016b0: 2020 2020 2020 6e75 6d62 6572 206f 6620        number of 
-000016c0: 7461 736b 730a 2020 2020 2020 2020 6e5f  tasks.        n_
-000016d0: 6665 6174 7572 6573 3a20 696e 740a 2020  features: int.  
-000016e0: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
-000016f0: 206f 6620 6665 6174 7572 6573 0a20 2020   of features.   
-00001700: 2020 2020 2064 696d 733a 2069 6e74 0a20       dims: int. 
-00001710: 2020 2020 2020 2020 2020 2074 6865 206e             the n
-00001720: 756d 6265 7220 6f66 2064 696d 656e 7369  umber of dimensi
-00001730: 6f6e 7320 746f 2061 7070 6c79 2063 6f6e  ons to apply con
-00001740: 766f 6c75 7469 6f6e 7320 6f76 6572 2028  volutions over (
-00001750: 312c 2032 2c20 6f72 2033 290a 2020 2020  1, 2, or 3).    
-00001760: 2020 2020 6c61 7965 725f 6669 6c74 6572      layer_filter
-00001770: 733a 206c 6973 740a 2020 2020 2020 2020  s: list.        
-00001780: 2020 2020 7468 6520 6e75 6d62 6572 206f      the number o
-00001790: 6620 6f75 7470 7574 2066 696c 7465 7273  f output filters
-000017a0: 2066 6f72 2065 6163 6820 636f 6e76 6f6c   for each convol
-000017b0: 7574 696f 6e61 6c20 6c61 7965 7220 696e  utional layer in
-000017c0: 2074 6865 206e 6574 776f 726b 2e0a 2020   the network..  
-000017d0: 2020 2020 2020 2020 2020 5468 6520 6c65            The le
-000017e0: 6e67 7468 206f 6620 7468 6973 206c 6973  ngth of this lis
-000017f0: 7420 6465 7465 726d 696e 6573 2074 6865  t determines the
-00001800: 206e 756d 6265 7220 6f66 206c 6179 6572   number of layer
-00001810: 732e 0a20 2020 2020 2020 206b 6572 6e65  s..        kerne
-00001820: 6c5f 7369 7a65 3a20 696e 742c 2074 7570  l_size: int, tup
-00001830: 6c65 2c20 6f72 206c 6973 740a 2020 2020  le, or list.    
-00001840: 2020 2020 2020 2020 6120 6c69 7374 2067          a list g
-00001850: 6976 696e 6720 7468 6520 7368 6170 6520  iving the shape 
-00001860: 6f66 2074 6865 2063 6f6e 766f 6c75 7469  of the convoluti
-00001870: 6f6e 616c 206b 6572 6e65 6c20 666f 7220  onal kernel for 
-00001880: 6561 6368 206c 6179 6572 2e20 2045 6163  each layer.  Eac
-00001890: 680a 2020 2020 2020 2020 2020 2020 656c  h.            el
-000018a0: 656d 656e 7420 6d61 7920 6265 2065 6974  ement may be eit
-000018b0: 6865 7220 616e 2069 6e74 2028 7573 6520  her an int (use 
-000018c0: 7468 6520 7361 6d65 206b 6572 6e65 6c20  the same kernel 
-000018d0: 7769 6474 6820 666f 7220 6576 6572 7920  width for every 
-000018e0: 6469 6d65 6e73 696f 6e29 0a20 2020 2020  dimension).     
-000018f0: 2020 2020 2020 206f 7220 6120 7475 706c         or a tupl
-00001900: 6520 2874 6865 206b 6572 6e65 6c20 7769  e (the kernel wi
-00001910: 6474 6820 616c 6f6e 6720 6561 6368 2064  dth along each d
-00001920: 696d 656e 7369 6f6e 292e 2020 416c 7465  imension).  Alte
-00001930: 726e 6174 6976 656c 7920 7468 6973 206d  rnatively this m
-00001940: 6179 0a20 2020 2020 2020 2020 2020 2062  ay.            b
-00001950: 6520 6120 7369 6e67 6c65 2069 6e74 206f  e a single int o
-00001960: 7220 7475 706c 6520 696e 7374 6561 6420  r tuple instead 
-00001970: 6f66 2061 206c 6973 742c 2069 6e20 7768  of a list, in wh
-00001980: 6963 6820 6361 7365 2074 6865 2073 616d  ich case the sam
-00001990: 6520 6b65 726e 656c 0a20 2020 2020 2020  e kernel.       
-000019a0: 2020 2020 2073 6861 7065 2069 7320 7573       shape is us
-000019b0: 6564 2066 6f72 2065 7665 7279 206c 6179  ed for every lay
-000019c0: 6572 2e0a 2020 2020 2020 2020 7374 7269  er..        stri
-000019d0: 6465 733a 2069 6e74 2c20 7475 706c 652c  des: int, tuple,
-000019e0: 206f 7220 6c69 7374 0a20 2020 2020 2020   or list.       
-000019f0: 2020 2020 2061 206c 6973 7420 6769 7669       a list givi
-00001a00: 6e67 2074 6865 2073 7472 6964 6520 6265  ng the stride be
-00001a10: 7477 6565 6e20 6170 706c 6963 6174 696f  tween applicatio
-00001a20: 6e73 206f 6620 7468 6520 206b 6572 6e65  ns of the  kerne
-00001a30: 6c20 666f 7220 6561 6368 206c 6179 6572  l for each layer
-00001a40: 2e0a 2020 2020 2020 2020 2020 2020 4561  ..            Ea
-00001a50: 6368 2065 6c65 6d65 6e74 206d 6179 2062  ch element may b
-00001a60: 6520 6569 7468 6572 2061 6e20 696e 7420  e either an int 
-00001a70: 2875 7365 2074 6865 2073 616d 6520 7374  (use the same st
-00001a80: 7269 6465 2066 6f72 2065 7665 7279 2064  ride for every d
-00001a90: 696d 656e 7369 6f6e 290a 2020 2020 2020  imension).      
-00001aa0: 2020 2020 2020 6f72 2061 2074 7570 6c65        or a tuple
-00001ab0: 2028 7468 6520 7374 7269 6465 2061 6c6f   (the stride alo
-00001ac0: 6e67 2065 6163 6820 6469 6d65 6e73 696f  ng each dimensio
-00001ad0: 6e29 2e20 2041 6c74 6572 6e61 7469 7665  n).  Alternative
-00001ae0: 6c79 2074 6869 7320 6d61 7920 6265 2061  ly this may be a
-00001af0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-00001b00: 676c 6520 696e 7420 6f72 2074 7570 6c65  gle int or tuple
-00001b10: 2069 6e73 7465 6164 206f 6620 6120 6c69   instead of a li
-00001b20: 7374 2c20 696e 2077 6869 6368 2063 6173  st, in which cas
-00001b30: 6520 7468 6520 7361 6d65 2073 7472 6964  e the same strid
-00001b40: 6520 6973 0a20 2020 2020 2020 2020 2020  e is.           
-00001b50: 2075 7365 6420 666f 7220 6576 6572 7920   used for every 
-00001b60: 6c61 7965 722e 0a20 2020 2020 2020 2077  layer..        w
-00001b70: 6569 6768 745f 696e 6974 5f73 7464 6465  eight_init_stdde
-00001b80: 7673 3a20 6c69 7374 206f 7220 666c 6f61  vs: list or floa
-00001b90: 740a 2020 2020 2020 2020 2020 2020 7468  t.            th
-00001ba0: 6520 7374 616e 6461 7264 2064 6576 6961  e standard devia
-00001bb0: 7469 6f6e 206f 6620 7468 6520 6469 7374  tion of the dist
-00001bc0: 7269 6275 7469 6f6e 2074 6f20 7573 6520  ribution to use 
-00001bd0: 666f 7220 7765 6967 6874 2069 6e69 7469  for weight initi
-00001be0: 616c 697a 6174 696f 6e0a 2020 2020 2020  alization.      
-00001bf0: 2020 2020 2020 6f66 2065 6163 6820 6c61        of each la
-00001c00: 7965 722e 2020 5468 6520 6c65 6e67 7468  yer.  The length
-00001c10: 206f 6620 7468 6973 206c 6973 7420 7368   of this list sh
-00001c20: 6f75 6c64 2065 7175 616c 206c 656e 286c  ould equal len(l
-00001c30: 6179 6572 5f66 696c 7465 7273 292b 312c  ayer_filters)+1,
-00001c40: 0a20 2020 2020 2020 2020 2020 2077 6865  .            whe
-00001c50: 7265 2074 6865 2066 696e 616c 2065 6c65  re the final ele
-00001c60: 6d65 6e74 2063 6f72 7265 7370 6f6e 6473  ment corresponds
-00001c70: 2074 6f20 7468 6520 6465 6e73 6520 6c61   to the dense la
-00001c80: 7965 722e 2020 416c 7465 726e 6174 6976  yer.  Alternativ
-00001c90: 656c 7920 7468 6973 0a20 2020 2020 2020  ely this.       
-00001ca0: 2020 2020 206d 6179 2062 6520 6120 7369       may be a si
-00001cb0: 6e67 6c65 2076 616c 7565 2069 6e73 7465  ngle value inste
-00001cc0: 6164 206f 6620 6120 6c69 7374 2c20 696e  ad of a list, in
-00001cd0: 2077 6869 6368 2063 6173 6520 7468 6520   which case the 
-00001ce0: 7361 6d65 2076 616c 7565 2069 7320 7573  same value is us
-00001cf0: 6564 0a20 2020 2020 2020 2020 2020 2066  ed.            f
-00001d00: 6f72 2065 7665 7279 206c 6179 6572 2e0a  or every layer..
-00001d10: 2020 2020 2020 2020 6269 6173 5f69 6e69          bias_ini
-00001d20: 745f 636f 6e73 7473 3a20 6c69 7374 206f  t_consts: list o
-00001d30: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-00001d40: 2020 2020 7468 6520 7661 6c75 6520 746f      the value to
-00001d50: 2069 6e69 7469 616c 697a 6520 7468 6520   initialize the 
-00001d60: 6269 6173 6573 2069 6e20 6561 6368 206c  biases in each l
-00001d70: 6179 6572 2074 6f2e 2020 5468 6520 6c65  ayer to.  The le
-00001d80: 6e67 7468 206f 6620 7468 6973 0a20 2020  ngth of this.   
-00001d90: 2020 2020 2020 2020 206c 6973 7420 7368           list sh
-00001da0: 6f75 6c64 2065 7175 616c 206c 656e 286c  ould equal len(l
-00001db0: 6179 6572 5f66 696c 7465 7273 292b 312c  ayer_filters)+1,
-00001dc0: 2077 6865 7265 2074 6865 2066 696e 616c   where the final
-00001dd0: 2065 6c65 6d65 6e74 2063 6f72 7265 7370   element corresp
-00001de0: 6f6e 6473 0a20 2020 2020 2020 2020 2020  onds.           
-00001df0: 2074 6f20 7468 6520 6465 6e73 6520 6c61   to the dense la
-00001e00: 7965 722e 2020 416c 7465 726e 6174 6976  yer.  Alternativ
-00001e10: 656c 7920 7468 6973 206d 6179 2062 6520  ely this may be 
-00001e20: 6120 7369 6e67 6c65 2076 616c 7565 2069  a single value i
-00001e30: 6e73 7465 6164 206f 6620 610a 2020 2020  nstead of a.    
-00001e40: 2020 2020 2020 2020 6c69 7374 2c20 696e          list, in
-00001e50: 2077 6869 6368 2063 6173 6520 7468 6520   which case the 
-00001e60: 7361 6d65 2076 616c 7565 2069 7320 7573  same value is us
-00001e70: 6564 2066 6f72 2065 7665 7279 206c 6179  ed for every lay
-00001e80: 6572 2e0a 2020 2020 2020 2020 6472 6f70  er..        drop
-00001e90: 6f75 7473 3a20 6c69 7374 206f 7220 666c  outs: list or fl
-00001ea0: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
-00001eb0: 7468 6520 6472 6f70 6f75 7420 7072 6f62  the dropout prob
-00001ec0: 6162 696c 6974 7920 746f 2075 7365 2066  ability to use f
-00001ed0: 6f72 2065 6163 6820 6c61 7965 722e 2020  or each layer.  
-00001ee0: 5468 6520 6c65 6e67 7468 206f 6620 7468  The length of th
-00001ef0: 6973 206c 6973 7420 7368 6f75 6c64 2065  is list should e
-00001f00: 7175 616c 206c 656e 286c 6179 6572 5f66  qual len(layer_f
-00001f10: 696c 7465 7273 292e 0a20 2020 2020 2020  ilters)..       
-00001f20: 2020 2020 2041 6c74 6572 6e61 7469 7665       Alternative
-00001f30: 6c79 2074 6869 7320 6d61 7920 6265 2061  ly this may be a
-00001f40: 2073 696e 676c 6520 7661 6c75 6520 696e   single value in
-00001f50: 7374 6561 6420 6f66 2061 206c 6973 742c  stead of a list,
-00001f60: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
-00001f70: 6865 2073 616d 6520 7661 6c75 6520 6973  he same value is
-00001f80: 2075 7365 6420 666f 7220 6576 6572 7920   used for every 
-00001f90: 6c61 7965 720a 2020 2020 2020 2020 6163  layer.        ac
-00001fa0: 7469 7661 7469 6f6e 5f66 6e73 3a20 7374  tivation_fns: st
-00001fb0: 7220 6f72 206c 6973 740a 2020 2020 2020  r or list.      
-00001fc0: 2020 2020 2020 7468 6520 746f 7263 6820        the torch 
-00001fd0: 6163 7469 7661 7469 6f6e 2066 756e 6374  activation funct
-00001fe0: 696f 6e20 746f 2061 7070 6c79 2074 6f20  ion to apply to 
-00001ff0: 6561 6368 206c 6179 6572 2e20 5468 6520  each layer. The 
-00002000: 6c65 6e67 7468 206f 6620 7468 6973 206c  length of this l
-00002010: 6973 7420 7368 6f75 6c64 2065 7175 616c  ist should equal
-00002020: 0a20 2020 2020 2020 2020 2020 206c 656e  .            len
-00002030: 286c 6179 6572 5f66 696c 7465 7273 292e  (layer_filters).
-00002040: 2020 416c 7465 726e 6174 6976 656c 7920    Alternatively 
-00002050: 7468 6973 206d 6179 2062 6520 6120 7369  this may be a si
-00002060: 6e67 6c65 2076 616c 7565 2069 6e73 7465  ngle value inste
-00002070: 6164 206f 6620 6120 6c69 7374 2c20 696e  ad of a list, in
-00002080: 2077 6869 6368 2063 6173 6520 7468 650a   which case the.
-00002090: 2020 2020 2020 2020 2020 2020 7361 6d65              same
-000020a0: 2076 616c 7565 2069 7320 7573 6564 2066   value is used f
-000020b0: 6f72 2065 7665 7279 206c 6179 6572 2c20  or every layer, 
-000020c0: 2772 656c 7527 2062 7920 6465 6661 756c  'relu' by defaul
-000020d0: 740a 2020 2020 2020 2020 706f 6f6c 5f74  t.        pool_t
-000020e0: 7970 653a 2073 7472 0a20 2020 2020 2020  ype: str.       
-000020f0: 2020 2020 2074 6865 2074 7970 6520 6f66       the type of
-00002100: 2070 6f6f 6c69 6e67 206c 6179 6572 2074   pooling layer t
-00002110: 6f20 7573 652c 2065 6974 6865 7220 276d  o use, either 'm
-00002120: 6178 2720 6f72 2027 6176 6572 6167 6527  ax' or 'average'
-00002130: 0a20 2020 2020 2020 206d 6f64 653a 2073  .        mode: s
-00002140: 7472 0a20 2020 2020 2020 2020 2020 2045  tr.            E
-00002150: 6974 6865 7220 2763 6c61 7373 6966 6963  ither 'classific
-00002160: 6174 696f 6e27 206f 7220 2772 6567 7265  ation' or 'regre
-00002170: 7373 696f 6e27 0a20 2020 2020 2020 206e  ssion'.        n
-00002180: 5f63 6c61 7373 6573 3a20 696e 740a 2020  _classes: int.  
-00002190: 2020 2020 2020 2020 2020 7468 6520 6e75            the nu
-000021a0: 6d62 6572 206f 6620 636c 6173 7365 7320  mber of classes 
-000021b0: 746f 2070 7265 6469 6374 2028 6f6e 6c79  to predict (only
-000021c0: 2075 7365 6420 696e 2063 6c61 7373 6966   used in classif
-000021d0: 6963 6174 696f 6e20 6d6f 6465 290a 2020  ication mode).  
-000021e0: 2020 2020 2020 756e 6365 7274 6169 6e74        uncertaint
-000021f0: 793a 2062 6f6f 6c0a 2020 2020 2020 2020  y: bool.        
-00002200: 2020 2020 6966 2054 7275 652c 2069 6e63      if True, inc
-00002210: 6c75 6465 2065 7874 7261 206f 7574 7075  lude extra outpu
-00002220: 7473 2061 6e64 206c 6f73 7320 7465 726d  ts and loss term
-00002230: 7320 746f 2065 6e61 626c 6520 7468 6520  s to enable the 
-00002240: 756e 6365 7274 6169 6e74 790a 2020 2020  uncertainty.    
-00002250: 2020 2020 2020 2020 696e 206f 7574 7075          in outpu
-00002260: 7473 2074 6f20 6265 2070 7265 6469 6374  ts to be predict
-00002270: 6564 0a20 2020 2020 2020 2072 6573 6964  ed.        resid
-00002280: 7561 6c3a 2062 6f6f 6c0a 2020 2020 2020  ual: bool.      
-00002290: 2020 2020 2020 6966 2054 7275 652c 2074        if True, t
-000022a0: 6865 206d 6f64 656c 2077 696c 6c20 6265  he model will be
-000022b0: 2063 6f6d 706f 7365 6420 6f66 2070 7265   composed of pre
-000022c0: 2d61 6374 6976 6174 696f 6e20 7265 7369  -activation resi
-000022d0: 6475 616c 2062 6c6f 636b 7320 696e 7374  dual blocks inst
-000022e0: 6561 640a 2020 2020 2020 2020 2020 2020  ead.            
-000022f0: 6f66 2061 2073 696d 706c 6520 7374 6163  of a simple stac
-00002300: 6b20 6f66 2063 6f6e 766f 6c75 7469 6f6e  k of convolution
-00002310: 616c 206c 6179 6572 732e 0a20 2020 2020  al layers..     
-00002320: 2020 2070 6164 6469 6e67 3a20 7374 722c     padding: str,
-00002330: 2069 6e74 206f 7220 7475 706c 650a 2020   int or tuple.  
-00002340: 2020 2020 2020 2020 2020 7468 6520 7061            the pa
-00002350: 6464 696e 6720 746f 2075 7365 2066 6f72  dding to use for
-00002360: 2063 6f6e 766f 6c75 7469 6f6e 616c 206c   convolutional l
-00002370: 6179 6572 732c 2065 6974 6865 7220 2776  ayers, either 'v
-00002380: 616c 6964 2720 6f72 2027 7361 6d65 270a  alid' or 'same'.
-00002390: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-000023a0: 2020 2020 2073 7570 6572 2843 4e4e 4d6f       super(CNNMo
-000023b0: 6475 6c65 2c20 7365 6c66 292e 5f5f 696e  dule, self).__in
-000023c0: 6974 5f5f 2829 0a0a 2020 2020 2020 2020  it__()..        
-000023d0: 6966 2064 696d 7320 6e6f 7420 696e 2028  if dims not in (
-000023e0: 312c 2032 2c20 3329 3a0a 2020 2020 2020  1, 2, 3):.      
-000023f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00002400: 6545 7272 6f72 2827 4e75 6d62 6572 206f  eError('Number o
-00002410: 6620 6469 6d65 6e73 696f 6e73 206d 7573  f dimensions mus
-00002420: 7420 6265 2031 2c20 3220 6f72 2033 2729  t be 1, 2 or 3')
-00002430: 0a0a 2020 2020 2020 2020 6966 206d 6f64  ..        if mod
-00002440: 6520 6e6f 7420 696e 205b 2763 6c61 7373  e not in ['class
-00002450: 6966 6963 6174 696f 6e27 2c20 2772 6567  ification', 'reg
-00002460: 7265 7373 696f 6e27 5d3a 0a20 2020 2020  ression']:.     
-00002470: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00002480: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00002490: 2020 2020 2020 2020 2022 6d6f 6465 206d           "mode m
-000024a0: 7573 7420 6265 2065 6974 6865 7220 2763  ust be either 'c
-000024b0: 6c61 7373 6966 6963 6174 696f 6e27 206f  lassification' o
-000024c0: 7220 2772 6567 7265 7373 696f 6e27 2229  r 'regression'")
-000024d0: 0a0a 2020 2020 2020 2020 7365 6c66 2e6e  ..        self.n
-000024e0: 5f74 6173 6b73 203d 206e 5f74 6173 6b73  _tasks = n_tasks
-000024f0: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
-00002500: 6665 6174 7572 6573 203d 206e 5f66 6561  features = n_fea
-00002510: 7475 7265 730a 2020 2020 2020 2020 7365  tures.        se
-00002520: 6c66 2e64 696d 7320 3d20 6469 6d73 0a20  lf.dims = dims. 
-00002530: 2020 2020 2020 2073 656c 662e 6d6f 6465         self.mode
-00002540: 203d 206d 6f64 650a 2020 2020 2020 2020   = mode.        
-00002550: 7365 6c66 2e6e 5f63 6c61 7373 6573 203d  self.n_classes =
-00002560: 206e 5f63 6c61 7373 6573 0a20 2020 2020   n_classes.     
-00002570: 2020 2073 656c 662e 756e 6365 7274 6169     self.uncertai
-00002580: 6e74 7920 3d20 756e 6365 7274 6169 6e74  nty = uncertaint
-00002590: 790a 2020 2020 2020 2020 7365 6c66 2e6d  y.        self.m
-000025a0: 6f64 6520 3d20 6d6f 6465 0a20 2020 2020  ode = mode.     
-000025b0: 2020 2073 656c 662e 6c61 7965 725f 6669     self.layer_fi
-000025c0: 6c74 6572 7320 3d20 6c61 7965 725f 6669  lters = layer_fi
-000025d0: 6c74 6572 730a 2020 2020 2020 2020 7365  lters.        se
-000025e0: 6c66 2e72 6573 6964 7561 6c20 3d20 7265  lf.residual = re
-000025f0: 7369 6475 616c 0a0a 2020 2020 2020 2020  sidual..        
-00002600: 6e5f 6c61 7965 7273 203d 206c 656e 286c  n_layers = len(l
-00002610: 6179 6572 5f66 696c 7465 7273 290a 0a20  ayer_filters).. 
-00002620: 2020 2020 2020 2023 2050 7954 6f72 6368         # PyTorch
-00002630: 206c 6179 6572 7320 7265 7175 6972 6520   layers require 
-00002640: 696e 7075 7420 616e 6420 6f75 7470 7574  input and output
-00002650: 2063 6861 6e6e 656c 7320 6173 2070 6172   channels as par
-00002660: 616d 6574 6572 0a20 2020 2020 2020 2023  ameter.        #
-00002670: 2069 6620 6f6e 6c79 206f 6e65 206c 6179   if only one lay
-00002680: 6572 2074 6f20 6d61 6b65 2074 6865 206d  er to make the m
-00002690: 6f64 656c 2063 7265 6174 696e 6720 6c6f  odel creating lo
-000026a0: 6f70 2062 656c 6f77 2077 6f72 6b2c 206d  op below work, m
-000026b0: 756c 7469 706c 7920 6c61 7965 725f 6669  ultiply layer_fi
-000026c0: 6c74 6572 7320 7775 7467 2032 0a20 2020  lters wutg 2.   
-000026d0: 2020 2020 2069 6620 6c65 6e28 6c61 7965       if len(laye
-000026e0: 725f 6669 6c74 6572 7329 203d 3d20 313a  r_filters) == 1:
-000026f0: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00002700: 6572 5f66 696c 7465 7273 203d 206c 6179  er_filters = lay
-00002710: 6572 5f66 696c 7465 7273 202a 2032 0a0a  er_filters * 2..
-00002720: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00002730: 7369 6e73 7461 6e63 6528 6b65 726e 656c  sinstance(kernel
-00002740: 5f73 697a 652c 2053 6571 7565 6e63 6543  _size, SequenceC
-00002750: 6f6c 6c65 6374 696f 6e29 3a0a 2020 2020  ollection):.    
-00002760: 2020 2020 2020 2020 6b65 726e 656c 5f73          kernel_s
-00002770: 697a 6520 3d20 5b6b 6572 6e65 6c5f 7369  ize = [kernel_si
-00002780: 7a65 5d20 2a20 6e5f 6c61 7965 7273 0a20  ze] * n_layers. 
-00002790: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-000027a0: 696e 7374 616e 6365 2873 7472 6964 6573  instance(strides
-000027b0: 2c20 5365 7175 656e 6365 436f 6c6c 6563  , SequenceCollec
-000027c0: 7469 6f6e 293a 0a20 2020 2020 2020 2020  tion):.         
-000027d0: 2020 2073 7472 6964 6573 203d 205b 7374     strides = [st
-000027e0: 7269 6465 735d 202a 206e 5f6c 6179 6572  rides] * n_layer
-000027f0: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
-00002800: 2069 7369 6e73 7461 6e63 6528 6472 6f70   isinstance(drop
-00002810: 6f75 7473 2c20 5365 7175 656e 6365 436f  outs, SequenceCo
-00002820: 6c6c 6563 7469 6f6e 293a 0a20 2020 2020  llection):.     
-00002830: 2020 2020 2020 2064 726f 706f 7574 7320         dropouts 
-00002840: 3d20 5b64 726f 706f 7574 735d 202a 206e  = [dropouts] * n
-00002850: 5f6c 6179 6572 730a 2020 2020 2020 2020  _layers.        
-00002860: 6966 2069 7369 6e73 7461 6e63 6528 0a20  if isinstance(. 
-00002870: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00002880: 6374 6976 6174 696f 6e5f 666e 732c 0a20  ctivation_fns,. 
-00002890: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000028a0: 7472 2920 6f72 206e 6f74 2069 7369 6e73  tr) or not isins
-000028b0: 7461 6e63 6528 6163 7469 7661 7469 6f6e  tance(activation
-000028c0: 5f66 6e73 2c20 5365 7175 656e 6365 436f  _fns, SequenceCo
-000028d0: 6c6c 6563 7469 6f6e 293a 0a20 2020 2020  llection):.     
-000028e0: 2020 2020 2020 2061 6374 6976 6174 696f         activatio
-000028f0: 6e5f 666e 7320 3d20 5b61 6374 6976 6174  n_fns = [activat
-00002900: 696f 6e5f 666e 735d 202a 206e 5f6c 6179  ion_fns] * n_lay
-00002910: 6572 730a 2020 2020 2020 2020 6966 206e  ers.        if n
-00002920: 6f74 2069 7369 6e73 7461 6e63 6528 7765  ot isinstance(we
-00002930: 6967 6874 5f69 6e69 745f 7374 6464 6576  ight_init_stddev
-00002940: 732c 2053 6571 7565 6e63 6543 6f6c 6c65  s, SequenceColle
-00002950: 6374 696f 6e29 3a0a 2020 2020 2020 2020  ction):.        
-00002960: 2020 2020 7765 6967 6874 5f69 6e69 745f      weight_init_
-00002970: 7374 6464 6576 7320 3d20 5b77 6569 6768  stddevs = [weigh
-00002980: 745f 696e 6974 5f73 7464 6465 7673 5d20  t_init_stddevs] 
-00002990: 2a20 6e5f 6c61 7965 7273 0a20 2020 2020  * n_layers.     
-000029a0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-000029b0: 616e 6365 2862 6961 735f 696e 6974 5f63  ance(bias_init_c
-000029c0: 6f6e 7374 732c 2053 6571 7565 6e63 6543  onsts, SequenceC
-000029d0: 6f6c 6c65 6374 696f 6e29 3a0a 2020 2020  ollection):.    
-000029e0: 2020 2020 2020 2020 6269 6173 5f69 6e69          bias_ini
-000029f0: 745f 636f 6e73 7473 203d 205b 6269 6173  t_consts = [bias
-00002a00: 5f69 6e69 745f 636f 6e73 7473 5d20 2a20  _init_consts] * 
-00002a10: 6e5f 6c61 7965 7273 0a0a 2020 2020 2020  n_layers..      
-00002a20: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
-00002a30: 6e5f 666e 7320 3d20 5b67 6574 5f61 6374  n_fns = [get_act
-00002a40: 6976 6174 696f 6e28 6629 2066 6f72 2066  ivation(f) for f
-00002a50: 2069 6e20 6163 7469 7661 7469 6f6e 5f66   in activation_f
-00002a60: 6e73 5d0a 2020 2020 2020 2020 7365 6c66  ns].        self
-00002a70: 2e64 726f 706f 7574 7320 3d20 6472 6f70  .dropouts = drop
-00002a80: 6f75 7473 0a0a 2020 2020 2020 2020 6966  outs..        if
-00002a90: 2075 6e63 6572 7461 696e 7479 3a0a 0a20   uncertainty:.. 
-00002aa0: 2020 2020 2020 2020 2020 2069 6620 6d6f             if mo
-00002ab0: 6465 2021 3d20 2772 6567 7265 7373 696f  de != 'regressio
-00002ac0: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
-00002ad0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00002ae0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00002af0: 2020 2020 2020 2020 2020 2255 6e63 6572            "Uncer
-00002b00: 7461 696e 7479 2069 7320 6f6e 6c79 2073  tainty is only s
-00002b10: 7570 706f 7274 6564 2069 6e20 7265 6772  upported in regr
-00002b20: 6573 7369 6f6e 206d 6f64 6522 290a 0a20  ession mode").. 
-00002b30: 2020 2020 2020 2020 2020 2069 6620 616e             if an
-00002b40: 7928 6420 3d3d 2030 2e30 2066 6f72 2064  y(d == 0.0 for d
-00002b50: 2069 6e20 6472 6f70 6f75 7473 293a 0a20   in dropouts):. 
-00002b60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00002b70: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00002b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002b90: 2020 2020 2027 4472 6f70 6f75 7420 6d75       'Dropout mu
-00002ba0: 7374 2062 6520 696e 636c 7564 6564 2069  st be included i
-00002bb0: 6e20 6576 6572 7920 6c61 7965 7220 746f  n every layer to
-00002bc0: 2070 7265 6469 6374 2075 6e63 6572 7461   predict uncerta
-00002bd0: 696e 7479 270a 2020 2020 2020 2020 2020  inty'.          
-00002be0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00002bf0: 2023 2050 7974 686f 6e20 7475 706c 6573   # Python tuples
-00002c00: 2075 7365 2030 2062 6173 6564 2069 6e64   use 0 based ind
-00002c10: 6578 696e 672c 2064 696d 7320 6465 6669  exing, dims defi
-00002c20: 6e65 7320 6e75 6d62 6572 206f 6620 6469  nes number of di
-00002c30: 6d65 6e73 696f 6e20 666f 7220 636f 6e76  mension for conv
-00002c40: 6f6c 7574 696f 6e61 6c20 6f70 6572 6174  olutional operat
-00002c50: 696f 6e0a 2020 2020 2020 2020 436f 6e76  ion.        Conv
-00002c60: 4c61 7965 7220 3d20 286e 6e2e 436f 6e76  Layer = (nn.Conv
-00002c70: 3164 2c20 6e6e 2e43 6f6e 7632 642c 206e  1d, nn.Conv2d, n
-00002c80: 6e2e 436f 6e76 3364 295b 7365 6c66 2e64  n.Conv3d)[self.d
-00002c90: 696d 7320 2d20 315d 0a0a 2020 2020 2020  ims - 1]..      
-00002ca0: 2020 6966 2070 6f6f 6c5f 7479 7065 203d    if pool_type =
-00002cb0: 3d20 2761 7665 7261 6765 273a 0a20 2020  = 'average':.   
-00002cc0: 2020 2020 2020 2020 2050 6f6f 6c4c 6179           PoolLay
-00002cd0: 6572 203d 2028 462e 6176 675f 706f 6f6c  er = (F.avg_pool
-00002ce0: 3164 2c20 462e 6176 675f 706f 6f6c 3264  1d, F.avg_pool2d
-00002cf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00002d00: 2020 2020 2020 2020 2020 2046 2e61 7667             F.avg
-00002d10: 5f70 6f6f 6c33 6429 5b73 656c 662e 6469  _pool3d)[self.di
-00002d20: 6d73 202d 2031 5d0a 2020 2020 2020 2020  ms - 1].        
-00002d30: 656c 6966 2070 6f6f 6c5f 7479 7065 203d  elif pool_type =
-00002d40: 3d20 276d 6178 273a 0a20 2020 2020 2020  = 'max':.       
-00002d50: 2020 2020 2050 6f6f 6c4c 6179 6572 203d       PoolLayer =
-00002d60: 2028 462e 6d61 785f 706f 6f6c 3164 2c20   (F.max_pool1d, 
-00002d70: 462e 6d61 785f 706f 6f6c 3264 2c0a 2020  F.max_pool2d,.  
-00002d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d90: 2020 2020 2020 2046 2e6d 6178 5f70 6f6f         F.max_poo
-00002da0: 6c33 6429 5b73 656c 662e 6469 6d73 202d  l3d)[self.dims -
-00002db0: 2031 5d0a 2020 2020 2020 2020 656c 7365   1].        else
-00002dc0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00002dd0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-00002de0: 706f 6f6c 5f74 7970 6520 6d75 7374 2062  pool_type must b
-00002df0: 6520 6569 7468 6572 2027 6176 6572 6167  e either 'averag
-00002e00: 6527 206f 7220 276d 6178 2722 290a 0a20  e' or 'max'").. 
-00002e10: 2020 2020 2020 2073 656c 662e 506f 6f6c         self.Pool
-00002e20: 4c61 7965 7220 3d20 506f 6f6c 4c61 7965  Layer = PoolLaye
-00002e30: 720a 2020 2020 2020 2020 7365 6c66 2e6c  r.        self.l
-00002e40: 6179 6572 7320 3d20 6e6e 2e4d 6f64 756c  ayers = nn.Modul
-00002e50: 654c 6973 7428 290a 0a20 2020 2020 2020  eList()..       
-00002e60: 2069 6e5f 7368 6170 6520 3d20 6e5f 6665   in_shape = n_fe
-00002e70: 6174 7572 6573 0a0a 2020 2020 2020 2020  atures..        
-00002e80: 666f 7220 6f75 745f 7368 6170 652c 2073  for out_shape, s
-00002e90: 697a 652c 2073 7472 6964 652c 2077 6569  ize, stride, wei
-00002ea0: 6768 745f 7374 6464 6576 2c20 6269 6173  ght_stddev, bias
-00002eb0: 5f63 6f6e 7374 2069 6e20 7a69 7028 0a20  _const in zip(. 
-00002ec0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00002ed0: 6179 6572 5f66 696c 7465 7273 2c20 6b65  ayer_filters, ke
-00002ee0: 726e 656c 5f73 697a 652c 2073 7472 6964  rnel_size, strid
-00002ef0: 6573 2c20 7765 6967 6874 5f69 6e69 745f  es, weight_init_
-00002f00: 7374 6464 6576 732c 0a20 2020 2020 2020  stddevs,.       
-00002f10: 2020 2020 2020 2020 2062 6961 735f 696e           bias_in
-00002f20: 6974 5f63 6f6e 7374 7329 3a0a 0a20 2020  it_consts):..   
-00002f30: 2020 2020 2020 2020 206c 6179 6572 203d           layer =
-00002f40: 2043 6f6e 764c 6179 6572 2869 6e5f 6368   ConvLayer(in_ch
-00002f50: 616e 6e65 6c73 3d69 6e5f 7368 6170 652c  annels=in_shape,
-00002f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002f70: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00002f80: 7574 5f63 6861 6e6e 656c 733d 6f75 745f  ut_channels=out_
-00002f90: 7368 6170 652c 0a20 2020 2020 2020 2020  shape,.         
+00000060: 616c 6c61 626c 652c 2044 6963 740a 6672  allable, Dict.fr
+00000070: 6f6d 2063 6f6c 6c65 6374 696f 6e73 2e61  om collections.a
+00000080: 6263 2069 6d70 6f72 7420 5365 7175 656e  bc import Sequen
+00000090: 6365 2061 7320 5365 7175 656e 6365 436f  ce as SequenceCo
+000000a0: 6c6c 6563 7469 6f6e 0a74 7279 3a0a 2020  llection.try:.  
+000000b0: 2020 696d 706f 7274 2074 6f72 6368 0a20    import torch. 
+000000c0: 2020 2066 726f 6d20 746f 7263 6820 696d     from torch im
+000000d0: 706f 7274 2054 656e 736f 720a 2020 2020  port Tensor.    
+000000e0: 696d 706f 7274 2074 6f72 6368 2e6e 6e20  import torch.nn 
+000000f0: 6173 206e 6e0a 2020 2020 696d 706f 7274  as nn.    import
+00000100: 2074 6f72 6368 2e6e 6e2e 6675 6e63 7469   torch.nn.functi
+00000110: 6f6e 616c 2061 7320 460a 6578 6365 7074  onal as F.except
+00000120: 204d 6f64 756c 654e 6f74 466f 756e 6445   ModuleNotFoundE
+00000130: 7272 6f72 3a0a 2020 2020 7261 6973 6520  rror:.    raise 
+00000140: 496d 706f 7274 4572 726f 7228 2754 6865  ImportError('The
+00000150: 7365 2063 6c61 7373 6573 2072 6571 7569  se classes requi
+00000160: 7265 2050 7954 6f72 6368 2074 6f20 6265  re PyTorch to be
+00000170: 2069 6e73 7461 6c6c 6564 2e27 290a 0a74   installed.')..t
+00000180: 7279 3a0a 2020 2020 6672 6f6d 2074 6f72  ry:.    from tor
+00000190: 6368 5f67 656f 6d65 7472 6963 2e75 7469  ch_geometric.uti
+000001a0: 6c73 2069 6d70 6f72 7420 7363 6174 7465  ls import scatte
+000001b0: 720a 6578 6365 7074 204d 6f64 756c 654e  r.except ModuleN
+000001c0: 6f74 466f 756e 6445 7272 6f72 3a0a 2020  otFoundError:.  
+000001d0: 2020 7061 7373 0a0a 6672 6f6d 2064 6565    pass..from dee
+000001e0: 7063 6865 6d2e 7574 696c 732e 7479 7069  pchem.utils.typi
+000001f0: 6e67 2069 6d70 6f72 7420 4f6e 654f 724d  ng import OneOrM
+00000200: 616e 792c 2041 6374 6976 6174 696f 6e46  any, ActivationF
+00000210: 6e2c 2041 7272 6179 4c69 6b65 0a66 726f  n, ArrayLike.fro
+00000220: 6d20 6465 6570 6368 656d 2e75 7469 6c73  m deepchem.utils
+00000230: 2e70 7974 6f72 6368 5f75 7469 6c73 2069  .pytorch_utils i
+00000240: 6d70 6f72 7420 6765 745f 6163 7469 7661  mport get_activa
+00000250: 7469 6f6e 2c20 7365 676d 656e 745f 7375  tion, segment_su
+00000260: 6d0a 6672 6f6d 2074 6f72 6368 2e6e 6e20  m.from torch.nn 
+00000270: 696d 706f 7274 2069 6e69 7420 6173 2069  import init as i
+00000280: 6e69 7469 616c 697a 6572 730a 0a0a 636c  nitializers...cl
+00000290: 6173 7320 4d75 6c74 696c 6179 6572 5065  ass MultilayerPe
+000002a0: 7263 6570 7472 6f6e 286e 6e2e 4d6f 6475  rceptron(nn.Modu
+000002b0: 6c65 293a 0a20 2020 2022 2222 4120 7369  le):.    """A si
+000002c0: 6d70 6c65 2066 756c 6c79 2063 6f6e 6e65  mple fully conne
+000002d0: 6374 6564 2066 6565 642d 666f 7277 6172  cted feed-forwar
+000002e0: 6420 6e65 7477 6f72 6b2c 206f 7468 6572  d network, other
+000002f0: 7769 7365 206b 6e6f 776e 2061 7320 6120  wise known as a 
+00000300: 6d75 6c74 696c 6179 6572 2070 6572 6365  multilayer perce
+00000310: 7074 726f 6e20 284d 4c50 292e 0a0a 2020  ptron (MLP)...  
+00000320: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+00000330: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+00000340: 6d6f 6465 6c20 3d20 4d75 6c74 696c 6179  model = Multilay
+00000350: 6572 5065 7263 6570 7472 6f6e 2864 5f69  erPerceptron(d_i
+00000360: 6e70 7574 3d31 302c 2064 5f68 6964 6465  nput=10, d_hidde
+00000370: 6e3d 2832 2c33 292c 2064 5f6f 7574 7075  n=(2,3), d_outpu
+00000380: 743d 322c 2064 726f 706f 7574 3d30 2e30  t=2, dropout=0.0
+00000390: 2c20 6163 7469 7661 7469 6f6e 5f66 6e3d  , activation_fn=
+000003a0: 2772 656c 7527 290a 2020 2020 3e3e 3e20  'relu').    >>> 
+000003b0: 7820 3d20 746f 7263 682e 6f6e 6573 2832  x = torch.ones(2
+000003c0: 2c20 3130 290a 2020 2020 3e3e 3e20 6f75  , 10).    >>> ou
+000003d0: 7420 3d20 6d6f 6465 6c28 7829 0a20 2020  t = model(x).   
+000003e0: 203e 3e3e 2070 7269 6e74 286f 7574 2e73   >>> print(out.s
+000003f0: 6861 7065 290a 2020 2020 746f 7263 682e  hape).    torch.
+00000400: 5369 7a65 285b 322c 2032 5d29 0a20 2020  Size([2, 2]).   
+00000410: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+00000420: 696e 6974 5f5f 2873 656c 662c 0a20 2020  init__(self,.   
+00000430: 2020 2020 2020 2020 2020 2020 2020 645f                d_
+00000440: 696e 7075 743a 2069 6e74 2c0a 2020 2020  input: int,.    
+00000450: 2020 2020 2020 2020 2020 2020 2064 5f6f               d_o
+00000460: 7574 7075 743a 2069 6e74 2c0a 2020 2020  utput: int,.    
+00000470: 2020 2020 2020 2020 2020 2020 2064 5f68               d_h
+00000480: 6964 6465 6e3a 204f 7074 696f 6e61 6c5b  idden: Optional[
+00000490: 7475 706c 655d 203d 204e 6f6e 652c 0a20  tuple] = None,. 
+000004a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000004b0: 6472 6f70 6f75 743a 2066 6c6f 6174 203d  dropout: float =
+000004c0: 2030 2e30 2c0a 2020 2020 2020 2020 2020   0.0,.          
+000004d0: 2020 2020 2020 2062 6174 6368 5f6e 6f72         batch_nor
+000004e0: 6d3a 2062 6f6f 6c20 3d20 4661 6c73 652c  m: bool = False,
+000004f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000500: 2020 6261 7463 685f 6e6f 726d 5f6d 6f6d    batch_norm_mom
+00000510: 656e 7475 6d3a 2066 6c6f 6174 203d 2030  entum: float = 0
+00000520: 2e31 2c0a 2020 2020 2020 2020 2020 2020  .1,.            
+00000530: 2020 2020 2061 6374 6976 6174 696f 6e5f       activation_
+00000540: 666e 3a20 556e 696f 6e5b 4361 6c6c 6162  fn: Union[Callab
+00000550: 6c65 2c20 7374 725d 203d 2027 7265 6c75  le, str] = 'relu
+00000560: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00000570: 2020 2020 736b 6970 5f63 6f6e 6e65 6374      skip_connect
+00000580: 696f 6e3a 2062 6f6f 6c20 3d20 4661 6c73  ion: bool = Fals
+00000590: 6529 3a0a 2020 2020 2020 2020 2222 2249  e):.        """I
+000005a0: 6e69 7469 616c 697a 6520 7468 6520 6d6f  nitialize the mo
+000005b0: 6465 6c2e 0a0a 2020 2020 2020 2020 5061  del...        Pa
+000005c0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+000005d0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+000005e0: 2020 2020 645f 696e 7075 743a 2069 6e74      d_input: int
+000005f0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00000600: 2064 696d 656e 7369 6f6e 206f 6620 7468   dimension of th
+00000610: 6520 696e 7075 7420 6c61 7965 720a 2020  e input layer.  
+00000620: 2020 2020 2020 645f 6f75 7470 7574 3a20        d_output: 
+00000630: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+00000640: 7468 6520 6469 6d65 6e73 696f 6e20 6f66  the dimension of
+00000650: 2074 6865 206f 7574 7075 7420 6c61 7965   the output laye
+00000660: 720a 2020 2020 2020 2020 645f 6869 6464  r.        d_hidd
+00000670: 656e 3a20 7475 706c 650a 2020 2020 2020  en: tuple.      
+00000680: 2020 2020 2020 7468 6520 6469 6d65 6e73        the dimens
+00000690: 696f 6e73 206f 6620 7468 6520 6869 6464  ions of the hidd
+000006a0: 656e 206c 6179 6572 730a 2020 2020 2020  en layers.      
+000006b0: 2020 6472 6f70 6f75 743a 2066 6c6f 6174    dropout: float
+000006c0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+000006d0: 2064 726f 706f 7574 2070 726f 6261 6269   dropout probabi
+000006e0: 6c69 7479 0a20 2020 2020 2020 2062 6174  lity.        bat
+000006f0: 6368 5f6e 6f72 6d3a 2062 6f6f 6c0a 2020  ch_norm: bool.  
+00000700: 2020 2020 2020 2020 2020 7768 6574 6865            whethe
+00000710: 7220 746f 2075 7365 2062 6174 6368 206e  r to use batch n
+00000720: 6f72 6d61 6c69 7a61 7469 6f6e 0a20 2020  ormalization.   
+00000730: 2020 2020 2062 6174 6368 5f6e 6f72 6d5f       batch_norm_
+00000740: 6d6f 6d65 6e74 756d 3a20 666c 6f61 740a  momentum: float.
+00000750: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00000760: 6d6f 6d65 6e74 756d 2066 6f72 2062 6174  momentum for bat
+00000770: 6368 206e 6f72 6d61 6c69 7a61 7469 6f6e  ch normalization
+00000780: 0a20 2020 2020 2020 2061 6374 6976 6174  .        activat
+00000790: 696f 6e5f 666e 3a20 7374 720a 2020 2020  ion_fn: str.    
+000007a0: 2020 2020 2020 2020 7468 6520 6163 7469          the acti
+000007b0: 7661 7469 6f6e 2066 756e 6374 696f 6e20  vation function 
+000007c0: 746f 2075 7365 2069 6e20 7468 6520 6869  to use in the hi
+000007d0: 6464 656e 206c 6179 6572 730a 2020 2020  dden layers.    
+000007e0: 2020 2020 736b 6970 5f63 6f6e 6e65 6374      skip_connect
+000007f0: 696f 6e3a 2062 6f6f 6c0a 2020 2020 2020  ion: bool.      
+00000800: 2020 2020 2020 7768 6574 6865 7220 746f        whether to
+00000810: 2061 6464 2061 2073 6b69 7020 636f 6e6e   add a skip conn
+00000820: 6563 7469 6f6e 2066 726f 6d20 7468 6520  ection from the 
+00000830: 696e 7075 7420 746f 2074 6865 206f 7574  input to the out
+00000840: 7075 740a 2020 2020 2020 2020 2222 220a  put.        """.
+00000850: 2020 2020 2020 2020 7375 7065 7228 4d75          super(Mu
+00000860: 6c74 696c 6179 6572 5065 7263 6570 7472  ltilayerPerceptr
+00000870: 6f6e 2c20 7365 6c66 292e 5f5f 696e 6974  on, self).__init
+00000880: 5f5f 2829 0a20 2020 2020 2020 2073 656c  __().        sel
+00000890: 662e 645f 696e 7075 7420 3d20 645f 696e  f.d_input = d_in
+000008a0: 7075 740a 2020 2020 2020 2020 7365 6c66  put.        self
+000008b0: 2e64 5f68 6964 6465 6e20 3d20 645f 6869  .d_hidden = d_hi
+000008c0: 6464 656e 0a20 2020 2020 2020 2073 656c  dden.        sel
+000008d0: 662e 645f 6f75 7470 7574 203d 2064 5f6f  f.d_output = d_o
+000008e0: 7574 7075 740a 2020 2020 2020 2020 7365  utput.        se
+000008f0: 6c66 2e64 726f 706f 7574 203d 206e 6e2e  lf.dropout = nn.
+00000900: 4472 6f70 6f75 7428 6472 6f70 6f75 7429  Dropout(dropout)
+00000910: 0a20 2020 2020 2020 2073 656c 662e 6261  .        self.ba
+00000920: 7463 685f 6e6f 726d 203d 2062 6174 6368  tch_norm = batch
+00000930: 5f6e 6f72 6d0a 2020 2020 2020 2020 7365  _norm.        se
+00000940: 6c66 2e62 6174 6368 5f6e 6f72 6d5f 6d6f  lf.batch_norm_mo
+00000950: 6d65 6e74 756d 203d 2062 6174 6368 5f6e  mentum = batch_n
+00000960: 6f72 6d5f 6d6f 6d65 6e74 756d 0a20 2020  orm_momentum.   
+00000970: 2020 2020 2073 656c 662e 6163 7469 7661       self.activa
+00000980: 7469 6f6e 5f66 6e20 3d20 6765 745f 6163  tion_fn = get_ac
+00000990: 7469 7661 7469 6f6e 2861 6374 6976 6174  tivation(activat
+000009a0: 696f 6e5f 666e 290a 2020 2020 2020 2020  ion_fn).        
+000009b0: 7365 6c66 2e6d 6f64 656c 203d 206e 6e2e  self.model = nn.
+000009c0: 5365 7175 656e 7469 616c 282a 7365 6c66  Sequential(*self
+000009d0: 2e62 7569 6c64 5f6c 6179 6572 7328 2929  .build_layers())
+000009e0: 0a20 2020 2020 2020 2073 656c 662e 736b  .        self.sk
+000009f0: 6970 203d 206e 6e2e 4c69 6e65 6172 2864  ip = nn.Linear(d
+00000a00: 5f69 6e70 7574 2c20 645f 6f75 7470 7574  _input, d_output
+00000a10: 2920 6966 2073 6b69 705f 636f 6e6e 6563  ) if skip_connec
+00000a20: 7469 6f6e 2065 6c73 6520 4e6f 6e65 0a0a  tion else None..
+00000a30: 2020 2020 6465 6620 6275 696c 645f 6c61      def build_la
+00000a40: 7965 7273 2873 656c 6629 3a0a 2020 2020  yers(self):.    
+00000a50: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00000a60: 4275 696c 6420 7468 6520 6c61 7965 7273  Build the layers
+00000a70: 206f 6620 7468 6520 6d6f 6465 6c2c 2069   of the model, i
+00000a80: 7465 7261 7469 6e67 2074 6872 6f75 6768  terating through
+00000a90: 2074 6865 2068 6964 6465 6e20 6469 6d65   the hidden dime
+00000aa0: 6e73 696f 6e73 2074 6f20 7072 6f64 7563  nsions to produc
+00000ab0: 6520 6120 6c69 7374 206f 6620 6c61 7965  e a list of laye
+00000ac0: 7273 2e0a 2020 2020 2020 2020 2222 220a  rs..        """.
+00000ad0: 0a20 2020 2020 2020 206c 6179 6572 5f6c  .        layer_l
+00000ae0: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
+00000af0: 206c 6179 6572 5f64 696d 203d 2073 656c   layer_dim = sel
+00000b00: 662e 645f 696e 7075 740a 2020 2020 2020  f.d_input.      
+00000b10: 2020 6966 2073 656c 662e 645f 6869 6464    if self.d_hidd
+00000b20: 656e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  en is not None:.
+00000b30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00000b40: 6420 696e 2073 656c 662e 645f 6869 6464  d in self.d_hidd
+00000b50: 656e 3a0a 2020 2020 2020 2020 2020 2020  en:.            
+00000b60: 2020 2020 6c61 7965 725f 6c69 7374 2e61      layer_list.a
+00000b70: 7070 656e 6428 6e6e 2e4c 696e 6561 7228  ppend(nn.Linear(
+00000b80: 6c61 7965 725f 6469 6d2c 2064 2929 0a20  layer_dim, d)). 
+00000b90: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00000ba0: 6179 6572 5f6c 6973 742e 6170 7065 6e64  ayer_list.append
+00000bb0: 2873 656c 662e 6472 6f70 6f75 7429 0a20  (self.dropout). 
+00000bc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00000bd0: 6620 7365 6c66 2e62 6174 6368 5f6e 6f72  f self.batch_nor
+00000be0: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
+00000bf0: 2020 2020 2020 206c 6179 6572 5f6c 6973         layer_lis
+00000c00: 742e 6170 7065 6e64 280a 2020 2020 2020  t.append(.      
+00000c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000c20: 2020 6e6e 2e42 6174 6368 4e6f 726d 3164    nn.BatchNorm1d
+00000c30: 2864 2c20 6d6f 6d65 6e74 756d 3d73 656c  (d, momentum=sel
+00000c40: 662e 6261 7463 685f 6e6f 726d 5f6d 6f6d  f.batch_norm_mom
+00000c50: 656e 7475 6d29 290a 2020 2020 2020 2020  entum)).        
+00000c60: 2020 2020 2020 2020 6c61 7965 725f 6469          layer_di
+00000c70: 6d20 3d20 640a 2020 2020 2020 2020 6c61  m = d.        la
+00000c80: 7965 725f 6c69 7374 2e61 7070 656e 6428  yer_list.append(
+00000c90: 6e6e 2e4c 696e 6561 7228 6c61 7965 725f  nn.Linear(layer_
+00000ca0: 6469 6d2c 2073 656c 662e 645f 6f75 7470  dim, self.d_outp
+00000cb0: 7574 2929 0a20 2020 2020 2020 2072 6574  ut)).        ret
+00000cc0: 7572 6e20 6c61 7965 725f 6c69 7374 0a0a  urn layer_list..
+00000cd0: 2020 2020 6465 6620 666f 7277 6172 6428      def forward(
+00000ce0: 7365 6c66 2c20 783a 2054 656e 736f 7229  self, x: Tensor)
+00000cf0: 202d 3e20 5465 6e73 6f72 3a0a 2020 2020   -> Tensor:.    
+00000d00: 2020 2020 2222 2246 6f72 7761 7264 2070      """Forward p
+00000d10: 6173 7320 6f66 2074 6865 206d 6f64 656c  ass of the model
+00000d20: 2e22 2222 0a20 2020 2020 2020 2069 6e70  .""".        inp
+00000d30: 7574 203d 2078 0a20 2020 2020 2020 2066  ut = x.        f
+00000d40: 6f72 206c 6179 6572 2069 6e20 7365 6c66  or layer in self
+00000d50: 2e6d 6f64 656c 3a0a 2020 2020 2020 2020  .model:.        
+00000d60: 2020 2020 7820 3d20 6c61 7965 7228 7829      x = layer(x)
+00000d70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00000d80: 6973 696e 7374 616e 6365 286c 6179 6572  isinstance(layer
+00000d90: 2c20 6e6e 2e4c 696e 6561 7229 3a0a 2020  , nn.Linear):.  
+00000da0: 2020 2020 2020 2020 2020 2020 2020 7820                x 
+00000db0: 3d20 7365 6c66 2e61 6374 6976 6174 696f  = self.activatio
+00000dc0: 6e5f 666e 280a 2020 2020 2020 2020 2020  n_fn(.          
+00000dd0: 2020 2020 2020 2020 2020 780a 2020 2020            x.    
+00000de0: 2020 2020 2020 2020 2020 2020 2920 2023              )  #
+00000df0: 2044 6f6e 6520 6265 6361 7573 6520 6163   Done because ac
+00000e00: 7469 7661 7469 6f6e 5f66 6e20 7265 7475  tivation_fn retu
+00000e10: 726e 7320 6120 746f 7263 682e 6e6e 2e66  rns a torch.nn.f
+00000e20: 756e 6374 696f 6e61 6c0a 2020 2020 2020  unctional.      
+00000e30: 2020 6966 2073 656c 662e 736b 6970 2069    if self.skip i
+00000e40: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00000e50: 2020 2020 2020 2020 7265 7475 726e 2078          return x
+00000e60: 202b 2073 656c 662e 736b 6970 2869 6e70   + self.skip(inp
+00000e70: 7574 290a 2020 2020 2020 2020 656c 7365  ut).        else
+00000e80: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00000e90: 7475 726e 2078 0a0a 0a63 6c61 7373 2043  turn x...class C
+00000ea0: 4e4e 4d6f 6475 6c65 286e 6e2e 4d6f 6475  NNModule(nn.Modu
+00000eb0: 6c65 293a 0a20 2020 2022 2222 4120 312c  le):.    """A 1,
+00000ec0: 2032 2c20 6f72 2033 2064 696d 656e 7369   2, or 3 dimensi
+00000ed0: 6f6e 616c 2063 6f6e 766f 6c75 7469 6f6e  onal convolution
+00000ee0: 616c 206e 6574 776f 726b 2066 6f72 2065  al network for e
+00000ef0: 6974 6865 7220 7265 6772 6573 7369 6f6e  ither regression
+00000f00: 206f 7220 636c 6173 7369 6669 6361 7469   or classificati
+00000f10: 6f6e 2e0a 2020 2020 5468 6520 6e65 7477  on..    The netw
+00000f20: 6f72 6b20 636f 6e73 6973 7473 206f 6620  ork consists of 
+00000f30: 7468 6520 666f 6c6c 6f77 696e 6720 7365  the following se
+00000f40: 7175 656e 6365 206f 6620 6c61 7965 7273  quence of layers
+00000f50: 3a0a 2020 2020 2d20 4120 636f 6e66 6967  :.    - A config
+00000f60: 7572 6162 6c65 206e 756d 6265 7220 6f66  urable number of
+00000f70: 2063 6f6e 766f 6c75 7469 6f6e 616c 206c   convolutional l
+00000f80: 6179 6572 730a 2020 2020 2d20 4120 676c  ayers.    - A gl
+00000f90: 6f62 616c 2070 6f6f 6c69 6e67 206c 6179  obal pooling lay
+00000fa0: 6572 2028 6569 7468 6572 206d 6178 2070  er (either max p
+00000fb0: 6f6f 6c20 6f72 2061 7665 7261 6765 2070  ool or average p
+00000fc0: 6f6f 6c29 0a20 2020 202d 2041 2066 696e  ool).    - A fin
+00000fd0: 616c 2066 756c 6c79 2063 6f6e 6e65 6374  al fully connect
+00000fe0: 6564 206c 6179 6572 2074 6f20 636f 6d70  ed layer to comp
+00000ff0: 7574 6520 7468 6520 6f75 7470 7574 0a20  ute the output. 
+00001000: 2020 2049 7420 6f70 7469 6f6e 616c 6c79     It optionally
+00001010: 2063 616e 2063 6f6d 706f 7365 2074 6865   can compose the
+00001020: 206d 6f64 656c 2066 726f 6d20 7072 652d   model from pre-
+00001030: 6163 7469 7661 7469 6f6e 2072 6573 6964  activation resid
+00001040: 7561 6c20 626c 6f63 6b73 2c20 6173 0a20  ual blocks, as. 
+00001050: 2020 2064 6573 6372 6962 6564 2069 6e20     described in 
+00001060: 6874 7470 733a 2f2f 6172 7869 762e 6f72  https://arxiv.or
+00001070: 672f 6162 732f 3136 3033 2e30 3530 3237  g/abs/1603.05027
+00001080: 2c20 7261 7468 6572 2074 6861 6e20 6120  , rather than a 
+00001090: 7369 6d70 6c65 2073 7461 636b 206f 660a  simple stack of.
+000010a0: 2020 2020 636f 6e76 6f6c 7574 696f 6e20      convolution 
+000010b0: 6c61 7965 7273 2e20 2054 6869 7320 6f66  layers.  This of
+000010c0: 7465 6e20 6c65 6164 7320 746f 2065 6173  ten leads to eas
+000010d0: 6965 7220 7472 6169 6e69 6e67 2c20 6573  ier training, es
+000010e0: 7065 6369 616c 6c79 2077 6865 6e20 7573  pecially when us
+000010f0: 696e 6720 610a 2020 2020 6c61 7267 6520  ing a.    large 
+00001100: 6e75 6d62 6572 206f 6620 6c61 7965 7273  number of layers
+00001110: 2e20 204e 6f74 6520 7468 6174 2072 6573  .  Note that res
+00001120: 6964 7561 6c20 626c 6f63 6b73 2063 616e  idual blocks can
+00001130: 206f 6e6c 7920 6265 2075 7365 6420 7768   only be used wh
+00001140: 656e 0a20 2020 2073 7563 6365 7373 6976  en.    successiv
+00001150: 6520 6c61 7965 7273 2068 6176 6520 7468  e layers have th
+00001160: 6520 7361 6d65 206f 7574 7075 7420 7368  e same output sh
+00001170: 6170 652e 2020 5768 6572 6576 6572 2074  ape.  Wherever t
+00001180: 6865 206f 7574 7075 7420 7368 6170 6520  he output shape 
+00001190: 6368 616e 6765 732c 2061 0a20 2020 2073  changes, a.    s
+000011a0: 696d 706c 6520 636f 6e76 6f6c 7574 696f  imple convolutio
+000011b0: 6e20 6c61 7965 7220 7769 6c6c 2062 6520  n layer will be 
+000011c0: 7573 6564 2065 7665 6e20 6966 2072 6573  used even if res
+000011d0: 6964 7561 6c3d 5472 7565 2e0a 2020 2020  idual=True..    
+000011e0: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
+000011f0: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 6d6f  -----.    >>> mo
+00001200: 6465 6c20 3d20 434e 4e4d 6f64 756c 6528  del = CNNModule(
+00001210: 6e5f 7461 736b 733d 352c 206e 5f66 6561  n_tasks=5, n_fea
+00001220: 7475 7265 733d 382c 2064 696d 733d 322c  tures=8, dims=2,
+00001230: 206c 6179 6572 5f66 696c 7465 7273 3d5b   layer_filters=[
+00001240: 332c 382c 382c 3136 5d2c 206b 6572 6e65  3,8,8,16], kerne
+00001250: 6c5f 7369 7a65 3d33 2c20 6e5f 636c 6173  l_size=3, n_clas
+00001260: 7365 7320 3d20 372c 206d 6f64 653d 2763  ses = 7, mode='c
+00001270: 6c61 7373 6966 6963 6174 696f 6e27 2c20  lassification', 
+00001280: 756e 6365 7274 6169 6e74 793d 4661 6c73  uncertainty=Fals
+00001290: 652c 2070 6164 6469 6e67 3d27 7361 6d65  e, padding='same
+000012a0: 2729 0a20 2020 203e 3e3e 2078 203d 2074  ').    >>> x = t
+000012b0: 6f72 6368 2e6f 6e65 7328 322c 2032 3234  orch.ones(2, 224
+000012c0: 2c20 3232 342c 2038 290a 2020 2020 3e3e  , 224, 8).    >>
+000012d0: 3e20 7820 3d20 6d6f 6465 6c28 7829 0a20  > x = model(x). 
+000012e0: 2020 203e 3e3e 2066 6f72 2074 656e 736f     >>> for tenso
+000012f0: 7220 696e 2078 3a0a 2020 2020 2e2e 2e20  r in x:.    ... 
+00001300: 2020 2070 7269 6e74 2874 656e 736f 722e     print(tensor.
+00001310: 7368 6170 6529 0a20 2020 2074 6f72 6368  shape).    torch
+00001320: 2e53 697a 6528 5b32 2c20 352c 2037 5d29  .Size([2, 5, 7])
+00001330: 0a20 2020 2074 6f72 6368 2e53 697a 6528  .    torch.Size(
+00001340: 5b32 2c20 352c 2037 5d29 0a20 2020 2022  [2, 5, 7]).    "
+00001350: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+00001360: 6974 5f5f 2873 656c 662c 0a20 2020 2020  it__(self,.     
+00001370: 2020 2020 2020 2020 2020 2020 6e5f 7461              n_ta
+00001380: 736b 733a 2069 6e74 2c0a 2020 2020 2020  sks: int,.      
+00001390: 2020 2020 2020 2020 2020 206e 5f66 6561             n_fea
+000013a0: 7475 7265 733a 2069 6e74 2c0a 2020 2020  tures: int,.    
+000013b0: 2020 2020 2020 2020 2020 2020 2064 696d               dim
+000013c0: 733a 2069 6e74 2c0a 2020 2020 2020 2020  s: int,.        
+000013d0: 2020 2020 2020 2020 206c 6179 6572 5f66           layer_f
+000013e0: 696c 7465 7273 3a20 4c69 7374 5b69 6e74  ilters: List[int
+000013f0: 5d20 3d20 5b31 3030 5d2c 0a20 2020 2020  ] = [100],.     
+00001400: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
+00001410: 656c 5f73 697a 653a 204f 6e65 4f72 4d61  el_size: OneOrMa
+00001420: 6e79 5b69 6e74 5d20 3d20 352c 0a20 2020  ny[int] = 5,.   
+00001430: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00001440: 7269 6465 733a 204f 6e65 4f72 4d61 6e79  rides: OneOrMany
+00001450: 5b69 6e74 5d20 3d20 312c 0a20 2020 2020  [int] = 1,.     
+00001460: 2020 2020 2020 2020 2020 2020 7765 6967              weig
+00001470: 6874 5f69 6e69 745f 7374 6464 6576 733a  ht_init_stddevs:
+00001480: 204f 6e65 4f72 4d61 6e79 5b66 6c6f 6174   OneOrMany[float
+00001490: 5d20 3d20 302e 3032 2c0a 2020 2020 2020  ] = 0.02,.      
+000014a0: 2020 2020 2020 2020 2020 2062 6961 735f             bias_
+000014b0: 696e 6974 5f63 6f6e 7374 733a 204f 6e65  init_consts: One
+000014c0: 4f72 4d61 6e79 5b66 6c6f 6174 5d20 3d20  OrMany[float] = 
+000014d0: 312e 302c 0a20 2020 2020 2020 2020 2020  1.0,.           
+000014e0: 2020 2020 2020 6472 6f70 6f75 7473 3a20        dropouts: 
+000014f0: 4f6e 654f 724d 616e 795b 666c 6f61 745d  OneOrMany[float]
+00001500: 203d 2030 2e35 2c0a 2020 2020 2020 2020   = 0.5,.        
+00001510: 2020 2020 2020 2020 2061 6374 6976 6174           activat
+00001520: 696f 6e5f 666e 733a 204f 6e65 4f72 4d61  ion_fns: OneOrMa
+00001530: 6e79 5b41 6374 6976 6174 696f 6e46 6e5d  ny[ActivationFn]
+00001540: 203d 2027 7265 6c75 272c 0a20 2020 2020   = 'relu',.     
+00001550: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+00001560: 5f74 7970 653a 2073 7472 203d 2027 6d61  _type: str = 'ma
+00001570: 7827 2c0a 2020 2020 2020 2020 2020 2020  x',.            
+00001580: 2020 2020 206d 6f64 653a 2073 7472 203d       mode: str =
+00001590: 2027 636c 6173 7369 6669 6361 7469 6f6e   'classification
+000015a0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+000015b0: 2020 2020 6e5f 636c 6173 7365 733a 2069      n_classes: i
+000015c0: 6e74 203d 2032 2c0a 2020 2020 2020 2020  nt = 2,.        
+000015d0: 2020 2020 2020 2020 2075 6e63 6572 7461           uncerta
+000015e0: 696e 7479 3a20 626f 6f6c 203d 2046 616c  inty: bool = Fal
+000015f0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00001600: 2020 2020 2072 6573 6964 7561 6c3a 2062       residual: b
+00001610: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+00001620: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00001630: 6464 696e 673a 2055 6e69 6f6e 5b69 6e74  dding: Union[int
+00001640: 2c20 7374 725d 203d 2027 7661 6c69 6427  , str] = 'valid'
+00001650: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00001660: 2020 2022 2222 4372 6561 7465 2061 2043     """Create a C
+00001670: 4e4e 2e0a 0a20 2020 2020 2020 2050 6172  NN...        Par
+00001680: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+00001690: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+000016a0: 2020 206e 5f74 6173 6b73 3a20 696e 740a     n_tasks: int.
+000016b0: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
+000016c0: 6572 206f 6620 7461 736b 730a 2020 2020  er of tasks.    
+000016d0: 2020 2020 6e5f 6665 6174 7572 6573 3a20      n_features: 
+000016e0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+000016f0: 6e75 6d62 6572 206f 6620 6665 6174 7572  number of featur
+00001700: 6573 0a20 2020 2020 2020 2064 696d 733a  es.        dims:
+00001710: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
+00001720: 2074 6865 206e 756d 6265 7220 6f66 2064   the number of d
+00001730: 696d 656e 7369 6f6e 7320 746f 2061 7070  imensions to app
+00001740: 6c79 2063 6f6e 766f 6c75 7469 6f6e 7320  ly convolutions 
+00001750: 6f76 6572 2028 312c 2032 2c20 6f72 2033  over (1, 2, or 3
+00001760: 290a 2020 2020 2020 2020 6c61 7965 725f  ).        layer_
+00001770: 6669 6c74 6572 733a 206c 6973 740a 2020  filters: list.  
+00001780: 2020 2020 2020 2020 2020 7468 6520 6e75            the nu
+00001790: 6d62 6572 206f 6620 6f75 7470 7574 2066  mber of output f
+000017a0: 696c 7465 7273 2066 6f72 2065 6163 6820  ilters for each 
+000017b0: 636f 6e76 6f6c 7574 696f 6e61 6c20 6c61  convolutional la
+000017c0: 7965 7220 696e 2074 6865 206e 6574 776f  yer in the netwo
+000017d0: 726b 2e0a 2020 2020 2020 2020 2020 2020  rk..            
+000017e0: 5468 6520 6c65 6e67 7468 206f 6620 7468  The length of th
+000017f0: 6973 206c 6973 7420 6465 7465 726d 696e  is list determin
+00001800: 6573 2074 6865 206e 756d 6265 7220 6f66  es the number of
+00001810: 206c 6179 6572 732e 0a20 2020 2020 2020   layers..       
+00001820: 206b 6572 6e65 6c5f 7369 7a65 3a20 696e   kernel_size: in
+00001830: 742c 2074 7570 6c65 2c20 6f72 206c 6973  t, tuple, or lis
+00001840: 740a 2020 2020 2020 2020 2020 2020 6120  t.            a 
+00001850: 6c69 7374 2067 6976 696e 6720 7468 6520  list giving the 
+00001860: 7368 6170 6520 6f66 2074 6865 2063 6f6e  shape of the con
+00001870: 766f 6c75 7469 6f6e 616c 206b 6572 6e65  volutional kerne
+00001880: 6c20 666f 7220 6561 6368 206c 6179 6572  l for each layer
+00001890: 2e20 2045 6163 680a 2020 2020 2020 2020  .  Each.        
+000018a0: 2020 2020 656c 656d 656e 7420 6d61 7920      element may 
+000018b0: 6265 2065 6974 6865 7220 616e 2069 6e74  be either an int
+000018c0: 2028 7573 6520 7468 6520 7361 6d65 206b   (use the same k
+000018d0: 6572 6e65 6c20 7769 6474 6820 666f 7220  ernel width for 
+000018e0: 6576 6572 7920 6469 6d65 6e73 696f 6e29  every dimension)
+000018f0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+00001900: 6120 7475 706c 6520 2874 6865 206b 6572  a tuple (the ker
+00001910: 6e65 6c20 7769 6474 6820 616c 6f6e 6720  nel width along 
+00001920: 6561 6368 2064 696d 656e 7369 6f6e 292e  each dimension).
+00001930: 2020 416c 7465 726e 6174 6976 656c 7920    Alternatively 
+00001940: 7468 6973 206d 6179 0a20 2020 2020 2020  this may.       
+00001950: 2020 2020 2062 6520 6120 7369 6e67 6c65       be a single
+00001960: 2069 6e74 206f 7220 7475 706c 6520 696e   int or tuple in
+00001970: 7374 6561 6420 6f66 2061 206c 6973 742c  stead of a list,
+00001980: 2069 6e20 7768 6963 6820 6361 7365 2074   in which case t
+00001990: 6865 2073 616d 6520 6b65 726e 656c 0a20  he same kernel. 
+000019a0: 2020 2020 2020 2020 2020 2073 6861 7065             shape
+000019b0: 2069 7320 7573 6564 2066 6f72 2065 7665   is used for eve
+000019c0: 7279 206c 6179 6572 2e0a 2020 2020 2020  ry layer..      
+000019d0: 2020 7374 7269 6465 733a 2069 6e74 2c20    strides: int, 
+000019e0: 7475 706c 652c 206f 7220 6c69 7374 0a20  tuple, or list. 
+000019f0: 2020 2020 2020 2020 2020 2061 206c 6973             a lis
+00001a00: 7420 6769 7669 6e67 2074 6865 2073 7472  t giving the str
+00001a10: 6964 6520 6265 7477 6565 6e20 6170 706c  ide between appl
+00001a20: 6963 6174 696f 6e73 206f 6620 7468 6520  ications of the 
+00001a30: 206b 6572 6e65 6c20 666f 7220 6561 6368   kernel for each
+00001a40: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+00001a50: 2020 2020 4561 6368 2065 6c65 6d65 6e74      Each element
+00001a60: 206d 6179 2062 6520 6569 7468 6572 2061   may be either a
+00001a70: 6e20 696e 7420 2875 7365 2074 6865 2073  n int (use the s
+00001a80: 616d 6520 7374 7269 6465 2066 6f72 2065  ame stride for e
+00001a90: 7665 7279 2064 696d 656e 7369 6f6e 290a  very dimension).
+00001aa0: 2020 2020 2020 2020 2020 2020 6f72 2061              or a
+00001ab0: 2074 7570 6c65 2028 7468 6520 7374 7269   tuple (the stri
+00001ac0: 6465 2061 6c6f 6e67 2065 6163 6820 6469  de along each di
+00001ad0: 6d65 6e73 696f 6e29 2e20 2041 6c74 6572  mension).  Alter
+00001ae0: 6e61 7469 7665 6c79 2074 6869 7320 6d61  natively this ma
+00001af0: 7920 6265 2061 0a20 2020 2020 2020 2020  y be a.         
+00001b00: 2020 2073 696e 676c 6520 696e 7420 6f72     single int or
+00001b10: 2074 7570 6c65 2069 6e73 7465 6164 206f   tuple instead o
+00001b20: 6620 6120 6c69 7374 2c20 696e 2077 6869  f a list, in whi
+00001b30: 6368 2063 6173 6520 7468 6520 7361 6d65  ch case the same
+00001b40: 2073 7472 6964 6520 6973 0a20 2020 2020   stride is.     
+00001b50: 2020 2020 2020 2075 7365 6420 666f 7220         used for 
+00001b60: 6576 6572 7920 6c61 7965 722e 0a20 2020  every layer..   
+00001b70: 2020 2020 2077 6569 6768 745f 696e 6974       weight_init
+00001b80: 5f73 7464 6465 7673 3a20 6c69 7374 206f  _stddevs: list o
+00001b90: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
+00001ba0: 2020 2020 7468 6520 7374 616e 6461 7264      the standard
+00001bb0: 2064 6576 6961 7469 6f6e 206f 6620 7468   deviation of th
+00001bc0: 6520 6469 7374 7269 6275 7469 6f6e 2074  e distribution t
+00001bd0: 6f20 7573 6520 666f 7220 7765 6967 6874  o use for weight
+00001be0: 2069 6e69 7469 616c 697a 6174 696f 6e0a   initialization.
+00001bf0: 2020 2020 2020 2020 2020 2020 6f66 2065              of e
+00001c00: 6163 6820 6c61 7965 722e 2020 5468 6520  ach layer.  The 
+00001c10: 6c65 6e67 7468 206f 6620 7468 6973 206c  length of this l
+00001c20: 6973 7420 7368 6f75 6c64 2065 7175 616c  ist should equal
+00001c30: 206c 656e 286c 6179 6572 5f66 696c 7465   len(layer_filte
+00001c40: 7273 292b 312c 0a20 2020 2020 2020 2020  rs)+1,.         
+00001c50: 2020 2077 6865 7265 2074 6865 2066 696e     where the fin
+00001c60: 616c 2065 6c65 6d65 6e74 2063 6f72 7265  al element corre
+00001c70: 7370 6f6e 6473 2074 6f20 7468 6520 6465  sponds to the de
+00001c80: 6e73 6520 6c61 7965 722e 2020 416c 7465  nse layer.  Alte
+00001c90: 726e 6174 6976 656c 7920 7468 6973 0a20  rnatively this. 
+00001ca0: 2020 2020 2020 2020 2020 206d 6179 2062             may b
+00001cb0: 6520 6120 7369 6e67 6c65 2076 616c 7565  e a single value
+00001cc0: 2069 6e73 7465 6164 206f 6620 6120 6c69   instead of a li
+00001cd0: 7374 2c20 696e 2077 6869 6368 2063 6173  st, in which cas
+00001ce0: 6520 7468 6520 7361 6d65 2076 616c 7565  e the same value
+00001cf0: 2069 7320 7573 6564 0a20 2020 2020 2020   is used.       
+00001d00: 2020 2020 2066 6f72 2065 7665 7279 206c       for every l
+00001d10: 6179 6572 2e0a 2020 2020 2020 2020 6269  ayer..        bi
+00001d20: 6173 5f69 6e69 745f 636f 6e73 7473 3a20  as_init_consts: 
+00001d30: 6c69 7374 206f 7220 666c 6f61 740a 2020  list or float.  
+00001d40: 2020 2020 2020 2020 2020 7468 6520 7661            the va
+00001d50: 6c75 6520 746f 2069 6e69 7469 616c 697a  lue to initializ
+00001d60: 6520 7468 6520 6269 6173 6573 2069 6e20  e the biases in 
+00001d70: 6561 6368 206c 6179 6572 2074 6f2e 2020  each layer to.  
+00001d80: 5468 6520 6c65 6e67 7468 206f 6620 7468  The length of th
+00001d90: 6973 0a20 2020 2020 2020 2020 2020 206c  is.            l
+00001da0: 6973 7420 7368 6f75 6c64 2065 7175 616c  ist should equal
+00001db0: 206c 656e 286c 6179 6572 5f66 696c 7465   len(layer_filte
+00001dc0: 7273 292b 312c 2077 6865 7265 2074 6865  rs)+1, where the
+00001dd0: 2066 696e 616c 2065 6c65 6d65 6e74 2063   final element c
+00001de0: 6f72 7265 7370 6f6e 6473 0a20 2020 2020  orresponds.     
+00001df0: 2020 2020 2020 2074 6f20 7468 6520 6465         to the de
+00001e00: 6e73 6520 6c61 7965 722e 2020 416c 7465  nse layer.  Alte
+00001e10: 726e 6174 6976 656c 7920 7468 6973 206d  rnatively this m
+00001e20: 6179 2062 6520 6120 7369 6e67 6c65 2076  ay be a single v
+00001e30: 616c 7565 2069 6e73 7465 6164 206f 6620  alue instead of 
+00001e40: 610a 2020 2020 2020 2020 2020 2020 6c69  a.            li
+00001e50: 7374 2c20 696e 2077 6869 6368 2063 6173  st, in which cas
+00001e60: 6520 7468 6520 7361 6d65 2076 616c 7565  e the same value
+00001e70: 2069 7320 7573 6564 2066 6f72 2065 7665   is used for eve
+00001e80: 7279 206c 6179 6572 2e0a 2020 2020 2020  ry layer..      
+00001e90: 2020 6472 6f70 6f75 7473 3a20 6c69 7374    dropouts: list
+00001ea0: 206f 7220 666c 6f61 740a 2020 2020 2020   or float.      
+00001eb0: 2020 2020 2020 7468 6520 6472 6f70 6f75        the dropou
+00001ec0: 7420 7072 6f62 6162 696c 6974 7920 746f  t probability to
+00001ed0: 2075 7365 2066 6f72 2065 6163 6820 6c61   use for each la
+00001ee0: 7965 722e 2020 5468 6520 6c65 6e67 7468  yer.  The length
+00001ef0: 206f 6620 7468 6973 206c 6973 7420 7368   of this list sh
+00001f00: 6f75 6c64 2065 7175 616c 206c 656e 286c  ould equal len(l
+00001f10: 6179 6572 5f66 696c 7465 7273 292e 0a20  ayer_filters).. 
+00001f20: 2020 2020 2020 2020 2020 2041 6c74 6572             Alter
+00001f30: 6e61 7469 7665 6c79 2074 6869 7320 6d61  natively this ma
+00001f40: 7920 6265 2061 2073 696e 676c 6520 7661  y be a single va
+00001f50: 6c75 6520 696e 7374 6561 6420 6f66 2061  lue instead of a
+00001f60: 206c 6973 742c 2069 6e20 7768 6963 6820   list, in which 
+00001f70: 6361 7365 2074 6865 2073 616d 6520 7661  case the same va
+00001f80: 6c75 6520 6973 2075 7365 6420 666f 7220  lue is used for 
+00001f90: 6576 6572 7920 6c61 7965 720a 2020 2020  every layer.    
+00001fa0: 2020 2020 6163 7469 7661 7469 6f6e 5f66      activation_f
+00001fb0: 6e73 3a20 7374 7220 6f72 206c 6973 740a  ns: str or list.
+00001fc0: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00001fd0: 746f 7263 6820 6163 7469 7661 7469 6f6e  torch activation
+00001fe0: 2066 756e 6374 696f 6e20 746f 2061 7070   function to app
+00001ff0: 6c79 2074 6f20 6561 6368 206c 6179 6572  ly to each layer
+00002000: 2e20 5468 6520 6c65 6e67 7468 206f 6620  . The length of 
+00002010: 7468 6973 206c 6973 7420 7368 6f75 6c64  this list should
+00002020: 2065 7175 616c 0a20 2020 2020 2020 2020   equal.         
+00002030: 2020 206c 656e 286c 6179 6572 5f66 696c     len(layer_fil
+00002040: 7465 7273 292e 2020 416c 7465 726e 6174  ters).  Alternat
+00002050: 6976 656c 7920 7468 6973 206d 6179 2062  ively this may b
+00002060: 6520 6120 7369 6e67 6c65 2076 616c 7565  e a single value
+00002070: 2069 6e73 7465 6164 206f 6620 6120 6c69   instead of a li
+00002080: 7374 2c20 696e 2077 6869 6368 2063 6173  st, in which cas
+00002090: 6520 7468 650a 2020 2020 2020 2020 2020  e the.          
+000020a0: 2020 7361 6d65 2076 616c 7565 2069 7320    same value is 
+000020b0: 7573 6564 2066 6f72 2065 7665 7279 206c  used for every l
+000020c0: 6179 6572 2c20 2772 656c 7527 2062 7920  ayer, 'relu' by 
+000020d0: 6465 6661 756c 740a 2020 2020 2020 2020  default.        
+000020e0: 706f 6f6c 5f74 7970 653a 2073 7472 0a20  pool_type: str. 
+000020f0: 2020 2020 2020 2020 2020 2074 6865 2074             the t
+00002100: 7970 6520 6f66 2070 6f6f 6c69 6e67 206c  ype of pooling l
+00002110: 6179 6572 2074 6f20 7573 652c 2065 6974  ayer to use, eit
+00002120: 6865 7220 276d 6178 2720 6f72 2027 6176  her 'max' or 'av
+00002130: 6572 6167 6527 0a20 2020 2020 2020 206d  erage'.        m
+00002140: 6f64 653a 2073 7472 0a20 2020 2020 2020  ode: str.       
+00002150: 2020 2020 2045 6974 6865 7220 2763 6c61       Either 'cla
+00002160: 7373 6966 6963 6174 696f 6e27 206f 7220  ssification' or 
+00002170: 2772 6567 7265 7373 696f 6e27 0a20 2020  'regression'.   
+00002180: 2020 2020 206e 5f63 6c61 7373 6573 3a20       n_classes: 
+00002190: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+000021a0: 7468 6520 6e75 6d62 6572 206f 6620 636c  the number of cl
+000021b0: 6173 7365 7320 746f 2070 7265 6469 6374  asses to predict
+000021c0: 2028 6f6e 6c79 2075 7365 6420 696e 2063   (only used in c
+000021d0: 6c61 7373 6966 6963 6174 696f 6e20 6d6f  lassification mo
+000021e0: 6465 290a 2020 2020 2020 2020 756e 6365  de).        unce
+000021f0: 7274 6169 6e74 793a 2062 6f6f 6c0a 2020  rtainty: bool.  
+00002200: 2020 2020 2020 2020 2020 6966 2054 7275            if Tru
+00002210: 652c 2069 6e63 6c75 6465 2065 7874 7261  e, include extra
+00002220: 206f 7574 7075 7473 2061 6e64 206c 6f73   outputs and los
+00002230: 7320 7465 726d 7320 746f 2065 6e61 626c  s terms to enabl
+00002240: 6520 7468 6520 756e 6365 7274 6169 6e74  e the uncertaint
+00002250: 790a 2020 2020 2020 2020 2020 2020 696e  y.            in
+00002260: 206f 7574 7075 7473 2074 6f20 6265 2070   outputs to be p
+00002270: 7265 6469 6374 6564 0a20 2020 2020 2020  redicted.       
+00002280: 2072 6573 6964 7561 6c3a 2062 6f6f 6c0a   residual: bool.
+00002290: 2020 2020 2020 2020 2020 2020 6966 2054              if T
+000022a0: 7275 652c 2074 6865 206d 6f64 656c 2077  rue, the model w
+000022b0: 696c 6c20 6265 2063 6f6d 706f 7365 6420  ill be composed 
+000022c0: 6f66 2070 7265 2d61 6374 6976 6174 696f  of pre-activatio
+000022d0: 6e20 7265 7369 6475 616c 2062 6c6f 636b  n residual block
+000022e0: 7320 696e 7374 6561 640a 2020 2020 2020  s instead.      
+000022f0: 2020 2020 2020 6f66 2061 2073 696d 706c        of a simpl
+00002300: 6520 7374 6163 6b20 6f66 2063 6f6e 766f  e stack of convo
+00002310: 6c75 7469 6f6e 616c 206c 6179 6572 732e  lutional layers.
+00002320: 0a20 2020 2020 2020 2070 6164 6469 6e67  .        padding
+00002330: 3a20 7374 722c 2069 6e74 206f 7220 7475  : str, int or tu
+00002340: 706c 650a 2020 2020 2020 2020 2020 2020  ple.            
+00002350: 7468 6520 7061 6464 696e 6720 746f 2075  the padding to u
+00002360: 7365 2066 6f72 2063 6f6e 766f 6c75 7469  se for convoluti
+00002370: 6f6e 616c 206c 6179 6572 732c 2065 6974  onal layers, eit
+00002380: 6865 7220 2776 616c 6964 2720 6f72 2027  her 'valid' or '
+00002390: 7361 6d65 270a 2020 2020 2020 2020 2222  same'.        ""
+000023a0: 220a 0a20 2020 2020 2020 2073 7570 6572  "..        super
+000023b0: 2843 4e4e 4d6f 6475 6c65 2c20 7365 6c66  (CNNModule, self
+000023c0: 292e 5f5f 696e 6974 5f5f 2829 0a0a 2020  ).__init__()..  
+000023d0: 2020 2020 2020 6966 2064 696d 7320 6e6f        if dims no
+000023e0: 7420 696e 2028 312c 2032 2c20 3329 3a0a  t in (1, 2, 3):.
+000023f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00002400: 6520 5661 6c75 6545 7272 6f72 2827 4e75  e ValueError('Nu
+00002410: 6d62 6572 206f 6620 6469 6d65 6e73 696f  mber of dimensio
+00002420: 6e73 206d 7573 7420 6265 2031 2c20 3220  ns must be 1, 2 
+00002430: 6f72 2033 2729 0a0a 2020 2020 2020 2020  or 3')..        
+00002440: 6966 206d 6f64 6520 6e6f 7420 696e 205b  if mode not in [
+00002450: 2763 6c61 7373 6966 6963 6174 696f 6e27  'classification'
+00002460: 2c20 2772 6567 7265 7373 696f 6e27 5d3a  , 'regression']:
+00002470: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00002480: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00002490: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000024a0: 6d6f 6465 206d 7573 7420 6265 2065 6974  mode must be eit
+000024b0: 6865 7220 2763 6c61 7373 6966 6963 6174  her 'classificat
+000024c0: 696f 6e27 206f 7220 2772 6567 7265 7373  ion' or 'regress
+000024d0: 696f 6e27 2229 0a0a 2020 2020 2020 2020  ion'")..        
+000024e0: 7365 6c66 2e6e 5f74 6173 6b73 203d 206e  self.n_tasks = n
+000024f0: 5f74 6173 6b73 0a20 2020 2020 2020 2073  _tasks.        s
+00002500: 656c 662e 6e5f 6665 6174 7572 6573 203d  elf.n_features =
+00002510: 206e 5f66 6561 7475 7265 730a 2020 2020   n_features.    
+00002520: 2020 2020 7365 6c66 2e64 696d 7320 3d20      self.dims = 
+00002530: 6469 6d73 0a20 2020 2020 2020 2073 656c  dims.        sel
+00002540: 662e 6d6f 6465 203d 206d 6f64 650a 2020  f.mode = mode.  
+00002550: 2020 2020 2020 7365 6c66 2e6e 5f63 6c61        self.n_cla
+00002560: 7373 6573 203d 206e 5f63 6c61 7373 6573  sses = n_classes
+00002570: 0a20 2020 2020 2020 2073 656c 662e 756e  .        self.un
+00002580: 6365 7274 6169 6e74 7920 3d20 756e 6365  certainty = unce
+00002590: 7274 6169 6e74 790a 2020 2020 2020 2020  rtainty.        
+000025a0: 7365 6c66 2e6d 6f64 6520 3d20 6d6f 6465  self.mode = mode
+000025b0: 0a20 2020 2020 2020 2073 656c 662e 6c61  .        self.la
+000025c0: 7965 725f 6669 6c74 6572 7320 3d20 6c61  yer_filters = la
+000025d0: 7965 725f 6669 6c74 6572 730a 2020 2020  yer_filters.    
+000025e0: 2020 2020 7365 6c66 2e72 6573 6964 7561      self.residua
+000025f0: 6c20 3d20 7265 7369 6475 616c 0a0a 2020  l = residual..  
+00002600: 2020 2020 2020 6e5f 6c61 7965 7273 203d        n_layers =
+00002610: 206c 656e 286c 6179 6572 5f66 696c 7465   len(layer_filte
+00002620: 7273 290a 0a20 2020 2020 2020 2023 2050  rs)..        # P
+00002630: 7954 6f72 6368 206c 6179 6572 7320 7265  yTorch layers re
+00002640: 7175 6972 6520 696e 7075 7420 616e 6420  quire input and 
+00002650: 6f75 7470 7574 2063 6861 6e6e 656c 7320  output channels 
+00002660: 6173 2070 6172 616d 6574 6572 0a20 2020  as parameter.   
+00002670: 2020 2020 2023 2069 6620 6f6e 6c79 206f       # if only o
+00002680: 6e65 206c 6179 6572 2074 6f20 6d61 6b65  ne layer to make
+00002690: 2074 6865 206d 6f64 656c 2063 7265 6174   the model creat
+000026a0: 696e 6720 6c6f 6f70 2062 656c 6f77 2077  ing loop below w
+000026b0: 6f72 6b2c 206d 756c 7469 706c 7920 6c61  ork, multiply la
+000026c0: 7965 725f 6669 6c74 6572 7320 7775 7467  yer_filters wutg
+000026d0: 2032 0a20 2020 2020 2020 2069 6620 6c65   2.        if le
+000026e0: 6e28 6c61 7965 725f 6669 6c74 6572 7329  n(layer_filters)
+000026f0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00002700: 2020 206c 6179 6572 5f66 696c 7465 7273     layer_filters
+00002710: 203d 206c 6179 6572 5f66 696c 7465 7273   = layer_filters
+00002720: 202a 2032 0a0a 2020 2020 2020 2020 6966   * 2..        if
+00002730: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00002740: 6b65 726e 656c 5f73 697a 652c 2053 6571  kernel_size, Seq
+00002750: 7565 6e63 6543 6f6c 6c65 6374 696f 6e29  uenceCollection)
+00002760: 3a0a 2020 2020 2020 2020 2020 2020 6b65  :.            ke
+00002770: 726e 656c 5f73 697a 6520 3d20 5b6b 6572  rnel_size = [ker
+00002780: 6e65 6c5f 7369 7a65 5d20 2a20 6e5f 6c61  nel_size] * n_la
+00002790: 7965 7273 0a20 2020 2020 2020 2069 6620  yers.        if 
+000027a0: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
+000027b0: 7472 6964 6573 2c20 5365 7175 656e 6365  trides, Sequence
+000027c0: 436f 6c6c 6563 7469 6f6e 293a 0a20 2020  Collection):.   
+000027d0: 2020 2020 2020 2020 2073 7472 6964 6573           strides
+000027e0: 203d 205b 7374 7269 6465 735d 202a 206e   = [strides] * n
+000027f0: 5f6c 6179 6572 730a 2020 2020 2020 2020  _layers.        
+00002800: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00002810: 6528 6472 6f70 6f75 7473 2c20 5365 7175  e(dropouts, Sequ
+00002820: 656e 6365 436f 6c6c 6563 7469 6f6e 293a  enceCollection):
+00002830: 0a20 2020 2020 2020 2020 2020 2064 726f  .            dro
+00002840: 706f 7574 7320 3d20 5b64 726f 706f 7574  pouts = [dropout
+00002850: 735d 202a 206e 5f6c 6179 6572 730a 2020  s] * n_layers.  
+00002860: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00002870: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
+00002880: 2020 2020 2061 6374 6976 6174 696f 6e5f       activation_
+00002890: 666e 732c 0a20 2020 2020 2020 2020 2020  fns,.           
+000028a0: 2020 2020 2073 7472 2920 6f72 206e 6f74       str) or not
+000028b0: 2069 7369 6e73 7461 6e63 6528 6163 7469   isinstance(acti
+000028c0: 7661 7469 6f6e 5f66 6e73 2c20 5365 7175  vation_fns, Sequ
+000028d0: 656e 6365 436f 6c6c 6563 7469 6f6e 293a  enceCollection):
+000028e0: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
+000028f0: 6976 6174 696f 6e5f 666e 7320 3d20 5b61  ivation_fns = [a
+00002900: 6374 6976 6174 696f 6e5f 666e 735d 202a  ctivation_fns] *
+00002910: 206e 5f6c 6179 6572 730a 2020 2020 2020   n_layers.      
+00002920: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00002930: 6e63 6528 7765 6967 6874 5f69 6e69 745f  nce(weight_init_
+00002940: 7374 6464 6576 732c 2053 6571 7565 6e63  stddevs, Sequenc
+00002950: 6543 6f6c 6c65 6374 696f 6e29 3a0a 2020  eCollection):.  
+00002960: 2020 2020 2020 2020 2020 7765 6967 6874            weight
+00002970: 5f69 6e69 745f 7374 6464 6576 7320 3d20  _init_stddevs = 
+00002980: 5b77 6569 6768 745f 696e 6974 5f73 7464  [weight_init_std
+00002990: 6465 7673 5d20 2a20 6e5f 6c61 7965 7273  devs] * n_layers
+000029a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000029b0: 6973 696e 7374 616e 6365 2862 6961 735f  isinstance(bias_
+000029c0: 696e 6974 5f63 6f6e 7374 732c 2053 6571  init_consts, Seq
+000029d0: 7565 6e63 6543 6f6c 6c65 6374 696f 6e29  uenceCollection)
+000029e0: 3a0a 2020 2020 2020 2020 2020 2020 6269  :.            bi
+000029f0: 6173 5f69 6e69 745f 636f 6e73 7473 203d  as_init_consts =
+00002a00: 205b 6269 6173 5f69 6e69 745f 636f 6e73   [bias_init_cons
+00002a10: 7473 5d20 2a20 6e5f 6c61 7965 7273 0a0a  ts] * n_layers..
+00002a20: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
+00002a30: 6976 6174 696f 6e5f 666e 7320 3d20 5b67  ivation_fns = [g
+00002a40: 6574 5f61 6374 6976 6174 696f 6e28 6629  et_activation(f)
+00002a50: 2066 6f72 2066 2069 6e20 6163 7469 7661   for f in activa
+00002a60: 7469 6f6e 5f66 6e73 5d0a 2020 2020 2020  tion_fns].      
+00002a70: 2020 7365 6c66 2e64 726f 706f 7574 7320    self.dropouts 
+00002a80: 3d20 6472 6f70 6f75 7473 0a0a 2020 2020  = dropouts..    
+00002a90: 2020 2020 6966 2075 6e63 6572 7461 696e      if uncertain
+00002aa0: 7479 3a0a 0a20 2020 2020 2020 2020 2020  ty:..           
+00002ab0: 2069 6620 6d6f 6465 2021 3d20 2772 6567   if mode != 'reg
+00002ac0: 7265 7373 696f 6e27 3a0a 2020 2020 2020  ression':.      
+00002ad0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00002ae0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00002af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b00: 2255 6e63 6572 7461 696e 7479 2069 7320  "Uncertainty is 
+00002b10: 6f6e 6c79 2073 7570 706f 7274 6564 2069  only supported i
+00002b20: 6e20 7265 6772 6573 7369 6f6e 206d 6f64  n regression mod
+00002b30: 6522 290a 0a20 2020 2020 2020 2020 2020  e")..           
+00002b40: 2069 6620 616e 7928 6420 3d3d 2030 2e30   if any(d == 0.0
+00002b50: 2066 6f72 2064 2069 6e20 6472 6f70 6f75   for d in dropou
+00002b60: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
+00002b70: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00002b80: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00002b90: 2020 2020 2020 2020 2020 2027 4472 6f70             'Drop
+00002ba0: 6f75 7420 6d75 7374 2062 6520 696e 636c  out must be incl
+00002bb0: 7564 6564 2069 6e20 6576 6572 7920 6c61  uded in every la
+00002bc0: 7965 7220 746f 2070 7265 6469 6374 2075  yer to predict u
+00002bd0: 6e63 6572 7461 696e 7479 270a 2020 2020  ncertainty'.    
+00002be0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00002bf0: 2020 2020 2020 2023 2050 7974 686f 6e20         # Python 
+00002c00: 7475 706c 6573 2075 7365 2030 2062 6173  tuples use 0 bas
+00002c10: 6564 2069 6e64 6578 696e 672c 2064 696d  ed indexing, dim
+00002c20: 7320 6465 6669 6e65 7320 6e75 6d62 6572  s defines number
+00002c30: 206f 6620 6469 6d65 6e73 696f 6e20 666f   of dimension fo
+00002c40: 7220 636f 6e76 6f6c 7574 696f 6e61 6c20  r convolutional 
+00002c50: 6f70 6572 6174 696f 6e0a 2020 2020 2020  operation.      
+00002c60: 2020 436f 6e76 4c61 7965 7220 3d20 286e    ConvLayer = (n
+00002c70: 6e2e 436f 6e76 3164 2c20 6e6e 2e43 6f6e  n.Conv1d, nn.Con
+00002c80: 7632 642c 206e 6e2e 436f 6e76 3364 295b  v2d, nn.Conv3d)[
+00002c90: 7365 6c66 2e64 696d 7320 2d20 315d 0a0a  self.dims - 1]..
+00002ca0: 2020 2020 2020 2020 6966 2070 6f6f 6c5f          if pool_
+00002cb0: 7479 7065 203d 3d20 2761 7665 7261 6765  type == 'average
+00002cc0: 273a 0a20 2020 2020 2020 2020 2020 2050  ':.            P
+00002cd0: 6f6f 6c4c 6179 6572 203d 2028 462e 6176  oolLayer = (F.av
+00002ce0: 675f 706f 6f6c 3164 2c20 462e 6176 675f  g_pool1d, F.avg_
+00002cf0: 706f 6f6c 3264 2c0a 2020 2020 2020 2020  pool2d,.        
+00002d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d10: 2046 2e61 7667 5f70 6f6f 6c33 6429 5b73   F.avg_pool3d)[s
+00002d20: 656c 662e 6469 6d73 202d 2031 5d0a 2020  elf.dims - 1].  
+00002d30: 2020 2020 2020 656c 6966 2070 6f6f 6c5f        elif pool_
+00002d40: 7479 7065 203d 3d20 276d 6178 273a 0a20  type == 'max':. 
+00002d50: 2020 2020 2020 2020 2020 2050 6f6f 6c4c             PoolL
+00002d60: 6179 6572 203d 2028 462e 6d61 785f 706f  ayer = (F.max_po
+00002d70: 6f6c 3164 2c20 462e 6d61 785f 706f 6f6c  ol1d, F.max_pool
+00002d80: 3264 2c0a 2020 2020 2020 2020 2020 2020  2d,.            
+00002d90: 2020 2020 2020 2020 2020 2020 2046 2e6d               F.m
+00002da0: 6178 5f70 6f6f 6c33 6429 5b73 656c 662e  ax_pool3d)[self.
+00002db0: 6469 6d73 202d 2031 5d0a 2020 2020 2020  dims - 1].      
+00002dc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00002dd0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00002de0: 7272 6f72 2822 706f 6f6c 5f74 7970 6520  rror("pool_type 
+00002df0: 6d75 7374 2062 6520 6569 7468 6572 2027  must be either '
+00002e00: 6176 6572 6167 6527 206f 7220 276d 6178  average' or 'max
+00002e10: 2722 290a 0a20 2020 2020 2020 2073 656c  '")..        sel
+00002e20: 662e 506f 6f6c 4c61 7965 7220 3d20 506f  f.PoolLayer = Po
+00002e30: 6f6c 4c61 7965 720a 2020 2020 2020 2020  olLayer.        
+00002e40: 7365 6c66 2e6c 6179 6572 7320 3d20 6e6e  self.layers = nn
+00002e50: 2e4d 6f64 756c 654c 6973 7428 290a 0a20  .ModuleList().. 
+00002e60: 2020 2020 2020 2069 6e5f 7368 6170 6520         in_shape 
+00002e70: 3d20 6e5f 6665 6174 7572 6573 0a0a 2020  = n_features..  
+00002e80: 2020 2020 2020 666f 7220 6f75 745f 7368        for out_sh
+00002e90: 6170 652c 2073 697a 652c 2073 7472 6964  ape, size, strid
+00002ea0: 652c 2077 6569 6768 745f 7374 6464 6576  e, weight_stddev
+00002eb0: 2c20 6269 6173 5f63 6f6e 7374 2069 6e20  , bias_const in 
+00002ec0: 7a69 7028 0a20 2020 2020 2020 2020 2020  zip(.           
+00002ed0: 2020 2020 206c 6179 6572 5f66 696c 7465       layer_filte
+00002ee0: 7273 2c20 6b65 726e 656c 5f73 697a 652c  rs, kernel_size,
+00002ef0: 2073 7472 6964 6573 2c20 7765 6967 6874   strides, weight
+00002f00: 5f69 6e69 745f 7374 6464 6576 732c 0a20  _init_stddevs,. 
+00002f10: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00002f20: 6961 735f 696e 6974 5f63 6f6e 7374 7329  ias_init_consts)
+00002f30: 3a0a 0a20 2020 2020 2020 2020 2020 206c  :..            l
+00002f40: 6179 6572 203d 2043 6f6e 764c 6179 6572  ayer = ConvLayer
+00002f50: 2869 6e5f 6368 616e 6e65 6c73 3d69 6e5f  (in_channels=in_
+00002f60: 7368 6170 652c 0a20 2020 2020 2020 2020  shape,.         
+00002f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f80: 2020 2020 206f 7574 5f63 6861 6e6e 656c       out_channel
+00002f90: 733d 6f75 745f 7368 6170 652c 0a20 2020  s=out_shape,.   
 00002fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fb0: 2020 2020 206b 6572 6e65 6c5f 7369 7a65       kernel_size
-00002fc0: 3d73 697a 652c 0a20 2020 2020 2020 2020  =size,.         
+00002fb0: 2020 2020 2020 2020 2020 206b 6572 6e65             kerne
+00002fc0: 6c5f 7369 7a65 3d73 697a 652c 0a20 2020  l_size=size,.   
 00002fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fe0: 2020 2020 2073 7472 6964 653d 7374 7269       stride=stri
-00002ff0: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+00002fe0: 2020 2020 2020 2020 2020 2073 7472 6964             strid
+00002ff0: 653d 7374 7269 6465 2c0a 2020 2020 2020  e=stride,.      
 00003000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003010: 2020 7061 6464 696e 673d 7061 6464 696e    padding=paddin
-00003020: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+00003010: 2020 2020 2020 2020 7061 6464 696e 673d          padding=
+00003020: 7061 6464 696e 672c 0a20 2020 2020 2020  padding,.       
 00003030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003040: 2064 696c 6174 696f 6e3d 312c 0a20 2020   dilation=1,.   
-00003050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003060: 2020 2020 2020 2020 2020 2067 726f 7570             group
-00003070: 733d 312c 0a20 2020 2020 2020 2020 2020  s=1,.           
+00003040: 2020 2020 2020 2064 696c 6174 696f 6e3d         dilation=
+00003050: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
+00003060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003070: 2067 726f 7570 733d 312c 0a20 2020 2020   groups=1,.     
 00003080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003090: 2020 2062 6961 733d 5472 7565 290a 0a20     bias=True).. 
-000030a0: 2020 2020 2020 2020 2020 206e 6e2e 696e             nn.in
-000030b0: 6974 2e6e 6f72 6d61 6c5f 286c 6179 6572  it.normal_(layer
-000030c0: 2e77 6569 6768 742c 2030 2c20 7765 6967  .weight, 0, weig
-000030d0: 6874 5f73 7464 6465 7629 0a0a 2020 2020  ht_stddev)..    
-000030e0: 2020 2020 2020 2020 2320 696e 6974 6961          # initia
-000030f0: 6c69 7a69 6e67 206c 6179 6572 2062 6961  lizing layer bia
-00003100: 7320 7769 7468 206e 6e2e 696e 6974 2067  s with nn.init g
-00003110: 6976 6573 206d 7970 7920 7479 7065 6368  ives mypy typech
-00003120: 6563 6b20 6572 726f 720a 2020 2020 2020  eck error.      
-00003130: 2020 2020 2020 2320 7573 696e 6720 7468        # using th
-00003140: 6520 666f 6c6c 6f77 696e 6720 776f 726b  e following work
-00003150: 6172 6f75 6e64 0a20 2020 2020 2020 2020  around.         
-00003160: 2020 2069 6620 6c61 7965 722e 6269 6173     if layer.bias
-00003170: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00003180: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00003190: 7965 722e 6269 6173 203d 206e 6e2e 5061  yer.bias = nn.Pa
-000031a0: 7261 6d65 7465 7228 0a20 2020 2020 2020  rameter(.       
-000031b0: 2020 2020 2020 2020 2020 2020 2074 6f72               tor
-000031c0: 6368 2e66 756c 6c28 6c61 7965 722e 6269  ch.full(layer.bi
-000031d0: 6173 2e73 6861 7065 2c20 6269 6173 5f63  as.shape, bias_c
-000031e0: 6f6e 7374 2929 0a0a 2020 2020 2020 2020  onst))..        
-000031f0: 2020 2020 7365 6c66 2e6c 6179 6572 732e      self.layers.
-00003200: 6170 7065 6e64 286c 6179 6572 290a 0a20  append(layer).. 
-00003210: 2020 2020 2020 2020 2020 2069 6e5f 7368             in_sh
-00003220: 6170 6520 3d20 6f75 745f 7368 6170 650a  ape = out_shape.
-00003230: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
-00003240: 6173 7369 6669 6572 5f66 666e 203d 206e  assifier_ffn = n
-00003250: 6e2e 4c61 7a79 4c69 6e65 6172 2873 656c  n.LazyLinear(sel
-00003260: 662e 6e5f 7461 736b 7320 2a20 7365 6c66  f.n_tasks * self
-00003270: 2e6e 5f63 6c61 7373 6573 290a 2020 2020  .n_classes).    
-00003280: 2020 2020 7365 6c66 2e6f 7574 7075 745f      self.output_
-00003290: 6c61 7965 7220 3d20 6e6e 2e4c 617a 794c  layer = nn.LazyL
-000032a0: 696e 6561 7228 7365 6c66 2e6e 5f74 6173  inear(self.n_tas
-000032b0: 6b73 290a 2020 2020 2020 2020 7365 6c66  ks).        self
-000032c0: 2e75 6e63 6572 7461 696e 7479 5f6c 6179  .uncertainty_lay
-000032d0: 6572 203d 206e 6e2e 4c61 7a79 4c69 6e65  er = nn.LazyLine
-000032e0: 6172 2873 656c 662e 6e5f 7461 736b 7329  ar(self.n_tasks)
-000032f0: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
-00003300: 6428 7365 6c66 2c20 696e 7075 7473 3a20  d(self, inputs: 
-00003310: 4f6e 654f 724d 616e 795b 746f 7263 682e  OneOrMany[torch.
-00003320: 5465 6e73 6f72 5d29 202d 3e20 4c69 7374  Tensor]) -> List
-00003330: 5b41 6e79 5d3a 0a20 2020 2020 2020 2022  [Any]:.        "
-00003340: 2222 0a20 2020 2020 2020 2050 6172 616d  "".        Param
-00003350: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00003360: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00003370: 2078 3a20 746f 7263 682e 5465 6e73 6f72   x: torch.Tensor
-00003380: 0a20 2020 2020 2020 2020 2020 2049 6e70  .            Inp
-00003390: 7574 2054 656e 736f 720a 2020 2020 2020  ut Tensor.      
-000033a0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-000033b0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-000033c0: 2020 746f 7263 682e 5465 6e73 6f72 0a20    torch.Tensor. 
-000033d0: 2020 2020 2020 2020 2020 204f 7574 7075             Outpu
-000033e0: 7420 6173 2070 6572 2075 7365 2063 6173  t as per use cas
-000033f0: 6520 3a20 7265 6772 6573 7369 6f6e 2f63  e : regression/c
-00003400: 6c61 7373 6966 6963 6174 696f 6e0a 2020  lassification.  
-00003410: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00003420: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00003430: 696e 7075 7473 2c20 746f 7263 682e 5465  inputs, torch.Te
-00003440: 6e73 6f72 293a 0a20 2020 2020 2020 2020  nsor):.         
-00003450: 2020 2078 2c20 6472 6f70 6f75 745f 7377     x, dropout_sw
-00003460: 6974 6368 203d 2069 6e70 7574 732c 204e  itch = inputs, N
-00003470: 6f6e 650a 2020 2020 2020 2020 656c 7365  one.        else
-00003480: 3a0a 2020 2020 2020 2020 2020 2020 782c  :.            x,
-00003490: 2064 726f 706f 7574 5f73 7769 7463 6820   dropout_switch 
-000034a0: 3d20 696e 7075 7473 0a0a 2020 2020 2020  = inputs..      
-000034b0: 2020 7820 3d20 746f 7263 682e 7472 616e    x = torch.tran
-000034c0: 7370 6f73 6528 782c 2031 2c20 2d31 2920  spose(x, 1, -1) 
-000034d0: 2023 206e 2068 2077 2063 202d 3e20 6e20   # n h w c -> n 
-000034e0: 6320 6820 770a 0a20 2020 2020 2020 2070  c h w..        p
-000034f0: 7265 765f 6c61 7965 7220 3d20 780a 0a20  rev_layer = x.. 
-00003500: 2020 2020 2020 2066 6f72 206c 6179 6572         for layer
-00003510: 2c20 6163 7469 7661 7469 6f6e 5f66 6e2c  , activation_fn,
-00003520: 2064 726f 706f 7574 2069 6e20 7a69 7028   dropout in zip(
-00003530: 7365 6c66 2e6c 6179 6572 732c 0a20 2020  self.layers,.   
-00003540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003090: 2020 2020 2020 2020 2062 6961 733d 5472           bias=Tr
+000030a0: 7565 290a 0a20 2020 2020 2020 2020 2020  ue)..           
+000030b0: 206e 6e2e 696e 6974 2e6e 6f72 6d61 6c5f   nn.init.normal_
+000030c0: 286c 6179 6572 2e77 6569 6768 742c 2030  (layer.weight, 0
+000030d0: 2c20 7765 6967 6874 5f73 7464 6465 7629  , weight_stddev)
+000030e0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000030f0: 696e 6974 6961 6c69 7a69 6e67 206c 6179  initializing lay
+00003100: 6572 2062 6961 7320 7769 7468 206e 6e2e  er bias with nn.
+00003110: 696e 6974 2067 6976 6573 206d 7970 7920  init gives mypy 
+00003120: 7479 7065 6368 6563 6b20 6572 726f 720a  typecheck error.
+00003130: 2020 2020 2020 2020 2020 2020 2320 7573              # us
+00003140: 696e 6720 7468 6520 666f 6c6c 6f77 696e  ing the followin
+00003150: 6720 776f 726b 6172 6f75 6e64 0a20 2020  g workaround.   
+00003160: 2020 2020 2020 2020 2069 6620 6c61 7965           if laye
+00003170: 722e 6269 6173 2069 7320 6e6f 7420 4e6f  r.bias is not No
+00003180: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00003190: 2020 2020 6c61 7965 722e 6269 6173 203d      layer.bias =
+000031a0: 206e 6e2e 5061 7261 6d65 7465 7228 0a20   nn.Parameter(. 
+000031b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031c0: 2020 2074 6f72 6368 2e66 756c 6c28 6c61     torch.full(la
+000031d0: 7965 722e 6269 6173 2e73 6861 7065 2c20  yer.bias.shape, 
+000031e0: 6269 6173 5f63 6f6e 7374 2929 0a0a 2020  bias_const))..  
+000031f0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00003200: 6179 6572 732e 6170 7065 6e64 286c 6179  ayers.append(lay
+00003210: 6572 290a 0a20 2020 2020 2020 2020 2020  er)..           
+00003220: 2069 6e5f 7368 6170 6520 3d20 6f75 745f   in_shape = out_
+00003230: 7368 6170 650a 0a20 2020 2020 2020 2073  shape..        s
+00003240: 656c 662e 636c 6173 7369 6669 6572 5f66  elf.classifier_f
+00003250: 666e 203d 206e 6e2e 4c61 7a79 4c69 6e65  fn = nn.LazyLine
+00003260: 6172 2873 656c 662e 6e5f 7461 736b 7320  ar(self.n_tasks 
+00003270: 2a20 7365 6c66 2e6e 5f63 6c61 7373 6573  * self.n_classes
+00003280: 290a 2020 2020 2020 2020 7365 6c66 2e6f  ).        self.o
+00003290: 7574 7075 745f 6c61 7965 7220 3d20 6e6e  utput_layer = nn
+000032a0: 2e4c 617a 794c 696e 6561 7228 7365 6c66  .LazyLinear(self
+000032b0: 2e6e 5f74 6173 6b73 290a 2020 2020 2020  .n_tasks).      
+000032c0: 2020 7365 6c66 2e75 6e63 6572 7461 696e    self.uncertain
+000032d0: 7479 5f6c 6179 6572 203d 206e 6e2e 4c61  ty_layer = nn.La
+000032e0: 7a79 4c69 6e65 6172 2873 656c 662e 6e5f  zyLinear(self.n_
+000032f0: 7461 736b 7329 0a0a 2020 2020 6465 6620  tasks)..    def 
+00003300: 666f 7277 6172 6428 7365 6c66 2c20 696e  forward(self, in
+00003310: 7075 7473 3a20 4f6e 654f 724d 616e 795b  puts: OneOrMany[
+00003320: 746f 7263 682e 5465 6e73 6f72 5d29 202d  torch.Tensor]) -
+00003330: 3e20 4c69 7374 5b41 6e79 5d3a 0a20 2020  > List[Any]:.   
+00003340: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003350: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00003360: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00003370: 2020 2020 2020 2078 3a20 746f 7263 682e         x: torch.
+00003380: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00003390: 2020 2049 6e70 7574 2054 656e 736f 720a     Input Tensor.
+000033a0: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+000033b0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+000033c0: 2020 2020 2020 2020 746f 7263 682e 5465          torch.Te
+000033d0: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+000033e0: 204f 7574 7075 7420 6173 2070 6572 2075   Output as per u
+000033f0: 7365 2063 6173 6520 3a20 7265 6772 6573  se case : regres
+00003400: 7369 6f6e 2f63 6c61 7373 6966 6963 6174  sion/classificat
+00003410: 696f 6e0a 2020 2020 2020 2020 2222 220a  ion.        """.
+00003420: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00003430: 7461 6e63 6528 696e 7075 7473 2c20 746f  tance(inputs, to
+00003440: 7263 682e 5465 6e73 6f72 293a 0a20 2020  rch.Tensor):.   
+00003450: 2020 2020 2020 2020 2078 2c20 6472 6f70           x, drop
+00003460: 6f75 745f 7377 6974 6368 203d 2069 6e70  out_switch = inp
+00003470: 7574 732c 204e 6f6e 650a 2020 2020 2020  uts, None.      
+00003480: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00003490: 2020 2020 782c 2064 726f 706f 7574 5f73      x, dropout_s
+000034a0: 7769 7463 6820 3d20 696e 7075 7473 0a0a  witch = inputs..
+000034b0: 2020 2020 2020 2020 7820 3d20 746f 7263          x = torc
+000034c0: 682e 7472 616e 7370 6f73 6528 782c 2031  h.transpose(x, 1
+000034d0: 2c20 2d31 2920 2023 206e 2068 2077 2063  , -1)  # n h w c
+000034e0: 202d 3e20 6e20 6320 6820 770a 0a20 2020   -> n c h w..   
+000034f0: 2020 2020 2070 7265 765f 6c61 7965 7220       prev_layer 
+00003500: 3d20 780a 0a20 2020 2020 2020 2066 6f72  = x..        for
+00003510: 206c 6179 6572 2c20 6163 7469 7661 7469   layer, activati
+00003520: 6f6e 5f66 6e2c 2064 726f 706f 7574 2069  on_fn, dropout i
+00003530: 6e20 7a69 7028 7365 6c66 2e6c 6179 6572  n zip(self.layer
+00003540: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
 00003550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003560: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003570: 6c66 2e61 6374 6976 6174 696f 6e5f 666e  lf.activation_fn
-00003580: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00003560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003570: 2020 2020 7365 6c66 2e61 6374 6976 6174      self.activat
+00003580: 696f 6e5f 666e 732c 0a20 2020 2020 2020  ion_fns,.       
 00003590: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000035a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000035b0: 2020 2020 7365 6c66 2e64 726f 706f 7574      self.dropout
-000035c0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-000035d0: 7820 3d20 6c61 7965 7228 7829 0a0a 2020  x = layer(x)..  
-000035e0: 2020 2020 2020 2020 2020 6966 2064 726f            if dro
-000035f0: 706f 7574 203e 2030 2e20 616e 6420 6472  pout > 0. and dr
-00003600: 6f70 6f75 745f 7377 6974 6368 3a0a 2020  opout_switch:.  
-00003610: 2020 2020 2020 2020 2020 2020 2020 7820                x 
-00003620: 3d20 462e 6472 6f70 6f75 7428 782c 2064  = F.dropout(x, d
-00003630: 726f 706f 7574 290a 0a20 2020 2020 2020  ropout)..       
-00003640: 2020 2020 2023 2072 6573 6964 7561 6c20       # residual 
-00003650: 626c 6f63 6b73 2063 616e 206f 6e6c 7920  blocks can only 
-00003660: 6265 2075 7365 6420 7768 656e 2073 7563  be used when suc
-00003670: 6365 7373 6976 6520 6c61 7965 7273 2068  cessive layers h
-00003680: 6176 6520 7468 6520 7361 6d65 206f 7574  ave the same out
-00003690: 7075 7420 7368 6170 650a 2020 2020 2020  put shape.      
-000036a0: 2020 2020 2020 6966 2073 656c 662e 7265        if self.re
-000036b0: 7369 6475 616c 2061 6e64 2078 2e73 6861  sidual and x.sha
-000036c0: 7065 5b31 5d20 3d3d 2070 7265 765f 6c61  pe[1] == prev_la
-000036d0: 7965 722e 7368 6170 655b 315d 3a0a 2020  yer.shape[1]:.  
-000036e0: 2020 2020 2020 2020 2020 2020 2020 7820                x 
-000036f0: 3d20 7820 2b20 7072 6576 5f6c 6179 6572  = x + prev_layer
-00003700: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00003710: 2061 6374 6976 6174 696f 6e5f 666e 2069   activation_fn i
-00003720: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00003730: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
-00003740: 6163 7469 7661 7469 6f6e 5f66 6e28 7829  activation_fn(x)
-00003750: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00003760: 6576 5f6c 6179 6572 203d 2078 0a0a 2020  ev_layer = x..  
-00003770: 2020 2020 2020 7820 3d20 7365 6c66 2e50        x = self.P
-00003780: 6f6f 6c4c 6179 6572 2878 2c20 6b65 726e  oolLayer(x, kern
-00003790: 656c 5f73 697a 653d 782e 7369 7a65 2829  el_size=x.size()
-000037a0: 5b32 3a5d 290a 0a20 2020 2020 2020 206f  [2:])..        o
-000037b0: 7574 7075 7473 203d 205b 5d0a 2020 2020  utputs = [].    
-000037c0: 2020 2020 6261 7463 685f 7369 7a65 203d      batch_size =
-000037d0: 2078 2e73 6861 7065 5b30 5d0a 0a20 2020   x.shape[0]..   
-000037e0: 2020 2020 2078 203d 2074 6f72 6368 2e72       x = torch.r
-000037f0: 6573 6861 7065 2878 2c20 2862 6174 6368  eshape(x, (batch
-00003800: 5f73 697a 652c 202d 3129 290a 0a20 2020  _size, -1))..   
-00003810: 2020 2020 2069 6620 7365 6c66 2e6d 6f64       if self.mod
-00003820: 6520 3d3d 2022 636c 6173 7369 6669 6361  e == "classifica
-00003830: 7469 6f6e 223a 0a0a 2020 2020 2020 2020  tion":..        
-00003840: 2020 2020 6c6f 6769 7473 203d 2073 656c      logits = sel
-00003850: 662e 636c 6173 7369 6669 6572 5f66 666e  f.classifier_ffn
-00003860: 2878 290a 2020 2020 2020 2020 2020 2020  (x).            
-00003870: 6c6f 6769 7473 203d 206c 6f67 6974 732e  logits = logits.
-00003880: 7669 6577 2862 6174 6368 5f73 697a 652c  view(batch_size,
-00003890: 2073 656c 662e 6e5f 7461 736b 732c 2073   self.n_tasks, s
-000038a0: 656c 662e 6e5f 636c 6173 7365 7329 0a20  elf.n_classes). 
-000038b0: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-000038c0: 7420 3d20 462e 736f 6674 6d61 7828 6c6f  t = F.softmax(lo
-000038d0: 6769 7473 2c20 6469 6d3d 3229 0a20 2020  gits, dim=2).   
-000038e0: 2020 2020 2020 2020 206f 7574 7075 7473           outputs
-000038f0: 203d 205b 6f75 7470 7574 2c20 6c6f 6769   = [output, logi
-00003900: 7473 5d0a 0a20 2020 2020 2020 2065 6c73  ts]..        els
-00003910: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-00003920: 7574 7075 7420 3d20 7365 6c66 2e6f 7574  utput = self.out
-00003930: 7075 745f 6c61 7965 7228 7829 0a20 2020  put_layer(x).   
-00003940: 2020 2020 2020 2020 206f 7574 7075 7420           output 
-00003950: 3d20 6f75 7470 7574 2e76 6965 7728 6261  = output.view(ba
-00003960: 7463 685f 7369 7a65 2c20 7365 6c66 2e6e  tch_size, self.n
-00003970: 5f74 6173 6b73 290a 0a20 2020 2020 2020  _tasks)..       
-00003980: 2020 2020 2069 6620 7365 6c66 2e75 6e63       if self.unc
-00003990: 6572 7461 696e 7479 3a0a 2020 2020 2020  ertainty:.      
-000039a0: 2020 2020 2020 2020 2020 6c6f 675f 7661            log_va
-000039b0: 7220 3d20 7365 6c66 2e75 6e63 6572 7461  r = self.uncerta
-000039c0: 696e 7479 5f6c 6179 6572 2878 290a 2020  inty_layer(x).  
-000039d0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-000039e0: 675f 7661 7220 3d20 6c6f 675f 7661 722e  g_var = log_var.
-000039f0: 7669 6577 2862 6174 6368 5f73 697a 652c  view(batch_size,
-00003a00: 2073 656c 662e 6e5f 7461 736b 732c 2031   self.n_tasks, 1
-00003a10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00003a20: 2020 7661 7220 3d20 746f 7263 682e 6578    var = torch.ex
-00003a30: 7028 6c6f 675f 7661 7229 0a20 2020 2020  p(log_var).     
-00003a40: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-00003a50: 7473 203d 205b 6f75 7470 7574 2c20 7661  ts = [output, va
-00003a60: 722c 206f 7574 7075 742c 206c 6f67 5f76  r, output, log_v
-00003a70: 6172 5d0a 2020 2020 2020 2020 2020 2020  ar].            
-00003a80: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00003a90: 2020 2020 2020 6f75 7470 7574 7320 3d20        outputs = 
-00003aa0: 5b6f 7574 7075 745d 0a0a 2020 2020 2020  [output]..      
-00003ab0: 2020 7265 7475 726e 206f 7574 7075 7473    return outputs
-00003ac0: 0a0a 0a63 6c61 7373 2053 6361 6c65 4e6f  ...class ScaleNo
-00003ad0: 726d 286e 6e2e 4d6f 6475 6c65 293a 0a20  rm(nn.Module):. 
-00003ae0: 2020 2022 2222 4170 706c 7920 5363 616c     """Apply Scal
-00003af0: 6520 4e6f 726d 616c 697a 6174 696f 6e20  e Normalization 
-00003b00: 746f 2069 6e70 7574 2e0a 0a20 2020 2054  to input...    T
-00003b10: 6865 2053 6361 6c65 4e6f 726d 206c 6179  he ScaleNorm lay
-00003b20: 6572 2066 6972 7374 2063 6f6d 7075 7465  er first compute
-00003b30: 7320 7468 6520 7371 7561 7265 2072 6f6f  s the square roo
-00003b40: 7420 6f66 2074 6865 2073 6361 6c65 2c20  t of the scale, 
-00003b50: 7468 656e 2063 6f6d 7075 7465 7320 7468  then computes th
-00003b60: 6520 6d61 7472 6978 2f76 6563 746f 7220  e matrix/vector 
-00003b70: 6e6f 726d 206f 6620 7468 6520 696e 7075  norm of the inpu
-00003b80: 7420 7465 6e73 6f72 2e0a 2020 2020 5468  t tensor..    Th
-00003b90: 6520 6e6f 726d 2076 616c 7565 2069 7320  e norm value is 
-00003ba0: 6361 6c63 756c 6174 6564 2061 7320 6073  calculated as `s
-00003bb0: 7172 7428 7363 616c 6529 202f 206d 6174  qrt(scale) / mat
-00003bc0: 7269 7820 6e6f 726d 602e 0a20 2020 2046  rix norm`..    F
-00003bd0: 696e 616c 6c79 2c20 7468 6520 7265 7375  inally, the resu
-00003be0: 6c74 2069 7320 7265 7475 726e 6564 2061  lt is returned a
-00003bf0: 7320 6069 6e70 7574 5f74 656e 736f 7220  s `input_tensor 
-00003c00: 2a20 6e6f 726d 2076 616c 7565 602e 0a0a  * norm value`...
-00003c10: 2020 2020 5468 6973 206c 6179 6572 2063      This layer c
-00003c20: 616e 2062 6520 7573 6564 2069 6e73 7465  an be used inste
-00003c30: 6164 206f 6620 4c61 7965 724e 6f72 6d20  ad of LayerNorm 
-00003c40: 7768 656e 2061 2073 6361 6c65 6420 7665  when a scaled ve
-00003c50: 7273 696f 6e20 6f66 2074 6865 206e 6f72  rsion of the nor
-00003c60: 6d20 6973 2072 6571 7569 7265 642e 0a20  m is required.. 
-00003c70: 2020 2049 6e73 7465 6164 206f 6620 7065     Instead of pe
-00003c80: 7266 6f72 6d69 6e67 2074 6865 2073 6361  rforming the sca
-00003c90: 6c69 6e67 206f 7065 7261 7469 6f6e 2028  ling operation (
-00003ca0: 6073 6361 6c65 202f 206e 6f72 6d60 2920  `scale / norm`) 
-00003cb0: 696e 2061 206c 616d 6264 612d 6c69 6b65  in a lambda-like
-00003cc0: 206c 6179 6572 2c20 7765 2061 7265 2064   layer, we are d
-00003cd0: 6566 696e 696e 6720 6974 2077 6974 6869  efining it withi
-00003ce0: 6e20 7468 6973 206c 6179 6572 2074 6f20  n this layer to 
-00003cf0: 6d61 6b65 2070 726f 746f 7479 7069 6e67  make prototyping
-00003d00: 206d 6f72 6520 6566 6669 6369 656e 742e   more efficient.
-00003d10: 0a0a 2020 2020 5265 6665 7265 6e63 6573  ..    References
-00003d20: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-00003d30: 2020 2020 2e2e 205b 315d 204c 756b 6173      .. [1] Lukas
-00003d40: 7a20 4d61 7a69 6172 6b61 2065 7420 616c  z Maziarka et al
-00003d50: 2e20 224d 6f6c 6563 756c 6520 4174 7465  . "Molecule Atte
-00003d60: 6e74 696f 6e20 5472 616e 7366 6f72 6d65  ntion Transforme
-00003d70: 7222 2047 7261 7068 2052 6570 7265 7365  r" Graph Represe
-00003d80: 6e74 6174 696f 6e20 4c65 6172 6e69 6e67  ntation Learning
-00003d90: 2077 6f72 6b73 686f 7020 616e 6420 4d61   workshop and Ma
-00003da0: 6368 696e 6520 4c65 6172 6e69 6e67 2061  chine Learning a
-00003db0: 6e64 2074 6865 2050 6879 7369 6361 6c20  nd the Physical 
-00003dc0: 5363 6965 6e63 6573 2077 6f72 6b73 686f  Sciences worksho
-00003dd0: 7020 6174 204e 6575 7249 5053 2032 3031  p at NeurIPS 201
-00003de0: 392e 2032 3032 302e 2068 7474 7073 3a2f  9. 2020. https:/
-00003df0: 2f61 7278 6976 2e6f 7267 2f61 6273 2f32  /arxiv.org/abs/2
-00003e00: 3030 322e 3038 3236 340a 0a20 2020 2045  002.08264..    E
-00003e10: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
-00003e20: 2d2d 2d2d 0a20 2020 203e 3e3e 2066 726f  ----.    >>> fro
-00003e30: 6d20 6465 6570 6368 656d 2e6d 6f64 656c  m deepchem.model
-00003e40: 732e 746f 7263 685f 6d6f 6465 6c73 2e6c  s.torch_models.l
-00003e50: 6179 6572 7320 696d 706f 7274 2053 6361  ayers import Sca
-00003e60: 6c65 4e6f 726d 0a20 2020 203e 3e3e 2073  leNorm.    >>> s
-00003e70: 6361 6c65 203d 2030 2e33 350a 2020 2020  cale = 0.35.    
-00003e80: 3e3e 3e20 6c61 7965 7220 3d20 5363 616c  >>> layer = Scal
-00003e90: 654e 6f72 6d28 7363 616c 6529 0a20 2020  eNorm(scale).   
-00003ea0: 203e 3e3e 2069 6e70 7574 5f74 656e 736f   >>> input_tenso
-00003eb0: 7220 3d20 746f 7263 682e 7465 6e73 6f72  r = torch.tensor
-00003ec0: 285b 5b31 2e32 3639 2c20 3339 2e33 365d  ([[1.269, 39.36]
-00003ed0: 2c20 5b30 2e30 3039 3138 2c20 2d39 2e31  , [0.00918, -9.1
-00003ee0: 325d 5d29 0a20 2020 203e 3e3e 206f 7574  2]]).    >>> out
-00003ef0: 7075 745f 7465 6e73 6f72 203d 206c 6179  put_tensor = lay
-00003f00: 6572 2869 6e70 7574 5f74 656e 736f 7229  er(input_tensor)
-00003f10: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-00003f20: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00003f30: 2073 6361 6c65 3a20 666c 6f61 742c 2065   scale: float, e
-00003f40: 7073 3a20 666c 6f61 7420 3d20 3165 2d35  ps: float = 1e-5
-00003f50: 293a 0a20 2020 2020 2020 2022 2222 496e  ):.        """In
-00003f60: 6974 6961 6c69 7a65 2061 2053 6361 6c65  itialize a Scale
-00003f70: 4e6f 726d 206c 6179 6572 2e0a 0a20 2020  Norm layer...   
-00003f80: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00003f90: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00003fa0: 2d2d 0a20 2020 2020 2020 2073 6361 6c65  --.        scale
-00003fb0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-00003fc0: 2020 2020 5363 616c 6520 6d61 676e 6974      Scale magnit
-00003fd0: 7564 652e 0a20 2020 2020 2020 2065 7073  ude..        eps
-00003fe0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-00003ff0: 2020 2020 4570 7369 6c6f 6e20 7661 6c75      Epsilon valu
-00004000: 652e 2044 6566 6175 6c74 203d 2031 652d  e. Default = 1e-
-00004010: 352e 0a20 2020 2020 2020 2022 2222 0a20  5..        """. 
-00004020: 2020 2020 2020 2073 7570 6572 2853 6361         super(Sca
-00004030: 6c65 4e6f 726d 2c20 7365 6c66 292e 5f5f  leNorm, self).__
-00004040: 696e 6974 5f5f 2829 0a20 2020 2020 2020  init__().       
-00004050: 2073 656c 662e 7363 616c 6520 3d20 6e6e   self.scale = nn
-00004060: 2e50 6172 616d 6574 6572 2874 6f72 6368  .Parameter(torch
-00004070: 2e74 656e 736f 7228 6d61 7468 2e73 7172  .tensor(math.sqr
-00004080: 7428 7363 616c 6529 2929 0a20 2020 2020  t(scale))).     
-00004090: 2020 2073 656c 662e 6570 7320 3d20 6570     self.eps = ep
-000040a0: 730a 0a20 2020 2064 6566 2066 6f72 7761  s..    def forwa
-000040b0: 7264 2873 656c 662c 2078 3a20 746f 7263  rd(self, x: torc
-000040c0: 682e 5465 6e73 6f72 2920 2d3e 2074 6f72  h.Tensor) -> tor
-000040d0: 6368 2e54 656e 736f 723a 0a20 2020 2020  ch.Tensor:.     
-000040e0: 2020 206e 6f72 6d20 3d20 7365 6c66 2e73     norm = self.s
-000040f0: 6361 6c65 202f 2074 6f72 6368 2e6e 6f72  cale / torch.nor
-00004100: 6d28 782c 2064 696d 3d2d 312c 0a20 2020  m(x, dim=-1,.   
-00004110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035b0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+000035c0: 726f 706f 7574 7329 3a0a 2020 2020 2020  ropouts):.      
+000035d0: 2020 2020 2020 7820 3d20 6c61 7965 7228        x = layer(
+000035e0: 7829 0a0a 2020 2020 2020 2020 2020 2020  x)..            
+000035f0: 6966 2064 726f 706f 7574 203e 2030 2e20  if dropout > 0. 
+00003600: 616e 6420 6472 6f70 6f75 745f 7377 6974  and dropout_swit
+00003610: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
+00003620: 2020 2020 7820 3d20 462e 6472 6f70 6f75      x = F.dropou
+00003630: 7428 782c 2064 726f 706f 7574 290a 0a20  t(x, dropout).. 
+00003640: 2020 2020 2020 2020 2020 2023 2072 6573             # res
+00003650: 6964 7561 6c20 626c 6f63 6b73 2063 616e  idual blocks can
+00003660: 206f 6e6c 7920 6265 2075 7365 6420 7768   only be used wh
+00003670: 656e 2073 7563 6365 7373 6976 6520 6c61  en successive la
+00003680: 7965 7273 2068 6176 6520 7468 6520 7361  yers have the sa
+00003690: 6d65 206f 7574 7075 7420 7368 6170 650a  me output shape.
+000036a0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000036b0: 656c 662e 7265 7369 6475 616c 2061 6e64  elf.residual and
+000036c0: 2078 2e73 6861 7065 5b31 5d20 3d3d 2070   x.shape[1] == p
+000036d0: 7265 765f 6c61 7965 722e 7368 6170 655b  rev_layer.shape[
+000036e0: 315d 3a0a 2020 2020 2020 2020 2020 2020  1]:.            
+000036f0: 2020 2020 7820 3d20 7820 2b20 7072 6576      x = x + prev
+00003700: 5f6c 6179 6572 0a0a 2020 2020 2020 2020  _layer..        
+00003710: 2020 2020 6966 2061 6374 6976 6174 696f      if activatio
+00003720: 6e5f 666e 2069 7320 6e6f 7420 4e6f 6e65  n_fn is not None
+00003730: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003740: 2020 7820 3d20 6163 7469 7661 7469 6f6e    x = activation
+00003750: 5f66 6e28 7829 0a0a 2020 2020 2020 2020  _fn(x)..        
+00003760: 2020 2020 7072 6576 5f6c 6179 6572 203d      prev_layer =
+00003770: 2078 0a0a 2020 2020 2020 2020 7820 3d20   x..        x = 
+00003780: 7365 6c66 2e50 6f6f 6c4c 6179 6572 2878  self.PoolLayer(x
+00003790: 2c20 6b65 726e 656c 5f73 697a 653d 782e  , kernel_size=x.
+000037a0: 7369 7a65 2829 5b32 3a5d 290a 0a20 2020  size()[2:])..   
+000037b0: 2020 2020 206f 7574 7075 7473 203d 205b       outputs = [
+000037c0: 5d0a 2020 2020 2020 2020 6261 7463 685f  ].        batch_
+000037d0: 7369 7a65 203d 2078 2e73 6861 7065 5b30  size = x.shape[0
+000037e0: 5d0a 0a20 2020 2020 2020 2078 203d 2074  ]..        x = t
+000037f0: 6f72 6368 2e72 6573 6861 7065 2878 2c20  orch.reshape(x, 
+00003800: 2862 6174 6368 5f73 697a 652c 202d 3129  (batch_size, -1)
+00003810: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+00003820: 6c66 2e6d 6f64 6520 3d3d 2022 636c 6173  lf.mode == "clas
+00003830: 7369 6669 6361 7469 6f6e 223a 0a0a 2020  sification":..  
+00003840: 2020 2020 2020 2020 2020 6c6f 6769 7473            logits
+00003850: 203d 2073 656c 662e 636c 6173 7369 6669   = self.classifi
+00003860: 6572 5f66 666e 2878 290a 2020 2020 2020  er_ffn(x).      
+00003870: 2020 2020 2020 6c6f 6769 7473 203d 206c        logits = l
+00003880: 6f67 6974 732e 7669 6577 2862 6174 6368  ogits.view(batch
+00003890: 5f73 697a 652c 2073 656c 662e 6e5f 7461  _size, self.n_ta
+000038a0: 736b 732c 2073 656c 662e 6e5f 636c 6173  sks, self.n_clas
+000038b0: 7365 7329 0a20 2020 2020 2020 2020 2020  ses).           
+000038c0: 206f 7574 7075 7420 3d20 462e 736f 6674   output = F.soft
+000038d0: 6d61 7828 6c6f 6769 7473 2c20 6469 6d3d  max(logits, dim=
+000038e0: 3229 0a20 2020 2020 2020 2020 2020 206f  2).            o
+000038f0: 7574 7075 7473 203d 205b 6f75 7470 7574  utputs = [output
+00003900: 2c20 6c6f 6769 7473 5d0a 0a20 2020 2020  , logits]..     
+00003910: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00003920: 2020 2020 206f 7574 7075 7420 3d20 7365       output = se
+00003930: 6c66 2e6f 7574 7075 745f 6c61 7965 7228  lf.output_layer(
+00003940: 7829 0a20 2020 2020 2020 2020 2020 206f  x).            o
+00003950: 7574 7075 7420 3d20 6f75 7470 7574 2e76  utput = output.v
+00003960: 6965 7728 6261 7463 685f 7369 7a65 2c20  iew(batch_size, 
+00003970: 7365 6c66 2e6e 5f74 6173 6b73 290a 0a20  self.n_tasks).. 
+00003980: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00003990: 6c66 2e75 6e63 6572 7461 696e 7479 3a0a  lf.uncertainty:.
+000039a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000039b0: 6c6f 675f 7661 7220 3d20 7365 6c66 2e75  log_var = self.u
+000039c0: 6e63 6572 7461 696e 7479 5f6c 6179 6572  ncertainty_layer
+000039d0: 2878 290a 2020 2020 2020 2020 2020 2020  (x).            
+000039e0: 2020 2020 6c6f 675f 7661 7220 3d20 6c6f      log_var = lo
+000039f0: 675f 7661 722e 7669 6577 2862 6174 6368  g_var.view(batch
+00003a00: 5f73 697a 652c 2073 656c 662e 6e5f 7461  _size, self.n_ta
+00003a10: 736b 732c 2031 290a 2020 2020 2020 2020  sks, 1).        
+00003a20: 2020 2020 2020 2020 7661 7220 3d20 746f          var = to
+00003a30: 7263 682e 6578 7028 6c6f 675f 7661 7229  rch.exp(log_var)
+00003a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003a50: 206f 7574 7075 7473 203d 205b 6f75 7470   outputs = [outp
+00003a60: 7574 2c20 7661 722c 206f 7574 7075 742c  ut, var, output,
+00003a70: 206c 6f67 5f76 6172 5d0a 2020 2020 2020   log_var].      
+00003a80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00003a90: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+00003aa0: 7574 7320 3d20 5b6f 7574 7075 745d 0a0a  uts = [output]..
+00003ab0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+00003ac0: 7574 7075 7473 0a0a 0a63 6c61 7373 2053  utputs...class S
+00003ad0: 6361 6c65 4e6f 726d 286e 6e2e 4d6f 6475  caleNorm(nn.Modu
+00003ae0: 6c65 293a 0a20 2020 2022 2222 4170 706c  le):.    """Appl
+00003af0: 7920 5363 616c 6520 4e6f 726d 616c 697a  y Scale Normaliz
+00003b00: 6174 696f 6e20 746f 2069 6e70 7574 2e0a  ation to input..
+00003b10: 0a20 2020 2054 6865 2053 6361 6c65 4e6f  .    The ScaleNo
+00003b20: 726d 206c 6179 6572 2066 6972 7374 2063  rm layer first c
+00003b30: 6f6d 7075 7465 7320 7468 6520 7371 7561  omputes the squa
+00003b40: 7265 2072 6f6f 7420 6f66 2074 6865 2073  re root of the s
+00003b50: 6361 6c65 2c20 7468 656e 2063 6f6d 7075  cale, then compu
+00003b60: 7465 7320 7468 6520 6d61 7472 6978 2f76  tes the matrix/v
+00003b70: 6563 746f 7220 6e6f 726d 206f 6620 7468  ector norm of th
+00003b80: 6520 696e 7075 7420 7465 6e73 6f72 2e0a  e input tensor..
+00003b90: 2020 2020 5468 6520 6e6f 726d 2076 616c      The norm val
+00003ba0: 7565 2069 7320 6361 6c63 756c 6174 6564  ue is calculated
+00003bb0: 2061 7320 6073 7172 7428 7363 616c 6529   as `sqrt(scale)
+00003bc0: 202f 206d 6174 7269 7820 6e6f 726d 602e   / matrix norm`.
+00003bd0: 0a20 2020 2046 696e 616c 6c79 2c20 7468  .    Finally, th
+00003be0: 6520 7265 7375 6c74 2069 7320 7265 7475  e result is retu
+00003bf0: 726e 6564 2061 7320 6069 6e70 7574 5f74  rned as `input_t
+00003c00: 656e 736f 7220 2a20 6e6f 726d 2076 616c  ensor * norm val
+00003c10: 7565 602e 0a0a 2020 2020 5468 6973 206c  ue`...    This l
+00003c20: 6179 6572 2063 616e 2062 6520 7573 6564  ayer can be used
+00003c30: 2069 6e73 7465 6164 206f 6620 4c61 7965   instead of Laye
+00003c40: 724e 6f72 6d20 7768 656e 2061 2073 6361  rNorm when a sca
+00003c50: 6c65 6420 7665 7273 696f 6e20 6f66 2074  led version of t
+00003c60: 6865 206e 6f72 6d20 6973 2072 6571 7569  he norm is requi
+00003c70: 7265 642e 0a20 2020 2049 6e73 7465 6164  red..    Instead
+00003c80: 206f 6620 7065 7266 6f72 6d69 6e67 2074   of performing t
+00003c90: 6865 2073 6361 6c69 6e67 206f 7065 7261  he scaling opera
+00003ca0: 7469 6f6e 2028 6073 6361 6c65 202f 206e  tion (`scale / n
+00003cb0: 6f72 6d60 2920 696e 2061 206c 616d 6264  orm`) in a lambd
+00003cc0: 612d 6c69 6b65 206c 6179 6572 2c20 7765  a-like layer, we
+00003cd0: 2061 7265 2064 6566 696e 696e 6720 6974   are defining it
+00003ce0: 2077 6974 6869 6e20 7468 6973 206c 6179   within this lay
+00003cf0: 6572 2074 6f20 6d61 6b65 2070 726f 746f  er to make proto
+00003d00: 7479 7069 6e67 206d 6f72 6520 6566 6669  typing more effi
+00003d10: 6369 656e 742e 0a0a 2020 2020 5265 6665  cient...    Refe
+00003d20: 7265 6e63 6573 0a20 2020 202d 2d2d 2d2d  rences.    -----
+00003d30: 2d2d 2d2d 2d0a 2020 2020 2e2e 205b 315d  -----.    .. [1]
+00003d40: 204c 756b 6173 7a20 4d61 7a69 6172 6b61   Lukasz Maziarka
+00003d50: 2065 7420 616c 2e20 224d 6f6c 6563 756c   et al. "Molecul
+00003d60: 6520 4174 7465 6e74 696f 6e20 5472 616e  e Attention Tran
+00003d70: 7366 6f72 6d65 7222 2047 7261 7068 2052  sformer" Graph R
+00003d80: 6570 7265 7365 6e74 6174 696f 6e20 4c65  epresentation Le
+00003d90: 6172 6e69 6e67 2077 6f72 6b73 686f 7020  arning workshop 
+00003da0: 616e 6420 4d61 6368 696e 6520 4c65 6172  and Machine Lear
+00003db0: 6e69 6e67 2061 6e64 2074 6865 2050 6879  ning and the Phy
+00003dc0: 7369 6361 6c20 5363 6965 6e63 6573 2077  sical Sciences w
+00003dd0: 6f72 6b73 686f 7020 6174 204e 6575 7249  orkshop at NeurI
+00003de0: 5053 2032 3031 392e 2032 3032 302e 2068  PS 2019. 2020. h
+00003df0: 7474 7073 3a2f 2f61 7278 6976 2e6f 7267  ttps://arxiv.org
+00003e00: 2f61 6273 2f32 3030 322e 3038 3236 340a  /abs/2002.08264.
+00003e10: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
+00003e20: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
+00003e30: 3e3e 2066 726f 6d20 6465 6570 6368 656d  >> from deepchem
+00003e40: 2e6d 6f64 656c 732e 746f 7263 685f 6d6f  .models.torch_mo
+00003e50: 6465 6c73 2e6c 6179 6572 7320 696d 706f  dels.layers impo
+00003e60: 7274 2053 6361 6c65 4e6f 726d 0a20 2020  rt ScaleNorm.   
+00003e70: 203e 3e3e 2073 6361 6c65 203d 2030 2e33   >>> scale = 0.3
+00003e80: 350a 2020 2020 3e3e 3e20 6c61 7965 7220  5.    >>> layer 
+00003e90: 3d20 5363 616c 654e 6f72 6d28 7363 616c  = ScaleNorm(scal
+00003ea0: 6529 0a20 2020 203e 3e3e 2069 6e70 7574  e).    >>> input
+00003eb0: 5f74 656e 736f 7220 3d20 746f 7263 682e  _tensor = torch.
+00003ec0: 7465 6e73 6f72 285b 5b31 2e32 3639 2c20  tensor([[1.269, 
+00003ed0: 3339 2e33 365d 2c20 5b30 2e30 3039 3138  39.36], [0.00918
+00003ee0: 2c20 2d39 2e31 325d 5d29 0a20 2020 203e  , -9.12]]).    >
+00003ef0: 3e3e 206f 7574 7075 745f 7465 6e73 6f72  >> output_tensor
+00003f00: 203d 206c 6179 6572 2869 6e70 7574 5f74   = layer(input_t
+00003f10: 656e 736f 7229 0a20 2020 2022 2222 0a0a  ensor).    """..
+00003f20: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00003f30: 2873 656c 662c 2073 6361 6c65 3a20 666c  (self, scale: fl
+00003f40: 6f61 742c 2065 7073 3a20 666c 6f61 7420  oat, eps: float 
+00003f50: 3d20 3165 2d35 293a 0a20 2020 2020 2020  = 1e-5):.       
+00003f60: 2022 2222 496e 6974 6961 6c69 7a65 2061   """Initialize a
+00003f70: 2053 6361 6c65 4e6f 726d 206c 6179 6572   ScaleNorm layer
+00003f80: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00003f90: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00003fa0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00003fb0: 2073 6361 6c65 3a20 666c 6f61 740a 2020   scale: float.  
+00003fc0: 2020 2020 2020 2020 2020 5363 616c 6520            Scale 
+00003fd0: 6d61 676e 6974 7564 652e 0a20 2020 2020  magnitude..     
+00003fe0: 2020 2065 7073 3a20 666c 6f61 740a 2020     eps: float.  
+00003ff0: 2020 2020 2020 2020 2020 4570 7369 6c6f            Epsilo
+00004000: 6e20 7661 6c75 652e 2044 6566 6175 6c74  n value. Default
+00004010: 203d 2031 652d 352e 0a20 2020 2020 2020   = 1e-5..       
+00004020: 2022 2222 0a20 2020 2020 2020 2073 7570   """.        sup
+00004030: 6572 2853 6361 6c65 4e6f 726d 2c20 7365  er(ScaleNorm, se
+00004040: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a20  lf).__init__(). 
+00004050: 2020 2020 2020 2073 656c 662e 7363 616c         self.scal
+00004060: 6520 3d20 6e6e 2e50 6172 616d 6574 6572  e = nn.Parameter
+00004070: 2874 6f72 6368 2e74 656e 736f 7228 6d61  (torch.tensor(ma
+00004080: 7468 2e73 7172 7428 7363 616c 6529 2929  th.sqrt(scale)))
+00004090: 0a20 2020 2020 2020 2073 656c 662e 6570  .        self.ep
+000040a0: 7320 3d20 6570 730a 0a20 2020 2064 6566  s = eps..    def
+000040b0: 2066 6f72 7761 7264 2873 656c 662c 2078   forward(self, x
+000040c0: 3a20 746f 7263 682e 5465 6e73 6f72 2920  : torch.Tensor) 
+000040d0: 2d3e 2074 6f72 6368 2e54 656e 736f 723a  -> torch.Tensor:
+000040e0: 0a20 2020 2020 2020 206e 6f72 6d20 3d20  .        norm = 
+000040f0: 7365 6c66 2e73 6361 6c65 202f 2074 6f72  self.scale / tor
+00004100: 6368 2e6e 6f72 6d28 782c 2064 696d 3d2d  ch.norm(x, dim=-
+00004110: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
 00004120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004130: 2020 2020 6b65 6570 6469 6d3d 5472 7565      keepdim=True
-00004140: 292e 636c 616d 7028 6d69 6e3d 7365 6c66  ).clamp(min=self
-00004150: 2e65 7073 290a 2020 2020 2020 2020 7265  .eps).        re
-00004160: 7475 726e 2078 202a 206e 6f72 6d0a 0a0a  turn x * norm...
-00004170: 636c 6173 7320 4d75 6c74 6948 6561 6465  class MultiHeade
-00004180: 644d 4154 4174 7465 6e74 696f 6e28 6e6e  dMATAttention(nn
-00004190: 2e4d 6f64 756c 6529 3a0a 2020 2020 2222  .Module):.    ""
-000041a0: 2246 6972 7374 2063 6f6e 7374 7275 6374  "First construct
-000041b0: 7320 616e 2061 7474 656e 7469 6f6e 206c  s an attention l
-000041c0: 6179 6572 2074 6169 6c6f 7265 6420 746f  ayer tailored to
-000041d0: 2074 6865 204d 6f6c 6563 756c 6172 2041   the Molecular A
-000041e0: 7474 656e 7469 6f6e 2054 7261 6e73 666f  ttention Transfo
-000041f0: 726d 6572 205b 315d 5f20 616e 6420 7468  rmer [1]_ and th
-00004200: 656e 2063 6f6e 7665 7274 7320 6974 2069  en converts it i
-00004210: 6e74 6f20 4d75 6c74 692d 4865 6164 6564  nto Multi-Headed
-00004220: 2041 7474 656e 7469 6f6e 2e0a 0a20 2020   Attention...   
-00004230: 2049 6e20 4d75 6c74 692d 4865 6164 6564   In Multi-Headed
-00004240: 2061 7474 656e 7469 6f6e 2074 6865 2061   attention the a
-00004250: 7474 656e 7469 6f6e 206d 6563 6861 6e69  ttention mechani
-00004260: 736d 206d 756c 7469 706c 6520 7469 6d65  sm multiple time
-00004270: 7320 7061 7261 6c6c 656c 7920 7468 726f  s parallely thro
-00004280: 7567 6820 7468 6520 6d75 6c74 6970 6c65  ugh the multiple
-00004290: 2061 7474 656e 7469 6f6e 2068 6561 6473   attention heads
-000042a0: 2e0a 2020 2020 5468 7573 2c20 6469 6666  ..    Thus, diff
-000042b0: 6572 656e 7420 7375 6273 6571 7565 6e63  erent subsequenc
-000042c0: 6573 206f 6620 6120 6769 7665 6e20 7365  es of a given se
-000042d0: 7175 656e 6365 7320 6361 6e20 6265 2070  quences can be p
-000042e0: 726f 6365 7373 6564 2064 6966 6665 7265  rocessed differe
-000042f0: 6e74 6c79 2e0a 2020 2020 5468 6520 7175  ntly..    The qu
-00004300: 6572 792c 206b 6579 2061 6e64 2076 616c  ery, key and val
-00004310: 7565 2070 6172 616d 6574 6572 7320 6172  ue parameters ar
-00004320: 6520 7370 6c69 7420 6d75 6c74 6970 6c65  e split multiple
-00004330: 2077 6179 7320 616e 6420 6561 6368 2073   ways and each s
-00004340: 706c 6974 2069 7320 7061 7373 6564 2073  plit is passed s
-00004350: 6570 6172 6174 656c 7920 7468 726f 7567  eparately throug
-00004360: 6820 6120 6469 6666 6572 656e 7420 6174  h a different at
-00004370: 7465 6e74 696f 6e20 6865 6164 2e0a 2020  tention head..  
-00004380: 2020 5265 6665 7265 6e63 6573 0a20 2020    References.   
-00004390: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-000043a0: 2e2e 205b 315d 204c 756b 6173 7a20 4d61  .. [1] Lukasz Ma
-000043b0: 7a69 6172 6b61 2065 7420 616c 2e20 224d  ziarka et al. "M
-000043c0: 6f6c 6563 756c 6520 4174 7465 6e74 696f  olecule Attentio
-000043d0: 6e20 5472 616e 7366 6f72 6d65 7222 2047  n Transformer" G
-000043e0: 7261 7068 2052 6570 7265 7365 6e74 6174  raph Representat
-000043f0: 696f 6e20 4c65 6172 6e69 6e67 2077 6f72  ion Learning wor
-00004400: 6b73 686f 7020 616e 6420 4d61 6368 696e  kshop and Machin
-00004410: 6520 4c65 6172 6e69 6e67 2061 6e64 2074  e Learning and t
-00004420: 6865 2050 6879 7369 6361 6c20 5363 6965  he Physical Scie
-00004430: 6e63 6573 2077 6f72 6b73 686f 7020 6174  nces workshop at
-00004440: 204e 6575 7249 5053 2032 3031 392e 2032   NeurIPS 2019. 2
-00004450: 3032 302e 2068 7474 7073 3a2f 2f61 7278  020. https://arx
-00004460: 6976 2e6f 7267 2f61 6273 2f32 3030 322e  iv.org/abs/2002.
-00004470: 3038 3236 340a 2020 2020 4578 616d 706c  08264.    Exampl
-00004480: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
-00004490: 2020 2020 3e3e 3e20 6672 6f6d 2064 6565      >>> from dee
-000044a0: 7063 6865 6d2e 6d6f 6465 6c73 2e74 6f72  pchem.models.tor
-000044b0: 6368 5f6d 6f64 656c 732e 6c61 7965 7273  ch_models.layers
-000044c0: 2069 6d70 6f72 7420 4d75 6c74 6948 6561   import MultiHea
-000044d0: 6465 644d 4154 4174 7465 6e74 696f 6e2c  dedMATAttention,
-000044e0: 204d 4154 456d 6265 6464 696e 670a 2020   MATEmbedding.  
-000044f0: 2020 3e3e 3e20 696d 706f 7274 2064 6565    >>> import dee
-00004500: 7063 6865 6d20 6173 2064 630a 2020 2020  pchem as dc.    
-00004510: 3e3e 3e20 696d 706f 7274 2074 6f72 6368  >>> import torch
-00004520: 0a20 2020 203e 3e3e 2069 6e70 7574 5f73  .    >>> input_s
-00004530: 6d69 6c65 203d 2022 4343 220a 2020 2020  mile = "CC".    
-00004540: 3e3e 3e20 6665 6174 203d 2064 632e 6665  >>> feat = dc.fe
-00004550: 6174 2e4d 4154 4665 6174 7572 697a 6572  at.MATFeaturizer
-00004560: 2829 0a20 2020 203e 3e3e 2069 6e70 7574  ().    >>> input
-00004570: 5f73 6d69 6c65 203d 2022 4343 220a 2020  _smile = "CC".  
-00004580: 2020 3e3e 3e20 6f75 7420 3d20 6665 6174    >>> out = feat
-00004590: 2e66 6561 7475 7269 7a65 2869 6e70 7574  .featurize(input
-000045a0: 5f73 6d69 6c65 290a 2020 2020 3e3e 3e20  _smile).    >>> 
-000045b0: 6e6f 6465 203d 2074 6f72 6368 2e74 656e  node = torch.ten
-000045c0: 736f 7228 6f75 745b 305d 2e6e 6f64 655f  sor(out[0].node_
-000045d0: 6665 6174 7572 6573 292e 666c 6f61 7428  features).float(
-000045e0: 292e 756e 7371 7565 657a 6528 3029 0a20  ).unsqueeze(0). 
-000045f0: 2020 203e 3e3e 2061 646a 203d 2074 6f72     >>> adj = tor
-00004600: 6368 2e74 656e 736f 7228 6f75 745b 305d  ch.tensor(out[0]
-00004610: 2e61 646a 6163 656e 6379 5f6d 6174 7269  .adjacency_matri
-00004620: 7829 2e66 6c6f 6174 2829 2e75 6e73 7175  x).float().unsqu
-00004630: 6565 7a65 2830 290a 2020 2020 3e3e 3e20  eeze(0).    >>> 
-00004640: 6469 7374 203d 2074 6f72 6368 2e74 656e  dist = torch.ten
-00004650: 736f 7228 6f75 745b 305d 2e64 6973 7461  sor(out[0].dista
-00004660: 6e63 655f 6d61 7472 6978 292e 666c 6f61  nce_matrix).floa
-00004670: 7428 292e 756e 7371 7565 657a 6528 3029  t().unsqueeze(0)
-00004680: 0a20 2020 203e 3e3e 206d 6173 6b20 3d20  .    >>> mask = 
-00004690: 746f 7263 682e 7375 6d28 746f 7263 682e  torch.sum(torch.
-000046a0: 6162 7328 6e6f 6465 292c 2064 696d 3d2d  abs(node), dim=-
-000046b0: 3129 2021 3d20 300a 2020 2020 3e3e 3e20  1) != 0.    >>> 
-000046c0: 6c61 7965 7220 3d20 4d75 6c74 6948 6561  layer = MultiHea
-000046d0: 6465 644d 4154 4174 7465 6e74 696f 6e28  dedMATAttention(
-000046e0: 0a20 2020 202e 2e2e 2020 2020 6469 7374  .    ...    dist
-000046f0: 5f6b 6572 6e65 6c3d 2773 6f66 746d 6178  _kernel='softmax
-00004700: 272c 0a20 2020 202e 2e2e 2020 2020 6c61  ',.    ...    la
-00004710: 6d62 6461 5f61 7474 656e 7469 6f6e 3d30  mbda_attention=0
-00004720: 2e33 332c 0a20 2020 202e 2e2e 2020 2020  .33,.    ...    
-00004730: 6c61 6d62 6461 5f64 6973 7461 6e63 653d  lambda_distance=
-00004740: 302e 3333 2c0a 2020 2020 2e2e 2e20 2020  0.33,.    ...   
-00004750: 2068 3d31 362c 0a20 2020 202e 2e2e 2020   h=16,.    ...  
-00004760: 2020 6873 697a 653d 3130 3234 2c0a 2020    hsize=1024,.  
-00004770: 2020 2e2e 2e20 2020 2064 726f 706f 7574    ...    dropout
-00004780: 5f70 3d30 2e30 290a 2020 2020 3e3e 3e20  _p=0.0).    >>> 
-00004790: 6f70 203d 204d 4154 456d 6265 6464 696e  op = MATEmbeddin
-000047a0: 6728 2928 6e6f 6465 290a 2020 2020 3e3e  g()(node).    >>
-000047b0: 3e20 6f75 7470 7574 203d 206c 6179 6572  > output = layer
-000047c0: 286f 702c 206f 702c 206f 702c 206d 6173  (op, op, op, mas
-000047d0: 6b2c 2061 646a 2c20 6469 7374 290a 2020  k, adj, dist).  
-000047e0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-000047f0: 5f69 6e69 745f 5f28 7365 6c66 2c0a 2020  _init__(self,.  
-00004800: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00004810: 6973 745f 6b65 726e 656c 3a20 7374 7220  ist_kernel: str 
-00004820: 3d20 2773 6f66 746d 6178 272c 0a20 2020  = 'softmax',.   
-00004830: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00004840: 6d62 6461 5f61 7474 656e 7469 6f6e 3a20  mbda_attention: 
-00004850: 666c 6f61 7420 3d20 302e 3333 2c0a 2020  float = 0.33,.  
-00004860: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00004870: 616d 6264 615f 6469 7374 616e 6365 3a20  ambda_distance: 
-00004880: 666c 6f61 7420 3d20 302e 3333 2c0a 2020  float = 0.33,.  
-00004890: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-000048a0: 3a20 696e 7420 3d20 3136 2c0a 2020 2020  : int = 16,.    
-000048b0: 2020 2020 2020 2020 2020 2020 2068 7369               hsi
-000048c0: 7a65 3a20 696e 7420 3d20 3130 3234 2c0a  ze: int = 1024,.
-000048d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048e0: 2064 726f 706f 7574 5f70 3a20 666c 6f61   dropout_p: floa
-000048f0: 7420 3d20 302e 302c 0a20 2020 2020 2020  t = 0.0,.       
-00004900: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-00004910: 5f62 6961 733a 2062 6f6f 6c20 3d20 5472  _bias: bool = Tr
-00004920: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
-00004930: 496e 6974 6961 6c69 7a65 2061 206d 756c  Initialize a mul
-00004940: 7469 2d68 6561 6465 6420 6174 7465 6e74  ti-headed attent
-00004950: 696f 6e20 6c61 7965 722e 0a20 2020 2020  ion layer..     
-00004960: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00004970: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00004980: 0a20 2020 2020 2020 2064 6973 745f 6b65  .        dist_ke
-00004990: 726e 656c 3a20 7374 720a 2020 2020 2020  rnel: str.      
-000049a0: 2020 2020 2020 4b65 726e 656c 2061 6374        Kernel act
-000049b0: 6976 6174 696f 6e20 746f 2062 6520 7573  ivation to be us
-000049c0: 6564 2e20 4361 6e20 6265 2065 6974 6865  ed. Can be eithe
-000049d0: 7220 2773 6f66 746d 6178 2720 666f 7220  r 'softmax' for 
-000049e0: 736f 6674 6d61 7820 6f72 2027 6578 7027  softmax or 'exp'
-000049f0: 2066 6f72 2065 7870 6f6e 656e 7469 616c   for exponential
-00004a00: 2e0a 2020 2020 2020 2020 6c61 6d62 6461  ..        lambda
-00004a10: 5f61 7474 656e 7469 6f6e 3a20 666c 6f61  _attention: floa
-00004a20: 740a 2020 2020 2020 2020 2020 2020 436f  t.            Co
-00004a30: 6e73 7461 6e74 2074 6f20 6265 206d 756c  nstant to be mul
-00004a40: 7469 706c 6965 6420 7769 7468 2074 6865  tiplied with the
-00004a50: 2061 7474 656e 7469 6f6e 206d 6174 7269   attention matri
-00004a60: 782e 0a20 2020 2020 2020 206c 616d 6264  x..        lambd
-00004a70: 615f 6469 7374 616e 6365 3a20 666c 6f61  a_distance: floa
-00004a80: 740a 2020 2020 2020 2020 2020 2020 436f  t.            Co
-00004a90: 6e73 7461 6e74 2074 6f20 6265 206d 756c  nstant to be mul
-00004aa0: 7469 706c 6965 6420 7769 7468 2074 6865  tiplied with the
-00004ab0: 2064 6973 7461 6e63 6520 6d61 7472 6978   distance matrix
-00004ac0: 2e0a 2020 2020 2020 2020 683a 2069 6e74  ..        h: int
-00004ad0: 0a20 2020 2020 2020 2020 2020 204e 756d  .            Num
-00004ae0: 6265 7220 6f66 2061 7474 656e 7469 6f6e  ber of attention
-00004af0: 2068 6561 6473 2e0a 2020 2020 2020 2020   heads..        
-00004b00: 6873 697a 653a 2069 6e74 0a20 2020 2020  hsize: int.     
-00004b10: 2020 2020 2020 2053 697a 6520 6f66 2064         Size of d
-00004b20: 656e 7365 206c 6179 6572 2e0a 2020 2020  ense layer..    
-00004b30: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
-00004b40: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-00004b50: 2044 726f 706f 7574 2070 726f 6261 6269   Dropout probabi
-00004b60: 6c69 7479 2e0a 2020 2020 2020 2020 6f75  lity..        ou
-00004b70: 7470 7574 5f62 6961 733a 2062 6f6f 6c0a  tput_bias: bool.
-00004b80: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00004b90: 7275 652c 2064 656e 7365 206c 6179 6572  rue, dense layer
-00004ba0: 7320 7769 6c6c 2075 7365 2062 6961 7320  s will use bias 
-00004bb0: 7665 6374 6f72 732e 0a20 2020 2020 2020  vectors..       
-00004bc0: 2022 2222 0a20 2020 2020 2020 2073 7570   """.        sup
-00004bd0: 6572 2829 2e5f 5f69 6e69 745f 5f28 290a  er().__init__().
-00004be0: 2020 2020 2020 2020 6966 2064 6973 745f          if dist_
-00004bf0: 6b65 726e 656c 203d 3d20 2273 6f66 746d  kernel == "softm
-00004c00: 6178 223a 0a20 2020 2020 2020 2020 2020  ax":.           
-00004c10: 2073 656c 662e 6469 7374 5f6b 6572 6e65   self.dist_kerne
-00004c20: 6c20 3d20 6c61 6d62 6461 2078 3a20 746f  l = lambda x: to
-00004c30: 7263 682e 736f 6674 6d61 7828 2d78 2c20  rch.softmax(-x, 
-00004c40: 6469 6d3d 2d31 290a 2020 2020 2020 2020  dim=-1).        
-00004c50: 656c 6966 2064 6973 745f 6b65 726e 656c  elif dist_kernel
-00004c60: 203d 3d20 2265 7870 223a 0a20 2020 2020   == "exp":.     
-00004c70: 2020 2020 2020 2073 656c 662e 6469 7374         self.dist
-00004c80: 5f6b 6572 6e65 6c20 3d20 6c61 6d62 6461  _kernel = lambda
-00004c90: 2078 3a20 746f 7263 682e 6578 7028 2d78   x: torch.exp(-x
-00004ca0: 290a 2020 2020 2020 2020 7365 6c66 2e6c  ).        self.l
-00004cb0: 616d 6264 615f 6174 7465 6e74 696f 6e20  ambda_attention 
-00004cc0: 3d20 6c61 6d62 6461 5f61 7474 656e 7469  = lambda_attenti
-00004cd0: 6f6e 0a20 2020 2020 2020 2073 656c 662e  on.        self.
-00004ce0: 6c61 6d62 6461 5f64 6973 7461 6e63 6520  lambda_distance 
-00004cf0: 3d20 6c61 6d62 6461 5f64 6973 7461 6e63  = lambda_distanc
-00004d00: 650a 2020 2020 2020 2020 7365 6c66 2e6c  e.        self.l
-00004d10: 616d 6264 615f 6164 6a61 6365 6e63 7920  ambda_adjacency 
-00004d20: 3d20 312e 3020 2d20 7365 6c66 2e6c 616d  = 1.0 - self.lam
-00004d30: 6264 615f 6174 7465 6e74 696f 6e20 2d20  bda_attention - 
-00004d40: 7365 6c66 2e6c 616d 6264 615f 6469 7374  self.lambda_dist
-00004d50: 616e 6365 0a20 2020 2020 2020 2073 656c  ance.        sel
-00004d60: 662e 645f 6b20 3d20 6873 697a 6520 2f2f  f.d_k = hsize //
-00004d70: 2068 0a20 2020 2020 2020 2073 656c 662e   h.        self.
-00004d80: 6820 3d20 680a 2020 2020 2020 2020 6c69  h = h.        li
-00004d90: 6e65 6172 5f6c 6179 6572 203d 206e 6e2e  near_layer = nn.
-00004da0: 4c69 6e65 6172 2868 7369 7a65 2c20 6873  Linear(hsize, hs
-00004db0: 697a 6529 0a20 2020 2020 2020 2073 656c  ize).        sel
-00004dc0: 662e 6c69 6e65 6172 5f6c 6179 6572 7320  f.linear_layers 
-00004dd0: 3d20 6e6e 2e4d 6f64 756c 654c 6973 7428  = nn.ModuleList(
-00004de0: 5b6c 696e 6561 725f 6c61 7965 7220 666f  [linear_layer fo
-00004df0: 7220 5f20 696e 2072 616e 6765 2833 295d  r _ in range(3)]
-00004e00: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
-00004e10: 726f 706f 7574 5f70 203d 206e 6e2e 4472  ropout_p = nn.Dr
-00004e20: 6f70 6f75 7428 6472 6f70 6f75 745f 7029  opout(dropout_p)
-00004e30: 0a20 2020 2020 2020 2073 656c 662e 6f75  .        self.ou
-00004e40: 7470 7574 5f6c 696e 6561 7220 3d20 6e6e  tput_linear = nn
-00004e50: 2e4c 696e 6561 7228 6873 697a 652c 2068  .Linear(hsize, h
-00004e60: 7369 7a65 2c20 6f75 7470 7574 5f62 6961  size, output_bia
-00004e70: 7329 0a0a 2020 2020 6465 6620 5f73 696e  s)..    def _sin
-00004e80: 676c 655f 6174 7465 6e74 696f 6e28 0a20  gle_attention(. 
-00004e90: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-00004ea0: 0a20 2020 2020 2020 2020 2020 2071 7565  .            que
-00004eb0: 7279 3a20 746f 7263 682e 5465 6e73 6f72  ry: torch.Tensor
-00004ec0: 2c0a 2020 2020 2020 2020 2020 2020 6b65  ,.            ke
-00004ed0: 793a 2074 6f72 6368 2e54 656e 736f 722c  y: torch.Tensor,
-00004ee0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00004ef0: 7565 3a20 746f 7263 682e 5465 6e73 6f72  ue: torch.Tensor
-00004f00: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
-00004f10: 736b 3a20 746f 7263 682e 5465 6e73 6f72  sk: torch.Tensor
-00004f20: 2c0a 2020 2020 2020 2020 2020 2020 6164  ,.            ad
-00004f30: 6a5f 6d61 7472 6978 3a20 746f 7263 682e  j_matrix: torch.
-00004f40: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
-00004f50: 2020 2020 6469 7374 616e 6365 5f6d 6174      distance_mat
-00004f60: 7269 783a 2074 6f72 6368 2e54 656e 736f  rix: torch.Tenso
-00004f70: 722c 0a20 2020 2020 2020 2020 2020 2064  r,.            d
-00004f80: 726f 706f 7574 5f70 3a20 666c 6f61 7420  ropout_p: float 
-00004f90: 3d20 302e 302c 0a20 2020 2020 2020 2020  = 0.0,.         
-00004fa0: 2020 2065 7073 3a20 666c 6f61 7420 3d20     eps: float = 
-00004fb0: 3165 2d36 2c0a 2020 2020 2020 2020 2020  1e-6,.          
-00004fc0: 2020 696e 663a 2066 6c6f 6174 203d 2031    inf: float = 1
-00004fd0: 6531 3229 202d 3e20 5475 706c 655b 746f  e12) -> Tuple[to
-00004fe0: 7263 682e 5465 6e73 6f72 2c20 746f 7263  rch.Tensor, torc
-00004ff0: 682e 5465 6e73 6f72 5d3a 0a20 2020 2020  h.Tensor]:.     
-00005000: 2020 2022 2222 4465 6669 6e69 6e67 2061     """Defining a
-00005010: 6e64 2063 6f6d 7075 7469 6e67 206f 7574  nd computing out
-00005020: 7075 7420 666f 7220 6120 7369 6e67 6c65  put for a single
-00005030: 204d 4154 2061 7474 656e 7469 6f6e 206c   MAT attention l
-00005040: 6179 6572 2e0a 2020 2020 2020 2020 5061  ayer..        Pa
-00005050: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00005060: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00005070: 2020 2020 7175 6572 793a 2074 6f72 6368      query: torch
-00005080: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-00005090: 2020 2020 5374 616e 6461 7264 2071 7565      Standard que
-000050a0: 7279 2070 6172 616d 6574 6572 2066 6f72  ry parameter for
-000050b0: 2061 7474 656e 7469 6f6e 2e0a 2020 2020   attention..    
-000050c0: 2020 2020 6b65 793a 2074 6f72 6368 2e54      key: torch.T
-000050d0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-000050e0: 2020 5374 616e 6461 7264 206b 6579 2070    Standard key p
-000050f0: 6172 616d 6574 6572 2066 6f72 2061 7474  arameter for att
-00005100: 656e 7469 6f6e 2e0a 2020 2020 2020 2020  ention..        
-00005110: 7661 6c75 653a 2074 6f72 6368 2e54 656e  value: torch.Ten
-00005120: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-00005130: 5374 616e 6461 7264 2076 616c 7565 2070  Standard value p
-00005140: 6172 616d 6574 6572 2066 6f72 2061 7474  arameter for att
-00005150: 656e 7469 6f6e 2e0a 2020 2020 2020 2020  ention..        
-00005160: 6d61 736b 3a20 746f 7263 682e 5465 6e73  mask: torch.Tens
-00005170: 6f72 0a20 2020 2020 2020 2020 2020 204d  or.            M
-00005180: 6173 6b73 206f 7574 2070 6164 6469 6e67  asks out padding
-00005190: 2076 616c 7565 7320 736f 2074 6861 7420   values so that 
-000051a0: 7468 6579 2061 7265 206e 6f74 2074 616b  they are not tak
-000051b0: 656e 2069 6e74 6f20 6163 636f 756e 7420  en into account 
-000051c0: 7768 656e 2063 6f6d 7075 7469 6e67 2074  when computing t
-000051d0: 6865 2061 7474 656e 7469 6f6e 2073 636f  he attention sco
-000051e0: 7265 2e0a 2020 2020 2020 2020 6164 6a5f  re..        adj_
-000051f0: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
-00005200: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-00005210: 2041 646a 6163 656e 6379 206d 6174 7269   Adjacency matri
-00005220: 7820 6f66 2074 6865 2069 6e70 7574 206d  x of the input m
-00005230: 6f6c 6563 756c 652c 2072 6574 7572 6e65  olecule, returne
-00005240: 6420 6672 6f6d 2064 632e 6665 6174 2e4d  d from dc.feat.M
-00005250: 4154 4665 6174 7572 697a 6572 2829 0a20  ATFeaturizer(). 
-00005260: 2020 2020 2020 2064 6973 745f 6d61 7472         dist_matr
-00005270: 6978 3a20 746f 7263 682e 5465 6e73 6f72  ix: torch.Tensor
-00005280: 0a20 2020 2020 2020 2020 2020 2044 6973  .            Dis
-00005290: 7461 6e63 6520 6d61 7472 6978 206f 6620  tance matrix of 
-000052a0: 7468 6520 696e 7075 7420 6d6f 6c65 6375  the input molecu
-000052b0: 6c65 2c20 7265 7475 726e 6564 2066 726f  le, returned fro
-000052c0: 6d20 6463 2e66 6561 742e 4d41 5446 6561  m dc.feat.MATFea
-000052d0: 7475 7269 7a65 7228 290a 2020 2020 2020  turizer().      
-000052e0: 2020 6472 6f70 6f75 745f 703a 2066 6c6f    dropout_p: flo
-000052f0: 6174 0a20 2020 2020 2020 2020 2020 2044  at.            D
-00005300: 726f 706f 7574 2070 726f 6261 6269 6c69  ropout probabili
-00005310: 7479 2e0a 2020 2020 2020 2020 6570 733a  ty..        eps:
-00005320: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
-00005330: 2020 2045 7073 696c 6f6e 2076 616c 7565     Epsilon value
-00005340: 0a20 2020 2020 2020 2069 6e66 3a20 666c  .        inf: fl
-00005350: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
-00005360: 5661 6c75 6520 6f66 2069 6e66 696e 6974  Value of infinit
-00005370: 7920 746f 2062 6520 7573 6564 2e0a 2020  y to be used..  
-00005380: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00005390: 2020 645f 6b20 3d20 7175 6572 792e 7369    d_k = query.si
-000053a0: 7a65 282d 3129 0a0a 2020 2020 2020 2020  ze(-1)..        
-000053b0: 7363 6f72 6573 203d 2074 6f72 6368 2e6d  scores = torch.m
-000053c0: 6174 6d75 6c28 7175 6572 792c 206b 6579  atmul(query, key
-000053d0: 2e74 7261 6e73 706f 7365 282d 322c 202d  .transpose(-2, -
-000053e0: 3129 2920 2f20 6d61 7468 2e73 7172 7428  1)) / math.sqrt(
-000053f0: 645f 6b29 0a0a 2020 2020 2020 2020 6966  d_k)..        if
-00005400: 206d 6173 6b20 6973 206e 6f74 204e 6f6e   mask is not Non
-00005410: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00005420: 636f 7265 7320 3d20 7363 6f72 6573 2e6d  cores = scores.m
-00005430: 6173 6b65 645f 6669 6c6c 280a 2020 2020  asked_fill(.    
-00005440: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00005450: 2e75 6e73 7175 6565 7a65 2831 292e 7265  .unsqueeze(1).re
-00005460: 7065 6174 2831 2c20 7175 6572 792e 7368  peat(1, query.sh
-00005470: 6170 655b 315d 2c20 7175 6572 792e 7368  ape[1], query.sh
-00005480: 6170 655b 325d 2c0a 2020 2020 2020 2020  ape[2],.        
+00004130: 2020 2020 2020 2020 2020 6b65 6570 6469            keepdi
+00004140: 6d3d 5472 7565 292e 636c 616d 7028 6d69  m=True).clamp(mi
+00004150: 6e3d 7365 6c66 2e65 7073 290a 2020 2020  n=self.eps).    
+00004160: 2020 2020 7265 7475 726e 2078 202a 206e      return x * n
+00004170: 6f72 6d0a 0a0a 636c 6173 7320 4d75 6c74  orm...class Mult
+00004180: 6948 6561 6465 644d 4154 4174 7465 6e74  iHeadedMATAttent
+00004190: 696f 6e28 6e6e 2e4d 6f64 756c 6529 3a0a  ion(nn.Module):.
+000041a0: 2020 2020 2222 2246 6972 7374 2063 6f6e      """First con
+000041b0: 7374 7275 6374 7320 616e 2061 7474 656e  structs an atten
+000041c0: 7469 6f6e 206c 6179 6572 2074 6169 6c6f  tion layer tailo
+000041d0: 7265 6420 746f 2074 6865 204d 6f6c 6563  red to the Molec
+000041e0: 756c 6172 2041 7474 656e 7469 6f6e 2054  ular Attention T
+000041f0: 7261 6e73 666f 726d 6572 205b 315d 5f20  ransformer [1]_ 
+00004200: 616e 6420 7468 656e 2063 6f6e 7665 7274  and then convert
+00004210: 7320 6974 2069 6e74 6f20 4d75 6c74 692d  s it into Multi-
+00004220: 4865 6164 6564 2041 7474 656e 7469 6f6e  Headed Attention
+00004230: 2e0a 0a20 2020 2049 6e20 4d75 6c74 692d  ...    In Multi-
+00004240: 4865 6164 6564 2061 7474 656e 7469 6f6e  Headed attention
+00004250: 2074 6865 2061 7474 656e 7469 6f6e 206d   the attention m
+00004260: 6563 6861 6e69 736d 206d 756c 7469 706c  echanism multipl
+00004270: 6520 7469 6d65 7320 7061 7261 6c6c 656c  e times parallel
+00004280: 7920 7468 726f 7567 6820 7468 6520 6d75  y through the mu
+00004290: 6c74 6970 6c65 2061 7474 656e 7469 6f6e  ltiple attention
+000042a0: 2068 6561 6473 2e0a 2020 2020 5468 7573   heads..    Thus
+000042b0: 2c20 6469 6666 6572 656e 7420 7375 6273  , different subs
+000042c0: 6571 7565 6e63 6573 206f 6620 6120 6769  equences of a gi
+000042d0: 7665 6e20 7365 7175 656e 6365 7320 6361  ven sequences ca
+000042e0: 6e20 6265 2070 726f 6365 7373 6564 2064  n be processed d
+000042f0: 6966 6665 7265 6e74 6c79 2e0a 2020 2020  ifferently..    
+00004300: 5468 6520 7175 6572 792c 206b 6579 2061  The query, key a
+00004310: 6e64 2076 616c 7565 2070 6172 616d 6574  nd value paramet
+00004320: 6572 7320 6172 6520 7370 6c69 7420 6d75  ers are split mu
+00004330: 6c74 6970 6c65 2077 6179 7320 616e 6420  ltiple ways and 
+00004340: 6561 6368 2073 706c 6974 2069 7320 7061  each split is pa
+00004350: 7373 6564 2073 6570 6172 6174 656c 7920  ssed separately 
+00004360: 7468 726f 7567 6820 6120 6469 6666 6572  through a differ
+00004370: 656e 7420 6174 7465 6e74 696f 6e20 6865  ent attention he
+00004380: 6164 2e0a 2020 2020 5265 6665 7265 6e63  ad..    Referenc
+00004390: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  es.    ---------
+000043a0: 2d0a 2020 2020 2e2e 205b 315d 204c 756b  -.    .. [1] Luk
+000043b0: 6173 7a20 4d61 7a69 6172 6b61 2065 7420  asz Maziarka et 
+000043c0: 616c 2e20 224d 6f6c 6563 756c 6520 4174  al. "Molecule At
+000043d0: 7465 6e74 696f 6e20 5472 616e 7366 6f72  tention Transfor
+000043e0: 6d65 7222 2047 7261 7068 2052 6570 7265  mer" Graph Repre
+000043f0: 7365 6e74 6174 696f 6e20 4c65 6172 6e69  sentation Learni
+00004400: 6e67 2077 6f72 6b73 686f 7020 616e 6420  ng workshop and 
+00004410: 4d61 6368 696e 6520 4c65 6172 6e69 6e67  Machine Learning
+00004420: 2061 6e64 2074 6865 2050 6879 7369 6361   and the Physica
+00004430: 6c20 5363 6965 6e63 6573 2077 6f72 6b73  l Sciences works
+00004440: 686f 7020 6174 204e 6575 7249 5053 2032  hop at NeurIPS 2
+00004450: 3031 392e 2032 3032 302e 2068 7474 7073  019. 2020. https
+00004460: 3a2f 2f61 7278 6976 2e6f 7267 2f61 6273  ://arxiv.org/abs
+00004470: 2f32 3030 322e 3038 3236 340a 2020 2020  /2002.08264.    
+00004480: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
+00004490: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 6672  -----.    >>> fr
+000044a0: 6f6d 2064 6565 7063 6865 6d2e 6d6f 6465  om deepchem.mode
+000044b0: 6c73 2e74 6f72 6368 5f6d 6f64 656c 732e  ls.torch_models.
+000044c0: 6c61 7965 7273 2069 6d70 6f72 7420 4d75  layers import Mu
+000044d0: 6c74 6948 6561 6465 644d 4154 4174 7465  ltiHeadedMATAtte
+000044e0: 6e74 696f 6e2c 204d 4154 456d 6265 6464  ntion, MATEmbedd
+000044f0: 696e 670a 2020 2020 3e3e 3e20 696d 706f  ing.    >>> impo
+00004500: 7274 2064 6565 7063 6865 6d20 6173 2064  rt deepchem as d
+00004510: 630a 2020 2020 3e3e 3e20 696d 706f 7274  c.    >>> import
+00004520: 2074 6f72 6368 0a20 2020 203e 3e3e 2069   torch.    >>> i
+00004530: 6e70 7574 5f73 6d69 6c65 203d 2022 4343  nput_smile = "CC
+00004540: 220a 2020 2020 3e3e 3e20 6665 6174 203d  ".    >>> feat =
+00004550: 2064 632e 6665 6174 2e4d 4154 4665 6174   dc.feat.MATFeat
+00004560: 7572 697a 6572 2829 0a20 2020 203e 3e3e  urizer().    >>>
+00004570: 2069 6e70 7574 5f73 6d69 6c65 203d 2022   input_smile = "
+00004580: 4343 220a 2020 2020 3e3e 3e20 6f75 7420  CC".    >>> out 
+00004590: 3d20 6665 6174 2e66 6561 7475 7269 7a65  = feat.featurize
+000045a0: 2869 6e70 7574 5f73 6d69 6c65 290a 2020  (input_smile).  
+000045b0: 2020 3e3e 3e20 6e6f 6465 203d 2074 6f72    >>> node = tor
+000045c0: 6368 2e74 656e 736f 7228 6f75 745b 305d  ch.tensor(out[0]
+000045d0: 2e6e 6f64 655f 6665 6174 7572 6573 292e  .node_features).
+000045e0: 666c 6f61 7428 292e 756e 7371 7565 657a  float().unsqueez
+000045f0: 6528 3029 0a20 2020 203e 3e3e 2061 646a  e(0).    >>> adj
+00004600: 203d 2074 6f72 6368 2e74 656e 736f 7228   = torch.tensor(
+00004610: 6f75 745b 305d 2e61 646a 6163 656e 6379  out[0].adjacency
+00004620: 5f6d 6174 7269 7829 2e66 6c6f 6174 2829  _matrix).float()
+00004630: 2e75 6e73 7175 6565 7a65 2830 290a 2020  .unsqueeze(0).  
+00004640: 2020 3e3e 3e20 6469 7374 203d 2074 6f72    >>> dist = tor
+00004650: 6368 2e74 656e 736f 7228 6f75 745b 305d  ch.tensor(out[0]
+00004660: 2e64 6973 7461 6e63 655f 6d61 7472 6978  .distance_matrix
+00004670: 292e 666c 6f61 7428 292e 756e 7371 7565  ).float().unsque
+00004680: 657a 6528 3029 0a20 2020 203e 3e3e 206d  eze(0).    >>> m
+00004690: 6173 6b20 3d20 746f 7263 682e 7375 6d28  ask = torch.sum(
+000046a0: 746f 7263 682e 6162 7328 6e6f 6465 292c  torch.abs(node),
+000046b0: 2064 696d 3d2d 3129 2021 3d20 300a 2020   dim=-1) != 0.  
+000046c0: 2020 3e3e 3e20 6c61 7965 7220 3d20 4d75    >>> layer = Mu
+000046d0: 6c74 6948 6561 6465 644d 4154 4174 7465  ltiHeadedMATAtte
+000046e0: 6e74 696f 6e28 0a20 2020 202e 2e2e 2020  ntion(.    ...  
+000046f0: 2020 6469 7374 5f6b 6572 6e65 6c3d 2773    dist_kernel='s
+00004700: 6f66 746d 6178 272c 0a20 2020 202e 2e2e  oftmax',.    ...
+00004710: 2020 2020 6c61 6d62 6461 5f61 7474 656e      lambda_atten
+00004720: 7469 6f6e 3d30 2e33 332c 0a20 2020 202e  tion=0.33,.    .
+00004730: 2e2e 2020 2020 6c61 6d62 6461 5f64 6973  ..    lambda_dis
+00004740: 7461 6e63 653d 302e 3333 2c0a 2020 2020  tance=0.33,.    
+00004750: 2e2e 2e20 2020 2068 3d31 362c 0a20 2020  ...    h=16,.   
+00004760: 202e 2e2e 2020 2020 6873 697a 653d 3130   ...    hsize=10
+00004770: 3234 2c0a 2020 2020 2e2e 2e20 2020 2064  24,.    ...    d
+00004780: 726f 706f 7574 5f70 3d30 2e30 290a 2020  ropout_p=0.0).  
+00004790: 2020 3e3e 3e20 6f70 203d 204d 4154 456d    >>> op = MATEm
+000047a0: 6265 6464 696e 6728 2928 6e6f 6465 290a  bedding()(node).
+000047b0: 2020 2020 3e3e 3e20 6f75 7470 7574 203d      >>> output =
+000047c0: 206c 6179 6572 286f 702c 206f 702c 206f   layer(op, op, o
+000047d0: 702c 206d 6173 6b2c 2061 646a 2c20 6469  p, mask, adj, di
+000047e0: 7374 290a 2020 2020 2222 220a 0a20 2020  st).    """..   
+000047f0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00004800: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00004810: 2020 2020 2064 6973 745f 6b65 726e 656c       dist_kernel
+00004820: 3a20 7374 7220 3d20 2773 6f66 746d 6178  : str = 'softmax
+00004830: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00004840: 2020 2020 6c61 6d62 6461 5f61 7474 656e      lambda_atten
+00004850: 7469 6f6e 3a20 666c 6f61 7420 3d20 302e  tion: float = 0.
+00004860: 3333 2c0a 2020 2020 2020 2020 2020 2020  33,.            
+00004870: 2020 2020 206c 616d 6264 615f 6469 7374       lambda_dist
+00004880: 616e 6365 3a20 666c 6f61 7420 3d20 302e  ance: float = 0.
+00004890: 3333 2c0a 2020 2020 2020 2020 2020 2020  33,.            
+000048a0: 2020 2020 2068 3a20 696e 7420 3d20 3136       h: int = 16
+000048b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000048c0: 2020 2068 7369 7a65 3a20 696e 7420 3d20     hsize: int = 
+000048d0: 3130 3234 2c0a 2020 2020 2020 2020 2020  1024,.          
+000048e0: 2020 2020 2020 2064 726f 706f 7574 5f70         dropout_p
+000048f0: 3a20 666c 6f61 7420 3d20 302e 302c 0a20  : float = 0.0,. 
+00004900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004910: 6f75 7470 7574 5f62 6961 733a 2062 6f6f  output_bias: boo
+00004920: 6c20 3d20 5472 7565 293a 0a20 2020 2020  l = True):.     
+00004930: 2020 2022 2222 496e 6974 6961 6c69 7a65     """Initialize
+00004940: 2061 206d 756c 7469 2d68 6561 6465 6420   a multi-headed 
+00004950: 6174 7465 6e74 696f 6e20 6c61 7965 722e  attention layer.
+00004960: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00004970: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00004980: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+00004990: 6973 745f 6b65 726e 656c 3a20 7374 720a  ist_kernel: str.
+000049a0: 2020 2020 2020 2020 2020 2020 4b65 726e              Kern
+000049b0: 656c 2061 6374 6976 6174 696f 6e20 746f  el activation to
+000049c0: 2062 6520 7573 6564 2e20 4361 6e20 6265   be used. Can be
+000049d0: 2065 6974 6865 7220 2773 6f66 746d 6178   either 'softmax
+000049e0: 2720 666f 7220 736f 6674 6d61 7820 6f72  ' for softmax or
+000049f0: 2027 6578 7027 2066 6f72 2065 7870 6f6e   'exp' for expon
+00004a00: 656e 7469 616c 2e0a 2020 2020 2020 2020  ential..        
+00004a10: 6c61 6d62 6461 5f61 7474 656e 7469 6f6e  lambda_attention
+00004a20: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+00004a30: 2020 2020 436f 6e73 7461 6e74 2074 6f20      Constant to 
+00004a40: 6265 206d 756c 7469 706c 6965 6420 7769  be multiplied wi
+00004a50: 7468 2074 6865 2061 7474 656e 7469 6f6e  th the attention
+00004a60: 206d 6174 7269 782e 0a20 2020 2020 2020   matrix..       
+00004a70: 206c 616d 6264 615f 6469 7374 616e 6365   lambda_distance
+00004a80: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+00004a90: 2020 2020 436f 6e73 7461 6e74 2074 6f20      Constant to 
+00004aa0: 6265 206d 756c 7469 706c 6965 6420 7769  be multiplied wi
+00004ab0: 7468 2074 6865 2064 6973 7461 6e63 6520  th the distance 
+00004ac0: 6d61 7472 6978 2e0a 2020 2020 2020 2020  matrix..        
+00004ad0: 683a 2069 6e74 0a20 2020 2020 2020 2020  h: int.         
+00004ae0: 2020 204e 756d 6265 7220 6f66 2061 7474     Number of att
+00004af0: 656e 7469 6f6e 2068 6561 6473 2e0a 2020  ention heads..  
+00004b00: 2020 2020 2020 6873 697a 653a 2069 6e74        hsize: int
+00004b10: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
+00004b20: 6520 6f66 2064 656e 7365 206c 6179 6572  e of dense layer
+00004b30: 2e0a 2020 2020 2020 2020 6472 6f70 6f75  ..        dropou
+00004b40: 745f 703a 2066 6c6f 6174 0a20 2020 2020  t_p: float.     
+00004b50: 2020 2020 2020 2044 726f 706f 7574 2070         Dropout p
+00004b60: 726f 6261 6269 6c69 7479 2e0a 2020 2020  robability..    
+00004b70: 2020 2020 6f75 7470 7574 5f62 6961 733a      output_bias:
+00004b80: 2062 6f6f 6c0a 2020 2020 2020 2020 2020   bool.          
+00004b90: 2020 4966 2054 7275 652c 2064 656e 7365    If True, dense
+00004ba0: 206c 6179 6572 7320 7769 6c6c 2075 7365   layers will use
+00004bb0: 2062 6961 7320 7665 6374 6f72 732e 0a20   bias vectors.. 
+00004bc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00004bd0: 2020 2073 7570 6572 2829 2e5f 5f69 6e69     super().__ini
+00004be0: 745f 5f28 290a 2020 2020 2020 2020 6966  t__().        if
+00004bf0: 2064 6973 745f 6b65 726e 656c 203d 3d20   dist_kernel == 
+00004c00: 2273 6f66 746d 6178 223a 0a20 2020 2020  "softmax":.     
+00004c10: 2020 2020 2020 2073 656c 662e 6469 7374         self.dist
+00004c20: 5f6b 6572 6e65 6c20 3d20 6c61 6d62 6461  _kernel = lambda
+00004c30: 2078 3a20 746f 7263 682e 736f 6674 6d61   x: torch.softma
+00004c40: 7828 2d78 2c20 6469 6d3d 2d31 290a 2020  x(-x, dim=-1).  
+00004c50: 2020 2020 2020 656c 6966 2064 6973 745f        elif dist_
+00004c60: 6b65 726e 656c 203d 3d20 2265 7870 223a  kernel == "exp":
+00004c70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00004c80: 662e 6469 7374 5f6b 6572 6e65 6c20 3d20  f.dist_kernel = 
+00004c90: 6c61 6d62 6461 2078 3a20 746f 7263 682e  lambda x: torch.
+00004ca0: 6578 7028 2d78 290a 2020 2020 2020 2020  exp(-x).        
+00004cb0: 7365 6c66 2e6c 616d 6264 615f 6174 7465  self.lambda_atte
+00004cc0: 6e74 696f 6e20 3d20 6c61 6d62 6461 5f61  ntion = lambda_a
+00004cd0: 7474 656e 7469 6f6e 0a20 2020 2020 2020  ttention.       
+00004ce0: 2073 656c 662e 6c61 6d62 6461 5f64 6973   self.lambda_dis
+00004cf0: 7461 6e63 6520 3d20 6c61 6d62 6461 5f64  tance = lambda_d
+00004d00: 6973 7461 6e63 650a 2020 2020 2020 2020  istance.        
+00004d10: 7365 6c66 2e6c 616d 6264 615f 6164 6a61  self.lambda_adja
+00004d20: 6365 6e63 7920 3d20 312e 3020 2d20 7365  cency = 1.0 - se
+00004d30: 6c66 2e6c 616d 6264 615f 6174 7465 6e74  lf.lambda_attent
+00004d40: 696f 6e20 2d20 7365 6c66 2e6c 616d 6264  ion - self.lambd
+00004d50: 615f 6469 7374 616e 6365 0a20 2020 2020  a_distance.     
+00004d60: 2020 2073 656c 662e 645f 6b20 3d20 6873     self.d_k = hs
+00004d70: 697a 6520 2f2f 2068 0a20 2020 2020 2020  ize // h.       
+00004d80: 2073 656c 662e 6820 3d20 680a 2020 2020   self.h = h.    
+00004d90: 2020 2020 6c69 6e65 6172 5f6c 6179 6572      linear_layer
+00004da0: 203d 206e 6e2e 4c69 6e65 6172 2868 7369   = nn.Linear(hsi
+00004db0: 7a65 2c20 6873 697a 6529 0a20 2020 2020  ze, hsize).     
+00004dc0: 2020 2073 656c 662e 6c69 6e65 6172 5f6c     self.linear_l
+00004dd0: 6179 6572 7320 3d20 6e6e 2e4d 6f64 756c  ayers = nn.Modul
+00004de0: 654c 6973 7428 5b6c 696e 6561 725f 6c61  eList([linear_la
+00004df0: 7965 7220 666f 7220 5f20 696e 2072 616e  yer for _ in ran
+00004e00: 6765 2833 295d 290a 2020 2020 2020 2020  ge(3)]).        
+00004e10: 7365 6c66 2e64 726f 706f 7574 5f70 203d  self.dropout_p =
+00004e20: 206e 6e2e 4472 6f70 6f75 7428 6472 6f70   nn.Dropout(drop
+00004e30: 6f75 745f 7029 0a20 2020 2020 2020 2073  out_p).        s
+00004e40: 656c 662e 6f75 7470 7574 5f6c 696e 6561  elf.output_linea
+00004e50: 7220 3d20 6e6e 2e4c 696e 6561 7228 6873  r = nn.Linear(hs
+00004e60: 697a 652c 2068 7369 7a65 2c20 6f75 7470  ize, hsize, outp
+00004e70: 7574 5f62 6961 7329 0a0a 2020 2020 6465  ut_bias)..    de
+00004e80: 6620 5f73 696e 676c 655f 6174 7465 6e74  f _single_attent
+00004e90: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+00004ea0: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
+00004eb0: 2020 2071 7565 7279 3a20 746f 7263 682e     query: torch.
+00004ec0: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
+00004ed0: 2020 2020 6b65 793a 2074 6f72 6368 2e54      key: torch.T
+00004ee0: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
+00004ef0: 2020 2076 616c 7565 3a20 746f 7263 682e     value: torch.
+00004f00: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
+00004f10: 2020 2020 6d61 736b 3a20 746f 7263 682e      mask: torch.
+00004f20: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
+00004f30: 2020 2020 6164 6a5f 6d61 7472 6978 3a20      adj_matrix: 
+00004f40: 746f 7263 682e 5465 6e73 6f72 2c0a 2020  torch.Tensor,.  
+00004f50: 2020 2020 2020 2020 2020 6469 7374 616e            distan
+00004f60: 6365 5f6d 6174 7269 783a 2074 6f72 6368  ce_matrix: torch
+00004f70: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
+00004f80: 2020 2020 2064 726f 706f 7574 5f70 3a20       dropout_p: 
+00004f90: 666c 6f61 7420 3d20 302e 302c 0a20 2020  float = 0.0,.   
+00004fa0: 2020 2020 2020 2020 2065 7073 3a20 666c           eps: fl
+00004fb0: 6f61 7420 3d20 3165 2d36 2c0a 2020 2020  oat = 1e-6,.    
+00004fc0: 2020 2020 2020 2020 696e 663a 2066 6c6f          inf: flo
+00004fd0: 6174 203d 2031 6531 3229 202d 3e20 5475  at = 1e12) -> Tu
+00004fe0: 706c 655b 746f 7263 682e 5465 6e73 6f72  ple[torch.Tensor
+00004ff0: 2c20 746f 7263 682e 5465 6e73 6f72 5d3a  , torch.Tensor]:
+00005000: 0a20 2020 2020 2020 2022 2222 4465 6669  .        """Defi
+00005010: 6e69 6e67 2061 6e64 2063 6f6d 7075 7469  ning and computi
+00005020: 6e67 206f 7574 7075 7420 666f 7220 6120  ng output for a 
+00005030: 7369 6e67 6c65 204d 4154 2061 7474 656e  single MAT atten
+00005040: 7469 6f6e 206c 6179 6572 2e0a 2020 2020  tion layer..    
+00005050: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00005060: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00005070: 2d0a 2020 2020 2020 2020 7175 6572 793a  -.        query:
+00005080: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+00005090: 2020 2020 2020 2020 2020 5374 616e 6461            Standa
+000050a0: 7264 2071 7565 7279 2070 6172 616d 6574  rd query paramet
+000050b0: 6572 2066 6f72 2061 7474 656e 7469 6f6e  er for attention
+000050c0: 2e0a 2020 2020 2020 2020 6b65 793a 2074  ..        key: t
+000050d0: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+000050e0: 2020 2020 2020 2020 5374 616e 6461 7264          Standard
+000050f0: 206b 6579 2070 6172 616d 6574 6572 2066   key parameter f
+00005100: 6f72 2061 7474 656e 7469 6f6e 2e0a 2020  or attention..  
+00005110: 2020 2020 2020 7661 6c75 653a 2074 6f72        value: tor
+00005120: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+00005130: 2020 2020 2020 5374 616e 6461 7264 2076        Standard v
+00005140: 616c 7565 2070 6172 616d 6574 6572 2066  alue parameter f
+00005150: 6f72 2061 7474 656e 7469 6f6e 2e0a 2020  or attention..  
+00005160: 2020 2020 2020 6d61 736b 3a20 746f 7263        mask: torc
+00005170: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00005180: 2020 2020 204d 6173 6b73 206f 7574 2070       Masks out p
+00005190: 6164 6469 6e67 2076 616c 7565 7320 736f  adding values so
+000051a0: 2074 6861 7420 7468 6579 2061 7265 206e   that they are n
+000051b0: 6f74 2074 616b 656e 2069 6e74 6f20 6163  ot taken into ac
+000051c0: 636f 756e 7420 7768 656e 2063 6f6d 7075  count when compu
+000051d0: 7469 6e67 2074 6865 2061 7474 656e 7469  ting the attenti
+000051e0: 6f6e 2073 636f 7265 2e0a 2020 2020 2020  on score..      
+000051f0: 2020 6164 6a5f 6d61 7472 6978 3a20 746f    adj_matrix: to
+00005200: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+00005210: 2020 2020 2020 2041 646a 6163 656e 6379         Adjacency
+00005220: 206d 6174 7269 7820 6f66 2074 6865 2069   matrix of the i
+00005230: 6e70 7574 206d 6f6c 6563 756c 652c 2072  nput molecule, r
+00005240: 6574 7572 6e65 6420 6672 6f6d 2064 632e  eturned from dc.
+00005250: 6665 6174 2e4d 4154 4665 6174 7572 697a  feat.MATFeaturiz
+00005260: 6572 2829 0a20 2020 2020 2020 2064 6973  er().        dis
+00005270: 745f 6d61 7472 6978 3a20 746f 7263 682e  t_matrix: torch.
+00005280: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00005290: 2020 2044 6973 7461 6e63 6520 6d61 7472     Distance matr
+000052a0: 6978 206f 6620 7468 6520 696e 7075 7420  ix of the input 
+000052b0: 6d6f 6c65 6375 6c65 2c20 7265 7475 726e  molecule, return
+000052c0: 6564 2066 726f 6d20 6463 2e66 6561 742e  ed from dc.feat.
+000052d0: 4d41 5446 6561 7475 7269 7a65 7228 290a  MATFeaturizer().
+000052e0: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
+000052f0: 703a 2066 6c6f 6174 0a20 2020 2020 2020  p: float.       
+00005300: 2020 2020 2044 726f 706f 7574 2070 726f       Dropout pro
+00005310: 6261 6269 6c69 7479 2e0a 2020 2020 2020  bability..      
+00005320: 2020 6570 733a 2066 6c6f 6174 0a20 2020    eps: float.   
+00005330: 2020 2020 2020 2020 2045 7073 696c 6f6e           Epsilon
+00005340: 2076 616c 7565 0a20 2020 2020 2020 2069   value.        i
+00005350: 6e66 3a20 666c 6f61 740a 2020 2020 2020  nf: float.      
+00005360: 2020 2020 2020 5661 6c75 6520 6f66 2069        Value of i
+00005370: 6e66 696e 6974 7920 746f 2062 6520 7573  nfinity to be us
+00005380: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
+00005390: 2020 2020 2020 2020 645f 6b20 3d20 7175          d_k = qu
+000053a0: 6572 792e 7369 7a65 282d 3129 0a0a 2020  ery.size(-1)..  
+000053b0: 2020 2020 2020 7363 6f72 6573 203d 2074        scores = t
+000053c0: 6f72 6368 2e6d 6174 6d75 6c28 7175 6572  orch.matmul(quer
+000053d0: 792c 206b 6579 2e74 7261 6e73 706f 7365  y, key.transpose
+000053e0: 282d 322c 202d 3129 2920 2f20 6d61 7468  (-2, -1)) / math
+000053f0: 2e73 7172 7428 645f 6b29 0a0a 2020 2020  .sqrt(d_k)..    
+00005400: 2020 2020 6966 206d 6173 6b20 6973 206e      if mask is n
+00005410: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00005420: 2020 2020 2073 636f 7265 7320 3d20 7363       scores = sc
+00005430: 6f72 6573 2e6d 6173 6b65 645f 6669 6c6c  ores.masked_fill
+00005440: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00005450: 2020 6d61 736b 2e75 6e73 7175 6565 7a65    mask.unsqueeze
+00005460: 2831 292e 7265 7065 6174 2831 2c20 7175  (1).repeat(1, qu
+00005470: 6572 792e 7368 6170 655b 315d 2c20 7175  ery.shape[1], qu
+00005480: 6572 792e 7368 6170 655b 325d 2c0a 2020  ery.shape[2],.  
 00005490: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000054a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054b0: 2031 2920 3d3d 2030 2c20 2d69 6e66 290a   1) == 0, -inf).
-000054c0: 2020 2020 2020 2020 705f 6174 746e 203d          p_attn =
-000054d0: 2046 2e73 6f66 746d 6178 2873 636f 7265   F.softmax(score
-000054e0: 732c 2064 696d 3d2d 3129 0a0a 2020 2020  s, dim=-1)..    
-000054f0: 2020 2020 6164 6a5f 6d61 7472 6978 203d      adj_matrix =
-00005500: 2061 646a 5f6d 6174 7269 7820 2f20 280a   adj_matrix / (.
-00005510: 2020 2020 2020 2020 2020 2020 746f 7263              torc
-00005520: 682e 7375 6d28 746f 7263 682e 7465 6e73  h.sum(torch.tens
-00005530: 6f72 2861 646a 5f6d 6174 7269 7829 2c20  or(adj_matrix), 
-00005540: 6469 6d3d 2d31 292e 756e 7371 7565 657a  dim=-1).unsqueez
-00005550: 6528 3229 202b 2065 7073 290a 0a20 2020  e(2) + eps)..   
-00005560: 2020 2020 2069 6620 6c65 6e28 6164 6a5f       if len(adj_
-00005570: 6d61 7472 6978 2e73 6861 7065 2920 3c3d  matrix.shape) <=
-00005580: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
-00005590: 705f 6164 6a20 3d20 6164 6a5f 6d61 7472  p_adj = adj_matr
-000055a0: 6978 2e75 6e73 7175 6565 7a65 2831 292e  ix.unsqueeze(1).
-000055b0: 7265 7065 6174 2831 2c20 7175 6572 792e  repeat(1, query.
-000055c0: 7368 6170 655b 315d 2c20 312c 2031 290a  shape[1], 1, 1).
-000055d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000055e0: 2020 2020 2020 2020 2020 705f 6164 6a20            p_adj 
-000055f0: 3d20 6164 6a5f 6d61 7472 6978 2e72 6570  = adj_matrix.rep
-00005600: 6561 7428 312c 2071 7565 7279 2e73 6861  eat(1, query.sha
-00005610: 7065 5b31 5d2c 2031 2c20 3129 0a0a 2020  pe[1], 1, 1)..  
-00005620: 2020 2020 2020 6469 7374 616e 6365 5f6d        distance_m
-00005630: 6174 7269 7820 3d20 746f 7263 682e 7465  atrix = torch.te
-00005640: 6e73 6f72 2864 6973 7461 6e63 655f 6d61  nsor(distance_ma
-00005650: 7472 6978 292e 7371 7565 657a 6528 292e  trix).squeeze().
-00005660: 6d61 736b 6564 5f66 696c 6c28 0a20 2020  masked_fill(.   
-00005670: 2020 2020 2020 2020 206d 6173 6b2e 7265           mask.re
-00005680: 7065 6174 2831 2c20 6d61 736b 2e73 6861  peat(1, mask.sha
-00005690: 7065 5b2d 315d 2c20 3129 203d 3d20 302c  pe[-1], 1) == 0,
-000056a0: 206e 702e 696e 6629 0a0a 2020 2020 2020   np.inf)..      
-000056b0: 2020 6469 7374 616e 6365 5f6d 6174 7269    distance_matri
-000056c0: 7820 3d20 7365 6c66 2e64 6973 745f 6b65  x = self.dist_ke
-000056d0: 726e 656c 2864 6973 7461 6e63 655f 6d61  rnel(distance_ma
-000056e0: 7472 6978 290a 0a20 2020 2020 2020 2070  trix)..        p
-000056f0: 5f64 6973 7420 3d20 6469 7374 616e 6365  _dist = distance
-00005700: 5f6d 6174 7269 782e 756e 7371 7565 657a  _matrix.unsqueez
-00005710: 6528 3129 2e72 6570 6561 7428 312c 2071  e(1).repeat(1, q
-00005720: 7565 7279 2e73 6861 7065 5b31 5d2c 2031  uery.shape[1], 1
-00005730: 2c20 3129 0a0a 2020 2020 2020 2020 705f  , 1)..        p_
-00005740: 7765 6967 6874 6564 203d 2073 656c 662e  weighted = self.
-00005750: 6c61 6d62 6461 5f61 7474 656e 7469 6f6e  lambda_attention
-00005760: 202a 2070 5f61 7474 6e20 2b20 7365 6c66   * p_attn + self
-00005770: 2e6c 616d 6264 615f 6469 7374 616e 6365  .lambda_distance
-00005780: 202a 2070 5f64 6973 7420 2b20 7365 6c66   * p_dist + self
-00005790: 2e6c 616d 6264 615f 6164 6a61 6365 6e63  .lambda_adjacenc
-000057a0: 7920 2a20 705f 6164 6a0a 2020 2020 2020  y * p_adj.      
-000057b0: 2020 705f 7765 6967 6874 6564 203d 2073    p_weighted = s
-000057c0: 656c 662e 6472 6f70 6f75 745f 7028 705f  elf.dropout_p(p_
-000057d0: 7765 6967 6874 6564 290a 0a20 2020 2020  weighted)..     
-000057e0: 2020 2072 6574 7572 6e20 746f 7263 682e     return torch.
-000057f0: 6d61 746d 756c 2870 5f77 6569 6768 7465  matmul(p_weighte
-00005800: 642e 666c 6f61 7428 292c 2076 616c 7565  d.float(), value
-00005810: 2e66 6c6f 6174 2829 292c 2070 5f61 7474  .float()), p_att
-00005820: 6e0a 0a20 2020 2064 6566 2066 6f72 7761  n..    def forwa
-00005830: 7264 2873 656c 662c 0a20 2020 2020 2020  rd(self,.       
-00005840: 2020 2020 2020 2020 2071 7565 7279 3a20           query: 
-00005850: 746f 7263 682e 5465 6e73 6f72 2c0a 2020  torch.Tensor,.  
-00005860: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00005870: 793a 2074 6f72 6368 2e54 656e 736f 722c  y: torch.Tensor,
-00005880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005890: 2076 616c 7565 3a20 746f 7263 682e 5465   value: torch.Te
-000058a0: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
-000058b0: 2020 2020 2020 6d61 736b 3a20 746f 7263        mask: torc
-000058c0: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
-000058d0: 2020 2020 2020 2020 2020 6164 6a5f 6d61            adj_ma
-000058e0: 7472 6978 3a20 746f 7263 682e 5465 6e73  trix: torch.Tens
-000058f0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00005900: 2020 2020 6469 7374 616e 6365 5f6d 6174      distance_mat
-00005910: 7269 783a 2074 6f72 6368 2e54 656e 736f  rix: torch.Tenso
-00005920: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00005930: 2020 2064 726f 706f 7574 5f70 3a20 666c     dropout_p: fl
-00005940: 6f61 7420 3d20 302e 302c 0a20 2020 2020  oat = 0.0,.     
-00005950: 2020 2020 2020 2020 2020 2065 7073 3a20             eps: 
-00005960: 666c 6f61 7420 3d20 3165 2d36 2c0a 2020  float = 1e-6,.  
-00005970: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00005980: 663a 2066 6c6f 6174 203d 2031 6531 3229  f: float = 1e12)
-00005990: 202d 3e20 746f 7263 682e 5465 6e73 6f72   -> torch.Tensor
-000059a0: 3a0a 2020 2020 2020 2020 2222 224f 7574  :.        """Out
-000059b0: 7075 7420 636f 6d70 7574 6174 696f 6e20  put computation 
-000059c0: 666f 7220 7468 6520 4d75 6c74 6948 6561  for the MultiHea
-000059d0: 6465 6441 7474 656e 7469 6f6e 206c 6179  dedAttention lay
-000059e0: 6572 2e0a 2020 2020 2020 2020 5061 7261  er..        Para
-000059f0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-00005a00: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00005a10: 2020 7175 6572 793a 2074 6f72 6368 2e54    query: torch.T
-00005a20: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00005a30: 2020 5374 616e 6461 7264 2071 7565 7279    Standard query
-00005a40: 2070 6172 616d 6574 6572 2066 6f72 2061   parameter for a
-00005a50: 7474 656e 7469 6f6e 2e0a 2020 2020 2020  ttention..      
-00005a60: 2020 6b65 793a 2074 6f72 6368 2e54 656e    key: torch.Ten
-00005a70: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-00005a80: 5374 616e 6461 7264 206b 6579 2070 6172  Standard key par
-00005a90: 616d 6574 6572 2066 6f72 2061 7474 656e  ameter for atten
-00005aa0: 7469 6f6e 2e0a 2020 2020 2020 2020 7661  tion..        va
-00005ab0: 6c75 653a 2074 6f72 6368 2e54 656e 736f  lue: torch.Tenso
-00005ac0: 720a 2020 2020 2020 2020 2020 2020 5374  r.            St
-00005ad0: 616e 6461 7264 2076 616c 7565 2070 6172  andard value par
-00005ae0: 616d 6574 6572 2066 6f72 2061 7474 656e  ameter for atten
-00005af0: 7469 6f6e 2e0a 2020 2020 2020 2020 6d61  tion..        ma
-00005b00: 736b 3a20 746f 7263 682e 5465 6e73 6f72  sk: torch.Tensor
-00005b10: 0a20 2020 2020 2020 2020 2020 204d 6173  .            Mas
-00005b20: 6b73 206f 7574 2070 6164 6469 6e67 2076  ks out padding v
-00005b30: 616c 7565 7320 736f 2074 6861 7420 7468  alues so that th
-00005b40: 6579 2061 7265 206e 6f74 2074 616b 656e  ey are not taken
-00005b50: 2069 6e74 6f20 6163 636f 756e 7420 7768   into account wh
-00005b60: 656e 2063 6f6d 7075 7469 6e67 2074 6865  en computing the
-00005b70: 2061 7474 656e 7469 6f6e 2073 636f 7265   attention score
-00005b80: 2e0a 2020 2020 2020 2020 6164 6a5f 6d61  ..        adj_ma
-00005b90: 7472 6978 3a20 746f 7263 682e 5465 6e73  trix: torch.Tens
-00005ba0: 6f72 0a20 2020 2020 2020 2020 2020 2041  or.            A
-00005bb0: 646a 6163 656e 6379 206d 6174 7269 7820  djacency matrix 
-00005bc0: 6f66 2074 6865 2069 6e70 7574 206d 6f6c  of the input mol
-00005bd0: 6563 756c 652c 2072 6574 7572 6e65 6420  ecule, returned 
-00005be0: 6672 6f6d 2064 632e 6665 6174 2e4d 4154  from dc.feat.MAT
-00005bf0: 4665 6174 7572 697a 6572 2829 0a20 2020  Featurizer().   
-00005c00: 2020 2020 2064 6973 745f 6d61 7472 6978       dist_matrix
-00005c10: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-00005c20: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
-00005c30: 6e63 6520 6d61 7472 6978 206f 6620 7468  nce matrix of th
-00005c40: 6520 696e 7075 7420 6d6f 6c65 6375 6c65  e input molecule
-00005c50: 2c20 7265 7475 726e 6564 2066 726f 6d20  , returned from 
-00005c60: 6463 2e66 6561 742e 4d41 5446 6561 7475  dc.feat.MATFeatu
-00005c70: 7269 7a65 7228 290a 2020 2020 2020 2020  rizer().        
-00005c80: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
-00005c90: 0a20 2020 2020 2020 2020 2020 2044 726f  .            Dro
-00005ca0: 706f 7574 2070 726f 6261 6269 6c69 7479  pout probability
-00005cb0: 2e0a 2020 2020 2020 2020 6570 733a 2066  ..        eps: f
-00005cc0: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-00005cd0: 2045 7073 696c 6f6e 2076 616c 7565 0a20   Epsilon value. 
-00005ce0: 2020 2020 2020 2069 6e66 3a20 666c 6f61         inf: floa
-00005cf0: 740a 2020 2020 2020 2020 2020 2020 5661  t.            Va
-00005d00: 6c75 6520 6f66 2069 6e66 696e 6974 7920  lue of infinity 
-00005d10: 746f 2062 6520 7573 6564 2e0a 2020 2020  to be used..    
-00005d20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00005d30: 6966 206d 6173 6b20 6973 206e 6f74 204e  if mask is not N
-00005d40: 6f6e 6520 616e 6420 6c65 6e28 6d61 736b  one and len(mask
-00005d50: 2e73 6861 7065 2920 3c3d 2032 3a0a 2020  .shape) <= 2:.  
-00005d60: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
-00005d70: 206d 6173 6b2e 756e 7371 7565 657a 6528   mask.unsqueeze(
-00005d80: 3129 0a0a 2020 2020 2020 2020 6261 7463  1)..        batc
-00005d90: 685f 7369 7a65 203d 2071 7565 7279 2e73  h_size = query.s
-00005da0: 697a 6528 3029 0a20 2020 2020 2020 2071  ize(0).        q
-00005db0: 7565 7279 2c20 6b65 792c 2076 616c 7565  uery, key, value
-00005dc0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00005dd0: 206c 6179 6572 2878 292e 7669 6577 2862   layer(x).view(b
-00005de0: 6174 6368 5f73 697a 652c 202d 312c 2073  atch_size, -1, s
-00005df0: 656c 662e 682c 2073 656c 662e 645f 6b29  elf.h, self.d_k)
-00005e00: 2e74 7261 6e73 706f 7365 2831 2c20 3229  .transpose(1, 2)
-00005e10: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00005e20: 206c 6179 6572 2c20 7820 696e 207a 6970   layer, x in zip
-00005e30: 2873 656c 662e 6c69 6e65 6172 5f6c 6179  (self.linear_lay
-00005e40: 6572 732c 2028 7175 6572 792c 206b 6579  ers, (query, key
-00005e50: 2c20 7661 6c75 6529 290a 2020 2020 2020  , value)).      
-00005e60: 2020 5d0a 0a20 2020 2020 2020 2078 2c20    ]..        x, 
-00005e70: 5f20 3d20 7365 6c66 2e5f 7369 6e67 6c65  _ = self._single
-00005e80: 5f61 7474 656e 7469 6f6e 2871 7565 7279  _attention(query
-00005e90: 2c20 6b65 792c 2076 616c 7565 2c20 6d61  , key, value, ma
-00005ea0: 736b 2c20 6164 6a5f 6d61 7472 6978 2c0a  sk, adj_matrix,.
-00005eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054b0: 2020 2020 2020 2031 2920 3d3d 2030 2c20         1) == 0, 
+000054c0: 2d69 6e66 290a 2020 2020 2020 2020 705f  -inf).        p_
+000054d0: 6174 746e 203d 2046 2e73 6f66 746d 6178  attn = F.softmax
+000054e0: 2873 636f 7265 732c 2064 696d 3d2d 3129  (scores, dim=-1)
+000054f0: 0a0a 2020 2020 2020 2020 6164 6a5f 6d61  ..        adj_ma
+00005500: 7472 6978 203d 2061 646a 5f6d 6174 7269  trix = adj_matri
+00005510: 7820 2f20 280a 2020 2020 2020 2020 2020  x / (.          
+00005520: 2020 746f 7263 682e 7375 6d28 746f 7263    torch.sum(torc
+00005530: 682e 7465 6e73 6f72 2861 646a 5f6d 6174  h.tensor(adj_mat
+00005540: 7269 7829 2c20 6469 6d3d 2d31 292e 756e  rix), dim=-1).un
+00005550: 7371 7565 657a 6528 3229 202b 2065 7073  squeeze(2) + eps
+00005560: 290a 0a20 2020 2020 2020 2069 6620 6c65  )..        if le
+00005570: 6e28 6164 6a5f 6d61 7472 6978 2e73 6861  n(adj_matrix.sha
+00005580: 7065 2920 3c3d 2033 3a0a 2020 2020 2020  pe) <= 3:.      
+00005590: 2020 2020 2020 705f 6164 6a20 3d20 6164        p_adj = ad
+000055a0: 6a5f 6d61 7472 6978 2e75 6e73 7175 6565  j_matrix.unsquee
+000055b0: 7a65 2831 292e 7265 7065 6174 2831 2c20  ze(1).repeat(1, 
+000055c0: 7175 6572 792e 7368 6170 655b 315d 2c20  query.shape[1], 
+000055d0: 312c 2031 290a 2020 2020 2020 2020 656c  1, 1).        el
+000055e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000055f0: 705f 6164 6a20 3d20 6164 6a5f 6d61 7472  p_adj = adj_matr
+00005600: 6978 2e72 6570 6561 7428 312c 2071 7565  ix.repeat(1, que
+00005610: 7279 2e73 6861 7065 5b31 5d2c 2031 2c20  ry.shape[1], 1, 
+00005620: 3129 0a0a 2020 2020 2020 2020 6469 7374  1)..        dist
+00005630: 616e 6365 5f6d 6174 7269 7820 3d20 746f  ance_matrix = to
+00005640: 7263 682e 7465 6e73 6f72 2864 6973 7461  rch.tensor(dista
+00005650: 6e63 655f 6d61 7472 6978 292e 7371 7565  nce_matrix).sque
+00005660: 657a 6528 292e 6d61 736b 6564 5f66 696c  eze().masked_fil
+00005670: 6c28 0a20 2020 2020 2020 2020 2020 206d  l(.            m
+00005680: 6173 6b2e 7265 7065 6174 2831 2c20 6d61  ask.repeat(1, ma
+00005690: 736b 2e73 6861 7065 5b2d 315d 2c20 3129  sk.shape[-1], 1)
+000056a0: 203d 3d20 302c 206e 702e 696e 6629 0a0a   == 0, np.inf)..
+000056b0: 2020 2020 2020 2020 6469 7374 616e 6365          distance
+000056c0: 5f6d 6174 7269 7820 3d20 7365 6c66 2e64  _matrix = self.d
+000056d0: 6973 745f 6b65 726e 656c 2864 6973 7461  ist_kernel(dista
+000056e0: 6e63 655f 6d61 7472 6978 290a 0a20 2020  nce_matrix)..   
+000056f0: 2020 2020 2070 5f64 6973 7420 3d20 6469       p_dist = di
+00005700: 7374 616e 6365 5f6d 6174 7269 782e 756e  stance_matrix.un
+00005710: 7371 7565 657a 6528 3129 2e72 6570 6561  squeeze(1).repea
+00005720: 7428 312c 2071 7565 7279 2e73 6861 7065  t(1, query.shape
+00005730: 5b31 5d2c 2031 2c20 3129 0a0a 2020 2020  [1], 1, 1)..    
+00005740: 2020 2020 705f 7765 6967 6874 6564 203d      p_weighted =
+00005750: 2073 656c 662e 6c61 6d62 6461 5f61 7474   self.lambda_att
+00005760: 656e 7469 6f6e 202a 2070 5f61 7474 6e20  ention * p_attn 
+00005770: 2b20 7365 6c66 2e6c 616d 6264 615f 6469  + self.lambda_di
+00005780: 7374 616e 6365 202a 2070 5f64 6973 7420  stance * p_dist 
+00005790: 2b20 7365 6c66 2e6c 616d 6264 615f 6164  + self.lambda_ad
+000057a0: 6a61 6365 6e63 7920 2a20 705f 6164 6a0a  jacency * p_adj.
+000057b0: 2020 2020 2020 2020 705f 7765 6967 6874          p_weight
+000057c0: 6564 203d 2073 656c 662e 6472 6f70 6f75  ed = self.dropou
+000057d0: 745f 7028 705f 7765 6967 6874 6564 290a  t_p(p_weighted).
+000057e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000057f0: 746f 7263 682e 6d61 746d 756c 2870 5f77  torch.matmul(p_w
+00005800: 6569 6768 7465 642e 666c 6f61 7428 292c  eighted.float(),
+00005810: 2076 616c 7565 2e66 6c6f 6174 2829 292c   value.float()),
+00005820: 2070 5f61 7474 6e0a 0a20 2020 2064 6566   p_attn..    def
+00005830: 2066 6f72 7761 7264 2873 656c 662c 0a20   forward(self,. 
+00005840: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+00005850: 7565 7279 3a20 746f 7263 682e 5465 6e73  uery: torch.Tens
+00005860: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+00005870: 2020 2020 6b65 793a 2074 6f72 6368 2e54      key: torch.T
+00005880: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
+00005890: 2020 2020 2020 2076 616c 7565 3a20 746f         value: to
+000058a0: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
+000058b0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+000058c0: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
+000058d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000058e0: 6164 6a5f 6d61 7472 6978 3a20 746f 7263  adj_matrix: torc
+000058f0: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
+00005900: 2020 2020 2020 2020 2020 6469 7374 616e            distan
+00005910: 6365 5f6d 6174 7269 783a 2074 6f72 6368  ce_matrix: torch
+00005920: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
+00005930: 2020 2020 2020 2020 2064 726f 706f 7574           dropout
+00005940: 5f70 3a20 666c 6f61 7420 3d20 302e 302c  _p: float = 0.0,
+00005950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005960: 2065 7073 3a20 666c 6f61 7420 3d20 3165   eps: float = 1e
+00005970: 2d36 2c0a 2020 2020 2020 2020 2020 2020  -6,.            
+00005980: 2020 2020 696e 663a 2066 6c6f 6174 203d      inf: float =
+00005990: 2031 6531 3229 202d 3e20 746f 7263 682e   1e12) -> torch.
+000059a0: 5465 6e73 6f72 3a0a 2020 2020 2020 2020  Tensor:.        
+000059b0: 2222 224f 7574 7075 7420 636f 6d70 7574  """Output comput
+000059c0: 6174 696f 6e20 666f 7220 7468 6520 4d75  ation for the Mu
+000059d0: 6c74 6948 6561 6465 6441 7474 656e 7469  ltiHeadedAttenti
+000059e0: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
+000059f0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00005a00: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00005a10: 2020 2020 2020 2020 7175 6572 793a 2074          query: t
+00005a20: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+00005a30: 2020 2020 2020 2020 5374 616e 6461 7264          Standard
+00005a40: 2071 7565 7279 2070 6172 616d 6574 6572   query parameter
+00005a50: 2066 6f72 2061 7474 656e 7469 6f6e 2e0a   for attention..
+00005a60: 2020 2020 2020 2020 6b65 793a 2074 6f72          key: tor
+00005a70: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+00005a80: 2020 2020 2020 5374 616e 6461 7264 206b        Standard k
+00005a90: 6579 2070 6172 616d 6574 6572 2066 6f72  ey parameter for
+00005aa0: 2061 7474 656e 7469 6f6e 2e0a 2020 2020   attention..    
+00005ab0: 2020 2020 7661 6c75 653a 2074 6f72 6368      value: torch
+00005ac0: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+00005ad0: 2020 2020 5374 616e 6461 7264 2076 616c      Standard val
+00005ae0: 7565 2070 6172 616d 6574 6572 2066 6f72  ue parameter for
+00005af0: 2061 7474 656e 7469 6f6e 2e0a 2020 2020   attention..    
+00005b00: 2020 2020 6d61 736b 3a20 746f 7263 682e      mask: torch.
+00005b10: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00005b20: 2020 204d 6173 6b73 206f 7574 2070 6164     Masks out pad
+00005b30: 6469 6e67 2076 616c 7565 7320 736f 2074  ding values so t
+00005b40: 6861 7420 7468 6579 2061 7265 206e 6f74  hat they are not
+00005b50: 2074 616b 656e 2069 6e74 6f20 6163 636f   taken into acco
+00005b60: 756e 7420 7768 656e 2063 6f6d 7075 7469  unt when computi
+00005b70: 6e67 2074 6865 2061 7474 656e 7469 6f6e  ng the attention
+00005b80: 2073 636f 7265 2e0a 2020 2020 2020 2020   score..        
+00005b90: 6164 6a5f 6d61 7472 6978 3a20 746f 7263  adj_matrix: torc
+00005ba0: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00005bb0: 2020 2020 2041 646a 6163 656e 6379 206d       Adjacency m
+00005bc0: 6174 7269 7820 6f66 2074 6865 2069 6e70  atrix of the inp
+00005bd0: 7574 206d 6f6c 6563 756c 652c 2072 6574  ut molecule, ret
+00005be0: 7572 6e65 6420 6672 6f6d 2064 632e 6665  urned from dc.fe
+00005bf0: 6174 2e4d 4154 4665 6174 7572 697a 6572  at.MATFeaturizer
+00005c00: 2829 0a20 2020 2020 2020 2064 6973 745f  ().        dist_
+00005c10: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
+00005c20: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+00005c30: 2044 6973 7461 6e63 6520 6d61 7472 6978   Distance matrix
+00005c40: 206f 6620 7468 6520 696e 7075 7420 6d6f   of the input mo
+00005c50: 6c65 6375 6c65 2c20 7265 7475 726e 6564  lecule, returned
+00005c60: 2066 726f 6d20 6463 2e66 6561 742e 4d41   from dc.feat.MA
+00005c70: 5446 6561 7475 7269 7a65 7228 290a 2020  TFeaturizer().  
+00005c80: 2020 2020 2020 6472 6f70 6f75 745f 703a        dropout_p:
+00005c90: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+00005ca0: 2020 2044 726f 706f 7574 2070 726f 6261     Dropout proba
+00005cb0: 6269 6c69 7479 2e0a 2020 2020 2020 2020  bility..        
+00005cc0: 6570 733a 2066 6c6f 6174 0a20 2020 2020  eps: float.     
+00005cd0: 2020 2020 2020 2045 7073 696c 6f6e 2076         Epsilon v
+00005ce0: 616c 7565 0a20 2020 2020 2020 2069 6e66  alue.        inf
+00005cf0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+00005d00: 2020 2020 5661 6c75 6520 6f66 2069 6e66      Value of inf
+00005d10: 696e 6974 7920 746f 2062 6520 7573 6564  inity to be used
+00005d20: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00005d30: 2020 2020 2020 6966 206d 6173 6b20 6973        if mask is
+00005d40: 206e 6f74 204e 6f6e 6520 616e 6420 6c65   not None and le
+00005d50: 6e28 6d61 736b 2e73 6861 7065 2920 3c3d  n(mask.shape) <=
+00005d60: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+00005d70: 6d61 736b 203d 206d 6173 6b2e 756e 7371  mask = mask.unsq
+00005d80: 7565 657a 6528 3129 0a0a 2020 2020 2020  ueeze(1)..      
+00005d90: 2020 6261 7463 685f 7369 7a65 203d 2071    batch_size = q
+00005da0: 7565 7279 2e73 697a 6528 3029 0a20 2020  uery.size(0).   
+00005db0: 2020 2020 2071 7565 7279 2c20 6b65 792c       query, key,
+00005dc0: 2076 616c 7565 203d 205b 0a20 2020 2020   value = [.     
+00005dd0: 2020 2020 2020 206c 6179 6572 2878 292e         layer(x).
+00005de0: 7669 6577 2862 6174 6368 5f73 697a 652c  view(batch_size,
+00005df0: 202d 312c 2073 656c 662e 682c 2073 656c   -1, self.h, sel
+00005e00: 662e 645f 6b29 2e74 7261 6e73 706f 7365  f.d_k).transpose
+00005e10: 2831 2c20 3229 0a20 2020 2020 2020 2020  (1, 2).         
+00005e20: 2020 2066 6f72 206c 6179 6572 2c20 7820     for layer, x 
+00005e30: 696e 207a 6970 2873 656c 662e 6c69 6e65  in zip(self.line
+00005e40: 6172 5f6c 6179 6572 732c 2028 7175 6572  ar_layers, (quer
+00005e50: 792c 206b 6579 2c20 7661 6c75 6529 290a  y, key, value)).
+00005e60: 2020 2020 2020 2020 5d0a 0a20 2020 2020          ]..     
+00005e70: 2020 2078 2c20 5f20 3d20 7365 6c66 2e5f     x, _ = self._
+00005e80: 7369 6e67 6c65 5f61 7474 656e 7469 6f6e  single_attention
+00005e90: 2871 7565 7279 2c20 6b65 792c 2076 616c  (query, key, val
+00005ea0: 7565 2c20 6d61 736b 2c20 6164 6a5f 6d61  ue, mask, adj_ma
+00005eb0: 7472 6978 2c0a 2020 2020 2020 2020 2020  trix,.          
 00005ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ed0: 2020 2020 2020 6469 7374 616e 6365 5f6d        distance_m
-00005ee0: 6174 7269 782c 2064 726f 706f 7574 5f70  atrix, dropout_p
-00005ef0: 2c20 6570 732c 2069 6e66 290a 2020 2020  , eps, inf).    
-00005f00: 2020 2020 7820 3d20 782e 7472 616e 7370      x = x.transp
-00005f10: 6f73 6528 312c 2032 292e 636f 6e74 6967  ose(1, 2).contig
-00005f20: 756f 7573 2829 2e76 6965 7728 6261 7463  uous().view(batc
-00005f30: 685f 7369 7a65 2c20 2d31 2c0a 2020 2020  h_size, -1,.    
-00005f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ed0: 2020 2020 2020 2020 2020 2020 6469 7374              dist
+00005ee0: 616e 6365 5f6d 6174 7269 782c 2064 726f  ance_matrix, dro
+00005ef0: 706f 7574 5f70 2c20 6570 732c 2069 6e66  pout_p, eps, inf
+00005f00: 290a 2020 2020 2020 2020 7820 3d20 782e  ).        x = x.
+00005f10: 7472 616e 7370 6f73 6528 312c 2032 292e  transpose(1, 2).
+00005f20: 636f 6e74 6967 756f 7573 2829 2e76 6965  contiguous().vie
+00005f30: 7728 6261 7463 685f 7369 7a65 2c20 2d31  w(batch_size, -1
+00005f40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00005f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005f70: 2e68 202a 2073 656c 662e 645f 6b29 0a0a  .h * self.d_k)..
-00005f80: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00005f90: 656c 662e 6f75 7470 7574 5f6c 696e 6561  elf.output_linea
-00005fa0: 7228 7829 0a0a 0a63 6c61 7373 204d 4154  r(x)...class MAT
-00005fb0: 456e 636f 6465 724c 6179 6572 286e 6e2e  EncoderLayer(nn.
-00005fc0: 4d6f 6475 6c65 293a 0a20 2020 2022 2222  Module):.    """
-00005fd0: 456e 636f 6465 7220 6c61 7965 7220 666f  Encoder layer fo
-00005fe0: 7220 7573 6520 696e 2074 6865 204d 6f6c  r use in the Mol
-00005ff0: 6563 756c 6172 2041 7474 656e 7469 6f6e  ecular Attention
-00006000: 2054 7261 6e73 666f 726d 6572 205b 315d   Transformer [1]
-00006010: 5f2e 0a0a 2020 2020 5468 6520 4d41 5445  _...    The MATE
-00006020: 6e63 6f64 6572 206c 6179 6572 2070 7269  ncoder layer pri
-00006030: 6d61 7269 6c79 2063 6f6e 7369 7374 7320  marily consists 
-00006040: 6f66 2061 2073 656c 662d 6174 7465 6e74  of a self-attent
-00006050: 696f 6e20 6c61 7965 7220 284d 756c 7469  ion layer (Multi
-00006060: 4865 6164 6564 4d41 5441 7474 656e 7469  HeadedMATAttenti
-00006070: 6f6e 2920 616e 6420 6120 6665 6564 2d66  on) and a feed-f
-00006080: 6f72 7761 7264 206c 6179 6572 2028 506f  orward layer (Po
-00006090: 7369 7469 6f6e 7769 7365 4665 6564 466f  sitionwiseFeedFo
-000060a0: 7277 6172 6429 2e0a 2020 2020 5468 6973  rward)..    This
-000060b0: 206c 6179 6572 2063 616e 2062 6520 7374   layer can be st
-000060c0: 6163 6b65 6420 6d75 6c74 6970 6c65 2074  acked multiple t
-000060d0: 696d 6573 2074 6f20 666f 726d 2061 6e20  imes to form an 
-000060e0: 656e 636f 6465 722e 0a0a 2020 2020 5265  encoder...    Re
-000060f0: 6665 7265 6e63 6573 0a20 2020 202d 2d2d  ferences.    ---
-00006100: 2d2d 2d2d 2d2d 2d0a 2020 2020 2e2e 205b  -------.    .. [
-00006110: 315d 204c 756b 6173 7a20 4d61 7a69 6172  1] Lukasz Maziar
-00006120: 6b61 2065 7420 616c 2e20 224d 6f6c 6563  ka et al. "Molec
-00006130: 756c 6520 4174 7465 6e74 696f 6e20 5472  ule Attention Tr
-00006140: 616e 7366 6f72 6d65 7222 2047 7261 7068  ansformer" Graph
-00006150: 2052 6570 7265 7365 6e74 6174 696f 6e20   Representation 
-00006160: 4c65 6172 6e69 6e67 2077 6f72 6b73 686f  Learning worksho
-00006170: 7020 616e 6420 4d61 6368 696e 6520 4c65  p and Machine Le
-00006180: 6172 6e69 6e67 2061 6e64 2074 6865 2050  arning and the P
-00006190: 6879 7369 6361 6c20 5363 6965 6e63 6573  hysical Sciences
-000061a0: 2077 6f72 6b73 686f 7020 6174 204e 6575   workshop at Neu
-000061b0: 7249 5053 2032 3031 392e 2032 3032 302e  rIPS 2019. 2020.
-000061c0: 2068 7474 7073 3a2f 2f61 7278 6976 2e6f   https://arxiv.o
-000061d0: 7267 2f61 6273 2f32 3030 322e 3038 3236  rg/abs/2002.0826
-000061e0: 340a 0a20 2020 2045 7861 6d70 6c65 730a  4..    Examples.
-000061f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00006200: 203e 3e3e 2066 726f 6d20 7264 6b69 7420   >>> from rdkit 
-00006210: 696d 706f 7274 2043 6865 6d0a 2020 2020  import Chem.    
-00006220: 3e3e 3e20 696d 706f 7274 2074 6f72 6368  >>> import torch
-00006230: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
-00006240: 6465 6570 6368 656d 0a20 2020 203e 3e3e  deepchem.    >>>
-00006250: 2066 726f 6d20 6465 6570 6368 656d 2e6d   from deepchem.m
-00006260: 6f64 656c 732e 746f 7263 685f 6d6f 6465  odels.torch_mode
-00006270: 6c73 2e6c 6179 6572 7320 696d 706f 7274  ls.layers import
-00006280: 204d 4154 456d 6265 6464 696e 672c 204d   MATEmbedding, M
-00006290: 4154 456e 636f 6465 724c 6179 6572 0a20  ATEncoderLayer. 
-000062a0: 2020 203e 3e3e 2069 6e70 7574 5f73 6d69     >>> input_smi
-000062b0: 6c65 203d 2022 4343 220a 2020 2020 3e3e  le = "CC".    >>
-000062c0: 3e20 6665 6174 203d 2064 6565 7063 6865  > feat = deepche
-000062d0: 6d2e 6665 6174 2e4d 4154 4665 6174 7572  m.feat.MATFeatur
-000062e0: 697a 6572 2829 0a20 2020 203e 3e3e 206f  izer().    >>> o
-000062f0: 7574 203d 2066 6561 742e 6665 6174 7572  ut = feat.featur
-00006300: 697a 6528 696e 7075 745f 736d 696c 6529  ize(input_smile)
-00006310: 0a20 2020 203e 3e3e 206e 6f64 6520 3d20  .    >>> node = 
-00006320: 746f 7263 682e 7465 6e73 6f72 286f 7574  torch.tensor(out
-00006330: 5b30 5d2e 6e6f 6465 5f66 6561 7475 7265  [0].node_feature
-00006340: 7329 2e66 6c6f 6174 2829 2e75 6e73 7175  s).float().unsqu
-00006350: 6565 7a65 2830 290a 2020 2020 3e3e 3e20  eeze(0).    >>> 
-00006360: 6164 6a20 3d20 746f 7263 682e 7465 6e73  adj = torch.tens
-00006370: 6f72 286f 7574 5b30 5d2e 6164 6a61 6365  or(out[0].adjace
-00006380: 6e63 795f 6d61 7472 6978 292e 666c 6f61  ncy_matrix).floa
-00006390: 7428 292e 756e 7371 7565 657a 6528 3029  t().unsqueeze(0)
-000063a0: 0a20 2020 203e 3e3e 2064 6973 7420 3d20  .    >>> dist = 
-000063b0: 746f 7263 682e 7465 6e73 6f72 286f 7574  torch.tensor(out
-000063c0: 5b30 5d2e 6469 7374 616e 6365 5f6d 6174  [0].distance_mat
-000063d0: 7269 7829 2e66 6c6f 6174 2829 2e75 6e73  rix).float().uns
-000063e0: 7175 6565 7a65 2830 290a 2020 2020 3e3e  queeze(0).    >>
-000063f0: 3e20 6d61 736b 203d 2074 6f72 6368 2e73  > mask = torch.s
-00006400: 756d 2874 6f72 6368 2e61 6273 286e 6f64  um(torch.abs(nod
-00006410: 6529 2c20 6469 6d3d 2d31 2920 213d 2030  e), dim=-1) != 0
-00006420: 0a20 2020 203e 3e3e 206c 6179 6572 203d  .    >>> layer =
-00006430: 204d 4154 456e 636f 6465 724c 6179 6572   MATEncoderLayer
-00006440: 2829 0a20 2020 203e 3e3e 206f 7020 3d20  ().    >>> op = 
-00006450: 4d41 5445 6d62 6564 6469 6e67 2829 286e  MATEmbedding()(n
-00006460: 6f64 6529 0a20 2020 203e 3e3e 206f 7574  ode).    >>> out
-00006470: 7075 7420 3d20 6c61 7965 7228 6f70 2c20  put = layer(op, 
-00006480: 6d61 736b 2c20 6164 6a2c 2064 6973 7429  mask, adj, dist)
-00006490: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-000064a0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-000064b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000064c0: 2020 6469 7374 5f6b 6572 6e65 6c3a 2073    dist_kernel: s
-000064d0: 7472 203d 2027 736f 6674 6d61 7827 2c0a  tr = 'softmax',.
-000064e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064f0: 206c 616d 6264 615f 6174 7465 6e74 696f   lambda_attentio
-00006500: 6e3a 2066 6c6f 6174 203d 2030 2e33 332c  n: float = 0.33,
-00006510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006520: 2020 6c61 6d62 6461 5f64 6973 7461 6e63    lambda_distanc
-00006530: 653a 2066 6c6f 6174 203d 2030 2e33 332c  e: float = 0.33,
-00006540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006550: 2020 683a 2069 6e74 203d 2031 362c 0a20    h: int = 16,. 
-00006560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006570: 7361 5f68 7369 7a65 3a20 696e 7420 3d20  sa_hsize: int = 
-00006580: 3130 3234 2c0a 2020 2020 2020 2020 2020  1024,.          
-00006590: 2020 2020 2020 2073 615f 6472 6f70 6f75         sa_dropou
-000065a0: 745f 703a 2066 6c6f 6174 203d 2030 2e30  t_p: float = 0.0
-000065b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000065c0: 2020 206f 7574 7075 745f 6269 6173 3a20     output_bias: 
-000065d0: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-000065e0: 2020 2020 2020 2020 2020 2020 2020 645f                d_
-000065f0: 696e 7075 743a 2069 6e74 203d 2031 3032  input: int = 102
-00006600: 342c 0a20 2020 2020 2020 2020 2020 2020  4,.             
-00006610: 2020 2020 645f 6869 6464 656e 3a20 696e      d_hidden: in
-00006620: 7420 3d20 3130 3234 2c0a 2020 2020 2020  t = 1024,.      
-00006630: 2020 2020 2020 2020 2020 2064 5f6f 7574             d_out
-00006640: 7075 743a 2069 6e74 203d 2031 3032 342c  put: int = 1024,
-00006650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006660: 2020 6163 7469 7661 7469 6f6e 3a20 7374    activation: st
-00006670: 7220 3d20 276c 6561 6b79 7265 6c75 272c  r = 'leakyrelu',
-00006680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006690: 2020 6e5f 6c61 7965 7273 3a20 696e 7420    n_layers: int 
-000066a0: 3d20 312c 0a20 2020 2020 2020 2020 2020  = 1,.           
-000066b0: 2020 2020 2020 6666 5f64 726f 706f 7574        ff_dropout
-000066c0: 5f70 3a20 666c 6f61 7420 3d20 302e 302c  _p: float = 0.0,
-000066d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000066e0: 2020 656e 636f 6465 725f 6873 697a 653a    encoder_hsize:
-000066f0: 2069 6e74 203d 2031 3032 342c 0a20 2020   int = 1024,.   
-00006700: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00006710: 636f 6465 725f 6472 6f70 6f75 745f 703a  coder_dropout_p:
-00006720: 2066 6c6f 6174 203d 2030 2e30 293a 0a20   float = 0.0):. 
-00006730: 2020 2020 2020 2022 2222 496e 6974 6961         """Initia
-00006740: 6c69 7a65 2061 204d 4154 456e 636f 6465  lize a MATEncode
-00006750: 7220 6c61 7965 722e 0a0a 2020 2020 2020  r layer...      
-00006760: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00006770: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00006780: 2020 2020 2020 2020 6469 7374 5f6b 6572          dist_ker
-00006790: 6e65 6c3a 2073 7472 0a20 2020 2020 2020  nel: str.       
-000067a0: 2020 2020 204b 6572 6e65 6c20 6163 7469       Kernel acti
-000067b0: 7661 7469 6f6e 2074 6f20 6265 2075 7365  vation to be use
-000067c0: 642e 2043 616e 2062 6520 6569 7468 6572  d. Can be either
-000067d0: 2027 736f 6674 6d61 7827 2066 6f72 2073   'softmax' for s
-000067e0: 6f66 746d 6178 206f 7220 2765 7870 2720  oftmax or 'exp' 
-000067f0: 666f 7220 6578 706f 6e65 6e74 6961 6c2c  for exponential,
-00006800: 2066 6f72 2074 6865 2073 656c 662d 6174   for the self-at
-00006810: 7465 6e74 696f 6e20 6c61 7965 722e 0a20  tention layer.. 
-00006820: 2020 2020 2020 206c 616d 6264 615f 6174         lambda_at
-00006830: 7465 6e74 696f 6e3a 2066 6c6f 6174 0a20  tention: float. 
-00006840: 2020 2020 2020 2020 2020 2043 6f6e 7374             Const
-00006850: 616e 7420 746f 2062 6520 6d75 6c74 6970  ant to be multip
-00006860: 6c69 6564 2077 6974 6820 7468 6520 6174  lied with the at
-00006870: 7465 6e74 696f 6e20 6d61 7472 6978 2069  tention matrix i
-00006880: 6e20 7468 6520 7365 6c66 2d61 7474 656e  n the self-atten
-00006890: 7469 6f6e 206c 6179 6572 2e0a 2020 2020  tion layer..    
-000068a0: 2020 2020 6c61 6d62 6461 5f64 6973 7461      lambda_dista
-000068b0: 6e63 653a 2066 6c6f 6174 0a20 2020 2020  nce: float.     
-000068c0: 2020 2020 2020 2043 6f6e 7374 616e 7420         Constant 
-000068d0: 746f 2062 6520 6d75 6c74 6970 6c69 6564  to be multiplied
-000068e0: 2077 6974 6820 7468 6520 6469 7374 616e   with the distan
-000068f0: 6365 206d 6174 7269 7820 696e 2074 6865  ce matrix in the
-00006900: 2073 656c 662d 6174 7465 6e74 696f 6e20   self-attention 
-00006910: 6c61 7965 722e 0a20 2020 2020 2020 2068  layer..        h
-00006920: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
-00006930: 2020 4e75 6d62 6572 206f 6620 6174 7465    Number of atte
-00006940: 6e74 696f 6e20 6865 6164 7320 666f 7220  ntion heads for 
-00006950: 7468 6520 7365 6c66 2d61 7474 656e 7469  the self-attenti
-00006960: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
-00006970: 2020 7361 5f68 7369 7a65 3a20 696e 740a    sa_hsize: int.
-00006980: 2020 2020 2020 2020 2020 2020 5369 7a65              Size
-00006990: 206f 6620 6465 6e73 6520 6c61 7965 7220   of dense layer 
-000069a0: 696e 2074 6865 2073 656c 662d 6174 7465  in the self-atte
-000069b0: 6e74 696f 6e20 6c61 7965 722e 0a20 2020  ntion layer..   
-000069c0: 2020 2020 2073 615f 6472 6f70 6f75 745f       sa_dropout_
-000069d0: 703a 2066 6c6f 6174 0a20 2020 2020 2020  p: float.       
-000069e0: 2020 2020 2044 726f 706f 7574 2070 726f       Dropout pro
-000069f0: 6261 6269 6c69 7479 2066 6f72 2074 6865  bability for the
-00006a00: 2073 656c 662d 6174 7465 6e74 696f 6e20   self-attention 
-00006a10: 6c61 7965 722e 0a20 2020 2020 2020 206f  layer..        o
-00006a20: 7574 7075 745f 6269 6173 3a20 626f 6f6c  utput_bias: bool
-00006a30: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00006a40: 5472 7565 2c20 6465 6e73 6520 6c61 7965  True, dense laye
-00006a50: 7273 2077 696c 6c20 7573 6520 6269 6173  rs will use bias
-00006a60: 2076 6563 746f 7273 2069 6e20 7468 6520   vectors in the 
-00006a70: 7365 6c66 2d61 7474 656e 7469 6f6e 206c  self-attention l
-00006a80: 6179 6572 2e0a 2020 2020 2020 2020 645f  ayer..        d_
-00006a90: 696e 7075 743a 2069 6e74 0a20 2020 2020  input: int.     
-00006aa0: 2020 2020 2020 2053 697a 6520 6f66 2069         Size of i
-00006ab0: 6e70 7574 206c 6179 6572 2069 6e20 7468  nput layer in th
-00006ac0: 6520 6665 6564 2d66 6f72 7761 7264 206c  e feed-forward l
-00006ad0: 6179 6572 2e0a 2020 2020 2020 2020 645f  ayer..        d_
-00006ae0: 6869 6464 656e 3a20 696e 740a 2020 2020  hidden: int.    
-00006af0: 2020 2020 2020 2020 5369 7a65 206f 6620          Size of 
-00006b00: 6869 6464 656e 206c 6179 6572 2069 6e20  hidden layer in 
-00006b10: 7468 6520 6665 6564 2d66 6f72 7761 7264  the feed-forward
-00006b20: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-00006b30: 645f 6f75 7470 7574 3a20 696e 740a 2020  d_output: int.  
-00006b40: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
-00006b50: 6620 6f75 7470 7574 206c 6179 6572 2069  f output layer i
-00006b60: 6e20 7468 6520 6665 6564 2d66 6f72 7761  n the feed-forwa
-00006b70: 7264 206c 6179 6572 2e0a 2020 2020 2020  rd layer..      
-00006b80: 2020 6163 7469 7661 7469 6f6e 3a20 7374    activation: st
-00006b90: 720a 2020 2020 2020 2020 2020 2020 4163  r.            Ac
-00006ba0: 7469 7661 7469 6f6e 2066 756e 6374 696f  tivation functio
-00006bb0: 6e20 746f 2062 6520 7573 6564 2069 6e20  n to be used in 
-00006bc0: 7468 6520 6665 6564 2d66 6f72 7761 7264  the feed-forward
-00006bd0: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-00006be0: 2020 2020 4361 6e20 6368 6f6f 7365 2062      Can choose b
-00006bf0: 6574 7765 656e 2027 7265 6c75 2720 666f  etween 'relu' fo
-00006c00: 7220 5265 4c55 2c20 276c 6561 6b79 7265  r ReLU, 'leakyre
-00006c10: 6c75 2720 666f 7220 4c65 616b 7952 654c  lu' for LeakyReL
-00006c20: 552c 2027 7072 656c 7527 2066 6f72 2050  U, 'prelu' for P
-00006c30: 5265 4c55 2c0a 2020 2020 2020 2020 2020  ReLU,.          
-00006c40: 2020 2774 616e 6827 2066 6f72 2054 616e    'tanh' for Tan
-00006c50: 482c 2027 7365 6c75 2720 666f 7220 5345  H, 'selu' for SE
-00006c60: 4c55 2c20 2765 6c75 2720 666f 7220 454c  LU, 'elu' for EL
-00006c70: 5520 616e 6420 276c 696e 6561 7227 2066  U and 'linear' f
-00006c80: 6f72 206c 696e 6561 7220 6163 7469 7661  or linear activa
-00006c90: 7469 6f6e 2e0a 2020 2020 2020 2020 6e5f  tion..        n_
-00006ca0: 6c61 7965 7273 3a20 696e 740a 2020 2020  layers: int.    
-00006cb0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
-00006cc0: 6620 6c61 7965 7273 2069 6e20 7468 6520  f layers in the 
-00006cd0: 6665 6564 2d66 6f72 7761 7264 206c 6179  feed-forward lay
-00006ce0: 6572 2e0a 2020 2020 2020 2020 6472 6f70  er..        drop
-00006cf0: 6f75 745f 703a 2066 6c6f 6174 0a20 2020  out_p: float.   
-00006d00: 2020 2020 2020 2020 2044 726f 706f 7574           Dropout
-00006d10: 2070 726f 6261 6269 6c69 7479 2069 6e20   probability in 
-00006d20: 7468 6520 6665 6565 642d 666f 7277 6172  the feeed-forwar
-00006d30: 6420 6c61 7965 722e 0a20 2020 2020 2020  d layer..       
-00006d40: 2065 6e63 6f64 6572 5f68 7369 7a65 3a20   encoder_hsize: 
-00006d50: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-00006d60: 5369 7a65 206f 6620 4465 6e73 6520 6c61  Size of Dense la
-00006d70: 7965 7220 666f 7220 7468 6520 656e 636f  yer for the enco
-00006d80: 6465 7220 6974 7365 6c66 2e0a 2020 2020  der itself..    
-00006d90: 2020 2020 656e 636f 6465 725f 6472 6f70      encoder_drop
-00006da0: 6f75 745f 703a 2066 6c6f 6174 0a20 2020  out_p: float.   
-00006db0: 2020 2020 2020 2020 2044 726f 706f 7574           Dropout
-00006dc0: 2070 726f 6261 6269 6c69 7479 2066 6f72   probability for
-00006dd0: 2063 6f6e 6e65 6374 696f 6e73 2069 6e20   connections in 
-00006de0: 7468 6520 656e 636f 6465 7220 6c61 7965  the encoder laye
-00006df0: 722e 0a20 2020 2020 2020 2022 2222 0a20  r..        """. 
-00006e00: 2020 2020 2020 2073 7570 6572 284d 4154         super(MAT
-00006e10: 456e 636f 6465 724c 6179 6572 2c20 7365  EncoderLayer, se
-00006e20: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a20  lf).__init__(). 
-00006e30: 2020 2020 2020 2073 656c 662e 7365 6c66         self.self
-00006e40: 5f61 7474 6e20 3d20 4d75 6c74 6948 6561  _attn = MultiHea
-00006e50: 6465 644d 4154 4174 7465 6e74 696f 6e28  dedMATAttention(
-00006e60: 6469 7374 5f6b 6572 6e65 6c2c 206c 616d  dist_kernel, lam
-00006e70: 6264 615f 6174 7465 6e74 696f 6e2c 0a20  bda_attention,. 
-00006e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f70: 2020 7365 6c66 2e68 202a 2073 656c 662e    self.h * self.
+00005f80: 645f 6b29 0a0a 2020 2020 2020 2020 7265  d_k)..        re
+00005f90: 7475 726e 2073 656c 662e 6f75 7470 7574  turn self.output
+00005fa0: 5f6c 696e 6561 7228 7829 0a0a 0a63 6c61  _linear(x)...cla
+00005fb0: 7373 204d 4154 456e 636f 6465 724c 6179  ss MATEncoderLay
+00005fc0: 6572 286e 6e2e 4d6f 6475 6c65 293a 0a20  er(nn.Module):. 
+00005fd0: 2020 2022 2222 456e 636f 6465 7220 6c61     """Encoder la
+00005fe0: 7965 7220 666f 7220 7573 6520 696e 2074  yer for use in t
+00005ff0: 6865 204d 6f6c 6563 756c 6172 2041 7474  he Molecular Att
+00006000: 656e 7469 6f6e 2054 7261 6e73 666f 726d  ention Transform
+00006010: 6572 205b 315d 5f2e 0a0a 2020 2020 5468  er [1]_...    Th
+00006020: 6520 4d41 5445 6e63 6f64 6572 206c 6179  e MATEncoder lay
+00006030: 6572 2070 7269 6d61 7269 6c79 2063 6f6e  er primarily con
+00006040: 7369 7374 7320 6f66 2061 2073 656c 662d  sists of a self-
+00006050: 6174 7465 6e74 696f 6e20 6c61 7965 7220  attention layer 
+00006060: 284d 756c 7469 4865 6164 6564 4d41 5441  (MultiHeadedMATA
+00006070: 7474 656e 7469 6f6e 2920 616e 6420 6120  ttention) and a 
+00006080: 6665 6564 2d66 6f72 7761 7264 206c 6179  feed-forward lay
+00006090: 6572 2028 506f 7369 7469 6f6e 7769 7365  er (Positionwise
+000060a0: 4665 6564 466f 7277 6172 6429 2e0a 2020  FeedForward)..  
+000060b0: 2020 5468 6973 206c 6179 6572 2063 616e    This layer can
+000060c0: 2062 6520 7374 6163 6b65 6420 6d75 6c74   be stacked mult
+000060d0: 6970 6c65 2074 696d 6573 2074 6f20 666f  iple times to fo
+000060e0: 726d 2061 6e20 656e 636f 6465 722e 0a0a  rm an encoder...
+000060f0: 2020 2020 5265 6665 7265 6e63 6573 0a20      References. 
+00006100: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00006110: 2020 2e2e 205b 315d 204c 756b 6173 7a20    .. [1] Lukasz 
+00006120: 4d61 7a69 6172 6b61 2065 7420 616c 2e20  Maziarka et al. 
+00006130: 224d 6f6c 6563 756c 6520 4174 7465 6e74  "Molecule Attent
+00006140: 696f 6e20 5472 616e 7366 6f72 6d65 7222  ion Transformer"
+00006150: 2047 7261 7068 2052 6570 7265 7365 6e74   Graph Represent
+00006160: 6174 696f 6e20 4c65 6172 6e69 6e67 2077  ation Learning w
+00006170: 6f72 6b73 686f 7020 616e 6420 4d61 6368  orkshop and Mach
+00006180: 696e 6520 4c65 6172 6e69 6e67 2061 6e64  ine Learning and
+00006190: 2074 6865 2050 6879 7369 6361 6c20 5363   the Physical Sc
+000061a0: 6965 6e63 6573 2077 6f72 6b73 686f 7020  iences workshop 
+000061b0: 6174 204e 6575 7249 5053 2032 3031 392e  at NeurIPS 2019.
+000061c0: 2032 3032 302e 2068 7474 7073 3a2f 2f61   2020. https://a
+000061d0: 7278 6976 2e6f 7267 2f61 6273 2f32 3030  rxiv.org/abs/200
+000061e0: 322e 3038 3236 340a 0a20 2020 2045 7861  2.08264..    Exa
+000061f0: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
+00006200: 2d2d 0a20 2020 203e 3e3e 2066 726f 6d20  --.    >>> from 
+00006210: 7264 6b69 7420 696d 706f 7274 2043 6865  rdkit import Che
+00006220: 6d0a 2020 2020 3e3e 3e20 696d 706f 7274  m.    >>> import
+00006230: 2074 6f72 6368 0a20 2020 203e 3e3e 2069   torch.    >>> i
+00006240: 6d70 6f72 7420 6465 6570 6368 656d 0a20  mport deepchem. 
+00006250: 2020 203e 3e3e 2066 726f 6d20 6465 6570     >>> from deep
+00006260: 6368 656d 2e6d 6f64 656c 732e 746f 7263  chem.models.torc
+00006270: 685f 6d6f 6465 6c73 2e6c 6179 6572 7320  h_models.layers 
+00006280: 696d 706f 7274 204d 4154 456d 6265 6464  import MATEmbedd
+00006290: 696e 672c 204d 4154 456e 636f 6465 724c  ing, MATEncoderL
+000062a0: 6179 6572 0a20 2020 203e 3e3e 2069 6e70  ayer.    >>> inp
+000062b0: 7574 5f73 6d69 6c65 203d 2022 4343 220a  ut_smile = "CC".
+000062c0: 2020 2020 3e3e 3e20 6665 6174 203d 2064      >>> feat = d
+000062d0: 6565 7063 6865 6d2e 6665 6174 2e4d 4154  eepchem.feat.MAT
+000062e0: 4665 6174 7572 697a 6572 2829 0a20 2020  Featurizer().   
+000062f0: 203e 3e3e 206f 7574 203d 2066 6561 742e   >>> out = feat.
+00006300: 6665 6174 7572 697a 6528 696e 7075 745f  featurize(input_
+00006310: 736d 696c 6529 0a20 2020 203e 3e3e 206e  smile).    >>> n
+00006320: 6f64 6520 3d20 746f 7263 682e 7465 6e73  ode = torch.tens
+00006330: 6f72 286f 7574 5b30 5d2e 6e6f 6465 5f66  or(out[0].node_f
+00006340: 6561 7475 7265 7329 2e66 6c6f 6174 2829  eatures).float()
+00006350: 2e75 6e73 7175 6565 7a65 2830 290a 2020  .unsqueeze(0).  
+00006360: 2020 3e3e 3e20 6164 6a20 3d20 746f 7263    >>> adj = torc
+00006370: 682e 7465 6e73 6f72 286f 7574 5b30 5d2e  h.tensor(out[0].
+00006380: 6164 6a61 6365 6e63 795f 6d61 7472 6978  adjacency_matrix
+00006390: 292e 666c 6f61 7428 292e 756e 7371 7565  ).float().unsque
+000063a0: 657a 6528 3029 0a20 2020 203e 3e3e 2064  eze(0).    >>> d
+000063b0: 6973 7420 3d20 746f 7263 682e 7465 6e73  ist = torch.tens
+000063c0: 6f72 286f 7574 5b30 5d2e 6469 7374 616e  or(out[0].distan
+000063d0: 6365 5f6d 6174 7269 7829 2e66 6c6f 6174  ce_matrix).float
+000063e0: 2829 2e75 6e73 7175 6565 7a65 2830 290a  ().unsqueeze(0).
+000063f0: 2020 2020 3e3e 3e20 6d61 736b 203d 2074      >>> mask = t
+00006400: 6f72 6368 2e73 756d 2874 6f72 6368 2e61  orch.sum(torch.a
+00006410: 6273 286e 6f64 6529 2c20 6469 6d3d 2d31  bs(node), dim=-1
+00006420: 2920 213d 2030 0a20 2020 203e 3e3e 206c  ) != 0.    >>> l
+00006430: 6179 6572 203d 204d 4154 456e 636f 6465  ayer = MATEncode
+00006440: 724c 6179 6572 2829 0a20 2020 203e 3e3e  rLayer().    >>>
+00006450: 206f 7020 3d20 4d41 5445 6d62 6564 6469   op = MATEmbeddi
+00006460: 6e67 2829 286e 6f64 6529 0a20 2020 203e  ng()(node).    >
+00006470: 3e3e 206f 7574 7075 7420 3d20 6c61 7965  >> output = laye
+00006480: 7228 6f70 2c20 6d61 736b 2c20 6164 6a2c  r(op, mask, adj,
+00006490: 2064 6973 7429 0a20 2020 2022 2222 0a0a   dist).    """..
+000064a0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+000064b0: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
+000064c0: 2020 2020 2020 2020 6469 7374 5f6b 6572          dist_ker
+000064d0: 6e65 6c3a 2073 7472 203d 2027 736f 6674  nel: str = 'soft
+000064e0: 6d61 7827 2c0a 2020 2020 2020 2020 2020  max',.          
+000064f0: 2020 2020 2020 206c 616d 6264 615f 6174         lambda_at
+00006500: 7465 6e74 696f 6e3a 2066 6c6f 6174 203d  tention: float =
+00006510: 2030 2e33 332c 0a20 2020 2020 2020 2020   0.33,.         
+00006520: 2020 2020 2020 2020 6c61 6d62 6461 5f64          lambda_d
+00006530: 6973 7461 6e63 653a 2066 6c6f 6174 203d  istance: float =
+00006540: 2030 2e33 332c 0a20 2020 2020 2020 2020   0.33,.         
+00006550: 2020 2020 2020 2020 683a 2069 6e74 203d          h: int =
+00006560: 2031 362c 0a20 2020 2020 2020 2020 2020   16,.           
+00006570: 2020 2020 2020 7361 5f68 7369 7a65 3a20        sa_hsize: 
+00006580: 696e 7420 3d20 3130 3234 2c0a 2020 2020  int = 1024,.    
+00006590: 2020 2020 2020 2020 2020 2020 2073 615f               sa_
+000065a0: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
+000065b0: 203d 2030 2e30 2c0a 2020 2020 2020 2020   = 0.0,.        
+000065c0: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+000065d0: 6269 6173 3a20 626f 6f6c 203d 2054 7275  bias: bool = Tru
+000065e0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+000065f0: 2020 2020 645f 696e 7075 743a 2069 6e74      d_input: int
+00006600: 203d 2031 3032 342c 0a20 2020 2020 2020   = 1024,.       
+00006610: 2020 2020 2020 2020 2020 645f 6869 6464            d_hidd
+00006620: 656e 3a20 696e 7420 3d20 3130 3234 2c0a  en: int = 1024,.
+00006630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006640: 2064 5f6f 7574 7075 743a 2069 6e74 203d   d_output: int =
+00006650: 2031 3032 342c 0a20 2020 2020 2020 2020   1024,.         
+00006660: 2020 2020 2020 2020 6163 7469 7661 7469          activati
+00006670: 6f6e 3a20 7374 7220 3d20 276c 6561 6b79  on: str = 'leaky
+00006680: 7265 6c75 272c 0a20 2020 2020 2020 2020  relu',.         
+00006690: 2020 2020 2020 2020 6e5f 6c61 7965 7273          n_layers
+000066a0: 3a20 696e 7420 3d20 312c 0a20 2020 2020  : int = 1,.     
+000066b0: 2020 2020 2020 2020 2020 2020 6666 5f64              ff_d
+000066c0: 726f 706f 7574 5f70 3a20 666c 6f61 7420  ropout_p: float 
+000066d0: 3d20 302e 302c 0a20 2020 2020 2020 2020  = 0.0,.         
+000066e0: 2020 2020 2020 2020 656e 636f 6465 725f          encoder_
+000066f0: 6873 697a 653a 2069 6e74 203d 2031 3032  hsize: int = 102
+00006700: 342c 0a20 2020 2020 2020 2020 2020 2020  4,.             
+00006710: 2020 2020 656e 636f 6465 725f 6472 6f70      encoder_drop
+00006720: 6f75 745f 703a 2066 6c6f 6174 203d 2030  out_p: float = 0
+00006730: 2e30 293a 0a20 2020 2020 2020 2022 2222  .0):.        """
+00006740: 496e 6974 6961 6c69 7a65 2061 204d 4154  Initialize a MAT
+00006750: 456e 636f 6465 7220 6c61 7965 722e 0a0a  Encoder layer...
+00006760: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00006770: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00006780: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6469  -----.        di
+00006790: 7374 5f6b 6572 6e65 6c3a 2073 7472 0a20  st_kernel: str. 
+000067a0: 2020 2020 2020 2020 2020 204b 6572 6e65             Kerne
+000067b0: 6c20 6163 7469 7661 7469 6f6e 2074 6f20  l activation to 
+000067c0: 6265 2075 7365 642e 2043 616e 2062 6520  be used. Can be 
+000067d0: 6569 7468 6572 2027 736f 6674 6d61 7827  either 'softmax'
+000067e0: 2066 6f72 2073 6f66 746d 6178 206f 7220   for softmax or 
+000067f0: 2765 7870 2720 666f 7220 6578 706f 6e65  'exp' for expone
+00006800: 6e74 6961 6c2c 2066 6f72 2074 6865 2073  ntial, for the s
+00006810: 656c 662d 6174 7465 6e74 696f 6e20 6c61  elf-attention la
+00006820: 7965 722e 0a20 2020 2020 2020 206c 616d  yer..        lam
+00006830: 6264 615f 6174 7465 6e74 696f 6e3a 2066  bda_attention: f
+00006840: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+00006850: 2043 6f6e 7374 616e 7420 746f 2062 6520   Constant to be 
+00006860: 6d75 6c74 6970 6c69 6564 2077 6974 6820  multiplied with 
+00006870: 7468 6520 6174 7465 6e74 696f 6e20 6d61  the attention ma
+00006880: 7472 6978 2069 6e20 7468 6520 7365 6c66  trix in the self
+00006890: 2d61 7474 656e 7469 6f6e 206c 6179 6572  -attention layer
+000068a0: 2e0a 2020 2020 2020 2020 6c61 6d62 6461  ..        lambda
+000068b0: 5f64 6973 7461 6e63 653a 2066 6c6f 6174  _distance: float
+000068c0: 0a20 2020 2020 2020 2020 2020 2043 6f6e  .            Con
+000068d0: 7374 616e 7420 746f 2062 6520 6d75 6c74  stant to be mult
+000068e0: 6970 6c69 6564 2077 6974 6820 7468 6520  iplied with the 
+000068f0: 6469 7374 616e 6365 206d 6174 7269 7820  distance matrix 
+00006900: 696e 2074 6865 2073 656c 662d 6174 7465  in the self-atte
+00006910: 6e74 696f 6e20 6c61 7965 722e 0a20 2020  ntion layer..   
+00006920: 2020 2020 2068 3a20 696e 740a 2020 2020       h: int.    
+00006930: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+00006940: 6620 6174 7465 6e74 696f 6e20 6865 6164  f attention head
+00006950: 7320 666f 7220 7468 6520 7365 6c66 2d61  s for the self-a
+00006960: 7474 656e 7469 6f6e 206c 6179 6572 2e0a  ttention layer..
+00006970: 2020 2020 2020 2020 7361 5f68 7369 7a65          sa_hsize
+00006980: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
+00006990: 2020 5369 7a65 206f 6620 6465 6e73 6520    Size of dense 
+000069a0: 6c61 7965 7220 696e 2074 6865 2073 656c  layer in the sel
+000069b0: 662d 6174 7465 6e74 696f 6e20 6c61 7965  f-attention laye
+000069c0: 722e 0a20 2020 2020 2020 2073 615f 6472  r..        sa_dr
+000069d0: 6f70 6f75 745f 703a 2066 6c6f 6174 0a20  opout_p: float. 
+000069e0: 2020 2020 2020 2020 2020 2044 726f 706f             Dropo
+000069f0: 7574 2070 726f 6261 6269 6c69 7479 2066  ut probability f
+00006a00: 6f72 2074 6865 2073 656c 662d 6174 7465  or the self-atte
+00006a10: 6e74 696f 6e20 6c61 7965 722e 0a20 2020  ntion layer..   
+00006a20: 2020 2020 206f 7574 7075 745f 6269 6173       output_bias
+00006a30: 3a20 626f 6f6c 0a20 2020 2020 2020 2020  : bool.         
+00006a40: 2020 2049 6620 5472 7565 2c20 6465 6e73     If True, dens
+00006a50: 6520 6c61 7965 7273 2077 696c 6c20 7573  e layers will us
+00006a60: 6520 6269 6173 2076 6563 746f 7273 2069  e bias vectors i
+00006a70: 6e20 7468 6520 7365 6c66 2d61 7474 656e  n the self-atten
+00006a80: 7469 6f6e 206c 6179 6572 2e0a 2020 2020  tion layer..    
+00006a90: 2020 2020 645f 696e 7075 743a 2069 6e74      d_input: int
+00006aa0: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
+00006ab0: 6520 6f66 2069 6e70 7574 206c 6179 6572  e of input layer
+00006ac0: 2069 6e20 7468 6520 6665 6564 2d66 6f72   in the feed-for
+00006ad0: 7761 7264 206c 6179 6572 2e0a 2020 2020  ward layer..    
+00006ae0: 2020 2020 645f 6869 6464 656e 3a20 696e      d_hidden: in
+00006af0: 740a 2020 2020 2020 2020 2020 2020 5369  t.            Si
+00006b00: 7a65 206f 6620 6869 6464 656e 206c 6179  ze of hidden lay
+00006b10: 6572 2069 6e20 7468 6520 6665 6564 2d66  er in the feed-f
+00006b20: 6f72 7761 7264 206c 6179 6572 2e0a 2020  orward layer..  
+00006b30: 2020 2020 2020 645f 6f75 7470 7574 3a20        d_output: 
+00006b40: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+00006b50: 5369 7a65 206f 6620 6f75 7470 7574 206c  Size of output l
+00006b60: 6179 6572 2069 6e20 7468 6520 6665 6564  ayer in the feed
+00006b70: 2d66 6f72 7761 7264 206c 6179 6572 2e0a  -forward layer..
+00006b80: 2020 2020 2020 2020 6163 7469 7661 7469          activati
+00006b90: 6f6e 3a20 7374 720a 2020 2020 2020 2020  on: str.        
+00006ba0: 2020 2020 4163 7469 7661 7469 6f6e 2066      Activation f
+00006bb0: 756e 6374 696f 6e20 746f 2062 6520 7573  unction to be us
+00006bc0: 6564 2069 6e20 7468 6520 6665 6564 2d66  ed in the feed-f
+00006bd0: 6f72 7761 7264 206c 6179 6572 2e0a 2020  orward layer..  
+00006be0: 2020 2020 2020 2020 2020 4361 6e20 6368            Can ch
+00006bf0: 6f6f 7365 2062 6574 7765 656e 2027 7265  oose between 're
+00006c00: 6c75 2720 666f 7220 5265 4c55 2c20 276c  lu' for ReLU, 'l
+00006c10: 6561 6b79 7265 6c75 2720 666f 7220 4c65  eakyrelu' for Le
+00006c20: 616b 7952 654c 552c 2027 7072 656c 7527  akyReLU, 'prelu'
+00006c30: 2066 6f72 2050 5265 4c55 2c0a 2020 2020   for PReLU,.    
+00006c40: 2020 2020 2020 2020 2774 616e 6827 2066          'tanh' f
+00006c50: 6f72 2054 616e 482c 2027 7365 6c75 2720  or TanH, 'selu' 
+00006c60: 666f 7220 5345 4c55 2c20 2765 6c75 2720  for SELU, 'elu' 
+00006c70: 666f 7220 454c 5520 616e 6420 276c 696e  for ELU and 'lin
+00006c80: 6561 7227 2066 6f72 206c 696e 6561 7220  ear' for linear 
+00006c90: 6163 7469 7661 7469 6f6e 2e0a 2020 2020  activation..    
+00006ca0: 2020 2020 6e5f 6c61 7965 7273 3a20 696e      n_layers: in
+00006cb0: 740a 2020 2020 2020 2020 2020 2020 4e75  t.            Nu
+00006cc0: 6d62 6572 206f 6620 6c61 7965 7273 2069  mber of layers i
+00006cd0: 6e20 7468 6520 6665 6564 2d66 6f72 7761  n the feed-forwa
+00006ce0: 7264 206c 6179 6572 2e0a 2020 2020 2020  rd layer..      
+00006cf0: 2020 6472 6f70 6f75 745f 703a 2066 6c6f    dropout_p: flo
+00006d00: 6174 0a20 2020 2020 2020 2020 2020 2044  at.            D
+00006d10: 726f 706f 7574 2070 726f 6261 6269 6c69  ropout probabili
+00006d20: 7479 2069 6e20 7468 6520 6665 6565 642d  ty in the feeed-
+00006d30: 666f 7277 6172 6420 6c61 7965 722e 0a20  forward layer.. 
+00006d40: 2020 2020 2020 2065 6e63 6f64 6572 5f68         encoder_h
+00006d50: 7369 7a65 3a20 696e 740a 2020 2020 2020  size: int.      
+00006d60: 2020 2020 2020 5369 7a65 206f 6620 4465        Size of De
+00006d70: 6e73 6520 6c61 7965 7220 666f 7220 7468  nse layer for th
+00006d80: 6520 656e 636f 6465 7220 6974 7365 6c66  e encoder itself
+00006d90: 2e0a 2020 2020 2020 2020 656e 636f 6465  ..        encode
+00006da0: 725f 6472 6f70 6f75 745f 703a 2066 6c6f  r_dropout_p: flo
+00006db0: 6174 0a20 2020 2020 2020 2020 2020 2044  at.            D
+00006dc0: 726f 706f 7574 2070 726f 6261 6269 6c69  ropout probabili
+00006dd0: 7479 2066 6f72 2063 6f6e 6e65 6374 696f  ty for connectio
+00006de0: 6e73 2069 6e20 7468 6520 656e 636f 6465  ns in the encode
+00006df0: 7220 6c61 7965 722e 0a20 2020 2020 2020  r layer..       
+00006e00: 2022 2222 0a20 2020 2020 2020 2073 7570   """.        sup
+00006e10: 6572 284d 4154 456e 636f 6465 724c 6179  er(MATEncoderLay
+00006e20: 6572 2c20 7365 6c66 292e 5f5f 696e 6974  er, self).__init
+00006e30: 5f5f 2829 0a20 2020 2020 2020 2073 656c  __().        sel
+00006e40: 662e 7365 6c66 5f61 7474 6e20 3d20 4d75  f.self_attn = Mu
+00006e50: 6c74 6948 6561 6465 644d 4154 4174 7465  ltiHeadedMATAtte
+00006e60: 6e74 696f 6e28 6469 7374 5f6b 6572 6e65  ntion(dist_kerne
+00006e70: 6c2c 206c 616d 6264 615f 6174 7465 6e74  l, lambda_attent
+00006e80: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
 00006e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00006ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006eb0: 6c61 6d62 6461 5f64 6973 7461 6e63 652c  lambda_distance,
-00006ec0: 2068 2c20 7361 5f68 7369 7a65 2c0a 2020   h, sa_hsize,.  
-00006ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006eb0: 2020 2020 2020 6c61 6d62 6461 5f64 6973        lambda_dis
+00006ec0: 7461 6e63 652c 2068 2c20 7361 5f68 7369  tance, h, sa_hsi
+00006ed0: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
 00006ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ef0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00006f00: 615f 6472 6f70 6f75 745f 702c 206f 7574  a_dropout_p, out
-00006f10: 7075 745f 6269 6173 290a 2020 2020 2020  put_bias).      
-00006f20: 2020 7365 6c66 2e66 6565 645f 666f 7277    self.feed_forw
-00006f30: 6172 6420 3d20 506f 7369 7469 6f6e 7769  ard = Positionwi
-00006f40: 7365 4665 6564 466f 7277 6172 6428 645f  seFeedForward(d_
-00006f50: 696e 7075 742c 2064 5f68 6964 6465 6e2c  input, d_hidden,
-00006f60: 2064 5f6f 7574 7075 742c 0a20 2020 2020   d_output,.     
-00006f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f00: 2020 2020 2073 615f 6472 6f70 6f75 745f       sa_dropout_
+00006f10: 702c 206f 7574 7075 745f 6269 6173 290a  p, output_bias).
+00006f20: 2020 2020 2020 2020 7365 6c66 2e66 6565          self.fee
+00006f30: 645f 666f 7277 6172 6420 3d20 506f 7369  d_forward = Posi
+00006f40: 7469 6f6e 7769 7365 4665 6564 466f 7277  tionwiseFeedForw
+00006f50: 6172 6428 645f 696e 7075 742c 2064 5f68  ard(d_input, d_h
+00006f60: 6964 6465 6e2c 2064 5f6f 7574 7075 742c  idden, d_output,
+00006f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00006f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f90: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00006fa0: 6374 6976 6174 696f 6e2c 206e 5f6c 6179  ctivation, n_lay
-00006fb0: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
+00006f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fa0: 2020 2020 2061 6374 6976 6174 696f 6e2c       activation,
+00006fb0: 206e 5f6c 6179 6572 732c 0a20 2020 2020   n_layers,.     
 00006fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00006fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fe0: 2020 2020 2020 2020 2066 665f 6472 6f70           ff_drop
-00006ff0: 6f75 745f 7029 0a20 2020 2020 2020 206c  out_p).        l
-00007000: 6179 6572 203d 2053 7562 6c61 7965 7243  ayer = SublayerC
-00007010: 6f6e 6e65 6374 696f 6e28 7369 7a65 3d65  onnection(size=e
-00007020: 6e63 6f64 6572 5f68 7369 7a65 2c0a 2020  ncoder_hsize,.  
-00007030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fe0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00006ff0: 665f 6472 6f70 6f75 745f 7029 0a20 2020  f_dropout_p).   
+00007000: 2020 2020 206c 6179 6572 203d 2053 7562       layer = Sub
+00007010: 6c61 7965 7243 6f6e 6e65 6374 696f 6e28  layerConnection(
+00007020: 7369 7a65 3d65 6e63 6f64 6572 5f68 7369  size=encoder_hsi
+00007030: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
 00007040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007050: 2064 726f 706f 7574 5f70 3d65 6e63 6f64   dropout_p=encod
-00007060: 6572 5f64 726f 706f 7574 5f70 290a 2020  er_dropout_p).  
-00007070: 2020 2020 2020 7365 6c66 2e73 7562 6c61        self.subla
-00007080: 7965 7220 3d20 6e6e 2e4d 6f64 756c 654c  yer = nn.ModuleL
-00007090: 6973 7428 5b6c 6179 6572 2066 6f72 205f  ist([layer for _
-000070a0: 2069 6e20 7261 6e67 6528 3229 5d29 0a20   in range(2)]). 
-000070b0: 2020 2020 2020 2073 656c 662e 7369 7a65         self.size
-000070c0: 203d 2065 6e63 6f64 6572 5f68 7369 7a65   = encoder_hsize
-000070d0: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
-000070e0: 6428 7365 6c66 2c0a 2020 2020 2020 2020  d(self,.        
-000070f0: 2020 2020 2020 2020 783a 2074 6f72 6368          x: torch
-00007100: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
-00007110: 2020 2020 2020 2020 206d 6173 6b3a 2074           mask: t
-00007120: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
-00007130: 2020 2020 2020 2020 2020 2020 2061 646a               adj
-00007140: 5f6d 6174 7269 783a 2074 6f72 6368 2e54  _matrix: torch.T
-00007150: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
-00007160: 2020 2020 2020 2064 6973 7461 6e63 655f         distance_
-00007170: 6d61 7472 6978 3a20 746f 7263 682e 5465  matrix: torch.Te
-00007180: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
-00007190: 2020 2020 2020 7361 5f64 726f 706f 7574        sa_dropout
-000071a0: 5f70 3a20 666c 6f61 7420 3d20 302e 3029  _p: float = 0.0)
-000071b0: 202d 3e20 746f 7263 682e 5465 6e73 6f72   -> torch.Tensor
-000071c0: 3a0a 2020 2020 2020 2020 2222 224f 7574  :.        """Out
-000071d0: 7075 7420 636f 6d70 7574 6174 696f 6e20  put computation 
-000071e0: 666f 7220 7468 6520 4d41 5445 6e63 6f64  for the MATEncod
-000071f0: 6572 206c 6179 6572 2e0a 0a20 2020 2020  er layer...     
-00007200: 2020 2049 6e20 7468 6520 4d41 5445 6e63     In the MATEnc
-00007210: 6f64 6572 4c61 7965 7220 696e 7469 616c  oderLayer intial
-00007220: 697a 6174 696f 6e2c 2073 656c 662e 7375  ization, self.su
-00007230: 626c 6179 6572 2069 7320 6465 6669 6e65  blayer is define
-00007240: 6420 6173 2061 6e20 6e6e 2e4d 6f64 756c  d as an nn.Modul
-00007250: 654c 6973 7420 6f66 2032 206c 6179 6572  eList of 2 layer
-00007260: 732e 2057 6520 7769 6c6c 2062 6520 7061  s. We will be pa
-00007270: 7373 696e 6720 6f75 7220 636f 6d70 7574  ssing our comput
-00007280: 6174 696f 6e20 7468 726f 7567 6820 7468  ation through th
-00007290: 6573 6520 6c61 7965 7273 2073 6571 7565  ese layers seque
-000072a0: 6e74 6961 6c6c 792e 0a20 2020 2020 2020  ntially..       
-000072b0: 206e 6e2e 4d6f 6475 6c65 4c69 7374 2069   nn.ModuleList i
-000072c0: 7320 7375 6273 6372 6970 7461 626c 6520  s subscriptable 
-000072d0: 616e 6420 7468 7573 2077 6520 6361 6e20  and thus we can 
-000072e0: 6163 6365 7373 2069 7420 6173 2073 656c  access it as sel
-000072f0: 662e 7375 626c 6179 6572 5b30 5d2c 2066  f.sublayer[0], f
-00007300: 6f72 2065 7861 6d70 6c65 2e0a 0a20 2020  or example...   
-00007310: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00007320: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00007330: 2d2d 0a20 2020 2020 2020 2078 3a20 746f  --.        x: to
-00007340: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-00007350: 2020 2020 2020 2049 6e70 7574 2074 656e         Input ten
-00007360: 736f 722e 0a20 2020 2020 2020 206d 6173  sor..        mas
-00007370: 6b3a 2074 6f72 6368 2e54 656e 736f 720a  k: torch.Tensor.
-00007380: 2020 2020 2020 2020 2020 2020 4d61 736b              Mask
-00007390: 7320 6f75 7420 7061 6464 696e 6720 7661  s out padding va
-000073a0: 6c75 6573 2073 6f20 7468 6174 2074 6865  lues so that the
-000073b0: 7920 6172 6520 6e6f 7420 7461 6b65 6e20  y are not taken 
-000073c0: 696e 746f 2061 6363 6f75 6e74 2077 6865  into account whe
-000073d0: 6e20 636f 6d70 7574 696e 6720 7468 6520  n computing the 
-000073e0: 6174 7465 6e74 696f 6e20 7363 6f72 652e  attention score.
-000073f0: 0a20 2020 2020 2020 2061 646a 5f6d 6174  .        adj_mat
-00007400: 7269 783a 2074 6f72 6368 2e54 656e 736f  rix: torch.Tenso
-00007410: 720a 2020 2020 2020 2020 2020 2020 4164  r.            Ad
-00007420: 6a61 6365 6e63 7920 6d61 7472 6978 206f  jacency matrix o
-00007430: 6620 6120 6d6f 6c65 6375 6c65 2e0a 2020  f a molecule..  
-00007440: 2020 2020 2020 6469 7374 616e 6365 5f6d        distance_m
-00007450: 6174 7269 783a 2074 6f72 6368 2e54 656e  atrix: torch.Ten
-00007460: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-00007470: 4469 7374 616e 6365 206d 6174 7269 7820  Distance matrix 
-00007480: 6f66 2061 206d 6f6c 6563 756c 652e 0a20  of a molecule.. 
-00007490: 2020 2020 2020 2073 615f 6472 6f70 6f75         sa_dropou
-000074a0: 745f 703a 2066 6c6f 6174 0a20 2020 2020  t_p: float.     
-000074b0: 2020 2020 2020 2044 726f 706f 7574 2070         Dropout p
-000074c0: 726f 6261 6269 6c69 7479 2066 6f72 2074  robability for t
-000074d0: 6865 2073 656c 662d 6174 7465 6e74 696f  he self-attentio
-000074e0: 6e20 6c61 7965 7220 284d 756c 7469 4865  n layer (MultiHe
-000074f0: 6164 6564 4d41 5441 7474 656e 7469 6f6e  adedMATAttention
-00007500: 292e 0a20 2020 2020 2020 2022 2222 0a20  )..        """. 
-00007510: 2020 2020 2020 2078 203d 2073 656c 662e         x = self.
-00007520: 7375 626c 6179 6572 5b30 5d28 782c 0a20  sublayer[0](x,. 
-00007530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007540: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007550: 2e73 656c 665f 6174 746e 2878 2c0a 2020  .self_attn(x,.  
-00007560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007050: 2020 2020 2020 2064 726f 706f 7574 5f70         dropout_p
+00007060: 3d65 6e63 6f64 6572 5f64 726f 706f 7574  =encoder_dropout
+00007070: 5f70 290a 2020 2020 2020 2020 7365 6c66  _p).        self
+00007080: 2e73 7562 6c61 7965 7220 3d20 6e6e 2e4d  .sublayer = nn.M
+00007090: 6f64 756c 654c 6973 7428 5b6c 6179 6572  oduleList([layer
+000070a0: 2066 6f72 205f 2069 6e20 7261 6e67 6528   for _ in range(
+000070b0: 3229 5d29 0a20 2020 2020 2020 2073 656c  2)]).        sel
+000070c0: 662e 7369 7a65 203d 2065 6e63 6f64 6572  f.size = encoder
+000070d0: 5f68 7369 7a65 0a0a 2020 2020 6465 6620  _hsize..    def 
+000070e0: 666f 7277 6172 6428 7365 6c66 2c0a 2020  forward(self,.  
+000070f0: 2020 2020 2020 2020 2020 2020 2020 783a                x:
+00007100: 2074 6f72 6368 2e54 656e 736f 722c 0a20   torch.Tensor,. 
+00007110: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00007120: 6173 6b3a 2074 6f72 6368 2e54 656e 736f  ask: torch.Tenso
+00007130: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00007140: 2020 2061 646a 5f6d 6174 7269 783a 2074     adj_matrix: t
+00007150: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
+00007160: 2020 2020 2020 2020 2020 2020 2064 6973               dis
+00007170: 7461 6e63 655f 6d61 7472 6978 3a20 746f  tance_matrix: to
+00007180: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
+00007190: 2020 2020 2020 2020 2020 2020 7361 5f64              sa_d
+000071a0: 726f 706f 7574 5f70 3a20 666c 6f61 7420  ropout_p: float 
+000071b0: 3d20 302e 3029 202d 3e20 746f 7263 682e  = 0.0) -> torch.
+000071c0: 5465 6e73 6f72 3a0a 2020 2020 2020 2020  Tensor:.        
+000071d0: 2222 224f 7574 7075 7420 636f 6d70 7574  """Output comput
+000071e0: 6174 696f 6e20 666f 7220 7468 6520 4d41  ation for the MA
+000071f0: 5445 6e63 6f64 6572 206c 6179 6572 2e0a  TEncoder layer..
+00007200: 0a20 2020 2020 2020 2049 6e20 7468 6520  .        In the 
+00007210: 4d41 5445 6e63 6f64 6572 4c61 7965 7220  MATEncoderLayer 
+00007220: 696e 7469 616c 697a 6174 696f 6e2c 2073  intialization, s
+00007230: 656c 662e 7375 626c 6179 6572 2069 7320  elf.sublayer is 
+00007240: 6465 6669 6e65 6420 6173 2061 6e20 6e6e  defined as an nn
+00007250: 2e4d 6f64 756c 654c 6973 7420 6f66 2032  .ModuleList of 2
+00007260: 206c 6179 6572 732e 2057 6520 7769 6c6c   layers. We will
+00007270: 2062 6520 7061 7373 696e 6720 6f75 7220   be passing our 
+00007280: 636f 6d70 7574 6174 696f 6e20 7468 726f  computation thro
+00007290: 7567 6820 7468 6573 6520 6c61 7965 7273  ugh these layers
+000072a0: 2073 6571 7565 6e74 6961 6c6c 792e 0a20   sequentially.. 
+000072b0: 2020 2020 2020 206e 6e2e 4d6f 6475 6c65         nn.Module
+000072c0: 4c69 7374 2069 7320 7375 6273 6372 6970  List is subscrip
+000072d0: 7461 626c 6520 616e 6420 7468 7573 2077  table and thus w
+000072e0: 6520 6361 6e20 6163 6365 7373 2069 7420  e can access it 
+000072f0: 6173 2073 656c 662e 7375 626c 6179 6572  as self.sublayer
+00007300: 5b30 5d2c 2066 6f72 2065 7861 6d70 6c65  [0], for example
+00007310: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00007320: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00007330: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00007340: 2078 3a20 746f 7263 682e 5465 6e73 6f72   x: torch.Tensor
+00007350: 0a20 2020 2020 2020 2020 2020 2049 6e70  .            Inp
+00007360: 7574 2074 656e 736f 722e 0a20 2020 2020  ut tensor..     
+00007370: 2020 206d 6173 6b3a 2074 6f72 6368 2e54     mask: torch.T
+00007380: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+00007390: 2020 4d61 736b 7320 6f75 7420 7061 6464    Masks out padd
+000073a0: 696e 6720 7661 6c75 6573 2073 6f20 7468  ing values so th
+000073b0: 6174 2074 6865 7920 6172 6520 6e6f 7420  at they are not 
+000073c0: 7461 6b65 6e20 696e 746f 2061 6363 6f75  taken into accou
+000073d0: 6e74 2077 6865 6e20 636f 6d70 7574 696e  nt when computin
+000073e0: 6720 7468 6520 6174 7465 6e74 696f 6e20  g the attention 
+000073f0: 7363 6f72 652e 0a20 2020 2020 2020 2061  score..        a
+00007400: 646a 5f6d 6174 7269 783a 2074 6f72 6368  dj_matrix: torch
+00007410: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+00007420: 2020 2020 4164 6a61 6365 6e63 7920 6d61      Adjacency ma
+00007430: 7472 6978 206f 6620 6120 6d6f 6c65 6375  trix of a molecu
+00007440: 6c65 2e0a 2020 2020 2020 2020 6469 7374  le..        dist
+00007450: 616e 6365 5f6d 6174 7269 783a 2074 6f72  ance_matrix: tor
+00007460: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+00007470: 2020 2020 2020 4469 7374 616e 6365 206d        Distance m
+00007480: 6174 7269 7820 6f66 2061 206d 6f6c 6563  atrix of a molec
+00007490: 756c 652e 0a20 2020 2020 2020 2073 615f  ule..        sa_
+000074a0: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
+000074b0: 0a20 2020 2020 2020 2020 2020 2044 726f  .            Dro
+000074c0: 706f 7574 2070 726f 6261 6269 6c69 7479  pout probability
+000074d0: 2066 6f72 2074 6865 2073 656c 662d 6174   for the self-at
+000074e0: 7465 6e74 696f 6e20 6c61 7965 7220 284d  tention layer (M
+000074f0: 756c 7469 4865 6164 6564 4d41 5441 7474  ultiHeadedMATAtt
+00007500: 656e 7469 6f6e 292e 0a20 2020 2020 2020  ention)..       
+00007510: 2022 2222 0a20 2020 2020 2020 2078 203d   """.        x =
+00007520: 2073 656c 662e 7375 626c 6179 6572 5b30   self.sublayer[0
+00007530: 5d28 782c 0a20 2020 2020 2020 2020 2020  ](x,.           
+00007540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007550: 2020 7365 6c66 2e73 656c 665f 6174 746e    self.self_attn
+00007560: 2878 2c0a 2020 2020 2020 2020 2020 2020  (x,.            
 00007570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007580: 2020 2020 2020 2020 2020 782c 0a20 2020            x,.   
-00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007590: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
 000075a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075b0: 2020 2020 2020 2020 2078 2c0a 2020 2020           x,.    
-000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075b0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+000075c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 000075d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075e0: 2020 2020 2020 2020 6d61 736b 3d6d 6173          mask=mas
-000075f0: 6b2c 0a20 2020 2020 2020 2020 2020 2020  k,.             
+000075e0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+000075f0: 736b 3d6d 6173 6b2c 0a20 2020 2020 2020  sk=mask,.       
 00007600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007610: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00007620: 726f 706f 7574 5f70 3d73 615f 6472 6f70  ropout_p=sa_drop
-00007630: 6f75 745f 702c 0a20 2020 2020 2020 2020  out_p,.         
+00007610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007620: 2020 2020 2064 726f 706f 7574 5f70 3d73       dropout_p=s
+00007630: 615f 6472 6f70 6f75 745f 702c 0a20 2020  a_dropout_p,.   
 00007640: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00007650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007660: 2020 2061 646a 5f6d 6174 7269 783d 6164     adj_matrix=ad
-00007670: 6a5f 6d61 7472 6978 2c0a 2020 2020 2020  j_matrix,.      
+00007660: 2020 2020 2020 2020 2061 646a 5f6d 6174           adj_mat
+00007670: 7269 783d 6164 6a5f 6d61 7472 6978 2c0a  rix=adj_matrix,.
 00007680: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00007690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000076a0: 2020 2020 2020 6469 7374 616e 6365 5f6d        distance_m
-000076b0: 6174 7269 783d 6469 7374 616e 6365 5f6d  atrix=distance_m
-000076c0: 6174 7269 7829 290a 2020 2020 2020 2020  atrix)).        
-000076d0: 7265 7475 726e 2073 656c 662e 7375 626c  return self.subl
-000076e0: 6179 6572 5b31 5d28 782c 2073 656c 662e  ayer[1](x, self.
-000076f0: 6665 6564 5f66 6f72 7761 7264 2878 2929  feed_forward(x))
-00007700: 0a0a 0a63 6c61 7373 2053 7562 6c61 7965  ...class Sublaye
-00007710: 7243 6f6e 6e65 6374 696f 6e28 6e6e 2e4d  rConnection(nn.M
-00007720: 6f64 756c 6529 3a0a 2020 2020 2222 2253  odule):.    """S
-00007730: 7562 6c61 7965 7243 6f6e 6e65 6374 696f  ublayerConnectio
-00007740: 6e20 6c61 7965 7220 6261 7365 6420 6f6e  n layer based on
-00007750: 2074 6865 2070 6170 6572 2060 4174 7465   the paper `Atte
-00007760: 6e74 696f 6e20 4973 2041 6c6c 2059 6f75  ntion Is All You
-00007770: 204e 6565 6420 3c68 7474 7073 3a2f 2f61   Need <https://a
-00007780: 7278 6976 2e6f 7267 2f61 6273 2f31 3730  rxiv.org/abs/170
-00007790: 362e 3033 3736 323e 605f 2e0a 0a20 2020  6.03762>`_...   
-000077a0: 2054 6865 2053 7562 6c61 7965 7243 6f6e   The SublayerCon
-000077b0: 6e65 6374 696f 6e20 6e6f 726d 616c 697a  nection normaliz
-000077c0: 6573 2061 6e64 2061 6464 7320 6472 6f70  es and adds drop
-000077d0: 6f75 7420 746f 206f 7574 7075 7420 7465  out to output te
-000077e0: 6e73 6f72 206f 6620 616e 2061 7262 6974  nsor of an arbit
-000077f0: 6172 7920 6c61 7965 722e 0a20 2020 2049  ary layer..    I
-00007800: 7420 6675 7274 6865 7220 6164 6473 2061  t further adds a
-00007810: 2072 6573 6964 7561 6c20 6c61 7965 7220   residual layer 
-00007820: 636f 6e6e 6563 7469 6f6e 2062 6574 7765  connection betwe
-00007830: 656e 2074 6865 2069 6e70 7574 206f 6620  en the input of 
-00007840: 7468 6520 6172 6269 7461 7279 206c 6179  the arbitary lay
-00007850: 6572 2061 6e64 2074 6865 2064 726f 706f  er and the dropo
-00007860: 7574 2d61 646a 7573 7465 6420 6c61 7965  ut-adjusted laye
-00007870: 7220 6f75 7470 7574 2e0a 0a20 2020 2045  r output...    E
-00007880: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
-00007890: 2d2d 2d2d 0a20 2020 203e 3e3e 2066 726f  ----.    >>> fro
-000078a0: 6d20 6465 6570 6368 656d 2e6d 6f64 656c  m deepchem.model
-000078b0: 732e 746f 7263 685f 6d6f 6465 6c73 2e6c  s.torch_models.l
-000078c0: 6179 6572 7320 696d 706f 7274 2053 7562  ayers import Sub
-000078d0: 6c61 7965 7243 6f6e 6e65 6374 696f 6e0a  layerConnection.
-000078e0: 2020 2020 3e3e 3e20 7363 616c 6520 3d20      >>> scale = 
-000078f0: 302e 3335 0a20 2020 203e 3e3e 206c 6179  0.35.    >>> lay
-00007900: 6572 203d 2053 7562 6c61 7965 7243 6f6e  er = SublayerCon
-00007910: 6e65 6374 696f 6e28 322c 2030 2e29 0a20  nection(2, 0.). 
-00007920: 2020 203e 3e3e 2069 6e70 7574 5f61 7220     >>> input_ar 
-00007930: 3d20 746f 7263 682e 7465 6e73 6f72 285b  = torch.tensor([
-00007940: 5b31 2e2c 2032 2e5d 2c20 5b35 2e2c 2036  [1., 2.], [5., 6
-00007950: 2e5d 5d29 0a20 2020 203e 3e3e 206f 7574  .]]).    >>> out
-00007960: 7075 7420 3d20 6c61 7965 7228 696e 7075  put = layer(inpu
-00007970: 745f 6172 2c20 696e 7075 745f 6172 290a  t_ar, input_ar).
-00007980: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-00007990: 5f69 6e69 745f 5f28 7365 6c66 2c20 7369  _init__(self, si
-000079a0: 7a65 3a20 696e 742c 2064 726f 706f 7574  ze: int, dropout
-000079b0: 5f70 3a20 666c 6f61 7420 3d20 302e 3029  _p: float = 0.0)
-000079c0: 3a0a 2020 2020 2020 2020 2222 2249 6e69  :.        """Ini
-000079d0: 7469 616c 697a 6520 6120 5375 626c 6179  tialize a Sublay
-000079e0: 6572 436f 6e6e 6563 7469 6f6e 204c 6179  erConnection Lay
-000079f0: 6572 2e0a 0a20 2020 2020 2020 2050 6172  er...        Par
-00007a00: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00007a10: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00007a20: 2020 2073 697a 653a 2069 6e74 0a20 2020     size: int.   
-00007a30: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
-00007a40: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-00007a50: 6472 6f70 6f75 745f 703a 2066 6c6f 6174  dropout_p: float
-00007a60: 0a20 2020 2020 2020 2020 2020 2044 726f  .            Dro
-00007a70: 706f 7574 2070 726f 6261 6269 6c69 7479  pout probability
-00007a80: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00007a90: 2020 2020 2020 7375 7065 7228 5375 626c        super(Subl
-00007aa0: 6179 6572 436f 6e6e 6563 7469 6f6e 2c20  ayerConnection, 
-00007ab0: 7365 6c66 292e 5f5f 696e 6974 5f5f 2829  self).__init__()
-00007ac0: 0a20 2020 2020 2020 2073 656c 662e 6e6f  .        self.no
-00007ad0: 726d 203d 206e 6e2e 4c61 7965 724e 6f72  rm = nn.LayerNor
-00007ae0: 6d28 7369 7a65 290a 2020 2020 2020 2020  m(size).        
-00007af0: 7365 6c66 2e64 726f 706f 7574 5f70 203d  self.dropout_p =
-00007b00: 206e 6e2e 4472 6f70 6f75 7428 6472 6f70   nn.Dropout(drop
-00007b10: 6f75 745f 7029 0a0a 2020 2020 6465 6620  out_p)..    def 
-00007b20: 666f 7277 6172 6428 7365 6c66 2c20 783a  forward(self, x:
-00007b30: 2074 6f72 6368 2e54 656e 736f 722c 206f   torch.Tensor, o
-00007b40: 7574 7075 743a 2074 6f72 6368 2e54 656e  utput: torch.Ten
-00007b50: 736f 7229 202d 3e20 746f 7263 682e 5465  sor) -> torch.Te
-00007b60: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
-00007b70: 224f 7574 7075 7420 636f 6d70 7574 6174  "Output computat
-00007b80: 696f 6e20 666f 7220 7468 6520 5375 626c  ion for the Subl
-00007b90: 6179 6572 436f 6e6e 6563 7469 6f6e 206c  ayerConnection l
-00007ba0: 6179 6572 2e0a 0a20 2020 2020 2020 2054  ayer...        T
-00007bb0: 616b 6573 2061 6e20 696e 7075 7420 7465  akes an input te
-00007bc0: 6e73 6f72 2078 2c20 7468 656e 2061 6464  nsor x, then add
-00007bd0: 7320 7468 6520 6472 6f70 6f75 742d 6164  s the dropout-ad
-00007be0: 6a75 7374 6564 2073 7562 6c61 7965 7220  justed sublayer 
-00007bf0: 6f75 7470 7574 2066 6f72 206e 6f72 6d61  output for norma
-00007c00: 6c69 7a65 6420 7820 746f 2069 742e 0a20  lized x to it.. 
-00007c10: 2020 2020 2020 2054 6869 7320 6973 2064         This is d
-00007c20: 6f6e 6520 746f 2061 6464 2061 2072 6573  one to add a res
-00007c30: 6964 7561 6c20 636f 6e6e 6563 7469 6f6e  idual connection
-00007c40: 2066 6f6c 6c6f 7765 6420 6279 204c 6179   followed by Lay
-00007c50: 6572 4e6f 726d 2e0a 0a20 2020 2020 2020  erNorm...       
-00007c60: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00007c70: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00007c80: 2020 2020 2020 2078 3a20 746f 7263 682e         x: torch.
-00007c90: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00007ca0: 2020 2049 6e70 7574 2074 656e 736f 722e     Input tensor.
-00007cb0: 0a20 2020 2020 2020 206f 7574 7075 743a  .        output:
-00007cc0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-00007cd0: 2020 2020 2020 2020 2020 4c61 7965 7220            Layer 
-00007ce0: 7768 6f73 6520 6e6f 726d 616c 697a 6564  whose normalized
-00007cf0: 206f 7574 7075 7420 7769 6c6c 2062 6520   output will be 
-00007d00: 6164 6465 6420 746f 2078 2e0a 2020 2020  added to x..    
-00007d10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007d20: 6966 2078 2069 7320 4e6f 6e65 3a0a 2020  if x is None:.  
-00007d30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00007d40: 2073 656c 662e 6472 6f70 6f75 745f 7028   self.dropout_p(
-00007d50: 7365 6c66 2e6e 6f72 6d28 6f75 7470 7574  self.norm(output
-00007d60: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
-00007d70: 6e20 7820 2b20 7365 6c66 2e64 726f 706f  n x + self.dropo
-00007d80: 7574 5f70 2873 656c 662e 6e6f 726d 286f  ut_p(self.norm(o
-00007d90: 7574 7075 7429 290a 0a0a 636c 6173 7320  utput))...class 
-00007da0: 506f 7369 7469 6f6e 7769 7365 4665 6564  PositionwiseFeed
-00007db0: 466f 7277 6172 6428 6e6e 2e4d 6f64 756c  Forward(nn.Modul
-00007dc0: 6529 3a0a 2020 2020 2222 2250 6f73 6974  e):.    """Posit
-00007dd0: 696f 6e77 6973 6546 6565 6446 6f72 7761  ionwiseFeedForwa
-00007de0: 7264 2069 7320 6120 6c61 7965 7220 7573  rd is a layer us
-00007df0: 6564 2074 6f20 6465 6669 6e65 2074 6865  ed to define the
-00007e00: 2070 6f73 6974 696f 6e2d 7769 7365 2066   position-wise f
-00007e10: 6565 642d 666f 7277 6172 6420 2846 464e  eed-forward (FFN
-00007e20: 2920 616c 676f 7269 7468 6d20 666f 7220  ) algorithm for 
-00007e30: 7468 6520 4d6f 6c65 6375 6c61 7220 4174  the Molecular At
-00007e40: 7465 6e74 696f 6e20 5472 616e 7366 6f72  tention Transfor
-00007e50: 6d65 7220 5b31 5d5f 0a0a 2020 2020 4561  mer [1]_..    Ea
-00007e60: 6368 206c 6179 6572 2069 6e20 7468 6520  ch layer in the 
-00007e70: 4d41 5420 656e 636f 6465 7220 636f 6e74  MAT encoder cont
-00007e80: 6169 6e73 2061 2066 756c 6c79 2063 6f6e  ains a fully con
-00007e90: 6e65 6374 6564 2066 6565 642d 666f 7277  nected feed-forw
-00007ea0: 6172 6420 6e65 7477 6f72 6b20 7768 6963  ard network whic
-00007eb0: 6820 6170 706c 6965 7320 7477 6f20 6c69  h applies two li
-00007ec0: 6e65 6172 2074 7261 6e73 666f 726d 6174  near transformat
-00007ed0: 696f 6e73 2061 6e64 2074 6865 2067 6976  ions and the giv
-00007ee0: 656e 2061 6374 6976 6174 696f 6e20 6675  en activation fu
-00007ef0: 6e63 7469 6f6e 2e0a 2020 2020 5468 6973  nction..    This
-00007f00: 2069 7320 646f 6e65 2069 6e20 6164 6469   is done in addi
-00007f10: 7469 6f6e 2074 6f20 7468 6520 5375 626c  tion to the Subl
-00007f20: 6179 6572 436f 6e6e 6563 7469 6f6e 206d  ayerConnection m
-00007f30: 6f64 756c 652e 0a0a 2020 2020 4e6f 7465  odule...    Note
-00007f40: 3a20 5468 6973 206d 6f64 6966 6965 6420  : This modified 
-00007f50: 7665 7273 696f 6e20 6f66 2060 506f 7369  version of `Posi
-00007f60: 7469 6f6e 7769 7365 4665 6564 466f 7277  tionwiseFeedForw
-00007f70: 6172 6460 2063 6c61 7373 2063 6f6e 7461  ard` class conta
-00007f80: 696e 7320 6064 726f 706f 7574 5f61 745f  ins `dropout_at_
-00007f90: 696e 7075 745f 6e6f 5f61 6374 6020 636f  input_no_act` co
-00007fa0: 6e64 6974 696f 6e20 746f 2066 6163 696c  ndition to facil
-00007fb0: 6974 6174 6520 6974 7320 7573 6520 696e  itate its use in
-00007fc0: 2064 6566 696e 696e 670a 2020 2020 2020   defining.      
-00007fd0: 2020 7468 6520 6665 6564 2d66 6f72 7761    the feed-forwa
-00007fe0: 7264 2028 4646 4e29 2061 6c67 6f72 6974  rd (FFN) algorit
-00007ff0: 686d 2066 6f72 2074 6865 2044 6972 6563  hm for the Direc
-00008000: 7465 6420 4d65 7373 6167 6520 5061 7373  ted Message Pass
-00008010: 696e 6720 4e65 7572 616c 204e 6574 776f  ing Neural Netwo
-00008020: 726b 2028 442d 4d50 4e4e 2920 5b32 5d5f  rk (D-MPNN) [2]_
-00008030: 0a0a 2020 2020 5265 6665 7265 6e63 6573  ..    References
-00008040: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-00008050: 2020 2020 2e2e 205b 315d 204c 756b 6173      .. [1] Lukas
-00008060: 7a20 4d61 7a69 6172 6b61 2065 7420 616c  z Maziarka et al
-00008070: 2e20 224d 6f6c 6563 756c 6520 4174 7465  . "Molecule Atte
-00008080: 6e74 696f 6e20 5472 616e 7366 6f72 6d65  ntion Transforme
-00008090: 7222 2047 7261 7068 2052 6570 7265 7365  r" Graph Represe
-000080a0: 6e74 6174 696f 6e20 4c65 6172 6e69 6e67  ntation Learning
-000080b0: 2077 6f72 6b73 686f 7020 616e 6420 4d61   workshop and Ma
-000080c0: 6368 696e 6520 4c65 6172 6e69 6e67 2061  chine Learning a
-000080d0: 6e64 2074 6865 2050 6879 7369 6361 6c20  nd the Physical 
-000080e0: 5363 6965 6e63 6573 2077 6f72 6b73 686f  Sciences worksho
-000080f0: 7020 6174 204e 6575 7249 5053 2032 3031  p at NeurIPS 201
-00008100: 392e 2032 3032 302e 2068 7474 7073 3a2f  9. 2020. https:/
-00008110: 2f61 7278 6976 2e6f 7267 2f61 6273 2f32  /arxiv.org/abs/2
-00008120: 3030 322e 3038 3236 340a 2020 2020 2e2e  002.08264.    ..
-00008130: 205b 325d 2041 6e61 6c79 7a69 6e67 204c   [2] Analyzing L
-00008140: 6561 726e 6564 204d 6f6c 6563 756c 6172  earned Molecular
-00008150: 2052 6570 7265 7365 6e74 6174 696f 6e73   Representations
-00008160: 2066 6f72 2050 726f 7065 7274 7920 5072   for Property Pr
-00008170: 6564 6963 7469 6f6e 2068 7474 7073 3a2f  ediction https:/
-00008180: 2f61 7278 6976 2e6f 7267 2f70 6466 2f31  /arxiv.org/pdf/1
-00008190: 3930 342e 3031 3536 312e 7064 660a 0a20  904.01561.pdf.. 
-000081a0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
-000081b0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e  --------.    >>>
-000081c0: 2066 726f 6d20 6465 6570 6368 656d 2e6d   from deepchem.m
-000081d0: 6f64 656c 732e 746f 7263 685f 6d6f 6465  odels.torch_mode
-000081e0: 6c73 2e6c 6179 6572 7320 696d 706f 7274  ls.layers import
-000081f0: 2050 6f73 6974 696f 6e77 6973 6546 6565   PositionwiseFee
-00008200: 6446 6f72 7761 7264 0a20 2020 203e 3e3e  dForward.    >>>
-00008210: 2066 6565 645f 6677 645f 6c61 7965 7220   feed_fwd_layer 
-00008220: 3d20 506f 7369 7469 6f6e 7769 7365 4665  = PositionwiseFe
-00008230: 6564 466f 7277 6172 6428 645f 696e 7075  edForward(d_inpu
-00008240: 7420 3d20 322c 2064 5f68 6964 6465 6e20  t = 2, d_hidden 
-00008250: 3d20 322c 2064 5f6f 7574 7075 7420 3d20  = 2, d_output = 
-00008260: 322c 2061 6374 6976 6174 696f 6e20 3d20  2, activation = 
-00008270: 2772 656c 7527 2c20 6e5f 6c61 7965 7273  'relu', n_layers
-00008280: 203d 2031 2c20 6472 6f70 6f75 745f 7020   = 1, dropout_p 
-00008290: 3d20 302e 3129 0a20 2020 203e 3e3e 2069  = 0.1).    >>> i
-000082a0: 6e70 7574 5f74 656e 736f 7220 3d20 746f  nput_tensor = to
-000082b0: 7263 682e 7465 6e73 6f72 285b 5b31 2e2c  rch.tensor([[1.,
-000082c0: 2032 2e5d 2c20 5b35 2e2c 2036 2e5d 5d29   2.], [5., 6.]])
-000082d0: 0a20 2020 203e 3e3e 206f 7574 7075 745f  .    >>> output_
-000082e0: 7465 6e73 6f72 203d 2066 6565 645f 6677  tensor = feed_fw
-000082f0: 645f 6c61 7965 7228 696e 7075 745f 7465  d_layer(input_te
-00008300: 6e73 6f72 290a 2020 2222 220a 0a20 2020  nsor).  """..   
-00008310: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00008320: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00008330: 2020 2020 2064 5f69 6e70 7574 3a20 696e       d_input: in
-00008340: 7420 3d20 3130 3234 2c0a 2020 2020 2020  t = 1024,.      
-00008350: 2020 2020 2020 2020 2020 2064 5f68 6964             d_hid
-00008360: 6465 6e3a 2069 6e74 203d 2031 3032 342c  den: int = 1024,
-00008370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008380: 2020 645f 6f75 7470 7574 3a20 696e 7420    d_output: int 
-00008390: 3d20 3130 3234 2c0a 2020 2020 2020 2020  = 1024,.        
-000083a0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
-000083b0: 696f 6e3a 2073 7472 203d 2027 6c65 616b  ion: str = 'leak
-000083c0: 7972 656c 7527 2c0a 2020 2020 2020 2020  yrelu',.        
-000083d0: 2020 2020 2020 2020 206e 5f6c 6179 6572           n_layer
-000083e0: 733a 2069 6e74 203d 2031 2c0a 2020 2020  s: int = 1,.    
-000083f0: 2020 2020 2020 2020 2020 2020 2064 726f               dro
-00008400: 706f 7574 5f70 3a20 666c 6f61 7420 3d20  pout_p: float = 
-00008410: 302e 302c 0a20 2020 2020 2020 2020 2020  0.0,.           
-00008420: 2020 2020 2020 6472 6f70 6f75 745f 6174        dropout_at
-00008430: 5f69 6e70 7574 5f6e 6f5f 6163 743a 2062  _input_no_act: b
-00008440: 6f6f 6c20 3d20 4661 6c73 6529 3a0a 2020  ool = False):.  
-00008450: 2020 2020 2020 2222 2249 6e69 7469 616c        """Initial
-00008460: 697a 6520 6120 506f 7369 7469 6f6e 7769  ize a Positionwi
-00008470: 7365 4665 6564 466f 7277 6172 6420 6c61  seFeedForward la
-00008480: 7965 722e 0a0a 2020 2020 2020 2020 5061  yer...        Pa
-00008490: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-000084a0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-000084b0: 2020 2020 645f 696e 7075 743a 2069 6e74      d_input: int
-000084c0: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
-000084d0: 6520 6f66 2069 6e70 7574 206c 6179 6572  e of input layer
-000084e0: 2e0a 2020 2020 2020 2020 645f 6869 6464  ..        d_hidd
-000084f0: 656e 3a20 696e 7420 2873 616d 6520 6173  en: int (same as
-00008500: 2064 5f69 6e70 7574 2069 6620 645f 6f75   d_input if d_ou
-00008510: 7470 7574 203d 2030 290a 2020 2020 2020  tput = 0).      
-00008520: 2020 2020 2020 5369 7a65 206f 6620 6869        Size of hi
-00008530: 6464 656e 206c 6179 6572 2e0a 2020 2020  dden layer..    
-00008540: 2020 2020 645f 6f75 7470 7574 3a20 696e      d_output: in
-00008550: 7420 2873 616d 6520 6173 2064 5f69 6e70  t (same as d_inp
-00008560: 7574 2069 6620 645f 6f75 7470 7574 203d  ut if d_output =
-00008570: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
-00008580: 5369 7a65 206f 6620 6f75 7470 7574 206c  Size of output l
-00008590: 6179 6572 2e0a 2020 2020 2020 2020 6163  ayer..        ac
-000085a0: 7469 7661 7469 6f6e 3a20 7374 720a 2020  tivation: str.  
-000085b0: 2020 2020 2020 2020 2020 4163 7469 7661            Activa
-000085c0: 7469 6f6e 2066 756e 6374 696f 6e20 746f  tion function to
-000085d0: 2062 6520 7573 6564 2e20 4361 6e20 6368   be used. Can ch
-000085e0: 6f6f 7365 2062 6574 7765 656e 2027 7265  oose between 're
-000085f0: 6c75 2720 666f 7220 5265 4c55 2c20 276c  lu' for ReLU, 'l
-00008600: 6561 6b79 7265 6c75 2720 666f 7220 4c65  eakyrelu' for Le
-00008610: 616b 7952 654c 552c 2027 7072 656c 7527  akyReLU, 'prelu'
-00008620: 2066 6f72 2050 5265 4c55 2c0a 2020 2020   for PReLU,.    
-00008630: 2020 2020 2020 2020 2774 616e 6827 2066          'tanh' f
-00008640: 6f72 2054 616e 482c 2027 7365 6c75 2720  or TanH, 'selu' 
-00008650: 666f 7220 5345 4c55 2c20 2765 6c75 2720  for SELU, 'elu' 
-00008660: 666f 7220 454c 5520 616e 6420 276c 696e  for ELU and 'lin
-00008670: 6561 7227 2066 6f72 206c 696e 6561 7220  ear' for linear 
-00008680: 6163 7469 7661 7469 6f6e 2e0a 2020 2020  activation..    
-00008690: 2020 2020 6e5f 6c61 7965 7273 3a20 696e      n_layers: in
-000086a0: 740a 2020 2020 2020 2020 2020 2020 4e75  t.            Nu
-000086b0: 6d62 6572 206f 6620 6c61 7965 7273 2e0a  mber of layers..
-000086c0: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
-000086d0: 703a 2066 6c6f 6174 0a20 2020 2020 2020  p: float.       
-000086e0: 2020 2020 2044 726f 706f 7574 2070 726f       Dropout pro
-000086f0: 6261 6269 6c69 7479 2e0a 2020 2020 2020  bability..      
-00008700: 2020 6472 6f70 6f75 745f 6174 5f69 6e70    dropout_at_inp
-00008710: 7574 5f6e 6f5f 6163 743a 2062 6f6f 6c0a  ut_no_act: bool.
-00008720: 2020 2020 2020 2020 2020 2020 4966 2074              If t
-00008730: 7275 652c 2064 726f 706f 7574 2069 7320  rue, dropout is 
-00008740: 6170 706c 6965 6420 6f6e 2074 6865 2069  applied on the i
-00008750: 6e70 7574 2074 656e 736f 722e 2046 6f72  nput tensor. For
-00008760: 2073 696e 676c 6520 6c61 7965 722c 2069   single layer, i
-00008770: 7420 6973 206e 6f74 2070 6173 7365 6420  t is not passed 
-00008780: 746f 2061 6e20 6163 7469 7661 7469 6f6e  to an activation
-00008790: 2066 756e 6374 696f 6e2e 0a20 2020 2020   function..     
-000087a0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
-000087b0: 7570 6572 2850 6f73 6974 696f 6e77 6973  uper(Positionwis
-000087c0: 6546 6565 6446 6f72 7761 7264 2c20 7365  eFeedForward, se
-000087d0: 6c66 292e 5f5f 696e 6974 5f5f 2829 0a0a  lf).__init__()..
-000087e0: 2020 2020 2020 2020 7365 6c66 2e64 726f          self.dro
-000087f0: 706f 7574 5f61 745f 696e 7075 745f 6e6f  pout_at_input_no
-00008800: 5f61 6374 3a20 626f 6f6c 203d 2064 726f  _act: bool = dro
-00008810: 706f 7574 5f61 745f 696e 7075 745f 6e6f  pout_at_input_no
-00008820: 5f61 6374 0a0a 2020 2020 2020 2020 6966  _act..        if
-00008830: 2061 6374 6976 6174 696f 6e20 3d3d 2027   activation == '
-00008840: 7265 6c75 273a 0a20 2020 2020 2020 2020  relu':.         
-00008850: 2020 2073 656c 662e 6163 7469 7661 7469     self.activati
-00008860: 6f6e 3a20 416e 7920 3d20 6e6e 2e52 654c  on: Any = nn.ReL
-00008870: 5528 290a 0a20 2020 2020 2020 2065 6c69  U()..        eli
-00008880: 6620 6163 7469 7661 7469 6f6e 203d 3d20  f activation == 
-00008890: 276c 6561 6b79 7265 6c75 273a 0a20 2020  'leakyrelu':.   
-000088a0: 2020 2020 2020 2020 2073 656c 662e 6163           self.ac
-000088b0: 7469 7661 7469 6f6e 203d 206e 6e2e 4c65  tivation = nn.Le
-000088c0: 616b 7952 654c 5528 302e 3129 0a0a 2020  akyReLU(0.1)..  
-000088d0: 2020 2020 2020 656c 6966 2061 6374 6976        elif activ
-000088e0: 6174 696f 6e20 3d3d 2027 7072 656c 7527  ation == 'prelu'
-000088f0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00008900: 6c66 2e61 6374 6976 6174 696f 6e20 3d20  lf.activation = 
-00008910: 6e6e 2e50 5265 4c55 2829 0a0a 2020 2020  nn.PReLU()..    
-00008920: 2020 2020 656c 6966 2061 6374 6976 6174      elif activat
-00008930: 696f 6e20 3d3d 2027 7461 6e68 273a 0a20  ion == 'tanh':. 
-00008940: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008950: 6163 7469 7661 7469 6f6e 203d 206e 6e2e  activation = nn.
-00008960: 5461 6e68 2829 0a0a 2020 2020 2020 2020  Tanh()..        
-00008970: 656c 6966 2061 6374 6976 6174 696f 6e20  elif activation 
-00008980: 3d3d 2027 7365 6c75 273a 0a20 2020 2020  == 'selu':.     
-00008990: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
-000089a0: 7661 7469 6f6e 203d 206e 6e2e 5345 4c55  vation = nn.SELU
-000089b0: 2829 0a0a 2020 2020 2020 2020 656c 6966  ()..        elif
-000089c0: 2061 6374 6976 6174 696f 6e20 3d3d 2027   activation == '
-000089d0: 656c 7527 3a0a 2020 2020 2020 2020 2020  elu':.          
-000089e0: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
-000089f0: 6e20 3d20 6e6e 2e45 4c55 2829 0a0a 2020  n = nn.ELU()..  
-00008a00: 2020 2020 2020 656c 6966 2061 6374 6976        elif activ
-00008a10: 6174 696f 6e20 3d3d 2022 6c69 6e65 6172  ation == "linear
-00008a20: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-00008a30: 656c 662e 6163 7469 7661 7469 6f6e 203d  elf.activation =
-00008a40: 206c 616d 6264 6120 783a 2078 0a0a 2020   lambda x: x..  
-00008a50: 2020 2020 2020 7365 6c66 2e6e 5f6c 6179        self.n_lay
-00008a60: 6572 733a 2069 6e74 203d 206e 5f6c 6179  ers: int = n_lay
-00008a70: 6572 730a 2020 2020 2020 2020 645f 6f75  ers.        d_ou
-00008a80: 7470 7574 203d 2064 5f6f 7574 7075 7420  tput = d_output 
-00008a90: 6966 2064 5f6f 7574 7075 7420 213d 2030  if d_output != 0
-00008aa0: 2065 6c73 6520 645f 696e 7075 740a 2020   else d_input.  
-00008ab0: 2020 2020 2020 645f 6869 6464 656e 203d        d_hidden =
-00008ac0: 2064 5f68 6964 6465 6e20 6966 2064 5f68   d_hidden if d_h
-00008ad0: 6964 6465 6e20 213d 2030 2065 6c73 6520  idden != 0 else 
-00008ae0: 645f 696e 7075 740a 0a20 2020 2020 2020  d_input..       
-00008af0: 2069 6620 6e5f 6c61 7965 7273 203d 3d20   if n_layers == 
-00008b00: 313a 0a20 2020 2020 2020 2020 2020 2073  1:.            s
-00008b10: 656c 662e 6c69 6e65 6172 733a 2041 6e79  elf.linears: Any
-00008b20: 203d 205b 6e6e 2e4c 696e 6561 7228 645f   = [nn.Linear(d_
-00008b30: 696e 7075 742c 2064 5f6f 7574 7075 7429  input, d_output)
-00008b40: 5d0a 0a20 2020 2020 2020 2065 6c73 653a  ]..        else:
-00008b50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008b60: 662e 6c69 6e65 6172 7320 3d20 5b6e 6e2e  f.linears = [nn.
-00008b70: 4c69 6e65 6172 2864 5f69 6e70 7574 2c20  Linear(d_input, 
-00008b80: 645f 6869 6464 656e 295d 202b 205c 0a20  d_hidden)] + \. 
-00008b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ba0: 2020 2020 2020 2020 2020 205b 6e6e 2e4c             [nn.L
-00008bb0: 696e 6561 7228 645f 6869 6464 656e 2c20  inear(d_hidden, 
-00008bc0: 645f 6869 6464 656e 2920 666f 7220 5f20  d_hidden) for _ 
-00008bd0: 696e 2072 616e 6765 286e 5f6c 6179 6572  in range(n_layer
-00008be0: 7320 2d20 3229 5d20 2b20 5c0a 2020 2020  s - 2)] + \.    
-00008bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c00: 2020 2020 2020 2020 5b6e 6e2e 4c69 6e65          [nn.Line
-00008c10: 6172 2864 5f68 6964 6465 6e2c 2064 5f6f  ar(d_hidden, d_o
-00008c20: 7574 7075 7429 5d0a 0a20 2020 2020 2020  utput)]..       
-00008c30: 2073 656c 662e 6c69 6e65 6172 7320 3d20   self.linears = 
-00008c40: 6e6e 2e4d 6f64 756c 654c 6973 7428 7365  nn.ModuleList(se
-00008c50: 6c66 2e6c 696e 6561 7273 290a 2020 2020  lf.linears).    
-00008c60: 2020 2020 6472 6f70 6f75 745f 6c61 7965      dropout_laye
-00008c70: 7220 3d20 6e6e 2e44 726f 706f 7574 2864  r = nn.Dropout(d
-00008c80: 726f 706f 7574 5f70 290a 2020 2020 2020  ropout_p).      
-00008c90: 2020 7365 6c66 2e64 726f 706f 7574 5f70    self.dropout_p
-00008ca0: 203d 206e 6e2e 4d6f 6475 6c65 4c69 7374   = nn.ModuleList
-00008cb0: 285b 6472 6f70 6f75 745f 6c61 7965 7220  ([dropout_layer 
-00008cc0: 666f 7220 5f20 696e 2072 616e 6765 286e  for _ in range(n
-00008cd0: 5f6c 6179 6572 7329 5d29 0a0a 2020 2020  _layers)])..    
-00008ce0: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
-00008cf0: 2c20 783a 2074 6f72 6368 2e54 656e 736f  , x: torch.Tenso
-00008d00: 7229 202d 3e20 746f 7263 682e 5465 6e73  r) -> torch.Tens
-00008d10: 6f72 3a0a 2020 2020 2020 2020 2222 224f  or:.        """O
-00008d20: 7574 7075 7420 436f 6d70 7574 6174 696f  utput Computatio
-00008d30: 6e20 666f 7220 7468 6520 506f 7369 7469  n for the Positi
-00008d40: 6f6e 7769 7365 4665 6564 466f 7277 6172  onwiseFeedForwar
-00008d50: 6420 6c61 7965 722e 0a0a 2020 2020 2020  d layer...      
-00008d60: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00008d70: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00008d80: 2020 2020 2020 2020 783a 2074 6f72 6368          x: torch
-00008d90: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-00008da0: 2020 2020 496e 7075 7420 7465 6e73 6f72      Input tensor
-00008db0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00008dc0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00008dd0: 662e 6e5f 6c61 7965 7273 3a0a 2020 2020  f.n_layers:.    
-00008de0: 2020 2020 2020 2020 7265 7475 726e 2078          return x
-00008df0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00008e00: 662e 6e5f 6c61 7965 7273 203d 3d20 313a  f.n_layers == 1:
-00008e10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00008e20: 7365 6c66 2e64 726f 706f 7574 5f61 745f  self.dropout_at_
-00008e30: 696e 7075 745f 6e6f 5f61 6374 3a0a 2020  input_no_act:.  
-00008e40: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00008e50: 7475 726e 2073 656c 662e 6c69 6e65 6172  turn self.linear
-00008e60: 735b 305d 2873 656c 662e 6472 6f70 6f75  s[0](self.dropou
-00008e70: 745f 705b 305d 2878 2929 0a20 2020 2020  t_p[0](x)).     
-00008e80: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00008e90: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00008ea0: 7572 6e20 7365 6c66 2e64 726f 706f 7574  urn self.dropout
-00008eb0: 5f70 5b30 5d28 7365 6c66 2e61 6374 6976  _p[0](self.activ
-00008ec0: 6174 696f 6e28 7365 6c66 2e6c 696e 6561  ation(self.linea
-00008ed0: 7273 5b30 5d28 7829 2929 0a0a 2020 2020  rs[0](x)))..    
-00008ee0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00008ef0: 2020 2020 2020 6966 2073 656c 662e 6472        if self.dr
-00008f00: 6f70 6f75 745f 6174 5f69 6e70 7574 5f6e  opout_at_input_n
-00008f10: 6f5f 6163 743a 0a20 2020 2020 2020 2020  o_act:.         
-00008f20: 2020 2020 2020 2078 203d 2073 656c 662e         x = self.
-00008f30: 6472 6f70 6f75 745f 705b 305d 2878 290a  dropout_p[0](x).
-00008f40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00008f50: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
-00008f60: 6e5f 6c61 7965 7273 202d 2031 293a 0a20  n_layers - 1):. 
-00008f70: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-00008f80: 203d 2073 656c 662e 6472 6f70 6f75 745f   = self.dropout_
-00008f90: 705b 695d 2873 656c 662e 6163 7469 7661  p[i](self.activa
-00008fa0: 7469 6f6e 2873 656c 662e 6c69 6e65 6172  tion(self.linear
-00008fb0: 735b 695d 2878 2929 290a 2020 2020 2020  s[i](x))).      
-00008fc0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00008fd0: 662e 6c69 6e65 6172 735b 2d31 5d28 7829  f.linears[-1](x)
-00008fe0: 0a0a 0a63 6c61 7373 204d 4154 456d 6265  ...class MATEmbe
-00008ff0: 6464 696e 6728 6e6e 2e4d 6f64 756c 6529  dding(nn.Module)
-00009000: 3a0a 2020 2020 2222 2245 6d62 6564 6469  :.    """Embeddi
-00009010: 6e67 206c 6179 6572 2074 6f20 6372 6561  ng layer to crea
-00009020: 7465 2065 6d62 6564 6469 6e67 2066 6f72  te embedding for
-00009030: 2069 6e70 7574 732e 0a0a 2020 2020 496e   inputs...    In
-00009040: 2061 6e20 656d 6265 6464 696e 6720 6c61   an embedding la
-00009050: 7965 722c 2069 6e70 7574 2069 7320 7461  yer, input is ta
-00009060: 6b65 6e20 616e 6420 636f 6e76 6572 7465  ken and converte
-00009070: 6420 746f 2061 2076 6563 746f 7220 7265  d to a vector re
-00009080: 7072 6573 656e 7461 7469 6f6e 2066 6f72  presentation for
-00009090: 2065 6163 6820 696e 7075 742e 0a20 2020   each input..   
-000090a0: 2049 6e20 7468 6520 4d41 5445 6d62 6564   In the MATEmbed
-000090b0: 6469 6e67 206c 6179 6572 2c20 616e 2069  ding layer, an i
-000090c0: 6e70 7574 2074 656e 736f 7220 6973 2070  nput tensor is p
-000090d0: 726f 6365 7373 6564 2074 6872 6f75 6768  rocessed through
-000090e0: 2061 2064 726f 706f 7574 2d61 646a 7573   a dropout-adjus
-000090f0: 7465 6420 6c69 6e65 6172 206c 6179 6572  ted linear layer
-00009100: 2061 6e64 2074 6865 2072 6573 756c 7461   and the resulta
-00009110: 6e74 2076 6563 746f 7220 6973 2072 6574  nt vector is ret
-00009120: 7572 6e65 642e 0a0a 2020 2020 5265 6665  urned...    Refe
-00009130: 7265 6e63 6573 0a20 2020 202d 2d2d 2d2d  rences.    -----
-00009140: 2d2d 2d2d 2d0a 2020 2020 2e2e 205b 315d  -----.    .. [1]
-00009150: 204c 756b 6173 7a20 4d61 7a69 6172 6b61   Lukasz Maziarka
-00009160: 2065 7420 616c 2e20 224d 6f6c 6563 756c   et al. "Molecul
-00009170: 6520 4174 7465 6e74 696f 6e20 5472 616e  e Attention Tran
-00009180: 7366 6f72 6d65 7222 2047 7261 7068 2052  sformer" Graph R
-00009190: 6570 7265 7365 6e74 6174 696f 6e20 4c65  epresentation Le
-000091a0: 6172 6e69 6e67 2077 6f72 6b73 686f 7020  arning workshop 
-000091b0: 616e 6420 4d61 6368 696e 6520 4c65 6172  and Machine Lear
-000091c0: 6e69 6e67 2061 6e64 2074 6865 2050 6879  ning and the Phy
-000091d0: 7369 6361 6c20 5363 6965 6e63 6573 2077  sical Sciences w
-000091e0: 6f72 6b73 686f 7020 6174 204e 6575 7249  orkshop at NeurI
-000091f0: 5053 2032 3031 392e 2032 3032 302e 2068  PS 2019. 2020. h
-00009200: 7474 7073 3a2f 2f61 7278 6976 2e6f 7267  ttps://arxiv.org
-00009210: 2f61 6273 2f32 3030 322e 3038 3236 340a  /abs/2002.08264.
-00009220: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
-00009230: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
-00009240: 3e3e 2066 726f 6d20 6465 6570 6368 656d  >> from deepchem
-00009250: 2e6d 6f64 656c 732e 746f 7263 685f 6d6f  .models.torch_mo
-00009260: 6465 6c73 2e6c 6179 6572 7320 696d 706f  dels.layers impo
-00009270: 7274 204d 4154 456d 6265 6464 696e 670a  rt MATEmbedding.
-00009280: 2020 2020 3e3e 3e20 6c61 7965 7220 3d20      >>> layer = 
-00009290: 4d41 5445 6d62 6564 6469 6e67 2864 5f69  MATEmbedding(d_i
-000092a0: 6e70 7574 203d 2033 2c20 645f 6f75 7470  nput = 3, d_outp
-000092b0: 7574 203d 2033 2c20 6472 6f70 6f75 745f  ut = 3, dropout_
-000092c0: 7020 3d20 302e 3229 0a20 2020 203e 3e3e  p = 0.2).    >>>
-000092d0: 2069 6e70 7574 5f74 656e 736f 7220 3d20   input_tensor = 
-000092e0: 746f 7263 682e 7465 6e73 6f72 285b 312e  torch.tensor([1.
-000092f0: 2c20 322e 2c20 332e 5d29 0a20 2020 203e  , 2., 3.]).    >
-00009300: 3e3e 206f 7574 7075 7420 3d20 6c61 7965  >> output = laye
-00009310: 7228 696e 7075 745f 7465 6e73 6f72 290a  r(input_tensor).
-00009320: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-00009330: 205f 5f69 6e69 745f 5f28 7365 6c66 2c0a   __init__(self,.
-00009340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009350: 2064 5f69 6e70 7574 3a20 696e 7420 3d20   d_input: int = 
-00009360: 3336 2c0a 2020 2020 2020 2020 2020 2020  36,.            
-00009370: 2020 2020 2064 5f6f 7574 7075 743a 2069       d_output: i
-00009380: 6e74 203d 2031 3032 342c 0a20 2020 2020  nt = 1024,.     
-00009390: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
-000093a0: 6f75 745f 703a 2066 6c6f 6174 203d 2030  out_p: float = 0
-000093b0: 2e30 293a 0a20 2020 2020 2020 2022 2222  .0):.        """
-000093c0: 496e 6974 6961 6c69 7a65 2061 204d 4154  Initialize a MAT
-000093d0: 456d 6265 6464 696e 6720 6c61 7965 722e  Embedding layer.
-000093e0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-000093f0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-00009400: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00009410: 645f 696e 7075 743a 2069 6e74 0a20 2020  d_input: int.   
-00009420: 2020 2020 2020 2020 2053 697a 6520 6f66           Size of
-00009430: 2069 6e70 7574 206c 6179 6572 2e0a 2020   input layer..  
-00009440: 2020 2020 2020 645f 6f75 7470 7574 3a20        d_output: 
-00009450: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-00009460: 5369 7a65 206f 6620 6f75 7470 7574 206c  Size of output l
-00009470: 6179 6572 2e0a 2020 2020 2020 2020 6472  ayer..        dr
-00009480: 6f70 6f75 745f 703a 2066 6c6f 6174 0a20  opout_p: float. 
-00009490: 2020 2020 2020 2020 2020 2044 726f 706f             Dropo
-000094a0: 7574 2070 726f 6261 6269 6c69 7479 2066  ut probability f
-000094b0: 6f72 206c 6179 6572 2e0a 2020 2020 2020  or layer..      
-000094c0: 2020 2222 220a 2020 2020 2020 2020 7375    """.        su
-000094d0: 7065 7228 4d41 5445 6d62 6564 6469 6e67  per(MATEmbedding
-000094e0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-000094f0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00009500: 6c69 6e65 6172 5f75 6e69 7420 3d20 6e6e  linear_unit = nn
-00009510: 2e4c 696e 6561 7228 645f 696e 7075 742c  .Linear(d_input,
-00009520: 2064 5f6f 7574 7075 7429 0a20 2020 2020   d_output).     
-00009530: 2020 2073 656c 662e 6472 6f70 6f75 7420     self.dropout 
-00009540: 3d20 6e6e 2e44 726f 706f 7574 2864 726f  = nn.Dropout(dro
-00009550: 706f 7574 5f70 290a 0a20 2020 2064 6566  pout_p)..    def
-00009560: 2066 6f72 7761 7264 2873 656c 662c 2078   forward(self, x
-00009570: 3a20 746f 7263 682e 5465 6e73 6f72 2920  : torch.Tensor) 
-00009580: 2d3e 2074 6f72 6368 2e54 656e 736f 723a  -> torch.Tensor:
-00009590: 0a20 2020 2020 2020 2022 2222 436f 6d70  .        """Comp
-000095a0: 7574 6174 696f 6e20 666f 7220 7468 6520  utation for the 
-000095b0: 4d41 5445 6d62 6564 6469 6e67 206c 6179  MATEmbedding lay
-000095c0: 6572 2e0a 0a20 2020 2020 2020 2050 6172  er...        Par
-000095d0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-000095e0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-000095f0: 2020 2078 3a20 746f 7263 682e 5465 6e73     x: torch.Tens
-00009600: 6f72 0a20 2020 2020 2020 2020 2020 2049  or.            I
-00009610: 6e70 7574 2074 656e 736f 7220 746f 2062  nput tensor to b
-00009620: 6520 636f 6e76 6572 7465 6420 696e 746f  e converted into
-00009630: 2061 2076 6563 746f 722e 0a20 2020 2020   a vector..     
-00009640: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00009650: 6574 7572 6e20 7365 6c66 2e64 726f 706f  eturn self.dropo
-00009660: 7574 2873 656c 662e 6c69 6e65 6172 5f75  ut(self.linear_u
-00009670: 6e69 7428 7829 290a 0a0a 636c 6173 7320  nit(x))...class 
-00009680: 4d41 5447 656e 6572 6174 6f72 286e 6e2e  MATGenerator(nn.
-00009690: 4d6f 6475 6c65 293a 0a20 2020 2022 2222  Module):.    """
-000096a0: 4d41 5447 656e 6572 6174 6f72 2064 6566  MATGenerator def
-000096b0: 696e 6573 2074 6865 206c 696e 6561 7220  ines the linear 
-000096c0: 616e 6420 736f 6674 6d61 7820 6765 6e65  and softmax gene
-000096d0: 7261 746f 7220 7374 6570 2066 6f72 2074  rator step for t
-000096e0: 6865 204d 6f6c 6563 756c 6172 2041 7474  he Molecular Att
-000096f0: 656e 7469 6f6e 2054 7261 6e73 666f 726d  ention Transform
-00009700: 6572 205b 315d 5f2e 0a0a 2020 2020 496e  er [1]_...    In
-00009710: 2074 6865 204d 4154 4765 6e65 7261 746f   the MATGenerato
-00009720: 722c 2061 2047 656e 6572 6174 6f72 2069  r, a Generator i
-00009730: 7320 6465 6669 6e65 6420 7768 6963 6820  s defined which 
-00009740: 7065 7266 6f72 6d73 2074 6865 204c 696e  performs the Lin
-00009750: 6561 7220 2b20 536f 6674 6d61 7820 6765  ear + Softmax ge
-00009760: 6e65 7261 7469 6f6e 2073 7465 702e 0a20  neration step.. 
-00009770: 2020 2044 6570 656e 6469 6e67 206f 6e20     Depending on 
-00009780: 7468 6520 7479 7065 206f 6620 6167 6772  the type of aggr
-00009790: 6567 6174 696f 6e20 7365 6c65 6374 6564  egation selected
-000097a0: 2c20 7468 6520 6174 7465 6e74 696f 6e20  , the attention 
-000097b0: 6f75 7470 7574 206c 6179 6572 2070 6572  output layer per
-000097c0: 666f 726d 7320 6469 6666 6572 656e 7420  forms different 
-000097d0: 6f70 6572 6174 696f 6e73 2e0a 0a20 2020  operations...   
-000097e0: 2052 6566 6572 656e 6365 730a 2020 2020   References.    
-000097f0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 202e  ----------.    .
-00009800: 2e20 5b31 5d20 4c75 6b61 737a 204d 617a  . [1] Lukasz Maz
-00009810: 6961 726b 6120 6574 2061 6c2e 2022 4d6f  iarka et al. "Mo
-00009820: 6c65 6375 6c65 2041 7474 656e 7469 6f6e  lecule Attention
-00009830: 2054 7261 6e73 666f 726d 6572 2220 4772   Transformer" Gr
-00009840: 6170 6820 5265 7072 6573 656e 7461 7469  aph Representati
-00009850: 6f6e 204c 6561 726e 696e 6720 776f 726b  on Learning work
-00009860: 7368 6f70 2061 6e64 204d 6163 6869 6e65  shop and Machine
-00009870: 204c 6561 726e 696e 6720 616e 6420 7468   Learning and th
-00009880: 6520 5068 7973 6963 616c 2053 6369 656e  e Physical Scien
-00009890: 6365 7320 776f 726b 7368 6f70 2061 7420  ces workshop at 
-000098a0: 4e65 7572 4950 5320 3230 3139 2e20 3230  NeurIPS 2019. 20
-000098b0: 3230 2e20 6874 7470 733a 2f2f 6172 7869  20. https://arxi
-000098c0: 762e 6f72 672f 6162 732f 3230 3032 2e30  v.org/abs/2002.0
-000098d0: 3832 3634 0a0a 2020 2020 4578 616d 706c  8264..    Exampl
-000098e0: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
-000098f0: 2020 2020 3e3e 3e20 6672 6f6d 2064 6565      >>> from dee
-00009900: 7063 6865 6d2e 6d6f 6465 6c73 2e74 6f72  pchem.models.tor
-00009910: 6368 5f6d 6f64 656c 732e 6c61 7965 7273  ch_models.layers
-00009920: 2069 6d70 6f72 7420 4d41 5447 656e 6572   import MATGener
-00009930: 6174 6f72 0a20 2020 203e 3e3e 206c 6179  ator.    >>> lay
-00009940: 6572 203d 204d 4154 4765 6e65 7261 746f  er = MATGenerato
-00009950: 7228 6873 697a 6520 3d20 332c 2061 6767  r(hsize = 3, agg
-00009960: 7265 6761 7469 6f6e 5f74 7970 6520 3d20  regation_type = 
-00009970: 276d 6561 6e27 2c20 645f 6f75 7470 7574  'mean', d_output
-00009980: 203d 2031 2c20 6e5f 6c61 7965 7273 203d   = 1, n_layers =
-00009990: 2031 2c20 6472 6f70 6f75 745f 7020 3d20   1, dropout_p = 
-000099a0: 302e 332c 2061 7474 6e5f 6869 6464 656e  0.3, attn_hidden
-000099b0: 203d 2031 3238 2c20 6174 746e 5f6f 7574   = 128, attn_out
-000099c0: 203d 2034 290a 2020 2020 3e3e 3e20 696e   = 4).    >>> in
-000099d0: 7075 745f 7465 6e73 6f72 203d 2074 6f72  put_tensor = tor
-000099e0: 6368 2e74 656e 736f 7228 5b31 2e2c 2032  ch.tensor([1., 2
-000099f0: 2e2c 2033 2e5d 290a 2020 2020 3e3e 3e20  ., 3.]).    >>> 
-00009a00: 6d61 736b 203d 2074 6f72 6368 2e74 656e  mask = torch.ten
-00009a10: 736f 7228 5b31 2e2c 2031 2e2c 2031 2e5d  sor([1., 1., 1.]
-00009a20: 290a 2020 2020 3e3e 3e20 6f75 7470 7574  ).    >>> output
-00009a30: 203d 206c 6179 6572 2869 6e70 7574 5f74   = layer(input_t
-00009a40: 656e 736f 722c 206d 6173 6b29 0a20 2020  ensor, mask).   
-00009a50: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
-00009a60: 696e 6974 5f5f 2873 656c 662c 0a20 2020  init__(self,.   
-00009a70: 2020 2020 2020 2020 2020 2020 2020 6873                hs
-00009a80: 697a 653a 2069 6e74 203d 2031 3032 342c  ize: int = 1024,
-00009a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009aa0: 2020 6167 6772 6567 6174 696f 6e5f 7479    aggregation_ty
-00009ab0: 7065 3a20 7374 7220 3d20 276d 6561 6e27  pe: str = 'mean'
-00009ac0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009ad0: 2020 2064 5f6f 7574 7075 743a 2069 6e74     d_output: int
-00009ae0: 203d 2031 2c0a 2020 2020 2020 2020 2020   = 1,.          
-00009af0: 2020 2020 2020 206e 5f6c 6179 6572 733a         n_layers:
-00009b00: 2069 6e74 203d 2031 2c0a 2020 2020 2020   int = 1,.      
-00009b10: 2020 2020 2020 2020 2020 2064 726f 706f             dropo
-00009b20: 7574 5f70 3a20 666c 6f61 7420 3d20 302e  ut_p: float = 0.
-00009b30: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-00009b40: 2020 2020 6174 746e 5f68 6964 6465 6e3a      attn_hidden:
-00009b50: 2069 6e74 203d 2031 3238 2c0a 2020 2020   int = 128,.    
-00009b60: 2020 2020 2020 2020 2020 2020 2061 7474               att
-00009b70: 6e5f 6f75 743a 2069 6e74 203d 2034 293a  n_out: int = 4):
-00009b80: 0a20 2020 2020 2020 2022 2222 496e 6974  .        """Init
-00009b90: 6961 6c69 7a65 2061 204d 4154 4765 6e65  ialize a MATGene
-00009ba0: 7261 746f 722e 0a0a 2020 2020 2020 2020  rator...        
-00009bb0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00009bc0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00009bd0: 2020 2020 2020 6873 697a 653a 2069 6e74        hsize: int
-00009be0: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
-00009bf0: 6520 6f66 2069 6e70 7574 206c 6179 6572  e of input layer
-00009c00: 2e0a 2020 2020 2020 2020 6167 6772 6567  ..        aggreg
-00009c10: 6174 696f 6e5f 7479 7065 3a20 7374 720a  ation_type: str.
-00009c20: 2020 2020 2020 2020 2020 2020 5479 7065              Type
-00009c30: 206f 6620 6167 6772 6567 6174 696f 6e20   of aggregation 
-00009c40: 746f 2062 6520 7573 6564 2e20 4361 6e20  to be used. Can 
-00009c50: 6265 2027 6772 6f76 6572 272c 2027 6d65  be 'grover', 'me
-00009c60: 616e 2720 6f72 2027 636f 6e74 6578 7475  an' or 'contextu
-00009c70: 616c 272e 0a20 2020 2020 2020 2064 5f6f  al'..        d_o
-00009c80: 7574 7075 743a 2069 6e74 0a20 2020 2020  utput: int.     
-00009c90: 2020 2020 2020 2053 697a 6520 6f66 206f         Size of o
-00009ca0: 7574 7075 7420 6c61 7965 722e 0a20 2020  utput layer..   
-00009cb0: 2020 2020 206e 5f6c 6179 6572 733a 2069       n_layers: i
-00009cc0: 6e74 0a20 2020 2020 2020 2020 2020 204e  nt.            N
-00009cd0: 756d 6265 7220 6f66 206c 6179 6572 7320  umber of layers 
-00009ce0: 696e 204d 4154 4765 6e65 7261 746f 722e  in MATGenerator.
-00009cf0: 0a20 2020 2020 2020 2064 726f 706f 7574  .        dropout
-00009d00: 5f70 3a20 666c 6f61 740a 2020 2020 2020  _p: float.      
-00009d10: 2020 2020 2020 4472 6f70 6f75 7420 7072        Dropout pr
-00009d20: 6f62 6162 696c 6974 7920 666f 7220 6c61  obability for la
-00009d30: 7965 722e 0a20 2020 2020 2020 2061 7474  yer..        att
-00009d40: 6e5f 6869 6464 656e 3a20 696e 740a 2020  n_hidden: int.  
-00009d50: 2020 2020 2020 2020 2020 5369 7a65 206f            Size o
-00009d60: 6620 6869 6464 656e 2061 7474 656e 7469  f hidden attenti
-00009d70: 6f6e 206c 6179 6572 2e0a 2020 2020 2020  on layer..      
-00009d80: 2020 6174 746e 5f6f 7574 3a20 696e 740a    attn_out: int.
-00009d90: 2020 2020 2020 2020 2020 2020 5369 7a65              Size
-00009da0: 206f 6620 6f75 7470 7574 2061 7474 656e   of output atten
-00009db0: 7469 6f6e 206c 6179 6572 2e0a 2020 2020  tion layer..    
-00009dc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00009dd0: 7375 7065 7228 4d41 5447 656e 6572 6174  super(MATGenerat
-00009de0: 6f72 2c20 7365 6c66 292e 5f5f 696e 6974  or, self).__init
-00009df0: 5f5f 2829 0a0a 2020 2020 2020 2020 6966  __()..        if
-00009e00: 2061 6767 7265 6761 7469 6f6e 5f74 7970   aggregation_typ
-00009e10: 6520 3d3d 2027 6772 6f76 6572 273a 0a20  e == 'grover':. 
-00009e20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009e30: 6174 745f 6e65 7420 3d20 6e6e 2e53 6571  att_net = nn.Seq
-00009e40: 7565 6e74 6961 6c28 0a20 2020 2020 2020  uential(.       
-00009e50: 2020 2020 2020 2020 206e 6e2e 4c69 6e65           nn.Line
-00009e60: 6172 2868 7369 7a65 2c20 6174 746e 5f68  ar(hsize, attn_h
-00009e70: 6964 6465 6e2c 2062 6961 733d 4661 6c73  idden, bias=Fals
-00009e80: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-00009e90: 2020 2020 6e6e 2e54 616e 6828 292c 0a20      nn.Tanh(),. 
-00009ea0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00009eb0: 6e2e 4c69 6e65 6172 2861 7474 6e5f 6869  n.Linear(attn_hi
-00009ec0: 6464 656e 2c20 6174 746e 5f6f 7574 2c20  dden, attn_out, 
-00009ed0: 6269 6173 3d46 616c 7365 292c 0a20 2020  bias=False),.   
-00009ee0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00009ef0: 2020 2020 2020 2068 7369 7a65 202a 3d20         hsize *= 
-00009f00: 6174 746e 5f6f 7574 0a0a 2020 2020 2020  attn_out..      
-00009f10: 2020 6966 206e 5f6c 6179 6572 7320 3d3d    if n_layers ==
-00009f20: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00009f30: 7365 6c66 2e70 726f 6a3a 2041 6e79 203d  self.proj: Any =
-00009f40: 206e 6e2e 4c69 6e65 6172 2868 7369 7a65   nn.Linear(hsize
-00009f50: 2c20 645f 6f75 7470 7574 290a 0a20 2020  , d_output)..   
-00009f60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00009f70: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
-00009f80: 203d 205b 5d0a 0a20 2020 2020 2020 2020   = []..         
-00009f90: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00009fa0: 6528 6e5f 6c61 7965 7273 202d 2031 293a  e(n_layers - 1):
-00009fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009fc0: 2073 656c 662e 7072 6f6a 2e61 7070 656e   self.proj.appen
-00009fd0: 6428 6e6e 2e4c 696e 6561 7228 6873 697a  d(nn.Linear(hsiz
-00009fe0: 652c 2061 7474 6e5f 6869 6464 656e 2929  e, attn_hidden))
-00009ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a000: 2073 656c 662e 7072 6f6a 2e61 7070 656e   self.proj.appen
-0000a010: 6428 6e6e 2e4c 6561 6b79 5265 4c55 286e  d(nn.LeakyReLU(n
-0000a020: 6567 6174 6976 655f 736c 6f70 653d 302e  egative_slope=0.
-0000a030: 3129 290a 2020 2020 2020 2020 2020 2020  1)).            
-0000a040: 2020 2020 7365 6c66 2e70 726f 6a2e 6170      self.proj.ap
-0000a050: 7065 6e64 286e 6e2e 4c61 7965 724e 6f72  pend(nn.LayerNor
-0000a060: 6d28 6174 746e 5f68 6964 6465 6e29 290a  m(attn_hidden)).
-0000a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a080: 7365 6c66 2e70 726f 6a2e 6170 7065 6e64  self.proj.append
-0000a090: 286e 6e2e 4472 6f70 6f75 7428 6472 6f70  (nn.Dropout(drop
-0000a0a0: 6f75 745f 7029 290a 2020 2020 2020 2020  out_p)).        
-0000a0b0: 2020 2020 7365 6c66 2e70 726f 6a2e 6170      self.proj.ap
-0000a0c0: 7065 6e64 286e 6e2e 4c69 6e65 6172 2861  pend(nn.Linear(a
-0000a0d0: 7474 6e5f 6869 6464 656e 2c20 645f 6f75  ttn_hidden, d_ou
-0000a0e0: 7470 7574 2929 0a20 2020 2020 2020 2020  tput)).         
-0000a0f0: 2020 2073 656c 662e 7072 6f6a 203d 2074     self.proj = t
-0000a100: 6f72 6368 2e6e 6e2e 5365 7175 656e 7469  orch.nn.Sequenti
-0000a110: 616c 282a 7365 6c66 2e70 726f 6a29 0a20  al(*self.proj). 
-0000a120: 2020 2020 2020 2073 656c 662e 6167 6772         self.aggr
-0000a130: 6567 6174 696f 6e5f 7479 7065 203d 2061  egation_type = a
-0000a140: 6767 7265 6761 7469 6f6e 5f74 7970 650a  ggregation_type.
-0000a150: 0a20 2020 2064 6566 2066 6f72 7761 7264  .    def forward
-0000a160: 2873 656c 662c 2078 3a20 746f 7263 682e  (self, x: torch.
-0000a170: 5465 6e73 6f72 2c20 6d61 736b 3a20 746f  Tensor, mask: to
-0000a180: 7263 682e 5465 6e73 6f72 2920 2d3e 2074  rch.Tensor) -> t
-0000a190: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
-0000a1a0: 2020 2020 2022 2222 436f 6d70 7574 6174       """Computat
-0000a1b0: 696f 6e20 666f 7220 7468 6520 4d41 5447  ion for the MATG
-0000a1c0: 656e 6572 6174 6f72 206c 6179 6572 2e0a  enerator layer..
-0000a1d0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0000a1e0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-0000a1f0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2078  ------.        x
-0000a200: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-0000a210: 2020 2020 2020 2020 2020 2049 6e70 7574             Input
-0000a220: 2074 656e 736f 722e 0a20 2020 2020 2020   tensor..       
-0000a230: 206d 6173 6b3a 2074 6f72 6368 2e54 656e   mask: torch.Ten
-0000a240: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-0000a250: 4d61 736b 2066 6f72 2070 6164 6469 6e67  Mask for padding
-0000a260: 2073 6f20 7468 6174 2070 6164 6465 6420   so that padded 
-0000a270: 7661 6c75 6573 2064 6f20 6e6f 7420 6765  values do not ge
-0000a280: 7420 696e 636c 7564 6564 2069 6e20 6174  t included in at
-0000a290: 7465 6e74 696f 6e20 7363 6f72 6520 6361  tention score ca
-0000a2a0: 6c63 756c 6174 696f 6e2e 0a20 2020 2020  lculation..     
-0000a2b0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-0000a2c0: 6d61 736b 203d 206d 6173 6b2e 756e 7371  mask = mask.unsq
-0000a2d0: 7565 657a 6528 2d31 292e 666c 6f61 7428  ueeze(-1).float(
-0000a2e0: 290a 2020 2020 2020 2020 6f75 745f 6d61  ).        out_ma
-0000a2f0: 736b 6564 203d 2078 202a 206d 6173 6b0a  sked = x * mask.
-0000a300: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000a310: 2e61 6767 7265 6761 7469 6f6e 5f74 7970  .aggregation_typ
-0000a320: 6520 3d3d 2027 6d65 616e 273a 0a20 2020  e == 'mean':.   
-0000a330: 2020 2020 2020 2020 206f 7574 5f73 756d           out_sum
-0000a340: 203d 206f 7574 5f6d 6173 6b65 642e 7375   = out_masked.su
-0000a350: 6d28 6469 6d3d 3129 0a20 2020 2020 2020  m(dim=1).       
-0000a360: 2020 2020 206d 6173 6b5f 7375 6d20 3d20       mask_sum = 
-0000a370: 6d61 736b 2e73 756d 2864 696d 3d28 3129  mask.sum(dim=(1)
-0000a380: 290a 2020 2020 2020 2020 2020 2020 6f75  ).            ou
-0000a390: 745f 6176 675f 706f 6f6c 696e 6720 3d20  t_avg_pooling = 
-0000a3a0: 6f75 745f 7375 6d20 2f20 6d61 736b 5f73  out_sum / mask_s
-0000a3b0: 756d 0a0a 2020 2020 2020 2020 656c 6966  um..        elif
-0000a3c0: 2073 656c 662e 6167 6772 6567 6174 696f   self.aggregatio
-0000a3d0: 6e5f 7479 7065 203d 3d20 2767 726f 7665  n_type == 'grove
-0000a3e0: 7227 3a0a 2020 2020 2020 2020 2020 2020  r':.            
-0000a3f0: 6f75 745f 6174 746e 203d 2073 656c 662e  out_attn = self.
-0000a400: 6174 745f 6e65 7428 6f75 745f 6d61 736b  att_net(out_mask
-0000a410: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
-0000a420: 6f75 745f 6174 746e 203d 206f 7574 5f61  out_attn = out_a
-0000a430: 7474 6e2e 6d61 736b 6564 5f66 696c 6c28  ttn.masked_fill(
-0000a440: 6d61 736b 203d 3d20 302c 202d 3165 3929  mask == 0, -1e9)
-0000a450: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0000a460: 5f61 7474 6e20 3d20 462e 736f 6674 6d61  _attn = F.softma
-0000a470: 7828 6f75 745f 6174 746e 2c20 6469 6d3d  x(out_attn, dim=
-0000a480: 3129 0a20 2020 2020 2020 2020 2020 206f  1).            o
-0000a490: 7574 5f61 7667 5f70 6f6f 6c69 6e67 203d  ut_avg_pooling =
-0000a4a0: 2074 6f72 6368 2e6d 6174 6d75 6c28 746f   torch.matmul(to
-0000a4b0: 7263 682e 7472 616e 7370 6f73 6528 6f75  rch.transpose(ou
-0000a4c0: 745f 6174 746e 2c20 2d31 2c20 2d32 292c  t_attn, -1, -2),
-0000a4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000076a0: 2020 2020 2020 2020 2020 2020 6469 7374              dist
+000076b0: 616e 6365 5f6d 6174 7269 783d 6469 7374  ance_matrix=dist
+000076c0: 616e 6365 5f6d 6174 7269 7829 290a 2020  ance_matrix)).  
+000076d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000076e0: 662e 7375 626c 6179 6572 5b31 5d28 782c  f.sublayer[1](x,
+000076f0: 2073 656c 662e 6665 6564 5f66 6f72 7761   self.feed_forwa
+00007700: 7264 2878 2929 0a0a 0a63 6c61 7373 2053  rd(x))...class S
+00007710: 7562 6c61 7965 7243 6f6e 6e65 6374 696f  ublayerConnectio
+00007720: 6e28 6e6e 2e4d 6f64 756c 6529 3a0a 2020  n(nn.Module):.  
+00007730: 2020 2222 2253 7562 6c61 7965 7243 6f6e    """SublayerCon
+00007740: 6e65 6374 696f 6e20 6c61 7965 7220 6261  nection layer ba
+00007750: 7365 6420 6f6e 2074 6865 2070 6170 6572  sed on the paper
+00007760: 2060 4174 7465 6e74 696f 6e20 4973 2041   `Attention Is A
+00007770: 6c6c 2059 6f75 204e 6565 6420 3c68 7474  ll You Need <htt
+00007780: 7073 3a2f 2f61 7278 6976 2e6f 7267 2f61  ps://arxiv.org/a
+00007790: 6273 2f31 3730 362e 3033 3736 323e 605f  bs/1706.03762>`_
+000077a0: 2e0a 0a20 2020 2054 6865 2053 7562 6c61  ...    The Subla
+000077b0: 7965 7243 6f6e 6e65 6374 696f 6e20 6e6f  yerConnection no
+000077c0: 726d 616c 697a 6573 2061 6e64 2061 6464  rmalizes and add
+000077d0: 7320 6472 6f70 6f75 7420 746f 206f 7574  s dropout to out
+000077e0: 7075 7420 7465 6e73 6f72 206f 6620 616e  put tensor of an
+000077f0: 2061 7262 6974 6172 7920 6c61 7965 722e   arbitary layer.
+00007800: 0a20 2020 2049 7420 6675 7274 6865 7220  .    It further 
+00007810: 6164 6473 2061 2072 6573 6964 7561 6c20  adds a residual 
+00007820: 6c61 7965 7220 636f 6e6e 6563 7469 6f6e  layer connection
+00007830: 2062 6574 7765 656e 2074 6865 2069 6e70   between the inp
+00007840: 7574 206f 6620 7468 6520 6172 6269 7461  ut of the arbita
+00007850: 7279 206c 6179 6572 2061 6e64 2074 6865  ry layer and the
+00007860: 2064 726f 706f 7574 2d61 646a 7573 7465   dropout-adjuste
+00007870: 6420 6c61 7965 7220 6f75 7470 7574 2e0a  d layer output..
+00007880: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
+00007890: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
+000078a0: 3e3e 2066 726f 6d20 6465 6570 6368 656d  >> from deepchem
+000078b0: 2e6d 6f64 656c 732e 746f 7263 685f 6d6f  .models.torch_mo
+000078c0: 6465 6c73 2e6c 6179 6572 7320 696d 706f  dels.layers impo
+000078d0: 7274 2053 7562 6c61 7965 7243 6f6e 6e65  rt SublayerConne
+000078e0: 6374 696f 6e0a 2020 2020 3e3e 3e20 7363  ction.    >>> sc
+000078f0: 616c 6520 3d20 302e 3335 0a20 2020 203e  ale = 0.35.    >
+00007900: 3e3e 206c 6179 6572 203d 2053 7562 6c61  >> layer = Subla
+00007910: 7965 7243 6f6e 6e65 6374 696f 6e28 322c  yerConnection(2,
+00007920: 2030 2e29 0a20 2020 203e 3e3e 2069 6e70   0.).    >>> inp
+00007930: 7574 5f61 7220 3d20 746f 7263 682e 7465  ut_ar = torch.te
+00007940: 6e73 6f72 285b 5b31 2e2c 2032 2e5d 2c20  nsor([[1., 2.], 
+00007950: 5b35 2e2c 2036 2e5d 5d29 0a20 2020 203e  [5., 6.]]).    >
+00007960: 3e3e 206f 7574 7075 7420 3d20 6c61 7965  >> output = laye
+00007970: 7228 696e 7075 745f 6172 2c20 696e 7075  r(input_ar, inpu
+00007980: 745f 6172 290a 2020 2222 220a 0a20 2020  t_ar).  """..   
+00007990: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+000079a0: 6c66 2c20 7369 7a65 3a20 696e 742c 2064  lf, size: int, d
+000079b0: 726f 706f 7574 5f70 3a20 666c 6f61 7420  ropout_p: float 
+000079c0: 3d20 302e 3029 3a0a 2020 2020 2020 2020  = 0.0):.        
+000079d0: 2222 2249 6e69 7469 616c 697a 6520 6120  """Initialize a 
+000079e0: 5375 626c 6179 6572 436f 6e6e 6563 7469  SublayerConnecti
+000079f0: 6f6e 204c 6179 6572 2e0a 0a20 2020 2020  on Layer...     
+00007a00: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00007a10: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00007a20: 0a20 2020 2020 2020 2073 697a 653a 2069  .        size: i
+00007a30: 6e74 0a20 2020 2020 2020 2020 2020 2053  nt.            S
+00007a40: 697a 6520 6f66 206c 6179 6572 2e0a 2020  ize of layer..  
+00007a50: 2020 2020 2020 6472 6f70 6f75 745f 703a        dropout_p:
+00007a60: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+00007a70: 2020 2044 726f 706f 7574 2070 726f 6261     Dropout proba
+00007a80: 6269 6c69 7479 2e0a 2020 2020 2020 2020  bility..        
+00007a90: 2222 220a 2020 2020 2020 2020 7375 7065  """.        supe
+00007aa0: 7228 5375 626c 6179 6572 436f 6e6e 6563  r(SublayerConnec
+00007ab0: 7469 6f6e 2c20 7365 6c66 292e 5f5f 696e  tion, self).__in
+00007ac0: 6974 5f5f 2829 0a20 2020 2020 2020 2073  it__().        s
+00007ad0: 656c 662e 6e6f 726d 203d 206e 6e2e 4c61  elf.norm = nn.La
+00007ae0: 7965 724e 6f72 6d28 7369 7a65 290a 2020  yerNorm(size).  
+00007af0: 2020 2020 2020 7365 6c66 2e64 726f 706f        self.dropo
+00007b00: 7574 5f70 203d 206e 6e2e 4472 6f70 6f75  ut_p = nn.Dropou
+00007b10: 7428 6472 6f70 6f75 745f 7029 0a0a 2020  t(dropout_p)..  
+00007b20: 2020 6465 6620 666f 7277 6172 6428 7365    def forward(se
+00007b30: 6c66 2c20 783a 2074 6f72 6368 2e54 656e  lf, x: torch.Ten
+00007b40: 736f 722c 206f 7574 7075 743a 2074 6f72  sor, output: tor
+00007b50: 6368 2e54 656e 736f 7229 202d 3e20 746f  ch.Tensor) -> to
+00007b60: 7263 682e 5465 6e73 6f72 3a0a 2020 2020  rch.Tensor:.    
+00007b70: 2020 2020 2222 224f 7574 7075 7420 636f      """Output co
+00007b80: 6d70 7574 6174 696f 6e20 666f 7220 7468  mputation for th
+00007b90: 6520 5375 626c 6179 6572 436f 6e6e 6563  e SublayerConnec
+00007ba0: 7469 6f6e 206c 6179 6572 2e0a 0a20 2020  tion layer...   
+00007bb0: 2020 2020 2054 616b 6573 2061 6e20 696e       Takes an in
+00007bc0: 7075 7420 7465 6e73 6f72 2078 2c20 7468  put tensor x, th
+00007bd0: 656e 2061 6464 7320 7468 6520 6472 6f70  en adds the drop
+00007be0: 6f75 742d 6164 6a75 7374 6564 2073 7562  out-adjusted sub
+00007bf0: 6c61 7965 7220 6f75 7470 7574 2066 6f72  layer output for
+00007c00: 206e 6f72 6d61 6c69 7a65 6420 7820 746f   normalized x to
+00007c10: 2069 742e 0a20 2020 2020 2020 2054 6869   it..        Thi
+00007c20: 7320 6973 2064 6f6e 6520 746f 2061 6464  s is done to add
+00007c30: 2061 2072 6573 6964 7561 6c20 636f 6e6e   a residual conn
+00007c40: 6563 7469 6f6e 2066 6f6c 6c6f 7765 6420  ection followed 
+00007c50: 6279 204c 6179 6572 4e6f 726d 2e0a 0a20  by LayerNorm... 
+00007c60: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00007c70: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00007c80: 2d2d 2d2d 0a20 2020 2020 2020 2078 3a20  ----.        x: 
+00007c90: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+00007ca0: 2020 2020 2020 2020 2049 6e70 7574 2074           Input t
+00007cb0: 656e 736f 722e 0a20 2020 2020 2020 206f  ensor..        o
+00007cc0: 7574 7075 743a 2074 6f72 6368 2e54 656e  utput: torch.Ten
+00007cd0: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00007ce0: 4c61 7965 7220 7768 6f73 6520 6e6f 726d  Layer whose norm
+00007cf0: 616c 697a 6564 206f 7574 7075 7420 7769  alized output wi
+00007d00: 6c6c 2062 6520 6164 6465 6420 746f 2078  ll be added to x
+00007d10: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00007d20: 2020 2020 2020 6966 2078 2069 7320 4e6f        if x is No
+00007d30: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007d40: 7265 7475 726e 2073 656c 662e 6472 6f70  return self.drop
+00007d50: 6f75 745f 7028 7365 6c66 2e6e 6f72 6d28  out_p(self.norm(
+00007d60: 6f75 7470 7574 2929 0a20 2020 2020 2020  output)).       
+00007d70: 2072 6574 7572 6e20 7820 2b20 7365 6c66   return x + self
+00007d80: 2e64 726f 706f 7574 5f70 2873 656c 662e  .dropout_p(self.
+00007d90: 6e6f 726d 286f 7574 7075 7429 290a 0a0a  norm(output))...
+00007da0: 636c 6173 7320 506f 7369 7469 6f6e 7769  class Positionwi
+00007db0: 7365 4665 6564 466f 7277 6172 6428 6e6e  seFeedForward(nn
+00007dc0: 2e4d 6f64 756c 6529 3a0a 2020 2020 2222  .Module):.    ""
+00007dd0: 2250 6f73 6974 696f 6e77 6973 6546 6565  "PositionwiseFee
+00007de0: 6446 6f72 7761 7264 2069 7320 6120 6c61  dForward is a la
+00007df0: 7965 7220 7573 6564 2074 6f20 6465 6669  yer used to defi
+00007e00: 6e65 2074 6865 2070 6f73 6974 696f 6e2d  ne the position-
+00007e10: 7769 7365 2066 6565 642d 666f 7277 6172  wise feed-forwar
+00007e20: 6420 2846 464e 2920 616c 676f 7269 7468  d (FFN) algorith
+00007e30: 6d20 666f 7220 7468 6520 4d6f 6c65 6375  m for the Molecu
+00007e40: 6c61 7220 4174 7465 6e74 696f 6e20 5472  lar Attention Tr
+00007e50: 616e 7366 6f72 6d65 7220 5b31 5d5f 0a0a  ansformer [1]_..
+00007e60: 2020 2020 4561 6368 206c 6179 6572 2069      Each layer i
+00007e70: 6e20 7468 6520 4d41 5420 656e 636f 6465  n the MAT encode
+00007e80: 7220 636f 6e74 6169 6e73 2061 2066 756c  r contains a ful
+00007e90: 6c79 2063 6f6e 6e65 6374 6564 2066 6565  ly connected fee
+00007ea0: 642d 666f 7277 6172 6420 6e65 7477 6f72  d-forward networ
+00007eb0: 6b20 7768 6963 6820 6170 706c 6965 7320  k which applies 
+00007ec0: 7477 6f20 6c69 6e65 6172 2074 7261 6e73  two linear trans
+00007ed0: 666f 726d 6174 696f 6e73 2061 6e64 2074  formations and t
+00007ee0: 6865 2067 6976 656e 2061 6374 6976 6174  he given activat
+00007ef0: 696f 6e20 6675 6e63 7469 6f6e 2e0a 2020  ion function..  
+00007f00: 2020 5468 6973 2069 7320 646f 6e65 2069    This is done i
+00007f10: 6e20 6164 6469 7469 6f6e 2074 6f20 7468  n addition to th
+00007f20: 6520 5375 626c 6179 6572 436f 6e6e 6563  e SublayerConnec
+00007f30: 7469 6f6e 206d 6f64 756c 652e 0a0a 2020  tion module...  
+00007f40: 2020 4e6f 7465 3a20 5468 6973 206d 6f64    Note: This mod
+00007f50: 6966 6965 6420 7665 7273 696f 6e20 6f66  ified version of
+00007f60: 2060 506f 7369 7469 6f6e 7769 7365 4665   `PositionwiseFe
+00007f70: 6564 466f 7277 6172 6460 2063 6c61 7373  edForward` class
+00007f80: 2063 6f6e 7461 696e 7320 6064 726f 706f   contains `dropo
+00007f90: 7574 5f61 745f 696e 7075 745f 6e6f 5f61  ut_at_input_no_a
+00007fa0: 6374 6020 636f 6e64 6974 696f 6e20 746f  ct` condition to
+00007fb0: 2066 6163 696c 6974 6174 6520 6974 7320   facilitate its 
+00007fc0: 7573 6520 696e 2064 6566 696e 696e 670a  use in defining.
+00007fd0: 2020 2020 2020 2020 7468 6520 6665 6564          the feed
+00007fe0: 2d66 6f72 7761 7264 2028 4646 4e29 2061  -forward (FFN) a
+00007ff0: 6c67 6f72 6974 686d 2066 6f72 2074 6865  lgorithm for the
+00008000: 2044 6972 6563 7465 6420 4d65 7373 6167   Directed Messag
+00008010: 6520 5061 7373 696e 6720 4e65 7572 616c  e Passing Neural
+00008020: 204e 6574 776f 726b 2028 442d 4d50 4e4e   Network (D-MPNN
+00008030: 2920 5b32 5d5f 0a0a 2020 2020 5265 6665  ) [2]_..    Refe
+00008040: 7265 6e63 6573 0a20 2020 202d 2d2d 2d2d  rences.    -----
+00008050: 2d2d 2d2d 2d0a 2020 2020 2e2e 205b 315d  -----.    .. [1]
+00008060: 204c 756b 6173 7a20 4d61 7a69 6172 6b61   Lukasz Maziarka
+00008070: 2065 7420 616c 2e20 224d 6f6c 6563 756c   et al. "Molecul
+00008080: 6520 4174 7465 6e74 696f 6e20 5472 616e  e Attention Tran
+00008090: 7366 6f72 6d65 7222 2047 7261 7068 2052  sformer" Graph R
+000080a0: 6570 7265 7365 6e74 6174 696f 6e20 4c65  epresentation Le
+000080b0: 6172 6e69 6e67 2077 6f72 6b73 686f 7020  arning workshop 
+000080c0: 616e 6420 4d61 6368 696e 6520 4c65 6172  and Machine Lear
+000080d0: 6e69 6e67 2061 6e64 2074 6865 2050 6879  ning and the Phy
+000080e0: 7369 6361 6c20 5363 6965 6e63 6573 2077  sical Sciences w
+000080f0: 6f72 6b73 686f 7020 6174 204e 6575 7249  orkshop at NeurI
+00008100: 5053 2032 3031 392e 2032 3032 302e 2068  PS 2019. 2020. h
+00008110: 7474 7073 3a2f 2f61 7278 6976 2e6f 7267  ttps://arxiv.org
+00008120: 2f61 6273 2f32 3030 322e 3038 3236 340a  /abs/2002.08264.
+00008130: 2020 2020 2e2e 205b 325d 2041 6e61 6c79      .. [2] Analy
+00008140: 7a69 6e67 204c 6561 726e 6564 204d 6f6c  zing Learned Mol
+00008150: 6563 756c 6172 2052 6570 7265 7365 6e74  ecular Represent
+00008160: 6174 696f 6e73 2066 6f72 2050 726f 7065  ations for Prope
+00008170: 7274 7920 5072 6564 6963 7469 6f6e 2068  rty Prediction h
+00008180: 7474 7073 3a2f 2f61 7278 6976 2e6f 7267  ttps://arxiv.org
+00008190: 2f70 6466 2f31 3930 342e 3031 3536 312e  /pdf/1904.01561.
+000081a0: 7064 660a 0a20 2020 2045 7861 6d70 6c65  pdf..    Example
+000081b0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  s.    --------. 
+000081c0: 2020 203e 3e3e 2066 726f 6d20 6465 6570     >>> from deep
+000081d0: 6368 656d 2e6d 6f64 656c 732e 746f 7263  chem.models.torc
+000081e0: 685f 6d6f 6465 6c73 2e6c 6179 6572 7320  h_models.layers 
+000081f0: 696d 706f 7274 2050 6f73 6974 696f 6e77  import Positionw
+00008200: 6973 6546 6565 6446 6f72 7761 7264 0a20  iseFeedForward. 
+00008210: 2020 203e 3e3e 2066 6565 645f 6677 645f     >>> feed_fwd_
+00008220: 6c61 7965 7220 3d20 506f 7369 7469 6f6e  layer = Position
+00008230: 7769 7365 4665 6564 466f 7277 6172 6428  wiseFeedForward(
+00008240: 645f 696e 7075 7420 3d20 322c 2064 5f68  d_input = 2, d_h
+00008250: 6964 6465 6e20 3d20 322c 2064 5f6f 7574  idden = 2, d_out
+00008260: 7075 7420 3d20 322c 2061 6374 6976 6174  put = 2, activat
+00008270: 696f 6e20 3d20 2772 656c 7527 2c20 6e5f  ion = 'relu', n_
+00008280: 6c61 7965 7273 203d 2031 2c20 6472 6f70  layers = 1, drop
+00008290: 6f75 745f 7020 3d20 302e 3129 0a20 2020  out_p = 0.1).   
+000082a0: 203e 3e3e 2069 6e70 7574 5f74 656e 736f   >>> input_tenso
+000082b0: 7220 3d20 746f 7263 682e 7465 6e73 6f72  r = torch.tensor
+000082c0: 285b 5b31 2e2c 2032 2e5d 2c20 5b35 2e2c  ([[1., 2.], [5.,
+000082d0: 2036 2e5d 5d29 0a20 2020 203e 3e3e 206f   6.]]).    >>> o
+000082e0: 7574 7075 745f 7465 6e73 6f72 203d 2066  utput_tensor = f
+000082f0: 6565 645f 6677 645f 6c61 7965 7228 696e  eed_fwd_layer(in
+00008300: 7075 745f 7465 6e73 6f72 290a 2020 2222  put_tensor).  ""
+00008310: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00008320: 745f 5f28 7365 6c66 2c0a 2020 2020 2020  t__(self,.      
+00008330: 2020 2020 2020 2020 2020 2064 5f69 6e70             d_inp
+00008340: 7574 3a20 696e 7420 3d20 3130 3234 2c0a  ut: int = 1024,.
+00008350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008360: 2064 5f68 6964 6465 6e3a 2069 6e74 203d   d_hidden: int =
+00008370: 2031 3032 342c 0a20 2020 2020 2020 2020   1024,.         
+00008380: 2020 2020 2020 2020 645f 6f75 7470 7574          d_output
+00008390: 3a20 696e 7420 3d20 3130 3234 2c0a 2020  : int = 1024,.  
+000083a0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000083b0: 6374 6976 6174 696f 6e3a 2073 7472 203d  ctivation: str =
+000083c0: 2027 6c65 616b 7972 656c 7527 2c0a 2020   'leakyrelu',.  
+000083d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000083e0: 5f6c 6179 6572 733a 2069 6e74 203d 2031  _layers: int = 1
+000083f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00008400: 2020 2064 726f 706f 7574 5f70 3a20 666c     dropout_p: fl
+00008410: 6f61 7420 3d20 302e 302c 0a20 2020 2020  oat = 0.0,.     
+00008420: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
+00008430: 6f75 745f 6174 5f69 6e70 7574 5f6e 6f5f  out_at_input_no_
+00008440: 6163 743a 2062 6f6f 6c20 3d20 4661 6c73  act: bool = Fals
+00008450: 6529 3a0a 2020 2020 2020 2020 2222 2249  e):.        """I
+00008460: 6e69 7469 616c 697a 6520 6120 506f 7369  nitialize a Posi
+00008470: 7469 6f6e 7769 7365 4665 6564 466f 7277  tionwiseFeedForw
+00008480: 6172 6420 6c61 7965 722e 0a0a 2020 2020  ard layer...    
+00008490: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+000084a0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+000084b0: 2d0a 2020 2020 2020 2020 645f 696e 7075  -.        d_inpu
+000084c0: 743a 2069 6e74 0a20 2020 2020 2020 2020  t: int.         
+000084d0: 2020 2053 697a 6520 6f66 2069 6e70 7574     Size of input
+000084e0: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+000084f0: 645f 6869 6464 656e 3a20 696e 7420 2873  d_hidden: int (s
+00008500: 616d 6520 6173 2064 5f69 6e70 7574 2069  ame as d_input i
+00008510: 6620 645f 6f75 7470 7574 203d 2030 290a  f d_output = 0).
+00008520: 2020 2020 2020 2020 2020 2020 5369 7a65              Size
+00008530: 206f 6620 6869 6464 656e 206c 6179 6572   of hidden layer
+00008540: 2e0a 2020 2020 2020 2020 645f 6f75 7470  ..        d_outp
+00008550: 7574 3a20 696e 7420 2873 616d 6520 6173  ut: int (same as
+00008560: 2064 5f69 6e70 7574 2069 6620 645f 6f75   d_input if d_ou
+00008570: 7470 7574 203d 2030 290a 2020 2020 2020  tput = 0).      
+00008580: 2020 2020 2020 5369 7a65 206f 6620 6f75        Size of ou
+00008590: 7470 7574 206c 6179 6572 2e0a 2020 2020  tput layer..    
+000085a0: 2020 2020 6163 7469 7661 7469 6f6e 3a20      activation: 
+000085b0: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
+000085c0: 4163 7469 7661 7469 6f6e 2066 756e 6374  Activation funct
+000085d0: 696f 6e20 746f 2062 6520 7573 6564 2e20  ion to be used. 
+000085e0: 4361 6e20 6368 6f6f 7365 2062 6574 7765  Can choose betwe
+000085f0: 656e 2027 7265 6c75 2720 666f 7220 5265  en 'relu' for Re
+00008600: 4c55 2c20 276c 6561 6b79 7265 6c75 2720  LU, 'leakyrelu' 
+00008610: 666f 7220 4c65 616b 7952 654c 552c 2027  for LeakyReLU, '
+00008620: 7072 656c 7527 2066 6f72 2050 5265 4c55  prelu' for PReLU
+00008630: 2c0a 2020 2020 2020 2020 2020 2020 2774  ,.            't
+00008640: 616e 6827 2066 6f72 2054 616e 482c 2027  anh' for TanH, '
+00008650: 7365 6c75 2720 666f 7220 5345 4c55 2c20  selu' for SELU, 
+00008660: 2765 6c75 2720 666f 7220 454c 5520 616e  'elu' for ELU an
+00008670: 6420 276c 696e 6561 7227 2066 6f72 206c  d 'linear' for l
+00008680: 696e 6561 7220 6163 7469 7661 7469 6f6e  inear activation
+00008690: 2e0a 2020 2020 2020 2020 6e5f 6c61 7965  ..        n_laye
+000086a0: 7273 3a20 696e 740a 2020 2020 2020 2020  rs: int.        
+000086b0: 2020 2020 4e75 6d62 6572 206f 6620 6c61      Number of la
+000086c0: 7965 7273 2e0a 2020 2020 2020 2020 6472  yers..        dr
+000086d0: 6f70 6f75 745f 703a 2066 6c6f 6174 0a20  opout_p: float. 
+000086e0: 2020 2020 2020 2020 2020 2044 726f 706f             Dropo
+000086f0: 7574 2070 726f 6261 6269 6c69 7479 2e0a  ut probability..
+00008700: 2020 2020 2020 2020 6472 6f70 6f75 745f          dropout_
+00008710: 6174 5f69 6e70 7574 5f6e 6f5f 6163 743a  at_input_no_act:
+00008720: 2062 6f6f 6c0a 2020 2020 2020 2020 2020   bool.          
+00008730: 2020 4966 2074 7275 652c 2064 726f 706f    If true, dropo
+00008740: 7574 2069 7320 6170 706c 6965 6420 6f6e  ut is applied on
+00008750: 2074 6865 2069 6e70 7574 2074 656e 736f   the input tenso
+00008760: 722e 2046 6f72 2073 696e 676c 6520 6c61  r. For single la
+00008770: 7965 722c 2069 7420 6973 206e 6f74 2070  yer, it is not p
+00008780: 6173 7365 6420 746f 2061 6e20 6163 7469  assed to an acti
+00008790: 7661 7469 6f6e 2066 756e 6374 696f 6e2e  vation function.
+000087a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000087b0: 2020 2020 2073 7570 6572 2850 6f73 6974       super(Posit
+000087c0: 696f 6e77 6973 6546 6565 6446 6f72 7761  ionwiseFeedForwa
+000087d0: 7264 2c20 7365 6c66 292e 5f5f 696e 6974  rd, self).__init
+000087e0: 5f5f 2829 0a0a 2020 2020 2020 2020 7365  __()..        se
+000087f0: 6c66 2e64 726f 706f 7574 5f61 745f 696e  lf.dropout_at_in
+00008800: 7075 745f 6e6f 5f61 6374 3a20 626f 6f6c  put_no_act: bool
+00008810: 203d 2064 726f 706f 7574 5f61 745f 696e   = dropout_at_in
+00008820: 7075 745f 6e6f 5f61 6374 0a0a 2020 2020  put_no_act..    
+00008830: 2020 2020 6966 2061 6374 6976 6174 696f      if activatio
+00008840: 6e20 3d3d 2027 7265 6c75 273a 0a20 2020  n == 'relu':.   
+00008850: 2020 2020 2020 2020 2073 656c 662e 6163           self.ac
+00008860: 7469 7661 7469 6f6e 3a20 416e 7920 3d20  tivation: Any = 
+00008870: 6e6e 2e52 654c 5528 290a 0a20 2020 2020  nn.ReLU()..     
+00008880: 2020 2065 6c69 6620 6163 7469 7661 7469     elif activati
+00008890: 6f6e 203d 3d20 276c 6561 6b79 7265 6c75  on == 'leakyrelu
+000088a0: 273a 0a20 2020 2020 2020 2020 2020 2073  ':.            s
+000088b0: 656c 662e 6163 7469 7661 7469 6f6e 203d  elf.activation =
+000088c0: 206e 6e2e 4c65 616b 7952 654c 5528 302e   nn.LeakyReLU(0.
+000088d0: 3129 0a0a 2020 2020 2020 2020 656c 6966  1)..        elif
+000088e0: 2061 6374 6976 6174 696f 6e20 3d3d 2027   activation == '
+000088f0: 7072 656c 7527 3a0a 2020 2020 2020 2020  prelu':.        
+00008900: 2020 2020 7365 6c66 2e61 6374 6976 6174      self.activat
+00008910: 696f 6e20 3d20 6e6e 2e50 5265 4c55 2829  ion = nn.PReLU()
+00008920: 0a0a 2020 2020 2020 2020 656c 6966 2061  ..        elif a
+00008930: 6374 6976 6174 696f 6e20 3d3d 2027 7461  ctivation == 'ta
+00008940: 6e68 273a 0a20 2020 2020 2020 2020 2020  nh':.           
+00008950: 2073 656c 662e 6163 7469 7661 7469 6f6e   self.activation
+00008960: 203d 206e 6e2e 5461 6e68 2829 0a0a 2020   = nn.Tanh()..  
+00008970: 2020 2020 2020 656c 6966 2061 6374 6976        elif activ
+00008980: 6174 696f 6e20 3d3d 2027 7365 6c75 273a  ation == 'selu':
+00008990: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000089a0: 662e 6163 7469 7661 7469 6f6e 203d 206e  f.activation = n
+000089b0: 6e2e 5345 4c55 2829 0a0a 2020 2020 2020  n.SELU()..      
+000089c0: 2020 656c 6966 2061 6374 6976 6174 696f    elif activatio
+000089d0: 6e20 3d3d 2027 656c 7527 3a0a 2020 2020  n == 'elu':.    
+000089e0: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
+000089f0: 6976 6174 696f 6e20 3d20 6e6e 2e45 4c55  ivation = nn.ELU
+00008a00: 2829 0a0a 2020 2020 2020 2020 656c 6966  ()..        elif
+00008a10: 2061 6374 6976 6174 696f 6e20 3d3d 2022   activation == "
+00008a20: 6c69 6e65 6172 223a 0a20 2020 2020 2020  linear":.       
+00008a30: 2020 2020 2073 656c 662e 6163 7469 7661       self.activa
+00008a40: 7469 6f6e 203d 206c 616d 6264 6120 783a  tion = lambda x:
+00008a50: 2078 0a0a 2020 2020 2020 2020 7365 6c66   x..        self
+00008a60: 2e6e 5f6c 6179 6572 733a 2069 6e74 203d  .n_layers: int =
+00008a70: 206e 5f6c 6179 6572 730a 2020 2020 2020   n_layers.      
+00008a80: 2020 645f 6f75 7470 7574 203d 2064 5f6f    d_output = d_o
+00008a90: 7574 7075 7420 6966 2064 5f6f 7574 7075  utput if d_outpu
+00008aa0: 7420 213d 2030 2065 6c73 6520 645f 696e  t != 0 else d_in
+00008ab0: 7075 740a 2020 2020 2020 2020 645f 6869  put.        d_hi
+00008ac0: 6464 656e 203d 2064 5f68 6964 6465 6e20  dden = d_hidden 
+00008ad0: 6966 2064 5f68 6964 6465 6e20 213d 2030  if d_hidden != 0
+00008ae0: 2065 6c73 6520 645f 696e 7075 740a 0a20   else d_input.. 
+00008af0: 2020 2020 2020 2069 6620 6e5f 6c61 7965         if n_laye
+00008b00: 7273 203d 3d20 313a 0a20 2020 2020 2020  rs == 1:.       
+00008b10: 2020 2020 2073 656c 662e 6c69 6e65 6172       self.linear
+00008b20: 733a 2041 6e79 203d 205b 6e6e 2e4c 696e  s: Any = [nn.Lin
+00008b30: 6561 7228 645f 696e 7075 742c 2064 5f6f  ear(d_input, d_o
+00008b40: 7574 7075 7429 5d0a 0a20 2020 2020 2020  utput)]..       
+00008b50: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00008b60: 2020 2073 656c 662e 6c69 6e65 6172 7320     self.linears 
+00008b70: 3d20 5b6e 6e2e 4c69 6e65 6172 2864 5f69  = [nn.Linear(d_i
+00008b80: 6e70 7574 2c20 645f 6869 6464 656e 295d  nput, d_hidden)]
+00008b90: 202b 205c 0a20 2020 2020 2020 2020 2020   + \.           
+00008ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008bb0: 205b 6e6e 2e4c 696e 6561 7228 645f 6869   [nn.Linear(d_hi
+00008bc0: 6464 656e 2c20 645f 6869 6464 656e 2920  dden, d_hidden) 
+00008bd0: 666f 7220 5f20 696e 2072 616e 6765 286e  for _ in range(n
+00008be0: 5f6c 6179 6572 7320 2d20 3229 5d20 2b20  _layers - 2)] + 
+00008bf0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00008c00: 2020 2020 2020 2020 2020 2020 2020 5b6e                [n
+00008c10: 6e2e 4c69 6e65 6172 2864 5f68 6964 6465  n.Linear(d_hidde
+00008c20: 6e2c 2064 5f6f 7574 7075 7429 5d0a 0a20  n, d_output)].. 
+00008c30: 2020 2020 2020 2073 656c 662e 6c69 6e65         self.line
+00008c40: 6172 7320 3d20 6e6e 2e4d 6f64 756c 654c  ars = nn.ModuleL
+00008c50: 6973 7428 7365 6c66 2e6c 696e 6561 7273  ist(self.linears
+00008c60: 290a 2020 2020 2020 2020 6472 6f70 6f75  ).        dropou
+00008c70: 745f 6c61 7965 7220 3d20 6e6e 2e44 726f  t_layer = nn.Dro
+00008c80: 706f 7574 2864 726f 706f 7574 5f70 290a  pout(dropout_p).
+00008c90: 2020 2020 2020 2020 7365 6c66 2e64 726f          self.dro
+00008ca0: 706f 7574 5f70 203d 206e 6e2e 4d6f 6475  pout_p = nn.Modu
+00008cb0: 6c65 4c69 7374 285b 6472 6f70 6f75 745f  leList([dropout_
+00008cc0: 6c61 7965 7220 666f 7220 5f20 696e 2072  layer for _ in r
+00008cd0: 616e 6765 286e 5f6c 6179 6572 7329 5d29  ange(n_layers)])
+00008ce0: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
+00008cf0: 6428 7365 6c66 2c20 783a 2074 6f72 6368  d(self, x: torch
+00008d00: 2e54 656e 736f 7229 202d 3e20 746f 7263  .Tensor) -> torc
+00008d10: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
+00008d20: 2020 2222 224f 7574 7075 7420 436f 6d70    """Output Comp
+00008d30: 7574 6174 696f 6e20 666f 7220 7468 6520  utation for the 
+00008d40: 506f 7369 7469 6f6e 7769 7365 4665 6564  PositionwiseFeed
+00008d50: 466f 7277 6172 6420 6c61 7965 722e 0a0a  Forward layer...
+00008d60: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00008d70: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00008d80: 2d2d 2d2d 2d0a 2020 2020 2020 2020 783a  -----.        x:
+00008d90: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+00008da0: 2020 2020 2020 2020 2020 496e 7075 7420            Input 
+00008db0: 7465 6e73 6f72 2e0a 2020 2020 2020 2020  tensor..        
+00008dc0: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+00008dd0: 6f74 2073 656c 662e 6e5f 6c61 7965 7273  ot self.n_layers
+00008de0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00008df0: 7475 726e 2078 0a0a 2020 2020 2020 2020  turn x..        
+00008e00: 6966 2073 656c 662e 6e5f 6c61 7965 7273  if self.n_layers
+00008e10: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00008e20: 2020 2069 6620 7365 6c66 2e64 726f 706f     if self.dropo
+00008e30: 7574 5f61 745f 696e 7075 745f 6e6f 5f61  ut_at_input_no_a
+00008e40: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
+00008e50: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00008e60: 6c69 6e65 6172 735b 305d 2873 656c 662e  linears[0](self.
+00008e70: 6472 6f70 6f75 745f 705b 305d 2878 2929  dropout_p[0](x))
+00008e80: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00008e90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00008ea0: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
+00008eb0: 726f 706f 7574 5f70 5b30 5d28 7365 6c66  ropout_p[0](self
+00008ec0: 2e61 6374 6976 6174 696f 6e28 7365 6c66  .activation(self
+00008ed0: 2e6c 696e 6561 7273 5b30 5d28 7829 2929  .linears[0](x)))
+00008ee0: 0a0a 2020 2020 2020 2020 656c 7365 3a0a  ..        else:.
+00008ef0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00008f00: 656c 662e 6472 6f70 6f75 745f 6174 5f69  elf.dropout_at_i
+00008f10: 6e70 7574 5f6e 6f5f 6163 743a 0a20 2020  nput_no_act:.   
+00008f20: 2020 2020 2020 2020 2020 2020 2078 203d               x =
+00008f30: 2073 656c 662e 6472 6f70 6f75 745f 705b   self.dropout_p[
+00008f40: 305d 2878 290a 2020 2020 2020 2020 2020  0](x).          
+00008f50: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00008f60: 2873 656c 662e 6e5f 6c61 7965 7273 202d  (self.n_layers -
+00008f70: 2031 293a 0a20 2020 2020 2020 2020 2020   1):.           
+00008f80: 2020 2020 2078 203d 2073 656c 662e 6472       x = self.dr
+00008f90: 6f70 6f75 745f 705b 695d 2873 656c 662e  opout_p[i](self.
+00008fa0: 6163 7469 7661 7469 6f6e 2873 656c 662e  activation(self.
+00008fb0: 6c69 6e65 6172 735b 695d 2878 2929 290a  linears[i](x))).
+00008fc0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00008fd0: 726e 2073 656c 662e 6c69 6e65 6172 735b  rn self.linears[
+00008fe0: 2d31 5d28 7829 0a0a 0a63 6c61 7373 204d  -1](x)...class M
+00008ff0: 4154 456d 6265 6464 696e 6728 6e6e 2e4d  ATEmbedding(nn.M
+00009000: 6f64 756c 6529 3a0a 2020 2020 2222 2245  odule):.    """E
+00009010: 6d62 6564 6469 6e67 206c 6179 6572 2074  mbedding layer t
+00009020: 6f20 6372 6561 7465 2065 6d62 6564 6469  o create embeddi
+00009030: 6e67 2066 6f72 2069 6e70 7574 732e 0a0a  ng for inputs...
+00009040: 2020 2020 496e 2061 6e20 656d 6265 6464      In an embedd
+00009050: 696e 6720 6c61 7965 722c 2069 6e70 7574  ing layer, input
+00009060: 2069 7320 7461 6b65 6e20 616e 6420 636f   is taken and co
+00009070: 6e76 6572 7465 6420 746f 2061 2076 6563  nverted to a vec
+00009080: 746f 7220 7265 7072 6573 656e 7461 7469  tor representati
+00009090: 6f6e 2066 6f72 2065 6163 6820 696e 7075  on for each inpu
+000090a0: 742e 0a20 2020 2049 6e20 7468 6520 4d41  t..    In the MA
+000090b0: 5445 6d62 6564 6469 6e67 206c 6179 6572  TEmbedding layer
+000090c0: 2c20 616e 2069 6e70 7574 2074 656e 736f  , an input tenso
+000090d0: 7220 6973 2070 726f 6365 7373 6564 2074  r is processed t
+000090e0: 6872 6f75 6768 2061 2064 726f 706f 7574  hrough a dropout
+000090f0: 2d61 646a 7573 7465 6420 6c69 6e65 6172  -adjusted linear
+00009100: 206c 6179 6572 2061 6e64 2074 6865 2072   layer and the r
+00009110: 6573 756c 7461 6e74 2076 6563 746f 7220  esultant vector 
+00009120: 6973 2072 6574 7572 6e65 642e 0a0a 2020  is returned...  
+00009130: 2020 5265 6665 7265 6e63 6573 0a20 2020    References.   
+00009140: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00009150: 2e2e 205b 315d 204c 756b 6173 7a20 4d61  .. [1] Lukasz Ma
+00009160: 7a69 6172 6b61 2065 7420 616c 2e20 224d  ziarka et al. "M
+00009170: 6f6c 6563 756c 6520 4174 7465 6e74 696f  olecule Attentio
+00009180: 6e20 5472 616e 7366 6f72 6d65 7222 2047  n Transformer" G
+00009190: 7261 7068 2052 6570 7265 7365 6e74 6174  raph Representat
+000091a0: 696f 6e20 4c65 6172 6e69 6e67 2077 6f72  ion Learning wor
+000091b0: 6b73 686f 7020 616e 6420 4d61 6368 696e  kshop and Machin
+000091c0: 6520 4c65 6172 6e69 6e67 2061 6e64 2074  e Learning and t
+000091d0: 6865 2050 6879 7369 6361 6c20 5363 6965  he Physical Scie
+000091e0: 6e63 6573 2077 6f72 6b73 686f 7020 6174  nces workshop at
+000091f0: 204e 6575 7249 5053 2032 3031 392e 2032   NeurIPS 2019. 2
+00009200: 3032 302e 2068 7474 7073 3a2f 2f61 7278  020. https://arx
+00009210: 6976 2e6f 7267 2f61 6273 2f32 3030 322e  iv.org/abs/2002.
+00009220: 3038 3236 340a 0a20 2020 2045 7861 6d70  08264..    Examp
+00009230: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
+00009240: 0a20 2020 203e 3e3e 2066 726f 6d20 6465  .    >>> from de
+00009250: 6570 6368 656d 2e6d 6f64 656c 732e 746f  epchem.models.to
+00009260: 7263 685f 6d6f 6465 6c73 2e6c 6179 6572  rch_models.layer
+00009270: 7320 696d 706f 7274 204d 4154 456d 6265  s import MATEmbe
+00009280: 6464 696e 670a 2020 2020 3e3e 3e20 6c61  dding.    >>> la
+00009290: 7965 7220 3d20 4d41 5445 6d62 6564 6469  yer = MATEmbeddi
+000092a0: 6e67 2864 5f69 6e70 7574 203d 2033 2c20  ng(d_input = 3, 
+000092b0: 645f 6f75 7470 7574 203d 2033 2c20 6472  d_output = 3, dr
+000092c0: 6f70 6f75 745f 7020 3d20 302e 3229 0a20  opout_p = 0.2). 
+000092d0: 2020 203e 3e3e 2069 6e70 7574 5f74 656e     >>> input_ten
+000092e0: 736f 7220 3d20 746f 7263 682e 7465 6e73  sor = torch.tens
+000092f0: 6f72 285b 312e 2c20 322e 2c20 332e 5d29  or([1., 2., 3.])
+00009300: 0a20 2020 203e 3e3e 206f 7574 7075 7420  .    >>> output 
+00009310: 3d20 6c61 7965 7228 696e 7075 745f 7465  = layer(input_te
+00009320: 6e73 6f72 290a 2020 2020 2222 220a 0a20  nsor).    """.. 
+00009330: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00009340: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00009350: 2020 2020 2020 2064 5f69 6e70 7574 3a20         d_input: 
+00009360: 696e 7420 3d20 3336 2c0a 2020 2020 2020  int = 36,.      
+00009370: 2020 2020 2020 2020 2020 2064 5f6f 7574             d_out
+00009380: 7075 743a 2069 6e74 203d 2031 3032 342c  put: int = 1024,
+00009390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000093a0: 2020 6472 6f70 6f75 745f 703a 2066 6c6f    dropout_p: flo
+000093b0: 6174 203d 2030 2e30 293a 0a20 2020 2020  at = 0.0):.     
+000093c0: 2020 2022 2222 496e 6974 6961 6c69 7a65     """Initialize
+000093d0: 2061 204d 4154 456d 6265 6464 696e 6720   a MATEmbedding 
+000093e0: 6c61 7965 722e 0a0a 2020 2020 2020 2020  layer...        
+000093f0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00009400: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00009410: 2020 2020 2020 645f 696e 7075 743a 2069        d_input: i
+00009420: 6e74 0a20 2020 2020 2020 2020 2020 2053  nt.            S
+00009430: 697a 6520 6f66 2069 6e70 7574 206c 6179  ize of input lay
+00009440: 6572 2e0a 2020 2020 2020 2020 645f 6f75  er..        d_ou
+00009450: 7470 7574 3a20 696e 740a 2020 2020 2020  tput: int.      
+00009460: 2020 2020 2020 5369 7a65 206f 6620 6f75        Size of ou
+00009470: 7470 7574 206c 6179 6572 2e0a 2020 2020  tput layer..    
+00009480: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
+00009490: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+000094a0: 2044 726f 706f 7574 2070 726f 6261 6269   Dropout probabi
+000094b0: 6c69 7479 2066 6f72 206c 6179 6572 2e0a  lity for layer..
+000094c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000094d0: 2020 2020 7375 7065 7228 4d41 5445 6d62      super(MATEmb
+000094e0: 6564 6469 6e67 2c20 7365 6c66 292e 5f5f  edding, self).__
+000094f0: 696e 6974 5f5f 2829 0a20 2020 2020 2020  init__().       
+00009500: 2073 656c 662e 6c69 6e65 6172 5f75 6e69   self.linear_uni
+00009510: 7420 3d20 6e6e 2e4c 696e 6561 7228 645f  t = nn.Linear(d_
+00009520: 696e 7075 742c 2064 5f6f 7574 7075 7429  input, d_output)
+00009530: 0a20 2020 2020 2020 2073 656c 662e 6472  .        self.dr
+00009540: 6f70 6f75 7420 3d20 6e6e 2e44 726f 706f  opout = nn.Dropo
+00009550: 7574 2864 726f 706f 7574 5f70 290a 0a20  ut(dropout_p).. 
+00009560: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
+00009570: 656c 662c 2078 3a20 746f 7263 682e 5465  elf, x: torch.Te
+00009580: 6e73 6f72 2920 2d3e 2074 6f72 6368 2e54  nsor) -> torch.T
+00009590: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
+000095a0: 2222 436f 6d70 7574 6174 696f 6e20 666f  ""Computation fo
+000095b0: 7220 7468 6520 4d41 5445 6d62 6564 6469  r the MATEmbeddi
+000095c0: 6e67 206c 6179 6572 2e0a 0a20 2020 2020  ng layer...     
+000095d0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+000095e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+000095f0: 0a20 2020 2020 2020 2078 3a20 746f 7263  .        x: torc
+00009600: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00009610: 2020 2020 2049 6e70 7574 2074 656e 736f       Input tenso
+00009620: 7220 746f 2062 6520 636f 6e76 6572 7465  r to be converte
+00009630: 6420 696e 746f 2061 2076 6563 746f 722e  d into a vector.
+00009640: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00009650: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00009660: 2e64 726f 706f 7574 2873 656c 662e 6c69  .dropout(self.li
+00009670: 6e65 6172 5f75 6e69 7428 7829 290a 0a0a  near_unit(x))...
+00009680: 636c 6173 7320 4d41 5447 656e 6572 6174  class MATGenerat
+00009690: 6f72 286e 6e2e 4d6f 6475 6c65 293a 0a20  or(nn.Module):. 
+000096a0: 2020 2022 2222 4d41 5447 656e 6572 6174     """MATGenerat
+000096b0: 6f72 2064 6566 696e 6573 2074 6865 206c  or defines the l
+000096c0: 696e 6561 7220 616e 6420 736f 6674 6d61  inear and softma
+000096d0: 7820 6765 6e65 7261 746f 7220 7374 6570  x generator step
+000096e0: 2066 6f72 2074 6865 204d 6f6c 6563 756c   for the Molecul
+000096f0: 6172 2041 7474 656e 7469 6f6e 2054 7261  ar Attention Tra
+00009700: 6e73 666f 726d 6572 205b 315d 5f2e 0a0a  nsformer [1]_...
+00009710: 2020 2020 496e 2074 6865 204d 4154 4765      In the MATGe
+00009720: 6e65 7261 746f 722c 2061 2047 656e 6572  nerator, a Gener
+00009730: 6174 6f72 2069 7320 6465 6669 6e65 6420  ator is defined 
+00009740: 7768 6963 6820 7065 7266 6f72 6d73 2074  which performs t
+00009750: 6865 204c 696e 6561 7220 2b20 536f 6674  he Linear + Soft
+00009760: 6d61 7820 6765 6e65 7261 7469 6f6e 2073  max generation s
+00009770: 7465 702e 0a20 2020 2044 6570 656e 6469  tep..    Dependi
+00009780: 6e67 206f 6e20 7468 6520 7479 7065 206f  ng on the type o
+00009790: 6620 6167 6772 6567 6174 696f 6e20 7365  f aggregation se
+000097a0: 6c65 6374 6564 2c20 7468 6520 6174 7465  lected, the atte
+000097b0: 6e74 696f 6e20 6f75 7470 7574 206c 6179  ntion output lay
+000097c0: 6572 2070 6572 666f 726d 7320 6469 6666  er performs diff
+000097d0: 6572 656e 7420 6f70 6572 6174 696f 6e73  erent operations
+000097e0: 2e0a 0a20 2020 2052 6566 6572 656e 6365  ...    Reference
+000097f0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+00009800: 0a20 2020 202e 2e20 5b31 5d20 4c75 6b61  .    .. [1] Luka
+00009810: 737a 204d 617a 6961 726b 6120 6574 2061  sz Maziarka et a
+00009820: 6c2e 2022 4d6f 6c65 6375 6c65 2041 7474  l. "Molecule Att
+00009830: 656e 7469 6f6e 2054 7261 6e73 666f 726d  ention Transform
+00009840: 6572 2220 4772 6170 6820 5265 7072 6573  er" Graph Repres
+00009850: 656e 7461 7469 6f6e 204c 6561 726e 696e  entation Learnin
+00009860: 6720 776f 726b 7368 6f70 2061 6e64 204d  g workshop and M
+00009870: 6163 6869 6e65 204c 6561 726e 696e 6720  achine Learning 
+00009880: 616e 6420 7468 6520 5068 7973 6963 616c  and the Physical
+00009890: 2053 6369 656e 6365 7320 776f 726b 7368   Sciences worksh
+000098a0: 6f70 2061 7420 4e65 7572 4950 5320 3230  op at NeurIPS 20
+000098b0: 3139 2e20 3230 3230 2e20 6874 7470 733a  19. 2020. https:
+000098c0: 2f2f 6172 7869 762e 6f72 672f 6162 732f  //arxiv.org/abs/
+000098d0: 3230 3032 2e30 3832 3634 0a0a 2020 2020  2002.08264..    
+000098e0: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
+000098f0: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 6672  -----.    >>> fr
+00009900: 6f6d 2064 6565 7063 6865 6d2e 6d6f 6465  om deepchem.mode
+00009910: 6c73 2e74 6f72 6368 5f6d 6f64 656c 732e  ls.torch_models.
+00009920: 6c61 7965 7273 2069 6d70 6f72 7420 4d41  layers import MA
+00009930: 5447 656e 6572 6174 6f72 0a20 2020 203e  TGenerator.    >
+00009940: 3e3e 206c 6179 6572 203d 204d 4154 4765  >> layer = MATGe
+00009950: 6e65 7261 746f 7228 6873 697a 6520 3d20  nerator(hsize = 
+00009960: 332c 2061 6767 7265 6761 7469 6f6e 5f74  3, aggregation_t
+00009970: 7970 6520 3d20 276d 6561 6e27 2c20 645f  ype = 'mean', d_
+00009980: 6f75 7470 7574 203d 2031 2c20 6e5f 6c61  output = 1, n_la
+00009990: 7965 7273 203d 2031 2c20 6472 6f70 6f75  yers = 1, dropou
+000099a0: 745f 7020 3d20 302e 332c 2061 7474 6e5f  t_p = 0.3, attn_
+000099b0: 6869 6464 656e 203d 2031 3238 2c20 6174  hidden = 128, at
+000099c0: 746e 5f6f 7574 203d 2034 290a 2020 2020  tn_out = 4).    
+000099d0: 3e3e 3e20 696e 7075 745f 7465 6e73 6f72  >>> input_tensor
+000099e0: 203d 2074 6f72 6368 2e74 656e 736f 7228   = torch.tensor(
+000099f0: 5b31 2e2c 2032 2e2c 2033 2e5d 290a 2020  [1., 2., 3.]).  
+00009a00: 2020 3e3e 3e20 6d61 736b 203d 2074 6f72    >>> mask = tor
+00009a10: 6368 2e74 656e 736f 7228 5b31 2e2c 2031  ch.tensor([1., 1
+00009a20: 2e2c 2031 2e5d 290a 2020 2020 3e3e 3e20  ., 1.]).    >>> 
+00009a30: 6f75 7470 7574 203d 206c 6179 6572 2869  output = layer(i
+00009a40: 6e70 7574 5f74 656e 736f 722c 206d 6173  nput_tensor, mas
+00009a50: 6b29 0a20 2020 2022 2222 0a0a 2020 2020  k).    """..    
+00009a60: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00009a70: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
+00009a80: 2020 2020 6873 697a 653a 2069 6e74 203d      hsize: int =
+00009a90: 2031 3032 342c 0a20 2020 2020 2020 2020   1024,.         
+00009aa0: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
+00009ab0: 696f 6e5f 7479 7065 3a20 7374 7220 3d20  ion_type: str = 
+00009ac0: 276d 6561 6e27 2c0a 2020 2020 2020 2020  'mean',.        
+00009ad0: 2020 2020 2020 2020 2064 5f6f 7574 7075           d_outpu
+00009ae0: 743a 2069 6e74 203d 2031 2c0a 2020 2020  t: int = 1,.    
+00009af0: 2020 2020 2020 2020 2020 2020 206e 5f6c               n_l
+00009b00: 6179 6572 733a 2069 6e74 203d 2031 2c0a  ayers: int = 1,.
+00009b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b20: 2064 726f 706f 7574 5f70 3a20 666c 6f61   dropout_p: floa
+00009b30: 7420 3d20 302e 302c 0a20 2020 2020 2020  t = 0.0,.       
+00009b40: 2020 2020 2020 2020 2020 6174 746e 5f68            attn_h
+00009b50: 6964 6465 6e3a 2069 6e74 203d 2031 3238  idden: int = 128
+00009b60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009b70: 2020 2061 7474 6e5f 6f75 743a 2069 6e74     attn_out: int
+00009b80: 203d 2034 293a 0a20 2020 2020 2020 2022   = 4):.        "
+00009b90: 2222 496e 6974 6961 6c69 7a65 2061 204d  ""Initialize a M
+00009ba0: 4154 4765 6e65 7261 746f 722e 0a0a 2020  ATGenerator...  
+00009bb0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00009bc0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00009bd0: 2d2d 2d0a 2020 2020 2020 2020 6873 697a  ---.        hsiz
+00009be0: 653a 2069 6e74 0a20 2020 2020 2020 2020  e: int.         
+00009bf0: 2020 2053 697a 6520 6f66 2069 6e70 7574     Size of input
+00009c00: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+00009c10: 6167 6772 6567 6174 696f 6e5f 7479 7065  aggregation_type
+00009c20: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
+00009c30: 2020 5479 7065 206f 6620 6167 6772 6567    Type of aggreg
+00009c40: 6174 696f 6e20 746f 2062 6520 7573 6564  ation to be used
+00009c50: 2e20 4361 6e20 6265 2027 6772 6f76 6572  . Can be 'grover
+00009c60: 272c 2027 6d65 616e 2720 6f72 2027 636f  ', 'mean' or 'co
+00009c70: 6e74 6578 7475 616c 272e 0a20 2020 2020  ntextual'..     
+00009c80: 2020 2064 5f6f 7574 7075 743a 2069 6e74     d_output: int
+00009c90: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
+00009ca0: 6520 6f66 206f 7574 7075 7420 6c61 7965  e of output laye
+00009cb0: 722e 0a20 2020 2020 2020 206e 5f6c 6179  r..        n_lay
+00009cc0: 6572 733a 2069 6e74 0a20 2020 2020 2020  ers: int.       
+00009cd0: 2020 2020 204e 756d 6265 7220 6f66 206c       Number of l
+00009ce0: 6179 6572 7320 696e 204d 4154 4765 6e65  ayers in MATGene
+00009cf0: 7261 746f 722e 0a20 2020 2020 2020 2064  rator..        d
+00009d00: 726f 706f 7574 5f70 3a20 666c 6f61 740a  ropout_p: float.
+00009d10: 2020 2020 2020 2020 2020 2020 4472 6f70              Drop
+00009d20: 6f75 7420 7072 6f62 6162 696c 6974 7920  out probability 
+00009d30: 666f 7220 6c61 7965 722e 0a20 2020 2020  for layer..     
+00009d40: 2020 2061 7474 6e5f 6869 6464 656e 3a20     attn_hidden: 
+00009d50: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+00009d60: 5369 7a65 206f 6620 6869 6464 656e 2061  Size of hidden a
+00009d70: 7474 656e 7469 6f6e 206c 6179 6572 2e0a  ttention layer..
+00009d80: 2020 2020 2020 2020 6174 746e 5f6f 7574          attn_out
+00009d90: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
+00009da0: 2020 5369 7a65 206f 6620 6f75 7470 7574    Size of output
+00009db0: 2061 7474 656e 7469 6f6e 206c 6179 6572   attention layer
+00009dc0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00009dd0: 2020 2020 2020 7375 7065 7228 4d41 5447        super(MATG
+00009de0: 656e 6572 6174 6f72 2c20 7365 6c66 292e  enerator, self).
+00009df0: 5f5f 696e 6974 5f5f 2829 0a0a 2020 2020  __init__()..    
+00009e00: 2020 2020 6966 2061 6767 7265 6761 7469      if aggregati
+00009e10: 6f6e 5f74 7970 6520 3d3d 2027 6772 6f76  on_type == 'grov
+00009e20: 6572 273a 0a20 2020 2020 2020 2020 2020  er':.           
+00009e30: 2073 656c 662e 6174 745f 6e65 7420 3d20   self.att_net = 
+00009e40: 6e6e 2e53 6571 7565 6e74 6961 6c28 0a20  nn.Sequential(. 
+00009e50: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00009e60: 6e2e 4c69 6e65 6172 2868 7369 7a65 2c20  n.Linear(hsize, 
+00009e70: 6174 746e 5f68 6964 6465 6e2c 2062 6961  attn_hidden, bia
+00009e80: 733d 4661 6c73 6529 2c0a 2020 2020 2020  s=False),.      
+00009e90: 2020 2020 2020 2020 2020 6e6e 2e54 616e            nn.Tan
+00009ea0: 6828 292c 0a20 2020 2020 2020 2020 2020  h(),.           
+00009eb0: 2020 2020 206e 6e2e 4c69 6e65 6172 2861       nn.Linear(a
+00009ec0: 7474 6e5f 6869 6464 656e 2c20 6174 746e  ttn_hidden, attn
+00009ed0: 5f6f 7574 2c20 6269 6173 3d46 616c 7365  _out, bias=False
+00009ee0: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+00009ef0: 0a20 2020 2020 2020 2020 2020 2068 7369  .            hsi
+00009f00: 7a65 202a 3d20 6174 746e 5f6f 7574 0a0a  ze *= attn_out..
+00009f10: 2020 2020 2020 2020 6966 206e 5f6c 6179          if n_lay
+00009f20: 6572 7320 3d3d 2031 3a0a 2020 2020 2020  ers == 1:.      
+00009f30: 2020 2020 2020 7365 6c66 2e70 726f 6a3a        self.proj:
+00009f40: 2041 6e79 203d 206e 6e2e 4c69 6e65 6172   Any = nn.Linear
+00009f50: 2868 7369 7a65 2c20 645f 6f75 7470 7574  (hsize, d_output
+00009f60: 290a 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00009f70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00009f80: 662e 7072 6f6a 203d 205b 5d0a 0a20 2020  f.proj = []..   
+00009f90: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+00009fa0: 6e20 7261 6e67 6528 6e5f 6c61 7965 7273  n range(n_layers
+00009fb0: 202d 2031 293a 0a20 2020 2020 2020 2020   - 1):.         
+00009fc0: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
+00009fd0: 2e61 7070 656e 6428 6e6e 2e4c 696e 6561  .append(nn.Linea
+00009fe0: 7228 6873 697a 652c 2061 7474 6e5f 6869  r(hsize, attn_hi
+00009ff0: 6464 656e 2929 0a20 2020 2020 2020 2020  dden)).         
+0000a000: 2020 2020 2020 2073 656c 662e 7072 6f6a         self.proj
+0000a010: 2e61 7070 656e 6428 6e6e 2e4c 6561 6b79  .append(nn.Leaky
+0000a020: 5265 4c55 286e 6567 6174 6976 655f 736c  ReLU(negative_sl
+0000a030: 6f70 653d 302e 3129 290a 2020 2020 2020  ope=0.1)).      
+0000a040: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000a050: 726f 6a2e 6170 7065 6e64 286e 6e2e 4c61  roj.append(nn.La
+0000a060: 7965 724e 6f72 6d28 6174 746e 5f68 6964  yerNorm(attn_hid
+0000a070: 6465 6e29 290a 2020 2020 2020 2020 2020  den)).          
+0000a080: 2020 2020 2020 7365 6c66 2e70 726f 6a2e        self.proj.
+0000a090: 6170 7065 6e64 286e 6e2e 4472 6f70 6f75  append(nn.Dropou
+0000a0a0: 7428 6472 6f70 6f75 745f 7029 290a 2020  t(dropout_p)).  
+0000a0b0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000a0c0: 726f 6a2e 6170 7065 6e64 286e 6e2e 4c69  roj.append(nn.Li
+0000a0d0: 6e65 6172 2861 7474 6e5f 6869 6464 656e  near(attn_hidden
+0000a0e0: 2c20 645f 6f75 7470 7574 2929 0a20 2020  , d_output)).   
+0000a0f0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000a100: 6f6a 203d 2074 6f72 6368 2e6e 6e2e 5365  oj = torch.nn.Se
+0000a110: 7175 656e 7469 616c 282a 7365 6c66 2e70  quential(*self.p
+0000a120: 726f 6a29 0a20 2020 2020 2020 2073 656c  roj).        sel
+0000a130: 662e 6167 6772 6567 6174 696f 6e5f 7479  f.aggregation_ty
+0000a140: 7065 203d 2061 6767 7265 6761 7469 6f6e  pe = aggregation
+0000a150: 5f74 7970 650a 0a20 2020 2064 6566 2066  _type..    def f
+0000a160: 6f72 7761 7264 2873 656c 662c 2078 3a20  orward(self, x: 
+0000a170: 746f 7263 682e 5465 6e73 6f72 2c20 6d61  torch.Tensor, ma
+0000a180: 736b 3a20 746f 7263 682e 5465 6e73 6f72  sk: torch.Tensor
+0000a190: 2920 2d3e 2074 6f72 6368 2e54 656e 736f  ) -> torch.Tenso
+0000a1a0: 723a 0a20 2020 2020 2020 2022 2222 436f  r:.        """Co
+0000a1b0: 6d70 7574 6174 696f 6e20 666f 7220 7468  mputation for th
+0000a1c0: 6520 4d41 5447 656e 6572 6174 6f72 206c  e MATGenerator l
+0000a1d0: 6179 6572 2e0a 0a20 2020 2020 2020 2050  ayer...        P
+0000a1e0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0000a1f0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0000a200: 2020 2020 2078 3a20 746f 7263 682e 5465       x: torch.Te
+0000a210: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+0000a220: 2049 6e70 7574 2074 656e 736f 722e 0a20   Input tensor.. 
+0000a230: 2020 2020 2020 206d 6173 6b3a 2074 6f72         mask: tor
+0000a240: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+0000a250: 2020 2020 2020 4d61 736b 2066 6f72 2070        Mask for p
+0000a260: 6164 6469 6e67 2073 6f20 7468 6174 2070  adding so that p
+0000a270: 6164 6465 6420 7661 6c75 6573 2064 6f20  added values do 
+0000a280: 6e6f 7420 6765 7420 696e 636c 7564 6564  not get included
+0000a290: 2069 6e20 6174 7465 6e74 696f 6e20 7363   in attention sc
+0000a2a0: 6f72 6520 6361 6c63 756c 6174 696f 6e2e  ore calculation.
+0000a2b0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0000a2c0: 2020 2020 2020 6d61 736b 203d 206d 6173        mask = mas
+0000a2d0: 6b2e 756e 7371 7565 657a 6528 2d31 292e  k.unsqueeze(-1).
+0000a2e0: 666c 6f61 7428 290a 2020 2020 2020 2020  float().        
+0000a2f0: 6f75 745f 6d61 736b 6564 203d 2078 202a  out_masked = x *
+0000a300: 206d 6173 6b0a 0a20 2020 2020 2020 2069   mask..        i
+0000a310: 6620 7365 6c66 2e61 6767 7265 6761 7469  f self.aggregati
+0000a320: 6f6e 5f74 7970 6520 3d3d 2027 6d65 616e  on_type == 'mean
+0000a330: 273a 0a20 2020 2020 2020 2020 2020 206f  ':.            o
+0000a340: 7574 5f73 756d 203d 206f 7574 5f6d 6173  ut_sum = out_mas
+0000a350: 6b65 642e 7375 6d28 6469 6d3d 3129 0a20  ked.sum(dim=1). 
+0000a360: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
+0000a370: 7375 6d20 3d20 6d61 736b 2e73 756d 2864  sum = mask.sum(d
+0000a380: 696d 3d28 3129 290a 2020 2020 2020 2020  im=(1)).        
+0000a390: 2020 2020 6f75 745f 6176 675f 706f 6f6c      out_avg_pool
+0000a3a0: 696e 6720 3d20 6f75 745f 7375 6d20 2f20  ing = out_sum / 
+0000a3b0: 6d61 736b 5f73 756d 0a0a 2020 2020 2020  mask_sum..      
+0000a3c0: 2020 656c 6966 2073 656c 662e 6167 6772    elif self.aggr
+0000a3d0: 6567 6174 696f 6e5f 7479 7065 203d 3d20  egation_type == 
+0000a3e0: 2767 726f 7665 7227 3a0a 2020 2020 2020  'grover':.      
+0000a3f0: 2020 2020 2020 6f75 745f 6174 746e 203d        out_attn =
+0000a400: 2073 656c 662e 6174 745f 6e65 7428 6f75   self.att_net(ou
+0000a410: 745f 6d61 736b 6564 290a 2020 2020 2020  t_masked).      
+0000a420: 2020 2020 2020 6f75 745f 6174 746e 203d        out_attn =
+0000a430: 206f 7574 5f61 7474 6e2e 6d61 736b 6564   out_attn.masked
+0000a440: 5f66 696c 6c28 6d61 736b 203d 3d20 302c  _fill(mask == 0,
+0000a450: 202d 3165 3929 0a20 2020 2020 2020 2020   -1e9).         
+0000a460: 2020 206f 7574 5f61 7474 6e20 3d20 462e     out_attn = F.
+0000a470: 736f 6674 6d61 7828 6f75 745f 6174 746e  softmax(out_attn
+0000a480: 2c20 6469 6d3d 3129 0a20 2020 2020 2020  , dim=1).       
+0000a490: 2020 2020 206f 7574 5f61 7667 5f70 6f6f       out_avg_poo
+0000a4a0: 6c69 6e67 203d 2074 6f72 6368 2e6d 6174  ling = torch.mat
+0000a4b0: 6d75 6c28 746f 7263 682e 7472 616e 7370  mul(torch.transp
+0000a4c0: 6f73 6528 6f75 745f 6174 746e 2c20 2d31  ose(out_attn, -1
+0000a4d0: 2c20 2d32 292c 0a20 2020 2020 2020 2020  , -2),.         
 0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4f0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-0000a500: 6d61 736b 6564 290a 2020 2020 2020 2020  masked).        
-0000a510: 2020 2020 6f75 745f 6176 675f 706f 6f6c      out_avg_pool
-0000a520: 696e 6720 3d20 6f75 745f 6176 675f 706f  ing = out_avg_po
-0000a530: 6f6c 696e 672e 7669 6577 286f 7574 5f61  oling.view(out_a
-0000a540: 7667 5f70 6f6f 6c69 6e67 2e73 697a 6528  vg_pooling.size(
-0000a550: 3029 2c20 2d31 290a 0a20 2020 2020 2020  0), -1)..       
-0000a560: 2065 6c69 6620 7365 6c66 2e61 6767 7265   elif self.aggre
-0000a570: 6761 7469 6f6e 5f74 7970 6520 3d3d 2027  gation_type == '
-0000a580: 636f 6e74 6578 7475 616c 273a 0a20 2020  contextual':.   
-0000a590: 2020 2020 2020 2020 206f 7574 5f61 7667           out_avg
-0000a5a0: 5f70 6f6f 6c69 6e67 203d 2078 0a0a 2020  _pooling = x..  
-0000a5b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000a5c0: 662e 7072 6f6a 286f 7574 5f61 7667 5f70  f.proj(out_avg_p
-0000a5d0: 6f6f 6c69 6e67 290a 0a0a 636c 6173 7320  ooling)...class 
-0000a5e0: 4772 6170 684e 6574 776f 726b 2874 6f72  GraphNetwork(tor
-0000a5f0: 6368 2e6e 6e2e 4d6f 6475 6c65 293a 0a20  ch.nn.Module):. 
-0000a600: 2020 2022 2222 4772 6170 6820 4e65 7477     """Graph Netw
-0000a610: 6f72 6b73 0a0a 2020 2020 4120 4772 6170  orks..    A Grap
-0000a620: 6820 4e65 7477 6f72 6b20 5b31 5d5f 2074  h Network [1]_ t
-0000a630: 616b 6573 2061 2067 7261 7068 2061 7320  akes a graph as 
-0000a640: 696e 7075 7420 616e 6420 7265 7475 726e  input and return
-0000a650: 7320 616e 2075 7064 6174 6564 2067 7261  s an updated gra
-0000a660: 7068 0a20 2020 2061 7320 6f75 7470 7574  ph.    as output
-0000a670: 2e20 5468 6520 6f75 7470 7574 2067 7261  . The output gra
-0000a680: 7068 2068 6173 2073 616d 6520 7374 7275  ph has same stru
-0000a690: 6374 7572 6520 6173 2069 6e70 7574 2067  cture as input g
-0000a6a0: 7261 7068 2062 7574 2069 740a 2020 2020  raph but it.    
-0000a6b0: 6861 7320 7570 6461 7465 6420 6e6f 6465  has updated node
-0000a6c0: 2066 6561 7475 7265 732c 2065 6467 6520   features, edge 
-0000a6d0: 6665 6174 7572 6573 2061 6e64 2067 6c6f  features and glo
-0000a6e0: 6261 6c20 7374 6174 6520 6665 6174 7572  bal state featur
-0000a6f0: 6573 2e0a 0a20 2020 2050 6172 616d 6574  es...    Paramet
-0000a700: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-0000a710: 2d2d 0a20 2020 206e 5f6e 6f64 655f 6665  --.    n_node_fe
-0000a720: 6174 7572 6573 3a20 696e 740a 2020 2020  atures: int.    
-0000a730: 2020 2020 4e75 6d62 6572 206f 6620 6665      Number of fe
-0000a740: 6174 7572 6573 2069 6e20 6120 6e6f 6465  atures in a node
-0000a750: 0a20 2020 206e 5f65 6467 655f 6665 6174  .    n_edge_feat
-0000a760: 7572 6573 3a20 696e 740a 2020 2020 2020  ures: int.      
-0000a770: 2020 4e75 6d62 6572 206f 6620 6665 6174    Number of feat
-0000a780: 7572 6573 2069 6e20 6120 6564 6765 0a20  ures in a edge. 
-0000a790: 2020 206e 5f67 6c6f 6261 6c5f 6665 6174     n_global_feat
-0000a7a0: 7572 6573 3a20 696e 740a 2020 2020 2020  ures: int.      
-0000a7b0: 2020 4e75 6d62 6572 206f 6620 676c 6f62    Number of glob
-0000a7c0: 616c 2066 6561 7475 7265 730a 2020 2020  al features.    
-0000a7d0: 6973 5f75 6e64 6972 6563 7465 643a 2062  is_undirected: b
-0000a7e0: 6f6f 6c2c 206f 7074 696f 6e61 6c20 2864  ool, optional (d
-0000a7f0: 6566 6175 6c74 2054 7275 6529 0a20 2020  efault True).   
-0000a800: 2020 2020 2044 6972 6563 7465 6420 6f72       Directed or
-0000a810: 2075 6e64 6972 6563 7465 6420 6772 6170   undirected grap
-0000a820: 680a 2020 2020 7265 7369 6475 616c 5f63  h.    residual_c
-0000a830: 6f6e 6e65 6374 696f 6e3a 2062 6f6f 6c2c  onnection: bool,
-0000a840: 206f 7074 696f 6e61 6c20 2864 6566 6175   optional (defau
-0000a850: 6c74 2054 7275 6529 0a20 2020 2020 2020  lt True).       
-0000a860: 2049 6620 5472 7565 2c20 7468 6520 6c61   If True, the la
-0000a870: 7965 7220 7573 6573 2061 2072 6573 6964  yer uses a resid
-0000a880: 7561 6c20 636f 6e6e 6563 7469 6f6e 2064  ual connection d
-0000a890: 7572 696e 6720 7472 6169 6e69 6e67 0a0a  uring training..
-0000a8a0: 2020 2020 4578 616d 706c 650a 2020 2020      Example.    
-0000a8b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
-0000a8c0: 696d 706f 7274 2074 6f72 6368 0a20 2020  import torch.   
-0000a8d0: 203e 3e3e 2066 726f 6d20 6465 6570 6368   >>> from deepch
-0000a8e0: 656d 2e6d 6f64 656c 732e 746f 7263 685f  em.models.torch_
-0000a8f0: 6d6f 6465 6c73 2e6c 6179 6572 7320 696d  models.layers im
-0000a900: 706f 7274 2047 7261 7068 4e65 7477 6f72  port GraphNetwor
-0000a910: 6b20 6173 2047 4e0a 2020 2020 3e3e 3e20  k as GN.    >>> 
-0000a920: 6e5f 6e6f 6465 732c 206e 5f6e 6f64 655f  n_nodes, n_node_
-0000a930: 6665 6174 7572 6573 203d 2035 2c20 3130  features = 5, 10
-0000a940: 0a20 2020 203e 3e3e 206e 5f65 6467 6573  .    >>> n_edges
-0000a950: 2c20 6e5f 6564 6765 5f66 6561 7475 7265  , n_edge_feature
-0000a960: 7320 3d20 352c 2032 0a20 2020 203e 3e3e  s = 5, 2.    >>>
-0000a970: 206e 5f67 6c6f 6261 6c5f 6665 6174 7572   n_global_featur
-0000a980: 6573 203d 2034 0a20 2020 203e 3e3e 206e  es = 4.    >>> n
-0000a990: 6f64 655f 6665 6174 7572 6573 203d 2074  ode_features = t
-0000a9a0: 6f72 6368 2e72 616e 646e 286e 5f6e 6f64  orch.randn(n_nod
-0000a9b0: 6573 2c20 6e5f 6e6f 6465 5f66 6561 7475  es, n_node_featu
-0000a9c0: 7265 7329 0a20 2020 203e 3e3e 2065 6467  res).    >>> edg
-0000a9d0: 655f 6665 6174 7572 6573 203d 2074 6f72  e_features = tor
-0000a9e0: 6368 2e72 616e 646e 286e 5f65 6467 6573  ch.randn(n_edges
-0000a9f0: 2c20 6e5f 6564 6765 5f66 6561 7475 7265  , n_edge_feature
-0000aa00: 7329 0a20 2020 203e 3e3e 2065 6467 655f  s).    >>> edge_
-0000aa10: 696e 6465 7820 3d20 746f 7263 682e 7465  index = torch.te
-0000aa20: 6e73 6f72 285b 5b30 2c20 312c 2032 2c20  nsor([[0, 1, 2, 
-0000aa30: 332c 2034 5d2c 205b 312c 2032 2c20 332c  3, 4], [1, 2, 3,
-0000aa40: 2034 2c20 305d 5d29 2e6c 6f6e 6728 290a   4, 0]]).long().
-0000aa50: 2020 2020 3e3e 3e20 676c 6f62 616c 5f66      >>> global_f
-0000aa60: 6561 7475 7265 7320 3d20 746f 7263 682e  eatures = torch.
-0000aa70: 7261 6e64 6e28 312c 206e 5f67 6c6f 6261  randn(1, n_globa
-0000aa80: 6c5f 6665 6174 7572 6573 290a 2020 2020  l_features).    
-0000aa90: 3e3e 3e20 676e 203d 2047 4e28 6e5f 6e6f  >>> gn = GN(n_no
-0000aaa0: 6465 5f66 6561 7475 7265 733d 6e5f 6e6f  de_features=n_no
-0000aab0: 6465 5f66 6561 7475 7265 732c 206e 5f65  de_features, n_e
-0000aac0: 6467 655f 6665 6174 7572 6573 3d6e 5f65  dge_features=n_e
-0000aad0: 6467 655f 6665 6174 7572 6573 2c20 6e5f  dge_features, n_
-0000aae0: 676c 6f62 616c 5f66 6561 7475 7265 733d  global_features=
-0000aaf0: 6e5f 676c 6f62 616c 5f66 6561 7475 7265  n_global_feature
-0000ab00: 7329 0a20 2020 203e 3e3e 206e 6f64 655f  s).    >>> node_
-0000ab10: 6665 6174 7572 6573 2c20 6564 6765 5f66  features, edge_f
-0000ab20: 6561 7475 7265 732c 2067 6c6f 6261 6c5f  eatures, global_
-0000ab30: 6665 6174 7572 6573 203d 2067 6e28 6e6f  features = gn(no
-0000ab40: 6465 5f66 6561 7475 7265 732c 2065 6467  de_features, edg
-0000ab50: 655f 696e 6465 782c 2065 6467 655f 6665  e_index, edge_fe
-0000ab60: 6174 7572 6573 2c20 676c 6f62 616c 5f66  atures, global_f
-0000ab70: 6561 7475 7265 7329 0a0a 2020 2020 5265  eatures)..    Re
-0000ab80: 6665 7265 6e63 6573 0a20 2020 202d 2d2d  ferences.    ---
-0000ab90: 2d2d 2d2d 2d2d 2d0a 2020 2020 2e2e 205b  -------.    .. [
-0000aba0: 315d 2042 6174 7461 676c 6961 2065 7420  1] Battaglia et 
-0000abb0: 616c 2c20 5265 6c61 7469 6f6e 616c 2069  al, Relational i
-0000abc0: 6e64 7563 7469 7665 2062 6961 7365 732c  nductive biases,
-0000abd0: 2064 6565 7020 6c65 6172 6e69 6e67 2c20   deep learning, 
-0000abe0: 616e 6420 6772 6170 6820 6e65 7477 6f72  and graph networ
-0000abf0: 6b73 2e20 6874 7470 733a 2f2f 6172 7869  ks. https://arxi
-0000ac00: 762e 6f72 672f 6162 732f 3138 3036 2e30  v.org/abs/1806.0
-0000ac10: 3132 3631 2028 3230 3138 290a 2020 2222  1261 (2018).  ""
-0000ac20: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-0000ac30: 745f 5f28 7365 6c66 2c0a 2020 2020 2020  t__(self,.      
-0000ac40: 2020 2020 2020 2020 2020 206e 5f6e 6f64             n_nod
-0000ac50: 655f 6665 6174 7572 6573 3a20 696e 7420  e_features: int 
-0000ac60: 3d20 3332 2c0a 2020 2020 2020 2020 2020  = 32,.          
-0000ac70: 2020 2020 2020 206e 5f65 6467 655f 6665         n_edge_fe
-0000ac80: 6174 7572 6573 3a20 696e 7420 3d20 3332  atures: int = 32
-0000ac90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000aca0: 2020 206e 5f67 6c6f 6261 6c5f 6665 6174     n_global_feat
-0000acb0: 7572 6573 3a20 696e 7420 3d20 3332 2c0a  ures: int = 32,.
-0000acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acd0: 2069 735f 756e 6469 7265 6374 6564 3a20   is_undirected: 
-0000ace0: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-0000acf0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000ad00: 7369 6475 616c 5f63 6f6e 6e65 6374 696f  sidual_connectio
-0000ad10: 6e3a 2062 6f6f 6c20 3d20 5472 7565 293a  n: bool = True):
-0000ad20: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
-0000ad30: 2e5f 5f69 6e69 745f 5f28 290a 2020 2020  .__init__().    
-0000ad40: 2020 2020 7365 6c66 2e6e 5f6e 6f64 655f      self.n_node_
-0000ad50: 6665 6174 7572 6573 203d 206e 5f6e 6f64  features = n_nod
-0000ad60: 655f 6665 6174 7572 6573 0a20 2020 2020  e_features.     
-0000ad70: 2020 2073 656c 662e 6e5f 6564 6765 5f66     self.n_edge_f
-0000ad80: 6561 7475 7265 7320 3d20 6e5f 6564 6765  eatures = n_edge
-0000ad90: 5f66 6561 7475 7265 730a 2020 2020 2020  _features.      
-0000ada0: 2020 7365 6c66 2e6e 5f67 6c6f 6261 6c5f    self.n_global_
-0000adb0: 6665 6174 7572 6573 203d 206e 5f67 6c6f  features = n_glo
-0000adc0: 6261 6c5f 6665 6174 7572 6573 0a20 2020  bal_features.   
-0000add0: 2020 2020 2073 656c 662e 6973 5f75 6e64       self.is_und
-0000ade0: 6972 6563 7465 6420 3d20 6973 5f75 6e64  irected = is_und
-0000adf0: 6972 6563 7465 640a 2020 2020 2020 2020  irected.        
-0000ae00: 7365 6c66 2e72 6573 6964 7561 6c5f 636f  self.residual_co
-0000ae10: 6e6e 6563 7469 6f6e 203d 2072 6573 6964  nnection = resid
-0000ae20: 7561 6c5f 636f 6e6e 6563 7469 6f6e 0a0a  ual_connection..
-0000ae30: 2020 2020 2020 2020 7365 6c66 2e65 6467          self.edg
-0000ae40: 655f 6d6f 6465 6c73 2c20 7365 6c66 2e6e  e_models, self.n
-0000ae50: 6f64 655f 6d6f 6465 6c73 2c20 7365 6c66  ode_models, self
-0000ae60: 2e67 6c6f 6261 6c5f 6d6f 6465 6c73 203d  .global_models =
-0000ae70: 2074 6f72 6368 2e6e 6e2e 4d6f 6475 6c65   torch.nn.Module
-0000ae80: 4c69 7374 280a 2020 2020 2020 2020 292c  List(.        ),
-0000ae90: 2074 6f72 6368 2e6e 6e2e 4d6f 6475 6c65   torch.nn.Module
-0000aea0: 4c69 7374 2829 2c20 746f 7263 682e 6e6e  List(), torch.nn
-0000aeb0: 2e4d 6f64 756c 654c 6973 7428 290a 2020  .ModuleList().  
-0000aec0: 2020 2020 2020 7365 6c66 2e65 6467 655f        self.edge_
-0000aed0: 6d6f 6465 6c73 2e61 7070 656e 6428 0a20  models.append(. 
-0000aee0: 2020 2020 2020 2020 2020 206e 6e2e 4c69             nn.Li
-0000aef0: 6e65 6172 2869 6e5f 6665 6174 7572 6573  near(in_features
-0000af00: 3d6e 5f6e 6f64 655f 6665 6174 7572 6573  =n_node_features
-0000af10: 202a 2032 202b 206e 5f65 6467 655f 6665   * 2 + n_edge_fe
-0000af20: 6174 7572 6573 202b 0a20 2020 2020 2020  atures +.       
-0000af30: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000af40: 5f67 6c6f 6261 6c5f 6665 6174 7572 6573  _global_features
-0000af50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000af60: 2020 2020 2020 2020 6f75 745f 6665 6174          out_feat
-0000af70: 7572 6573 3d33 3229 290a 2020 2020 2020  ures=32)).      
-0000af80: 2020 7365 6c66 2e6e 6f64 655f 6d6f 6465    self.node_mode
-0000af90: 6c73 2e61 7070 656e 6428 0a20 2020 2020  ls.append(.     
-0000afa0: 2020 2020 2020 206e 6e2e 4c69 6e65 6172         nn.Linear
-0000afb0: 2869 6e5f 6665 6174 7572 6573 3d6e 5f6e  (in_features=n_n
-0000afc0: 6f64 655f 6665 6174 7572 6573 202b 206e  ode_features + n
-0000afd0: 5f65 6467 655f 6665 6174 7572 6573 202b  _edge_features +
-0000afe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aff0: 2020 2020 2020 206e 5f67 6c6f 6261 6c5f         n_global_
-0000b000: 6665 6174 7572 6573 2c0a 2020 2020 2020  features,.      
+0000a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a500: 2020 6f75 745f 6d61 736b 6564 290a 2020    out_masked).  
+0000a510: 2020 2020 2020 2020 2020 6f75 745f 6176            out_av
+0000a520: 675f 706f 6f6c 696e 6720 3d20 6f75 745f  g_pooling = out_
+0000a530: 6176 675f 706f 6f6c 696e 672e 7669 6577  avg_pooling.view
+0000a540: 286f 7574 5f61 7667 5f70 6f6f 6c69 6e67  (out_avg_pooling
+0000a550: 2e73 697a 6528 3029 2c20 2d31 290a 0a20  .size(0), -1).. 
+0000a560: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+0000a570: 2e61 6767 7265 6761 7469 6f6e 5f74 7970  .aggregation_typ
+0000a580: 6520 3d3d 2027 636f 6e74 6578 7475 616c  e == 'contextual
+0000a590: 273a 0a20 2020 2020 2020 2020 2020 206f  ':.            o
+0000a5a0: 7574 5f61 7667 5f70 6f6f 6c69 6e67 203d  ut_avg_pooling =
+0000a5b0: 2078 0a0a 2020 2020 2020 2020 7265 7475   x..        retu
+0000a5c0: 726e 2073 656c 662e 7072 6f6a 286f 7574  rn self.proj(out
+0000a5d0: 5f61 7667 5f70 6f6f 6c69 6e67 290a 0a0a  _avg_pooling)...
+0000a5e0: 636c 6173 7320 4772 6170 684e 6574 776f  class GraphNetwo
+0000a5f0: 726b 2874 6f72 6368 2e6e 6e2e 4d6f 6475  rk(torch.nn.Modu
+0000a600: 6c65 293a 0a20 2020 2022 2222 4772 6170  le):.    """Grap
+0000a610: 6820 4e65 7477 6f72 6b73 0a0a 2020 2020  h Networks..    
+0000a620: 4120 4772 6170 6820 4e65 7477 6f72 6b20  A Graph Network 
+0000a630: 5b31 5d5f 2074 616b 6573 2061 2067 7261  [1]_ takes a gra
+0000a640: 7068 2061 7320 696e 7075 7420 616e 6420  ph as input and 
+0000a650: 7265 7475 726e 7320 616e 2075 7064 6174  returns an updat
+0000a660: 6564 2067 7261 7068 0a20 2020 2061 7320  ed graph.    as 
+0000a670: 6f75 7470 7574 2e20 5468 6520 6f75 7470  output. The outp
+0000a680: 7574 2067 7261 7068 2068 6173 2073 616d  ut graph has sam
+0000a690: 6520 7374 7275 6374 7572 6520 6173 2069  e structure as i
+0000a6a0: 6e70 7574 2067 7261 7068 2062 7574 2069  nput graph but i
+0000a6b0: 740a 2020 2020 6861 7320 7570 6461 7465  t.    has update
+0000a6c0: 6420 6e6f 6465 2066 6561 7475 7265 732c  d node features,
+0000a6d0: 2065 6467 6520 6665 6174 7572 6573 2061   edge features a
+0000a6e0: 6e64 2067 6c6f 6261 6c20 7374 6174 6520  nd global state 
+0000a6f0: 6665 6174 7572 6573 2e0a 0a20 2020 2050  features...    P
+0000a700: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+0000a710: 2d2d 2d2d 2d2d 2d2d 0a20 2020 206e 5f6e  --------.    n_n
+0000a720: 6f64 655f 6665 6174 7572 6573 3a20 696e  ode_features: in
+0000a730: 740a 2020 2020 2020 2020 4e75 6d62 6572  t.        Number
+0000a740: 206f 6620 6665 6174 7572 6573 2069 6e20   of features in 
+0000a750: 6120 6e6f 6465 0a20 2020 206e 5f65 6467  a node.    n_edg
+0000a760: 655f 6665 6174 7572 6573 3a20 696e 740a  e_features: int.
+0000a770: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+0000a780: 6620 6665 6174 7572 6573 2069 6e20 6120  f features in a 
+0000a790: 6564 6765 0a20 2020 206e 5f67 6c6f 6261  edge.    n_globa
+0000a7a0: 6c5f 6665 6174 7572 6573 3a20 696e 740a  l_features: int.
+0000a7b0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+0000a7c0: 6620 676c 6f62 616c 2066 6561 7475 7265  f global feature
+0000a7d0: 730a 2020 2020 6973 5f75 6e64 6972 6563  s.    is_undirec
+0000a7e0: 7465 643a 2062 6f6f 6c2c 206f 7074 696f  ted: bool, optio
+0000a7f0: 6e61 6c20 2864 6566 6175 6c74 2054 7275  nal (default Tru
+0000a800: 6529 0a20 2020 2020 2020 2044 6972 6563  e).        Direc
+0000a810: 7465 6420 6f72 2075 6e64 6972 6563 7465  ted or undirecte
+0000a820: 6420 6772 6170 680a 2020 2020 7265 7369  d graph.    resi
+0000a830: 6475 616c 5f63 6f6e 6e65 6374 696f 6e3a  dual_connection:
+0000a840: 2062 6f6f 6c2c 206f 7074 696f 6e61 6c20   bool, optional 
+0000a850: 2864 6566 6175 6c74 2054 7275 6529 0a20  (default True). 
+0000a860: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+0000a870: 7468 6520 6c61 7965 7220 7573 6573 2061  the layer uses a
+0000a880: 2072 6573 6964 7561 6c20 636f 6e6e 6563   residual connec
+0000a890: 7469 6f6e 2064 7572 696e 6720 7472 6169  tion during trai
+0000a8a0: 6e69 6e67 0a0a 2020 2020 4578 616d 706c  ning..    Exampl
+0000a8b0: 650a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  e.    -------.  
+0000a8c0: 2020 3e3e 3e20 696d 706f 7274 2074 6f72    >>> import tor
+0000a8d0: 6368 0a20 2020 203e 3e3e 2066 726f 6d20  ch.    >>> from 
+0000a8e0: 6465 6570 6368 656d 2e6d 6f64 656c 732e  deepchem.models.
+0000a8f0: 746f 7263 685f 6d6f 6465 6c73 2e6c 6179  torch_models.lay
+0000a900: 6572 7320 696d 706f 7274 2047 7261 7068  ers import Graph
+0000a910: 4e65 7477 6f72 6b20 6173 2047 4e0a 2020  Network as GN.  
+0000a920: 2020 3e3e 3e20 6e5f 6e6f 6465 732c 206e    >>> n_nodes, n
+0000a930: 5f6e 6f64 655f 6665 6174 7572 6573 203d  _node_features =
+0000a940: 2035 2c20 3130 0a20 2020 203e 3e3e 206e   5, 10.    >>> n
+0000a950: 5f65 6467 6573 2c20 6e5f 6564 6765 5f66  _edges, n_edge_f
+0000a960: 6561 7475 7265 7320 3d20 352c 2032 0a20  eatures = 5, 2. 
+0000a970: 2020 203e 3e3e 206e 5f67 6c6f 6261 6c5f     >>> n_global_
+0000a980: 6665 6174 7572 6573 203d 2034 0a20 2020  features = 4.   
+0000a990: 203e 3e3e 206e 6f64 655f 6665 6174 7572   >>> node_featur
+0000a9a0: 6573 203d 2074 6f72 6368 2e72 616e 646e  es = torch.randn
+0000a9b0: 286e 5f6e 6f64 6573 2c20 6e5f 6e6f 6465  (n_nodes, n_node
+0000a9c0: 5f66 6561 7475 7265 7329 0a20 2020 203e  _features).    >
+0000a9d0: 3e3e 2065 6467 655f 6665 6174 7572 6573  >> edge_features
+0000a9e0: 203d 2074 6f72 6368 2e72 616e 646e 286e   = torch.randn(n
+0000a9f0: 5f65 6467 6573 2c20 6e5f 6564 6765 5f66  _edges, n_edge_f
+0000aa00: 6561 7475 7265 7329 0a20 2020 203e 3e3e  eatures).    >>>
+0000aa10: 2065 6467 655f 696e 6465 7820 3d20 746f   edge_index = to
+0000aa20: 7263 682e 7465 6e73 6f72 285b 5b30 2c20  rch.tensor([[0, 
+0000aa30: 312c 2032 2c20 332c 2034 5d2c 205b 312c  1, 2, 3, 4], [1,
+0000aa40: 2032 2c20 332c 2034 2c20 305d 5d29 2e6c   2, 3, 4, 0]]).l
+0000aa50: 6f6e 6728 290a 2020 2020 3e3e 3e20 676c  ong().    >>> gl
+0000aa60: 6f62 616c 5f66 6561 7475 7265 7320 3d20  obal_features = 
+0000aa70: 746f 7263 682e 7261 6e64 6e28 312c 206e  torch.randn(1, n
+0000aa80: 5f67 6c6f 6261 6c5f 6665 6174 7572 6573  _global_features
+0000aa90: 290a 2020 2020 3e3e 3e20 676e 203d 2047  ).    >>> gn = G
+0000aaa0: 4e28 6e5f 6e6f 6465 5f66 6561 7475 7265  N(n_node_feature
+0000aab0: 733d 6e5f 6e6f 6465 5f66 6561 7475 7265  s=n_node_feature
+0000aac0: 732c 206e 5f65 6467 655f 6665 6174 7572  s, n_edge_featur
+0000aad0: 6573 3d6e 5f65 6467 655f 6665 6174 7572  es=n_edge_featur
+0000aae0: 6573 2c20 6e5f 676c 6f62 616c 5f66 6561  es, n_global_fea
+0000aaf0: 7475 7265 733d 6e5f 676c 6f62 616c 5f66  tures=n_global_f
+0000ab00: 6561 7475 7265 7329 0a20 2020 203e 3e3e  eatures).    >>>
+0000ab10: 206e 6f64 655f 6665 6174 7572 6573 2c20   node_features, 
+0000ab20: 6564 6765 5f66 6561 7475 7265 732c 2067  edge_features, g
+0000ab30: 6c6f 6261 6c5f 6665 6174 7572 6573 203d  lobal_features =
+0000ab40: 2067 6e28 6e6f 6465 5f66 6561 7475 7265   gn(node_feature
+0000ab50: 732c 2065 6467 655f 696e 6465 782c 2065  s, edge_index, e
+0000ab60: 6467 655f 6665 6174 7572 6573 2c20 676c  dge_features, gl
+0000ab70: 6f62 616c 5f66 6561 7475 7265 7329 0a0a  obal_features)..
+0000ab80: 2020 2020 5265 6665 7265 6e63 6573 0a20      References. 
+0000ab90: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0000aba0: 2020 2e2e 205b 315d 2042 6174 7461 676c    .. [1] Battagl
+0000abb0: 6961 2065 7420 616c 2c20 5265 6c61 7469  ia et al, Relati
+0000abc0: 6f6e 616c 2069 6e64 7563 7469 7665 2062  onal inductive b
+0000abd0: 6961 7365 732c 2064 6565 7020 6c65 6172  iases, deep lear
+0000abe0: 6e69 6e67 2c20 616e 6420 6772 6170 6820  ning, and graph 
+0000abf0: 6e65 7477 6f72 6b73 2e20 6874 7470 733a  networks. https:
+0000ac00: 2f2f 6172 7869 762e 6f72 672f 6162 732f  //arxiv.org/abs/
+0000ac10: 3138 3036 2e30 3132 3631 2028 3230 3138  1806.01261 (2018
+0000ac20: 290a 2020 2222 220a 0a20 2020 2064 6566  ).  """..    def
+0000ac30: 205f 5f69 6e69 745f 5f28 7365 6c66 2c0a   __init__(self,.
+0000ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac50: 206e 5f6e 6f64 655f 6665 6174 7572 6573   n_node_features
+0000ac60: 3a20 696e 7420 3d20 3332 2c0a 2020 2020  : int = 32,.    
+0000ac70: 2020 2020 2020 2020 2020 2020 206e 5f65               n_e
+0000ac80: 6467 655f 6665 6174 7572 6573 3a20 696e  dge_features: in
+0000ac90: 7420 3d20 3332 2c0a 2020 2020 2020 2020  t = 32,.        
+0000aca0: 2020 2020 2020 2020 206e 5f67 6c6f 6261           n_globa
+0000acb0: 6c5f 6665 6174 7572 6573 3a20 696e 7420  l_features: int 
+0000acc0: 3d20 3332 2c0a 2020 2020 2020 2020 2020  = 32,.          
+0000acd0: 2020 2020 2020 2069 735f 756e 6469 7265         is_undire
+0000ace0: 6374 6564 3a20 626f 6f6c 203d 2054 7275  cted: bool = Tru
+0000acf0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000ad00: 2020 2020 7265 7369 6475 616c 5f63 6f6e      residual_con
+0000ad10: 6e65 6374 696f 6e3a 2062 6f6f 6c20 3d20  nection: bool = 
+0000ad20: 5472 7565 293a 0a20 2020 2020 2020 2073  True):.        s
+0000ad30: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
+0000ad40: 290a 2020 2020 2020 2020 7365 6c66 2e6e  ).        self.n
+0000ad50: 5f6e 6f64 655f 6665 6174 7572 6573 203d  _node_features =
+0000ad60: 206e 5f6e 6f64 655f 6665 6174 7572 6573   n_node_features
+0000ad70: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
+0000ad80: 6564 6765 5f66 6561 7475 7265 7320 3d20  edge_features = 
+0000ad90: 6e5f 6564 6765 5f66 6561 7475 7265 730a  n_edge_features.
+0000ada0: 2020 2020 2020 2020 7365 6c66 2e6e 5f67          self.n_g
+0000adb0: 6c6f 6261 6c5f 6665 6174 7572 6573 203d  lobal_features =
+0000adc0: 206e 5f67 6c6f 6261 6c5f 6665 6174 7572   n_global_featur
+0000add0: 6573 0a20 2020 2020 2020 2073 656c 662e  es.        self.
+0000ade0: 6973 5f75 6e64 6972 6563 7465 6420 3d20  is_undirected = 
+0000adf0: 6973 5f75 6e64 6972 6563 7465 640a 2020  is_undirected.  
+0000ae00: 2020 2020 2020 7365 6c66 2e72 6573 6964        self.resid
+0000ae10: 7561 6c5f 636f 6e6e 6563 7469 6f6e 203d  ual_connection =
+0000ae20: 2072 6573 6964 7561 6c5f 636f 6e6e 6563   residual_connec
+0000ae30: 7469 6f6e 0a0a 2020 2020 2020 2020 7365  tion..        se
+0000ae40: 6c66 2e65 6467 655f 6d6f 6465 6c73 2c20  lf.edge_models, 
+0000ae50: 7365 6c66 2e6e 6f64 655f 6d6f 6465 6c73  self.node_models
+0000ae60: 2c20 7365 6c66 2e67 6c6f 6261 6c5f 6d6f  , self.global_mo
+0000ae70: 6465 6c73 203d 2074 6f72 6368 2e6e 6e2e  dels = torch.nn.
+0000ae80: 4d6f 6475 6c65 4c69 7374 280a 2020 2020  ModuleList(.    
+0000ae90: 2020 2020 292c 2074 6f72 6368 2e6e 6e2e      ), torch.nn.
+0000aea0: 4d6f 6475 6c65 4c69 7374 2829 2c20 746f  ModuleList(), to
+0000aeb0: 7263 682e 6e6e 2e4d 6f64 756c 654c 6973  rch.nn.ModuleLis
+0000aec0: 7428 290a 2020 2020 2020 2020 7365 6c66  t().        self
+0000aed0: 2e65 6467 655f 6d6f 6465 6c73 2e61 7070  .edge_models.app
+0000aee0: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+0000aef0: 206e 6e2e 4c69 6e65 6172 2869 6e5f 6665   nn.Linear(in_fe
+0000af00: 6174 7572 6573 3d6e 5f6e 6f64 655f 6665  atures=n_node_fe
+0000af10: 6174 7572 6573 202a 2032 202b 206e 5f65  atures * 2 + n_e
+0000af20: 6467 655f 6665 6174 7572 6573 202b 0a20  dge_features +. 
+0000af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af40: 2020 2020 206e 5f67 6c6f 6261 6c5f 6665       n_global_fe
+0000af50: 6174 7572 6573 2c0a 2020 2020 2020 2020  atures,.        
+0000af60: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+0000af70: 745f 6665 6174 7572 6573 3d33 3229 290a  t_features=32)).
+0000af80: 2020 2020 2020 2020 7365 6c66 2e6e 6f64          self.nod
+0000af90: 655f 6d6f 6465 6c73 2e61 7070 656e 6428  e_models.append(
+0000afa0: 0a20 2020 2020 2020 2020 2020 206e 6e2e  .            nn.
+0000afb0: 4c69 6e65 6172 2869 6e5f 6665 6174 7572  Linear(in_featur
+0000afc0: 6573 3d6e 5f6e 6f64 655f 6665 6174 7572  es=n_node_featur
+0000afd0: 6573 202b 206e 5f65 6467 655f 6665 6174  es + n_edge_feat
+0000afe0: 7572 6573 202b 0a20 2020 2020 2020 2020  ures +.         
+0000aff0: 2020 2020 2020 2020 2020 2020 206e 5f67               n_g
+0000b000: 6c6f 6261 6c5f 6665 6174 7572 6573 2c0a  lobal_features,.
 0000b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b020: 6f75 745f 6665 6174 7572 6573 3d33 3229  out_features=32)
-0000b030: 290a 2020 2020 2020 2020 7365 6c66 2e67  ).        self.g
-0000b040: 6c6f 6261 6c5f 6d6f 6465 6c73 2e61 7070  lobal_models.app
-0000b050: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
-0000b060: 206e 6e2e 4c69 6e65 6172 2869 6e5f 6665   nn.Linear(in_fe
-0000b070: 6174 7572 6573 3d6e 5f6e 6f64 655f 6665  atures=n_node_fe
-0000b080: 6174 7572 6573 202b 206e 5f65 6467 655f  atures + n_edge_
-0000b090: 6665 6174 7572 6573 202b 0a20 2020 2020  features +.     
-0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0b0: 206e 5f67 6c6f 6261 6c5f 6665 6174 7572   n_global_featur
-0000b0c0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-0000b0d0: 2020 2020 2020 2020 2020 6f75 745f 6665            out_fe
-0000b0e0: 6174 7572 6573 3d33 3229 290a 0a20 2020  atures=32))..   
-0000b0f0: 2020 2020 2023 2055 7365 6420 666f 7220       # Used for 
-0000b100: 636f 6e76 6572 7469 6e67 2065 6467 6573  converting edges
-0000b110: 2062 6163 6b20 746f 2074 6865 6972 206f   back to their o
-0000b120: 7269 6769 6e61 6c20 7368 6170 650a 2020  riginal shape.  
-0000b130: 2020 2020 2020 7365 6c66 2e65 6467 655f        self.edge_
-0000b140: 6465 6e73 6520 3d20 6e6e 2e4c 696e 6561  dense = nn.Linea
-0000b150: 7228 696e 5f66 6561 7475 7265 733d 3332  r(in_features=32
-0000b160: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b020: 2020 2020 2020 6f75 745f 6665 6174 7572        out_featur
+0000b030: 6573 3d33 3229 290a 2020 2020 2020 2020  es=32)).        
+0000b040: 7365 6c66 2e67 6c6f 6261 6c5f 6d6f 6465  self.global_mode
+0000b050: 6c73 2e61 7070 656e 6428 0a20 2020 2020  ls.append(.     
+0000b060: 2020 2020 2020 206e 6e2e 4c69 6e65 6172         nn.Linear
+0000b070: 2869 6e5f 6665 6174 7572 6573 3d6e 5f6e  (in_features=n_n
+0000b080: 6f64 655f 6665 6174 7572 6573 202b 206e  ode_features + n
+0000b090: 5f65 6467 655f 6665 6174 7572 6573 202b  _edge_features +
+0000b0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b0b0: 2020 2020 2020 206e 5f67 6c6f 6261 6c5f         n_global_
+0000b0c0: 6665 6174 7572 6573 2c0a 2020 2020 2020  features,.      
+0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0e0: 6f75 745f 6665 6174 7572 6573 3d33 3229  out_features=32)
+0000b0f0: 290a 0a20 2020 2020 2020 2023 2055 7365  )..        # Use
+0000b100: 6420 666f 7220 636f 6e76 6572 7469 6e67  d for converting
+0000b110: 2065 6467 6573 2062 6163 6b20 746f 2074   edges back to t
+0000b120: 6865 6972 206f 7269 6769 6e61 6c20 7368  heir original sh
+0000b130: 6170 650a 2020 2020 2020 2020 7365 6c66  ape.        self
+0000b140: 2e65 6467 655f 6465 6e73 6520 3d20 6e6e  .edge_dense = nn
+0000b150: 2e4c 696e 6561 7228 696e 5f66 6561 7475  .Linear(in_featu
+0000b160: 7265 733d 3332 2c0a 2020 2020 2020 2020  res=32,.        
 0000b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b180: 2020 2020 2020 6f75 745f 6665 6174 7572        out_featur
-0000b190: 6573 3d6e 5f65 6467 655f 6665 6174 7572  es=n_edge_featur
-0000b1a0: 6573 290a 2020 2020 2020 2020 7365 6c66  es).        self
-0000b1b0: 2e6e 6f64 655f 6465 6e73 6520 3d20 6e6e  .node_dense = nn
-0000b1c0: 2e4c 696e 6561 7228 696e 5f66 6561 7475  .Linear(in_featu
-0000b1d0: 7265 733d 3332 2c0a 2020 2020 2020 2020  res=32,.        
+0000b180: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0000b190: 6665 6174 7572 6573 3d6e 5f65 6467 655f  features=n_edge_
+0000b1a0: 6665 6174 7572 6573 290a 2020 2020 2020  features).      
+0000b1b0: 2020 7365 6c66 2e6e 6f64 655f 6465 6e73    self.node_dens
+0000b1c0: 6520 3d20 6e6e 2e4c 696e 6561 7228 696e  e = nn.Linear(in
+0000b1d0: 5f66 6561 7475 7265 733d 3332 2c0a 2020  _features=32,.  
 0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1f0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-0000b200: 6665 6174 7572 6573 3d6e 5f6e 6f64 655f  features=n_node_
-0000b210: 6665 6174 7572 6573 290a 2020 2020 2020  features).      
-0000b220: 2020 7365 6c66 2e67 6c6f 6261 6c5f 6465    self.global_de
-0000b230: 6e73 6520 3d20 6e6e 2e4c 696e 6561 7228  nse = nn.Linear(
-0000b240: 696e 5f66 6561 7475 7265 733d 3332 2c0a  in_features=32,.
-0000b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b200: 2020 6f75 745f 6665 6174 7572 6573 3d6e    out_features=n
+0000b210: 5f6e 6f64 655f 6665 6174 7572 6573 290a  _node_features).
+0000b220: 2020 2020 2020 2020 7365 6c66 2e67 6c6f          self.glo
+0000b230: 6261 6c5f 6465 6e73 6520 3d20 6e6e 2e4c  bal_dense = nn.L
+0000b240: 696e 6561 7228 696e 5f66 6561 7475 7265  inear(in_feature
+0000b250: 733d 3332 2c0a 2020 2020 2020 2020 2020  s=32,.          
 0000b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b270: 2020 2020 2020 6f75 745f 6665 6174 7572        out_featur
-0000b280: 6573 3d6e 5f67 6c6f 6261 6c5f 6665 6174  es=n_global_feat
-0000b290: 7572 6573 290a 0a20 2020 2064 6566 2072  ures)..    def r
-0000b2a0: 6573 6574 5f70 6172 616d 6574 6572 7328  eset_parameters(
-0000b2b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-0000b2c0: 2020 2020 2020 2073 656c 662e 6564 6765         self.edge
-0000b2d0: 5f64 656e 7365 2e72 6573 6574 5f70 6172  _dense.reset_par
-0000b2e0: 616d 6574 6572 7328 290a 2020 2020 2020  ameters().      
-0000b2f0: 2020 7365 6c66 2e6e 6f64 655f 6465 6e73    self.node_dens
-0000b300: 652e 7265 7365 745f 7061 7261 6d65 7465  e.reset_paramete
-0000b310: 7273 2829 0a20 2020 2020 2020 2073 656c  rs().        sel
-0000b320: 662e 676c 6f62 616c 5f64 656e 7365 2e72  f.global_dense.r
-0000b330: 6573 6574 5f70 6172 616d 6574 6572 7328  eset_parameters(
-0000b340: 290a 2020 2020 2020 2020 666f 7220 6920  ).        for i 
-0000b350: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
-0000b360: 7365 6c66 2e65 6467 655f 6d6f 6465 6c73  self.edge_models
-0000b370: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0000b380: 7365 6c66 2e65 6467 655f 6d6f 6465 6c73  self.edge_models
-0000b390: 5b69 5d2e 7265 7365 745f 7061 7261 6d65  [i].reset_parame
-0000b3a0: 7465 7273 2829 0a20 2020 2020 2020 2066  ters().        f
-0000b3b0: 6f72 2069 2069 6e20 7261 6e67 6528 302c  or i in range(0,
-0000b3c0: 206c 656e 2873 656c 662e 6e6f 6465 5f6d   len(self.node_m
-0000b3d0: 6f64 656c 7329 293a 0a20 2020 2020 2020  odels)):.       
-0000b3e0: 2020 2020 2073 656c 662e 6e6f 6465 5f6d       self.node_m
-0000b3f0: 6f64 656c 735b 695d 2e72 6573 6574 5f70  odels[i].reset_p
-0000b400: 6172 616d 6574 6572 7328 290a 2020 2020  arameters().    
-0000b410: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0000b420: 6765 2830 2c20 6c65 6e28 7365 6c66 2e67  ge(0, len(self.g
-0000b430: 6c6f 6261 6c5f 6d6f 6465 6c73 2929 3a0a  lobal_models)):.
-0000b440: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b450: 2e67 6c6f 6261 6c5f 6d6f 6465 6c73 5b69  .global_models[i
-0000b460: 5d2e 7265 7365 745f 7061 7261 6d65 7465  ].reset_paramete
-0000b470: 7273 2829 0a0a 2020 2020 6465 6620 5f75  rs()..    def _u
-0000b480: 7064 6174 655f 6564 6765 5f66 6561 7475  pdate_edge_featu
-0000b490: 7265 7328 7365 6c66 2c20 6e6f 6465 5f66  res(self, node_f
-0000b4a0: 6561 7475 7265 732c 2065 6467 655f 696e  eatures, edge_in
-0000b4b0: 6465 782c 2065 6467 655f 6665 6174 7572  dex, edge_featur
-0000b4c0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0000b270: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0000b280: 6665 6174 7572 6573 3d6e 5f67 6c6f 6261  features=n_globa
+0000b290: 6c5f 6665 6174 7572 6573 290a 0a20 2020  l_features)..   
+0000b2a0: 2064 6566 2072 6573 6574 5f70 6172 616d   def reset_param
+0000b2b0: 6574 6572 7328 7365 6c66 2920 2d3e 204e  eters(self) -> N
+0000b2c0: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
+0000b2d0: 662e 6564 6765 5f64 656e 7365 2e72 6573  f.edge_dense.res
+0000b2e0: 6574 5f70 6172 616d 6574 6572 7328 290a  et_parameters().
+0000b2f0: 2020 2020 2020 2020 7365 6c66 2e6e 6f64          self.nod
+0000b300: 655f 6465 6e73 652e 7265 7365 745f 7061  e_dense.reset_pa
+0000b310: 7261 6d65 7465 7273 2829 0a20 2020 2020  rameters().     
+0000b320: 2020 2073 656c 662e 676c 6f62 616c 5f64     self.global_d
+0000b330: 656e 7365 2e72 6573 6574 5f70 6172 616d  ense.reset_param
+0000b340: 6574 6572 7328 290a 2020 2020 2020 2020  eters().        
+0000b350: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
+0000b360: 2c20 6c65 6e28 7365 6c66 2e65 6467 655f  , len(self.edge_
+0000b370: 6d6f 6465 6c73 2929 3a0a 2020 2020 2020  models)):.      
+0000b380: 2020 2020 2020 7365 6c66 2e65 6467 655f        self.edge_
+0000b390: 6d6f 6465 6c73 5b69 5d2e 7265 7365 745f  models[i].reset_
+0000b3a0: 7061 7261 6d65 7465 7273 2829 0a20 2020  parameters().   
+0000b3b0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+0000b3c0: 6e67 6528 302c 206c 656e 2873 656c 662e  nge(0, len(self.
+0000b3d0: 6e6f 6465 5f6d 6f64 656c 7329 293a 0a20  node_models)):. 
+0000b3e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b3f0: 6e6f 6465 5f6d 6f64 656c 735b 695d 2e72  node_models[i].r
+0000b400: 6573 6574 5f70 6172 616d 6574 6572 7328  eset_parameters(
+0000b410: 290a 2020 2020 2020 2020 666f 7220 6920  ).        for i 
+0000b420: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
+0000b430: 7365 6c66 2e67 6c6f 6261 6c5f 6d6f 6465  self.global_mode
+0000b440: 6c73 2929 3a0a 2020 2020 2020 2020 2020  ls)):.          
+0000b450: 2020 7365 6c66 2e67 6c6f 6261 6c5f 6d6f    self.global_mo
+0000b460: 6465 6c73 5b69 5d2e 7265 7365 745f 7061  dels[i].reset_pa
+0000b470: 7261 6d65 7465 7273 2829 0a0a 2020 2020  rameters()..    
+0000b480: 6465 6620 5f75 7064 6174 655f 6564 6765  def _update_edge
+0000b490: 5f66 6561 7475 7265 7328 7365 6c66 2c20  _features(self, 
+0000b4a0: 6e6f 6465 5f66 6561 7475 7265 732c 2065  node_features, e
+0000b4b0: 6467 655f 696e 6465 782c 2065 6467 655f  dge_index, edge_
+0000b4c0: 6665 6174 7572 6573 2c0a 2020 2020 2020  features,.      
 0000b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4e0: 2020 676c 6f62 616c 5f66 6561 7475 7265    global_feature
-0000b4f0: 732c 2062 6174 6368 293a 0a20 2020 2020  s, batch):.     
-0000b500: 2020 2073 7263 5f69 6e64 6578 2c20 6473     src_index, ds
-0000b510: 745f 696e 6465 7820 3d20 6564 6765 5f69  t_index = edge_i
-0000b520: 6e64 6578 0a20 2020 2020 2020 206f 7574  ndex.        out
-0000b530: 203d 2074 6f72 6368 2e63 6174 2828 6e6f   = torch.cat((no
-0000b540: 6465 5f66 6561 7475 7265 735b 7372 635f  de_features[src_
-0000b550: 696e 6465 785d 2c20 6e6f 6465 5f66 6561  index], node_fea
-0000b560: 7475 7265 735b 6473 745f 696e 6465 785d  tures[dst_index]
-0000b570: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000b580: 2020 2020 2020 2020 2020 2065 6467 655f             edge_
-0000b590: 6665 6174 7572 6573 2c20 676c 6f62 616c  features, global
-0000b5a0: 5f66 6561 7475 7265 735b 6261 7463 685d  _features[batch]
-0000b5b0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0000b5c0: 2020 2020 2020 2020 2020 2064 696d 3d31             dim=1
-0000b5d0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-0000b5e0: 206f 7574 2e73 6861 7065 5b0a 2020 2020   out.shape[.    
-0000b5f0: 2020 2020 2020 2020 315d 203d 3d20 7365          1] == se
-0000b600: 6c66 2e6e 5f6e 6f64 655f 6665 6174 7572  lf.n_node_featur
-0000b610: 6573 202a 2032 202b 2073 656c 662e 6e5f  es * 2 + self.n_
-0000b620: 6564 6765 5f66 6561 7475 7265 7320 2b20  edge_features + 
-0000b630: 7365 6c66 2e6e 5f67 6c6f 6261 6c5f 6665  self.n_global_fe
-0000b640: 6174 7572 6573 0a20 2020 2020 2020 2066  atures.        f
-0000b650: 6f72 206d 6f64 656c 2069 6e20 7365 6c66  or model in self
-0000b660: 2e65 6467 655f 6d6f 6465 6c73 3a0a 2020  .edge_models:.  
-0000b670: 2020 2020 2020 2020 2020 6f75 7420 3d20            out = 
-0000b680: 6d6f 6465 6c28 6f75 7429 0a20 2020 2020  model(out).     
-0000b690: 2020 2072 6574 7572 6e20 7365 6c66 2e65     return self.e
-0000b6a0: 6467 655f 6465 6e73 6528 6f75 7429 0a0a  dge_dense(out)..
-0000b6b0: 2020 2020 6465 6620 5f75 7064 6174 655f      def _update_
-0000b6c0: 6e6f 6465 5f66 6561 7475 7265 7328 7365  node_features(se
-0000b6d0: 6c66 2c20 6e6f 6465 5f66 6561 7475 7265  lf, node_feature
-0000b6e0: 732c 2065 6467 655f 696e 6465 782c 2065  s, edge_index, e
-0000b6f0: 6467 655f 6665 6174 7572 6573 2c0a 2020  dge_features,.  
-0000b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b710: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
-0000b720: 616c 5f66 6561 7475 7265 732c 2062 6174  al_features, bat
-0000b730: 6368 293a 0a0a 2020 2020 2020 2020 7372  ch):..        sr
-0000b740: 635f 696e 6465 782c 2064 7374 5f69 6e64  c_index, dst_ind
-0000b750: 6578 203d 2065 6467 655f 696e 6465 780a  ex = edge_index.
-0000b760: 2020 2020 2020 2020 2320 436f 6d70 7574          # Comput
-0000b770: 6520 6d65 616e 2065 6467 6520 6665 6174  e mean edge feat
-0000b780: 7572 6573 2066 6f72 2065 6163 6820 6e6f  ures for each no
-0000b790: 6465 2062 7920 6473 745f 696e 6465 7820  de by dst_index 
-0000b7a0: 2865 6163 6820 6e6f 6465 0a20 2020 2020  (each node.     
-0000b7b0: 2020 2023 2072 6563 6569 7665 7320 696e     # receives in
-0000b7c0: 666f 726d 6174 696f 6e20 6672 6f6d 2065  formation from e
-0000b7d0: 6467 6573 2077 6869 6368 2068 6176 6520  dges which have 
-0000b7e0: 7468 6174 206e 6f64 6520 6173 2069 7473  that node as its
-0000b7f0: 2064 6573 7469 6e61 7469 6f6e 2c0a 2020   destination,.  
-0000b800: 2020 2020 2020 2320 6865 6e63 6520 7468        # hence th
-0000b810: 6520 636f 6d70 7574 6174 696f 6e20 7573  e computation us
-0000b820: 6573 2064 7374 5f69 6e64 6578 2074 6f20  es dst_index to 
-0000b830: 6167 6772 6567 6174 6520 696e 666f 726d  aggregate inform
-0000b840: 6174 696f 6e29 0a20 2020 2020 2020 2065  ation).        e
-0000b850: 6467 655f 6665 6174 7572 6573 5f6d 6561  dge_features_mea
-0000b860: 6e5f 6279 5f6e 6f64 6520 3d20 7363 6174  n_by_node = scat
-0000b870: 7465 7228 7372 633d 6564 6765 5f66 6561  ter(src=edge_fea
-0000b880: 7475 7265 732c 0a20 2020 2020 2020 2020  tures,.         
+0000b4e0: 2020 2020 2020 2020 676c 6f62 616c 5f66          global_f
+0000b4f0: 6561 7475 7265 732c 2062 6174 6368 293a  eatures, batch):
+0000b500: 0a20 2020 2020 2020 2073 7263 5f69 6e64  .        src_ind
+0000b510: 6578 2c20 6473 745f 696e 6465 7820 3d20  ex, dst_index = 
+0000b520: 6564 6765 5f69 6e64 6578 0a20 2020 2020  edge_index.     
+0000b530: 2020 206f 7574 203d 2074 6f72 6368 2e63     out = torch.c
+0000b540: 6174 2828 6e6f 6465 5f66 6561 7475 7265  at((node_feature
+0000b550: 735b 7372 635f 696e 6465 785d 2c20 6e6f  s[src_index], no
+0000b560: 6465 5f66 6561 7475 7265 735b 6473 745f  de_features[dst_
+0000b570: 696e 6465 785d 2c0a 2020 2020 2020 2020  index],.        
+0000b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b590: 2065 6467 655f 6665 6174 7572 6573 2c20   edge_features, 
+0000b5a0: 676c 6f62 616c 5f66 6561 7475 7265 735b  global_features[
+0000b5b0: 6261 7463 685d 292c 0a20 2020 2020 2020  batch]),.       
+0000b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5d0: 2064 696d 3d31 290a 2020 2020 2020 2020   dim=1).        
+0000b5e0: 6173 7365 7274 206f 7574 2e73 6861 7065  assert out.shape
+0000b5f0: 5b0a 2020 2020 2020 2020 2020 2020 315d  [.            1]
+0000b600: 203d 3d20 7365 6c66 2e6e 5f6e 6f64 655f   == self.n_node_
+0000b610: 6665 6174 7572 6573 202a 2032 202b 2073  features * 2 + s
+0000b620: 656c 662e 6e5f 6564 6765 5f66 6561 7475  elf.n_edge_featu
+0000b630: 7265 7320 2b20 7365 6c66 2e6e 5f67 6c6f  res + self.n_glo
+0000b640: 6261 6c5f 6665 6174 7572 6573 0a20 2020  bal_features.   
+0000b650: 2020 2020 2066 6f72 206d 6f64 656c 2069       for model i
+0000b660: 6e20 7365 6c66 2e65 6467 655f 6d6f 6465  n self.edge_mode
+0000b670: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
+0000b680: 6f75 7420 3d20 6d6f 6465 6c28 6f75 7429  out = model(out)
+0000b690: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000b6a0: 7365 6c66 2e65 6467 655f 6465 6e73 6528  self.edge_dense(
+0000b6b0: 6f75 7429 0a0a 2020 2020 6465 6620 5f75  out)..    def _u
+0000b6c0: 7064 6174 655f 6e6f 6465 5f66 6561 7475  pdate_node_featu
+0000b6d0: 7265 7328 7365 6c66 2c20 6e6f 6465 5f66  res(self, node_f
+0000b6e0: 6561 7475 7265 732c 2065 6467 655f 696e  eatures, edge_in
+0000b6f0: 6465 782c 2065 6467 655f 6665 6174 7572  dex, edge_featur
+0000b700: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0000b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b720: 2020 676c 6f62 616c 5f66 6561 7475 7265    global_feature
+0000b730: 732c 2062 6174 6368 293a 0a0a 2020 2020  s, batch):..    
+0000b740: 2020 2020 7372 635f 696e 6465 782c 2064      src_index, d
+0000b750: 7374 5f69 6e64 6578 203d 2065 6467 655f  st_index = edge_
+0000b760: 696e 6465 780a 2020 2020 2020 2020 2320  index.        # 
+0000b770: 436f 6d70 7574 6520 6d65 616e 2065 6467  Compute mean edg
+0000b780: 6520 6665 6174 7572 6573 2066 6f72 2065  e features for e
+0000b790: 6163 6820 6e6f 6465 2062 7920 6473 745f  ach node by dst_
+0000b7a0: 696e 6465 7820 2865 6163 6820 6e6f 6465  index (each node
+0000b7b0: 0a20 2020 2020 2020 2023 2072 6563 6569  .        # recei
+0000b7c0: 7665 7320 696e 666f 726d 6174 696f 6e20  ves information 
+0000b7d0: 6672 6f6d 2065 6467 6573 2077 6869 6368  from edges which
+0000b7e0: 2068 6176 6520 7468 6174 206e 6f64 6520   have that node 
+0000b7f0: 6173 2069 7473 2064 6573 7469 6e61 7469  as its destinati
+0000b800: 6f6e 2c0a 2020 2020 2020 2020 2320 6865  on,.        # he
+0000b810: 6e63 6520 7468 6520 636f 6d70 7574 6174  nce the computat
+0000b820: 696f 6e20 7573 6573 2064 7374 5f69 6e64  ion uses dst_ind
+0000b830: 6578 2074 6f20 6167 6772 6567 6174 6520  ex to aggregate 
+0000b840: 696e 666f 726d 6174 696f 6e29 0a20 2020  information).   
+0000b850: 2020 2020 2065 6467 655f 6665 6174 7572       edge_featur
+0000b860: 6573 5f6d 6561 6e5f 6279 5f6e 6f64 6520  es_mean_by_node 
+0000b870: 3d20 7363 6174 7465 7228 7372 633d 6564  = scatter(src=ed
+0000b880: 6765 5f66 6561 7475 7265 732c 0a20 2020  ge_features,.   
 0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8b0: 2020 2020 696e 6465 783d 6473 745f 696e      index=dst_in
-0000b8c0: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
+0000b8b0: 2020 2020 2020 2020 2020 696e 6465 783d            index=
+0000b8c0: 6473 745f 696e 6465 782c 0a20 2020 2020  dst_index,.     
 0000b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8f0: 2020 6469 6d3d 302c 0a20 2020 2020 2020    dim=0,.       
+0000b8f0: 2020 2020 2020 2020 6469 6d3d 302c 0a20          dim=0,. 
 0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b920: 2020 2020 2020 7265 6475 6365 3d27 6d65        reduce='me
-0000b930: 616e 2729 0a20 2020 2020 2020 206f 7574  an').        out
-0000b940: 203d 2074 6f72 6368 2e63 6174 280a 2020   = torch.cat(.  
-0000b950: 2020 2020 2020 2020 2020 286e 6f64 655f            (node_
-0000b960: 6665 6174 7572 6573 2c20 6564 6765 5f66  features, edge_f
-0000b970: 6561 7475 7265 735f 6d65 616e 5f62 795f  eatures_mean_by_
-0000b980: 6e6f 6465 2c20 676c 6f62 616c 5f66 6561  node, global_fea
-0000b990: 7475 7265 735b 6261 7463 685d 292c 0a20  tures[batch]),. 
-0000b9a0: 2020 2020 2020 2020 2020 2064 696d 3d31             dim=1
-0000b9b0: 290a 2020 2020 2020 2020 666f 7220 6d6f  ).        for mo
-0000b9c0: 6465 6c20 696e 2073 656c 662e 6e6f 6465  del in self.node
-0000b9d0: 5f6d 6f64 656c 733a 0a20 2020 2020 2020  _models:.       
-0000b9e0: 2020 2020 206f 7574 203d 206d 6f64 656c       out = model
-0000b9f0: 286f 7574 290a 2020 2020 2020 2020 7265  (out).        re
-0000ba00: 7475 726e 2073 656c 662e 6e6f 6465 5f64  turn self.node_d
-0000ba10: 656e 7365 286f 7574 290a 0a20 2020 2064  ense(out)..    d
-0000ba20: 6566 205f 7570 6461 7465 5f67 6c6f 6261  ef _update_globa
-0000ba30: 6c5f 6665 6174 7572 6573 2873 656c 662c  l_features(self,
-0000ba40: 206e 6f64 655f 6665 6174 7572 6573 2c20   node_features, 
-0000ba50: 6564 6765 5f66 6561 7475 7265 732c 0a20  edge_features,. 
-0000ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba70: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0000ba80: 6c6f 6261 6c5f 6665 6174 7572 6573 2c20  lobal_features, 
-0000ba90: 6e6f 6465 5f62 6174 6368 5f6d 6170 2c0a  node_batch_map,.
-0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b920: 2020 2020 2020 2020 2020 2020 7265 6475              redu
+0000b930: 6365 3d27 6d65 616e 2729 0a20 2020 2020  ce='mean').     
+0000b940: 2020 206f 7574 203d 2074 6f72 6368 2e63     out = torch.c
+0000b950: 6174 280a 2020 2020 2020 2020 2020 2020  at(.            
+0000b960: 286e 6f64 655f 6665 6174 7572 6573 2c20  (node_features, 
+0000b970: 6564 6765 5f66 6561 7475 7265 735f 6d65  edge_features_me
+0000b980: 616e 5f62 795f 6e6f 6465 2c20 676c 6f62  an_by_node, glob
+0000b990: 616c 5f66 6561 7475 7265 735b 6261 7463  al_features[batc
+0000b9a0: 685d 292c 0a20 2020 2020 2020 2020 2020  h]),.           
+0000b9b0: 2064 696d 3d31 290a 2020 2020 2020 2020   dim=1).        
+0000b9c0: 666f 7220 6d6f 6465 6c20 696e 2073 656c  for model in sel
+0000b9d0: 662e 6e6f 6465 5f6d 6f64 656c 733a 0a20  f.node_models:. 
+0000b9e0: 2020 2020 2020 2020 2020 206f 7574 203d             out =
+0000b9f0: 206d 6f64 656c 286f 7574 290a 2020 2020   model(out).    
+0000ba00: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000ba10: 6e6f 6465 5f64 656e 7365 286f 7574 290a  node_dense(out).
+0000ba20: 0a20 2020 2064 6566 205f 7570 6461 7465  .    def _update
+0000ba30: 5f67 6c6f 6261 6c5f 6665 6174 7572 6573  _global_features
+0000ba40: 2873 656c 662c 206e 6f64 655f 6665 6174  (self, node_feat
+0000ba50: 7572 6573 2c20 6564 6765 5f66 6561 7475  ures, edge_featu
+0000ba60: 7265 732c 0a20 2020 2020 2020 2020 2020  res,.           
+0000ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba80: 2020 2020 2067 6c6f 6261 6c5f 6665 6174       global_feat
+0000ba90: 7572 6573 2c20 6e6f 6465 5f62 6174 6368  ures, node_batch
+0000baa0: 5f6d 6170 2c0a 2020 2020 2020 2020 2020  _map,.          
 0000bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bac0: 6564 6765 5f62 6174 6368 5f6d 6170 293a  edge_batch_map):
-0000bad0: 0a20 2020 2020 2020 2065 6467 655f 6665  .        edge_fe
-0000bae0: 6174 7572 6573 5f6d 6561 6e20 3d20 7363  atures_mean = sc
-0000baf0: 6174 7465 7228 7372 633d 6564 6765 5f66  atter(src=edge_f
-0000bb00: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
+0000bac0: 2020 2020 2020 6564 6765 5f62 6174 6368        edge_batch
+0000bad0: 5f6d 6170 293a 0a20 2020 2020 2020 2065  _map):.        e
+0000bae0: 6467 655f 6665 6174 7572 6573 5f6d 6561  dge_features_mea
+0000baf0: 6e20 3d20 7363 6174 7465 7228 7372 633d  n = scatter(src=
+0000bb00: 6564 6765 5f66 6561 7475 7265 732c 0a20  edge_features,. 
 0000bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb20: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0000bb30: 6465 783d 6564 6765 5f62 6174 6368 5f6d  dex=edge_batch_m
-0000bb40: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
+0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb30: 2020 2020 696e 6465 783d 6564 6765 5f62      index=edge_b
+0000bb40: 6174 6368 5f6d 6170 2c0a 2020 2020 2020  atch_map,.      
 0000bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb60: 2020 2020 2020 2020 2064 696d 3d30 2c0a           dim=0,.
-0000bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000bb70: 696d 3d30 2c0a 2020 2020 2020 2020 2020  im=0,.          
 0000bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb90: 2020 2020 2072 6564 7563 653d 276d 6561       reduce='mea
-0000bba0: 6e27 290a 2020 2020 2020 2020 6e6f 6465  n').        node
-0000bbb0: 5f66 6561 7475 7265 735f 6d65 616e 203d  _features_mean =
-0000bbc0: 2073 6361 7474 6572 2873 7263 3d6e 6f64   scatter(src=nod
-0000bbd0: 655f 6665 6174 7572 6573 2c0a 2020 2020  e_features,.    
-0000bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb90: 2020 2020 2020 2020 2020 2072 6564 7563             reduc
+0000bba0: 653d 276d 6561 6e27 290a 2020 2020 2020  e='mean').      
+0000bbb0: 2020 6e6f 6465 5f66 6561 7475 7265 735f    node_features_
+0000bbc0: 6d65 616e 203d 2073 6361 7474 6572 2873  mean = scatter(s
+0000bbd0: 7263 3d6e 6f64 655f 6665 6174 7572 6573  rc=node_features
+0000bbe0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0000bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc00: 2069 6e64 6578 3d6e 6f64 655f 6261 7463   index=node_batc
-0000bc10: 685f 6d61 702c 0a20 2020 2020 2020 2020  h_map,.         
+0000bc00: 2020 2020 2020 2069 6e64 6578 3d6e 6f64         index=nod
+0000bc10: 655f 6261 7463 685f 6d61 702c 0a20 2020  e_batch_map,.   
 0000bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc30: 2020 2020 2020 2020 2020 2020 6469 6d3d              dim=
-0000bc40: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0000bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc40: 2020 6469 6d3d 302c 0a20 2020 2020 2020    dim=0,.       
 0000bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc60: 2020 2020 2020 2020 7265 6475 6365 3d27          reduce='
-0000bc70: 6d65 616e 2729 0a20 2020 2020 2020 206f  mean').        o
-0000bc80: 7574 203d 2074 6f72 6368 2e63 6174 280a  ut = torch.cat(.
-0000bc90: 2020 2020 2020 2020 2020 2020 2865 6467              (edg
-0000bca0: 655f 6665 6174 7572 6573 5f6d 6561 6e2c  e_features_mean,
-0000bcb0: 206e 6f64 655f 6665 6174 7572 6573 5f6d   node_features_m
-0000bcc0: 6561 6e2c 2067 6c6f 6261 6c5f 6665 6174  ean, global_feat
-0000bcd0: 7572 6573 292c 2064 696d 3d31 290a 2020  ures), dim=1).  
-0000bce0: 2020 2020 2020 666f 7220 6d6f 6465 6c20        for model 
-0000bcf0: 696e 2073 656c 662e 676c 6f62 616c 5f6d  in self.global_m
-0000bd00: 6f64 656c 733a 0a20 2020 2020 2020 2020  odels:.         
-0000bd10: 2020 206f 7574 203d 206d 6f64 656c 286f     out = model(o
-0000bd20: 7574 290a 2020 2020 2020 2020 7265 7475  ut).        retu
-0000bd30: 726e 2073 656c 662e 676c 6f62 616c 5f64  rn self.global_d
-0000bd40: 656e 7365 286f 7574 290a 0a20 2020 2064  ense(out)..    d
-0000bd50: 6566 2066 6f72 7761 7264 280a 2020 2020  ef forward(.    
-0000bd60: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000bd70: 2020 2020 2020 2020 2020 6e6f 6465 5f66            node_f
-0000bd80: 6561 7475 7265 733a 2054 656e 736f 722c  eatures: Tensor,
-0000bd90: 0a20 2020 2020 2020 2020 2020 2065 6467  .            edg
-0000bda0: 655f 696e 6465 783a 2054 656e 736f 722c  e_index: Tensor,
-0000bdb0: 0a20 2020 2020 2020 2020 2020 2065 6467  .            edg
-0000bdc0: 655f 6665 6174 7572 6573 3a20 5465 6e73  e_features: Tens
-0000bdd0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-0000bde0: 676c 6f62 616c 5f66 6561 7475 7265 733a  global_features:
-0000bdf0: 2054 656e 736f 722c 0a20 2020 2020 2020   Tensor,.       
-0000be00: 2020 2020 2062 6174 6368 3a20 4f70 7469       batch: Opti
-0000be10: 6f6e 616c 5b54 656e 736f 725d 203d 204e  onal[Tensor] = N
-0000be20: 6f6e 6529 202d 3e20 5475 706c 655b 5465  one) -> Tuple[Te
-0000be30: 6e73 6f72 2c20 5465 6e73 6f72 2c20 5465  nsor, Tensor, Te
-0000be40: 6e73 6f72 5d3a 0a20 2020 2020 2020 2022  nsor]:.        "
-0000be50: 2222 4f75 7470 7574 2063 6f6d 7075 7461  ""Output computa
-0000be60: 7469 6f6e 2066 6f72 2061 2047 7261 7068  tion for a Graph
-0000be70: 4e65 7477 6f72 6b0a 0a20 2020 2020 2020  Network..       
-0000be80: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-0000be90: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-0000bea0: 2020 2020 2020 206e 6f64 655f 6665 6174         node_feat
-0000beb0: 7572 6573 3a20 746f 7263 682e 5465 6e73  ures: torch.Tens
-0000bec0: 6f72 0a20 2020 2020 2020 2020 2020 2049  or.            I
-0000bed0: 6e70 7574 206e 6f64 6520 6665 6174 7572  nput node featur
-0000bee0: 6573 206f 6620 7368 6170 6520 3a6d 6174  es of shape :mat
-0000bef0: 683a 6028 7c5c 6d61 7468 6361 6c7b 567d  h:`(|\mathcal{V}
-0000bf00: 7c2c 2046 5f6e 2960 0a20 2020 2020 2020  |, F_n)`.       
-0000bf10: 2065 6467 655f 696e 6465 783a 2074 6f72   edge_index: tor
-0000bf20: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-0000bf30: 2020 2020 2020 4564 6765 2069 6e64 6578        Edge index
-0000bf40: 6573 206f 6620 7368 6170 6520 3a6d 6174  es of shape :mat
-0000bf50: 683a 6028 322c 207c 5c6d 6174 6863 616c  h:`(2, |\mathcal
-0000bf60: 7b45 7d7c 2960 0a20 2020 2020 2020 2065  {E}|)`.        e
-0000bf70: 6467 655f 6665 6174 7572 6573 3a20 746f  dge_features: to
-0000bf80: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-0000bf90: 2020 2020 2020 2045 6467 6520 6665 6174         Edge feat
-0000bfa0: 7572 6573 206f 6620 7468 6520 6772 6170  ures of the grap
-0000bfb0: 682c 2073 6861 7065 3a20 3a6d 6174 683a  h, shape: :math:
-0000bfc0: 6028 7c5c 6d61 7468 6361 6c7b 457d 7c2c  `(|\mathcal{E}|,
-0000bfd0: 2046 5f65 2960 0a20 2020 2020 2020 2067   F_e)`.        g
-0000bfe0: 6c6f 6261 6c5f 6665 6174 7572 6573 3a20  lobal_features: 
-0000bff0: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-0000c000: 2020 2020 2020 2020 2047 6c6f 6261 6c20           Global 
-0000c010: 6665 6174 7572 6573 206f 6620 7468 6520  features of the 
-0000c020: 6772 6170 682c 2073 6861 7065 3a20 3a6d  graph, shape: :m
-0000c030: 6174 683a 6028 465f 672c 2031 2960 2077  ath:`(F_g, 1)` w
-0000c040: 6865 7265 2c20 3a6d 6174 683a 607c 5c6d  here, :math:`|\m
-0000c050: 6174 6863 616c 7b56 7d7c 6020 616e 6420  athcal{V}|` and 
-0000c060: 3a6d 6174 683a 607c 5c6d 6174 6863 616c  :math:`|\mathcal
-0000c070: 7b45 7d7c 6020 6465 6e6f 7465 7320 7468  {E}|` denotes th
-0000c080: 6520 6e75 6d62 6572 206f 6620 6e6f 6465  e number of node
-0000c090: 7320 616e 6420 6564 6765 7320 696e 2074  s and edges in t
-0000c0a0: 6865 2067 7261 7068 2c0a 2020 2020 2020  he graph,.      
-0000c0b0: 2020 2020 2020 3a6d 6174 683a 6046 5f6e        :math:`F_n
-0000c0c0: 602c 203a 6d61 7468 3a60 465f 6560 2c20  `, :math:`F_e`, 
-0000c0d0: 3a6d 6174 683a 6046 5f67 6020 6465 6e6f  :math:`F_g` deno
-0000c0e0: 7465 7320 7468 6520 6e75 6d62 6572 206f  tes the number o
-0000c0f0: 6620 6e6f 6465 2066 6561 7475 7265 732c  f node features,
-0000c100: 2065 6467 6520 6665 6174 7572 6573 2061   edge features a
-0000c110: 6e64 2067 6c6f 6261 6c20 7374 6174 6520  nd global state 
-0000c120: 6665 6174 7572 6573 2072 6573 7065 6374  features respect
-0000c130: 6976 656c 792e 0a20 2020 2020 2020 2062  ively..        b
-0000c140: 6174 6368 3a20 746f 7263 682e 4c6f 6e67  atch: torch.Long
-0000c150: 5465 6e73 6f72 2028 6f70 7469 6f6e 616c  Tensor (optional
-0000c160: 2c20 6465 6661 756c 743a 204e 6f6e 6529  , default: None)
-0000c170: 0a20 2020 2020 2020 2020 2020 2041 2076  .            A v
-0000c180: 6563 746f 7220 7468 6174 206d 6170 7320  ector that maps 
-0000c190: 6561 6368 206e 6f64 6520 746f 2069 7473  each node to its
-0000c1a0: 2072 6573 7065 6374 6976 6520 6772 6170   respective grap
-0000c1b0: 6820 6964 656e 7469 6669 6572 2e20 5468  h identifier. Th
-0000c1c0: 6520 6174 7472 6962 7574 6520 6973 2075  e attribute is u
-0000c1d0: 7365 6420 6f6e 6c79 2077 6865 6e20 6d6f  sed only when mo
-0000c1e0: 7265 2074 6861 6e20 6f6e 6520 6772 6170  re than one grap
-0000c1f0: 6820 6172 6520 6261 7463 6865 6420 746f  h are batched to
-0000c200: 6765 7468 6572 2064 7572 696e 6720 6120  gether during a 
-0000c210: 7369 6e67 6c65 2066 6f72 7761 7264 2070  single forward p
-0000c220: 6173 732e 0a20 2020 2020 2020 2022 2222  ass..        """
-0000c230: 0a20 2020 2020 2020 2069 6620 6261 7463  .        if batc
-0000c240: 6820 6973 204e 6f6e 653a 0a20 2020 2020  h is None:.     
-0000c250: 2020 2020 2020 2062 6174 6368 203d 206e         batch = n
-0000c260: 6f64 655f 6665 6174 7572 6573 2e6e 6577  ode_features.new
-0000c270: 5f7a 6572 6f73 286e 6f64 655f 6665 6174  _zeros(node_feat
-0000c280: 7572 6573 2e73 697a 6528 3029 2c0a 2020  ures.size(0),.  
-0000c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc60: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000bc70: 6475 6365 3d27 6d65 616e 2729 0a20 2020  duce='mean').   
+0000bc80: 2020 2020 206f 7574 203d 2074 6f72 6368       out = torch
+0000bc90: 2e63 6174 280a 2020 2020 2020 2020 2020  .cat(.          
+0000bca0: 2020 2865 6467 655f 6665 6174 7572 6573    (edge_features
+0000bcb0: 5f6d 6561 6e2c 206e 6f64 655f 6665 6174  _mean, node_feat
+0000bcc0: 7572 6573 5f6d 6561 6e2c 2067 6c6f 6261  ures_mean, globa
+0000bcd0: 6c5f 6665 6174 7572 6573 292c 2064 696d  l_features), dim
+0000bce0: 3d31 290a 2020 2020 2020 2020 666f 7220  =1).        for 
+0000bcf0: 6d6f 6465 6c20 696e 2073 656c 662e 676c  model in self.gl
+0000bd00: 6f62 616c 5f6d 6f64 656c 733a 0a20 2020  obal_models:.   
+0000bd10: 2020 2020 2020 2020 206f 7574 203d 206d           out = m
+0000bd20: 6f64 656c 286f 7574 290a 2020 2020 2020  odel(out).      
+0000bd30: 2020 7265 7475 726e 2073 656c 662e 676c    return self.gl
+0000bd40: 6f62 616c 5f64 656e 7365 286f 7574 290a  obal_dense(out).
+0000bd50: 0a20 2020 2064 6566 2066 6f72 7761 7264  .    def forward
+0000bd60: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000bd70: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+0000bd80: 6e6f 6465 5f66 6561 7475 7265 733a 2054  node_features: T
+0000bd90: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
+0000bda0: 2020 2065 6467 655f 696e 6465 783a 2054     edge_index: T
+0000bdb0: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
+0000bdc0: 2020 2065 6467 655f 6665 6174 7572 6573     edge_features
+0000bdd0: 3a20 5465 6e73 6f72 2c0a 2020 2020 2020  : Tensor,.      
+0000bde0: 2020 2020 2020 676c 6f62 616c 5f66 6561        global_fea
+0000bdf0: 7475 7265 733a 2054 656e 736f 722c 0a20  tures: Tensor,. 
+0000be00: 2020 2020 2020 2020 2020 2062 6174 6368             batch
+0000be10: 3a20 4f70 7469 6f6e 616c 5b54 656e 736f  : Optional[Tenso
+0000be20: 725d 203d 204e 6f6e 6529 202d 3e20 5475  r] = None) -> Tu
+0000be30: 706c 655b 5465 6e73 6f72 2c20 5465 6e73  ple[Tensor, Tens
+0000be40: 6f72 2c20 5465 6e73 6f72 5d3a 0a20 2020  or, Tensor]:.   
+0000be50: 2020 2020 2022 2222 4f75 7470 7574 2063       """Output c
+0000be60: 6f6d 7075 7461 7469 6f6e 2066 6f72 2061  omputation for a
+0000be70: 2047 7261 7068 4e65 7477 6f72 6b0a 0a20   GraphNetwork.. 
+0000be80: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+0000be90: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0000bea0: 2d2d 2d2d 0a20 2020 2020 2020 206e 6f64  ----.        nod
+0000beb0: 655f 6665 6174 7572 6573 3a20 746f 7263  e_features: torc
+0000bec0: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+0000bed0: 2020 2020 2049 6e70 7574 206e 6f64 6520       Input node 
+0000bee0: 6665 6174 7572 6573 206f 6620 7368 6170  features of shap
+0000bef0: 6520 3a6d 6174 683a 6028 7c5c 6d61 7468  e :math:`(|\math
+0000bf00: 6361 6c7b 567d 7c2c 2046 5f6e 2960 0a20  cal{V}|, F_n)`. 
+0000bf10: 2020 2020 2020 2065 6467 655f 696e 6465         edge_inde
+0000bf20: 783a 2074 6f72 6368 2e54 656e 736f 720a  x: torch.Tensor.
+0000bf30: 2020 2020 2020 2020 2020 2020 4564 6765              Edge
+0000bf40: 2069 6e64 6578 6573 206f 6620 7368 6170   indexes of shap
+0000bf50: 6520 3a6d 6174 683a 6028 322c 207c 5c6d  e :math:`(2, |\m
+0000bf60: 6174 6863 616c 7b45 7d7c 2960 0a20 2020  athcal{E}|)`.   
+0000bf70: 2020 2020 2065 6467 655f 6665 6174 7572       edge_featur
+0000bf80: 6573 3a20 746f 7263 682e 5465 6e73 6f72  es: torch.Tensor
+0000bf90: 0a20 2020 2020 2020 2020 2020 2045 6467  .            Edg
+0000bfa0: 6520 6665 6174 7572 6573 206f 6620 7468  e features of th
+0000bfb0: 6520 6772 6170 682c 2073 6861 7065 3a20  e graph, shape: 
+0000bfc0: 3a6d 6174 683a 6028 7c5c 6d61 7468 6361  :math:`(|\mathca
+0000bfd0: 6c7b 457d 7c2c 2046 5f65 2960 0a20 2020  l{E}|, F_e)`.   
+0000bfe0: 2020 2020 2067 6c6f 6261 6c5f 6665 6174       global_feat
+0000bff0: 7572 6573 3a20 746f 7263 682e 5465 6e73  ures: torch.Tens
+0000c000: 6f72 0a20 2020 2020 2020 2020 2020 2047  or.            G
+0000c010: 6c6f 6261 6c20 6665 6174 7572 6573 206f  lobal features o
+0000c020: 6620 7468 6520 6772 6170 682c 2073 6861  f the graph, sha
+0000c030: 7065 3a20 3a6d 6174 683a 6028 465f 672c  pe: :math:`(F_g,
+0000c040: 2031 2960 2077 6865 7265 2c20 3a6d 6174   1)` where, :mat
+0000c050: 683a 607c 5c6d 6174 6863 616c 7b56 7d7c  h:`|\mathcal{V}|
+0000c060: 6020 616e 6420 3a6d 6174 683a 607c 5c6d  ` and :math:`|\m
+0000c070: 6174 6863 616c 7b45 7d7c 6020 6465 6e6f  athcal{E}|` deno
+0000c080: 7465 7320 7468 6520 6e75 6d62 6572 206f  tes the number o
+0000c090: 6620 6e6f 6465 7320 616e 6420 6564 6765  f nodes and edge
+0000c0a0: 7320 696e 2074 6865 2067 7261 7068 2c0a  s in the graph,.
+0000c0b0: 2020 2020 2020 2020 2020 2020 3a6d 6174              :mat
+0000c0c0: 683a 6046 5f6e 602c 203a 6d61 7468 3a60  h:`F_n`, :math:`
+0000c0d0: 465f 6560 2c20 3a6d 6174 683a 6046 5f67  F_e`, :math:`F_g
+0000c0e0: 6020 6465 6e6f 7465 7320 7468 6520 6e75  ` denotes the nu
+0000c0f0: 6d62 6572 206f 6620 6e6f 6465 2066 6561  mber of node fea
+0000c100: 7475 7265 732c 2065 6467 6520 6665 6174  tures, edge feat
+0000c110: 7572 6573 2061 6e64 2067 6c6f 6261 6c20  ures and global 
+0000c120: 7374 6174 6520 6665 6174 7572 6573 2072  state features r
+0000c130: 6573 7065 6374 6976 656c 792e 0a20 2020  espectively..   
+0000c140: 2020 2020 2062 6174 6368 3a20 746f 7263       batch: torc
+0000c150: 682e 4c6f 6e67 5465 6e73 6f72 2028 6f70  h.LongTensor (op
+0000c160: 7469 6f6e 616c 2c20 6465 6661 756c 743a  tional, default:
+0000c170: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+0000c180: 2020 2041 2076 6563 746f 7220 7468 6174     A vector that
+0000c190: 206d 6170 7320 6561 6368 206e 6f64 6520   maps each node 
+0000c1a0: 746f 2069 7473 2072 6573 7065 6374 6976  to its respectiv
+0000c1b0: 6520 6772 6170 6820 6964 656e 7469 6669  e graph identifi
+0000c1c0: 6572 2e20 5468 6520 6174 7472 6962 7574  er. The attribut
+0000c1d0: 6520 6973 2075 7365 6420 6f6e 6c79 2077  e is used only w
+0000c1e0: 6865 6e20 6d6f 7265 2074 6861 6e20 6f6e  hen more than on
+0000c1f0: 6520 6772 6170 6820 6172 6520 6261 7463  e graph are batc
+0000c200: 6865 6420 746f 6765 7468 6572 2064 7572  hed together dur
+0000c210: 696e 6720 6120 7369 6e67 6c65 2066 6f72  ing a single for
+0000c220: 7761 7264 2070 6173 732e 0a20 2020 2020  ward pass..     
+0000c230: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0000c240: 6620 6261 7463 6820 6973 204e 6f6e 653a  f batch is None:
+0000c250: 0a20 2020 2020 2020 2020 2020 2062 6174  .            bat
+0000c260: 6368 203d 206e 6f64 655f 6665 6174 7572  ch = node_featur
+0000c270: 6573 2e6e 6577 5f7a 6572 6f73 286e 6f64  es.new_zeros(nod
+0000c280: 655f 6665 6174 7572 6573 2e73 697a 6528  e_features.size(
+0000c290: 3029 2c0a 2020 2020 2020 2020 2020 2020  0),.            
 0000c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2b0: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
-0000c2c0: 746f 7263 682e 696e 7436 3429 0a0a 2020  torch.int64)..  
-0000c2d0: 2020 2020 2020 6e6f 6465 5f66 6561 7475        node_featu
-0000c2e0: 7265 735f 636f 7079 2c20 6564 6765 5f66  res_copy, edge_f
-0000c2f0: 6561 7475 7265 735f 636f 7079 2c20 676c  eatures_copy, gl
-0000c300: 6f62 616c 5f66 6561 7475 7265 735f 636f  obal_features_co
-0000c310: 7079 203d 206e 6f64 655f 6665 6174 7572  py = node_featur
-0000c320: 6573 2c20 6564 6765 5f66 6561 7475 7265  es, edge_feature
-0000c330: 732c 2067 6c6f 6261 6c5f 6665 6174 7572  s, global_featur
-0000c340: 6573 0a20 2020 2020 2020 2069 6620 7365  es.        if se
-0000c350: 6c66 2e69 735f 756e 6469 7265 6374 6564  lf.is_undirected
-0000c360: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
-0000c370: 2020 2020 2020 2320 686f 6c64 696e 6720        # holding 
-0000c380: 6269 2d64 6972 6563 7469 6f6e 616c 2065  bi-directional e
-0000c390: 6467 6573 2069 6e20 6361 7365 206f 6620  dges in case of 
-0000c3a0: 756e 6469 7265 6374 6564 2067 7261 7068  undirected graph
-0000c3b0: 730a 2020 2020 2020 2020 2020 2020 6564  s.            ed
-0000c3c0: 6765 5f69 6e64 6578 203d 2074 6f72 6368  ge_index = torch
-0000c3d0: 2e63 6174 2828 6564 6765 5f69 6e64 6578  .cat((edge_index
-0000c3e0: 2c20 6564 6765 5f69 6e64 6578 2e66 6c69  , edge_index.fli
-0000c3f0: 7028 5b30 5d29 292c 2064 696d 3d31 290a  p([0])), dim=1).
-0000c400: 2020 2020 2020 2020 2020 2020 6564 6765              edge
-0000c410: 5f66 6561 7475 7265 735f 6c65 6e20 3d20  _features_len = 
-0000c420: 6564 6765 5f66 6561 7475 7265 732e 7368  edge_features.sh
-0000c430: 6170 655b 305d 0a20 2020 2020 2020 2020  ape[0].         
-0000c440: 2020 2065 6467 655f 6665 6174 7572 6573     edge_features
-0000c450: 203d 2074 6f72 6368 2e63 6174 2828 6564   = torch.cat((ed
-0000c460: 6765 5f66 6561 7475 7265 732c 2065 6467  ge_features, edg
-0000c470: 655f 6665 6174 7572 6573 292c 2064 696d  e_features), dim
-0000c480: 3d30 290a 2020 2020 2020 2020 6564 6765  =0).        edge
-0000c490: 5f62 6174 6368 5f6d 6170 203d 2062 6174  _batch_map = bat
-0000c4a0: 6368 5b65 6467 655f 696e 6465 785b 305d  ch[edge_index[0]
-0000c4b0: 5d0a 2020 2020 2020 2020 6564 6765 5f66  ].        edge_f
-0000c4c0: 6561 7475 7265 7320 3d20 7365 6c66 2e5f  eatures = self._
-0000c4d0: 7570 6461 7465 5f65 6467 655f 6665 6174  update_edge_feat
-0000c4e0: 7572 6573 286e 6f64 655f 6665 6174 7572  ures(node_featur
-0000c4f0: 6573 2c20 6564 6765 5f69 6e64 6578 2c0a  es, edge_index,.
-0000c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2c0: 6474 7970 653d 746f 7263 682e 696e 7436  dtype=torch.int6
+0000c2d0: 3429 0a0a 2020 2020 2020 2020 6e6f 6465  4)..        node
+0000c2e0: 5f66 6561 7475 7265 735f 636f 7079 2c20  _features_copy, 
+0000c2f0: 6564 6765 5f66 6561 7475 7265 735f 636f  edge_features_co
+0000c300: 7079 2c20 676c 6f62 616c 5f66 6561 7475  py, global_featu
+0000c310: 7265 735f 636f 7079 203d 206e 6f64 655f  res_copy = node_
+0000c320: 6665 6174 7572 6573 2c20 6564 6765 5f66  features, edge_f
+0000c330: 6561 7475 7265 732c 2067 6c6f 6261 6c5f  eatures, global_
+0000c340: 6665 6174 7572 6573 0a20 2020 2020 2020  features.       
+0000c350: 2069 6620 7365 6c66 2e69 735f 756e 6469   if self.is_undi
+0000c360: 7265 6374 6564 2069 7320 5472 7565 3a0a  rected is True:.
+0000c370: 2020 2020 2020 2020 2020 2020 2320 686f              # ho
+0000c380: 6c64 696e 6720 6269 2d64 6972 6563 7469  lding bi-directi
+0000c390: 6f6e 616c 2065 6467 6573 2069 6e20 6361  onal edges in ca
+0000c3a0: 7365 206f 6620 756e 6469 7265 6374 6564  se of undirected
+0000c3b0: 2067 7261 7068 730a 2020 2020 2020 2020   graphs.        
+0000c3c0: 2020 2020 6564 6765 5f69 6e64 6578 203d      edge_index =
+0000c3d0: 2074 6f72 6368 2e63 6174 2828 6564 6765   torch.cat((edge
+0000c3e0: 5f69 6e64 6578 2c20 6564 6765 5f69 6e64  _index, edge_ind
+0000c3f0: 6578 2e66 6c69 7028 5b30 5d29 292c 2064  ex.flip([0])), d
+0000c400: 696d 3d31 290a 2020 2020 2020 2020 2020  im=1).          
+0000c410: 2020 6564 6765 5f66 6561 7475 7265 735f    edge_features_
+0000c420: 6c65 6e20 3d20 6564 6765 5f66 6561 7475  len = edge_featu
+0000c430: 7265 732e 7368 6170 655b 305d 0a20 2020  res.shape[0].   
+0000c440: 2020 2020 2020 2020 2065 6467 655f 6665           edge_fe
+0000c450: 6174 7572 6573 203d 2074 6f72 6368 2e63  atures = torch.c
+0000c460: 6174 2828 6564 6765 5f66 6561 7475 7265  at((edge_feature
+0000c470: 732c 2065 6467 655f 6665 6174 7572 6573  s, edge_features
+0000c480: 292c 2064 696d 3d30 290a 2020 2020 2020  ), dim=0).      
+0000c490: 2020 6564 6765 5f62 6174 6368 5f6d 6170    edge_batch_map
+0000c4a0: 203d 2062 6174 6368 5b65 6467 655f 696e   = batch[edge_in
+0000c4b0: 6465 785b 305d 5d0a 2020 2020 2020 2020  dex[0]].        
+0000c4c0: 6564 6765 5f66 6561 7475 7265 7320 3d20  edge_features = 
+0000c4d0: 7365 6c66 2e5f 7570 6461 7465 5f65 6467  self._update_edg
+0000c4e0: 655f 6665 6174 7572 6573 286e 6f64 655f  e_features(node_
+0000c4f0: 6665 6174 7572 6573 2c20 6564 6765 5f69  features, edge_i
+0000c500: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
 0000c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c530: 2020 2065 6467 655f 6665 6174 7572 6573     edge_features
-0000c540: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000c530: 2020 2020 2020 2020 2065 6467 655f 6665           edge_fe
+0000c540: 6174 7572 6573 2c0a 2020 2020 2020 2020  atures,.        
 0000c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c570: 2020 2020 2067 6c6f 6261 6c5f 6665 6174       global_feat
-0000c580: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
+0000c570: 2020 2020 2020 2020 2020 2067 6c6f 6261             globa
+0000c580: 6c5f 6665 6174 7572 6573 2c0a 2020 2020  l_features,.    
 0000c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5b0: 2020 2020 2020 2020 2065 6467 655f 6261           edge_ba
-0000c5c0: 7463 685f 6d61 7029 0a20 2020 2020 2020  tch_map).       
-0000c5d0: 206e 6f64 655f 6665 6174 7572 6573 203d   node_features =
-0000c5e0: 2073 656c 662e 5f75 7064 6174 655f 6e6f   self._update_no
-0000c5f0: 6465 5f66 6561 7475 7265 7328 6e6f 6465  de_features(node
-0000c600: 5f66 6561 7475 7265 732c 2065 6467 655f  _features, edge_
-0000c610: 696e 6465 782c 0a20 2020 2020 2020 2020  index,.         
+0000c5b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000c5c0: 6467 655f 6261 7463 685f 6d61 7029 0a20  dge_batch_map). 
+0000c5d0: 2020 2020 2020 206e 6f64 655f 6665 6174         node_feat
+0000c5e0: 7572 6573 203d 2073 656c 662e 5f75 7064  ures = self._upd
+0000c5f0: 6174 655f 6e6f 6465 5f66 6561 7475 7265  ate_node_feature
+0000c600: 7328 6e6f 6465 5f66 6561 7475 7265 732c  s(node_features,
+0000c610: 2065 6467 655f 696e 6465 782c 0a20 2020   edge_index,.   
 0000c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c640: 2020 2020 2020 2020 2020 6564 6765 5f66            edge_f
-0000c650: 6561 7475 7265 732c 0a20 2020 2020 2020  eatures,.       
+0000c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c650: 6564 6765 5f66 6561 7475 7265 732c 0a20  edge_features,. 
 0000c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c680: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
-0000c690: 616c 5f66 6561 7475 7265 732c 2062 6174  al_features, bat
-0000c6a0: 6368 290a 2020 2020 2020 2020 676c 6f62  ch).        glob
-0000c6b0: 616c 5f66 6561 7475 7265 7320 3d20 7365  al_features = se
-0000c6c0: 6c66 2e5f 7570 6461 7465 5f67 6c6f 6261  lf._update_globa
-0000c6d0: 6c5f 6665 6174 7572 6573 286e 6f64 655f  l_features(node_
-0000c6e0: 6665 6174 7572 6573 2c0a 2020 2020 2020  features,.      
+0000c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c690: 2020 676c 6f62 616c 5f66 6561 7475 7265    global_feature
+0000c6a0: 732c 2062 6174 6368 290a 2020 2020 2020  s, batch).      
+0000c6b0: 2020 676c 6f62 616c 5f66 6561 7475 7265    global_feature
+0000c6c0: 7320 3d20 7365 6c66 2e5f 7570 6461 7465  s = self._update
+0000c6d0: 5f67 6c6f 6261 6c5f 6665 6174 7572 6573  _global_features
+0000c6e0: 286e 6f64 655f 6665 6174 7572 6573 2c0a  (node_features,.
 0000c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c720: 2065 6467 655f 6665 6174 7572 6573 2c0a   edge_features,.
-0000c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c720: 2020 2020 2020 2065 6467 655f 6665 6174         edge_feat
+0000c730: 7572 6573 2c0a 2020 2020 2020 2020 2020  ures,.          
 0000c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c760: 2020 2020 2020 2067 6c6f 6261 6c5f 6665         global_fe
-0000c770: 6174 7572 6573 2c20 6261 7463 682c 0a20  atures, batch,. 
-0000c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c760: 2020 2020 2020 2020 2020 2020 2067 6c6f               glo
+0000c770: 6261 6c5f 6665 6174 7572 6573 2c20 6261  bal_features, ba
+0000c780: 7463 682c 0a20 2020 2020 2020 2020 2020  tch,.           
 0000c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7b0: 2020 2020 2020 6564 6765 5f62 6174 6368        edge_batch
-0000c7c0: 5f6d 6170 290a 0a20 2020 2020 2020 2069  _map)..        i
-0000c7d0: 6620 7365 6c66 2e69 735f 756e 6469 7265  f self.is_undire
-0000c7e0: 6374 6564 2069 7320 5472 7565 3a0a 2020  cted is True:.  
-0000c7f0: 2020 2020 2020 2020 2020 2320 636f 6f6e            # coon
-0000c800: 7665 7274 696e 6720 6564 6765 2066 6561  verting edge fea
-0000c810: 7475 7265 7320 746f 2069 7473 206f 7269  tures to its ori
-0000c820: 6769 6e61 6c20 7368 6170 650a 2020 2020  ginal shape.    
-0000c830: 2020 2020 2020 2020 7370 6c69 7420 3d20          split = 
-0000c840: 746f 7263 682e 7370 6c69 7428 6564 6765  torch.split(edge
-0000c850: 5f66 6561 7475 7265 732c 0a20 2020 2020  _features,.     
-0000c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c870: 2020 2020 2020 2020 2020 205b 6564 6765             [edge
-0000c880: 5f66 6561 7475 7265 735f 6c65 6e2c 2065  _features_len, e
-0000c890: 6467 655f 6665 6174 7572 6573 5f6c 656e  dge_features_len
-0000c8a0: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
-0000c8b0: 6467 655f 6665 6174 7572 6573 203d 2028  dge_features = (
-0000c8c0: 7370 6c69 745b 305d 202b 2073 706c 6974  split[0] + split
-0000c8d0: 5b31 5d29 202f 2032 0a0a 2020 2020 2020  [1]) / 2..      
-0000c8e0: 2020 6966 2073 656c 662e 7265 7369 6475    if self.residu
-0000c8f0: 616c 5f63 6f6e 6e65 6374 696f 6e3a 0a20  al_connection:. 
-0000c900: 2020 2020 2020 2020 2020 2065 6467 655f             edge_
-0000c910: 6665 6174 7572 6573 202b 3d20 6564 6765  features += edge
-0000c920: 5f66 6561 7475 7265 735f 636f 7079 0a20  _features_copy. 
-0000c930: 2020 2020 2020 2020 2020 206e 6f64 655f             node_
-0000c940: 6665 6174 7572 6573 202b 3d20 6e6f 6465  features += node
-0000c950: 5f66 6561 7475 7265 735f 636f 7079 0a20  _features_copy. 
-0000c960: 2020 2020 2020 2020 2020 2067 6c6f 6261             globa
-0000c970: 6c5f 6665 6174 7572 6573 202b 3d20 676c  l_features += gl
-0000c980: 6f62 616c 5f66 6561 7475 7265 735f 636f  obal_features_co
-0000c990: 7079 0a0a 2020 2020 2020 2020 7265 7475  py..        retu
-0000c9a0: 726e 206e 6f64 655f 6665 6174 7572 6573  rn node_features
-0000c9b0: 2c20 6564 6765 5f66 6561 7475 7265 732c  , edge_features,
-0000c9c0: 2067 6c6f 6261 6c5f 6665 6174 7572 6573   global_features
-0000c9d0: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
-0000c9e0: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
-0000c9f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000ca00: 280a 2020 2020 2020 2020 2020 2020 6627  (.            f'
-0000ca10: 7b73 656c 662e 5f5f 636c 6173 735f 5f2e  {self.__class__.
-0000ca20: 5f5f 6e61 6d65 5f5f 7d28 6e5f 6e6f 6465  __name__}(n_node
-0000ca30: 5f66 6561 7475 7265 733d 7b73 656c 662e  _features={self.
-0000ca40: 6e5f 6e6f 6465 5f66 6561 7475 7265 737d  n_node_features}
-0000ca50: 2c20 6e5f 6564 6765 5f66 6561 7475 7265  , n_edge_feature
-0000ca60: 733d 7b73 656c 662e 6e5f 6564 6765 5f66  s={self.n_edge_f
-0000ca70: 6561 7475 7265 737d 2c20 6e5f 676c 6f62  eatures}, n_glob
-0000ca80: 616c 5f66 6561 7475 7265 733d 7b73 656c  al_features={sel
-0000ca90: 662e 6e5f 676c 6f62 616c 5f66 6561 7475  f.n_global_featu
-0000caa0: 7265 737d 2c20 6973 5f75 6e64 6972 6563  res}, is_undirec
-0000cab0: 7465 643d 7b73 656c 662e 6973 5f75 6e64  ted={self.is_und
-0000cac0: 6972 6563 7465 647d 2c20 7265 7369 6475  irected}, residu
-0000cad0: 616c 5f63 6f6e 6e65 6374 696f 6e3d 7b73  al_connection={s
-0000cae0: 656c 662e 7265 7369 6475 616c 5f63 6f6e  elf.residual_con
-0000caf0: 6e65 6374 696f 6e7d 2927 0a20 2020 2020  nection})'.     
-0000cb00: 2020 2029 0a0a 0a63 6c61 7373 2041 6666     )...class Aff
-0000cb10: 696e 6528 6e6e 2e4d 6f64 756c 6529 3a0a  ine(nn.Module):.
-0000cb20: 2020 2020 2222 2243 6c61 7373 2077 6869      """Class whi
-0000cb30: 6368 2070 6572 666f 726d 7320 7468 6520  ch performs the 
-0000cb40: 4166 6669 6e65 2074 7261 6e73 666f 726d  Affine transform
-0000cb50: 6174 696f 6e2e 0a0a 2020 2020 5468 6973  ation...    This
-0000cb60: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
-0000cb70: 6973 2062 6173 6564 206f 6e20 7468 6520  is based on the 
-0000cb80: 6166 6669 6e69 7479 206f 6620 7468 6520  affinity of the 
-0000cb90: 6261 7365 2064 6973 7472 6962 7574 696f  base distributio
-0000cba0: 6e20 7769 7468 0a20 2020 2074 6865 2074  n with.    the t
-0000cbb0: 6172 6765 7420 6469 7374 7269 6275 7469  arget distributi
-0000cbc0: 6f6e 2e20 4120 6765 6f6d 6574 7269 6320  on. A geometric 
-0000cbd0: 7472 616e 7366 6f72 6d61 7469 6f6e 2069  transformation i
-0000cbe0: 7320 6170 706c 6965 6420 7768 6572 650a  s applied where.
-0000cbf0: 2020 2020 7468 6520 7061 7261 6d65 7465      the paramete
-0000cc00: 7273 2070 6572 666f 726d 7320 6368 616e  rs performs chan
-0000cc10: 6765 7320 6f6e 2074 6865 2073 6361 6c65  ges on the scale
-0000cc20: 2061 6e64 2073 6869 6674 206f 6620 6120   and shift of a 
-0000cc30: 6675 6e63 7469 6f6e 0a20 2020 2028 696e  function.    (in
-0000cc40: 7075 7473 292e 0a0a 2020 2020 4e6f 726d  puts)...    Norm
-0000cc50: 616c 697a 696e 6720 466c 6f77 2074 7261  alizing Flow tra
-0000cc60: 6e73 666f 726d 6174 696f 6e73 206d 7573  nsformations mus
-0000cc70: 7420 6265 2062 696a 6563 7469 7665 2069  t be bijective i
-0000cc80: 6e20 6f72 6465 7220 746f 2063 6f6d 7075  n order to compu
-0000cc90: 7465 0a20 2020 2074 6865 206c 6f67 6172  te.    the logar
-0000cca0: 6974 686d 206f 6620 6a61 636f 6269 616e  ithm of jacobian
-0000ccb0: 2773 2064 6574 6572 6d69 6e61 6e74 2e20  's determinant. 
-0000ccc0: 466f 7220 7468 6973 2072 6561 736f 6e2c  For this reason,
-0000ccd0: 2074 7261 6e73 666f 726d 6174 696f 6e73   transformations
-0000cce0: 0a20 2020 206d 7573 7420 7065 7266 6f72  .    must perfor
-0000ccf0: 6d20 6120 666f 7277 6172 6420 616e 6420  m a forward and 
-0000cd00: 696e 7665 7273 6520 7061 7373 2e0a 0a20  inverse pass... 
-0000cd10: 2020 2045 7861 6d70 6c65 0a20 2020 202d     Example.    -
-0000cd20: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
-0000cd30: 696d 706f 7274 2064 6565 7063 6865 6d20  import deepchem 
-0000cd40: 6173 2064 630a 2020 2020 3e3e 3e20 6672  as dc.    >>> fr
-0000cd50: 6f6d 2064 6565 7063 6865 6d2e 6d6f 6465  om deepchem.mode
-0000cd60: 6c73 2e74 6f72 6368 5f6d 6f64 656c 732e  ls.torch_models.
-0000cd70: 6c61 7965 7273 2069 6d70 6f72 7420 4166  layers import Af
-0000cd80: 6669 6e65 0a20 2020 203e 3e3e 2069 6d70  fine.    >>> imp
-0000cd90: 6f72 7420 746f 7263 680a 2020 2020 3e3e  ort torch.    >>
-0000cda0: 3e20 6672 6f6d 2074 6f72 6368 2e64 6973  > from torch.dis
-0000cdb0: 7472 6962 7574 696f 6e73 2069 6d70 6f72  tributions impor
-0000cdc0: 7420 4d75 6c74 6976 6172 6961 7465 4e6f  t MultivariateNo
-0000cdd0: 726d 616c 0a20 2020 203e 3e3e 2023 2069  rmal.    >>> # i
-0000cde0: 6e69 7469 616c 697a 6520 7468 6520 7472  nitialize the tr
-0000cdf0: 616e 7366 6f72 6d61 7469 6f6e 206c 6179  ansformation lay
-0000ce00: 6572 2773 2070 6172 616d 6574 6572 730a  er's parameters.
-0000ce10: 2020 2020 3e3e 3e20 6469 6d20 3d20 320a      >>> dim = 2.
-0000ce20: 2020 2020 3e3e 3e20 7361 6d70 6c65 7320      >>> samples 
-0000ce30: 3d20 3936 0a20 2020 203e 3e3e 2074 7261  = 96.    >>> tra
-0000ce40: 6e73 666f 726d 7320 3d20 4166 6669 6e65  nsforms = Affine
-0000ce50: 2864 696d 290a 2020 2020 3e3e 3e20 2320  (dim).    >>> # 
-0000ce60: 666f 7277 6172 6420 7061 7373 2062 6173  forward pass bas
-0000ce70: 6564 206f 6e20 6120 6769 7665 6e20 6469  ed on a given di
-0000ce80: 7374 7269 6275 7469 6f6e 0a20 2020 203e  stribution.    >
-0000ce90: 3e3e 2064 6973 7472 6962 7574 696f 6e20  >> distribution 
-0000cea0: 3d20 4d75 6c74 6976 6172 6961 7465 4e6f  = MultivariateNo
-0000ceb0: 726d 616c 2874 6f72 6368 2e7a 6572 6f73  rmal(torch.zeros
-0000cec0: 2864 696d 292c 2074 6f72 6368 2e65 7965  (dim), torch.eye
-0000ced0: 2864 696d 2929 0a20 2020 203e 3e3e 2069  (dim)).    >>> i
-0000cee0: 6e70 7574 203d 2064 6973 7472 6962 7574  nput = distribut
-0000cef0: 696f 6e2e 7361 6d70 6c65 2874 6f72 6368  ion.sample(torch
-0000cf00: 2e53 697a 6528 2873 616d 706c 6573 2c20  .Size((samples, 
-0000cf10: 6469 6d29 2929 0a20 2020 203e 3e3e 206c  dim))).    >>> l
-0000cf20: 656e 2874 7261 6e73 666f 726d 732e 666f  en(transforms.fo
-0000cf30: 7277 6172 6428 696e 7075 7429 290a 2020  rward(input)).  
-0000cf40: 2020 320a 2020 2020 3e3e 3e20 2320 696e    2.    >>> # in
-0000cf50: 7665 7273 6520 7061 7373 2062 6173 6564  verse pass based
-0000cf60: 206f 6e20 6120 6469 7374 7269 6275 7469   on a distributi
-0000cf70: 6f6e 0a20 2020 203e 3e3e 206c 656e 2874  on.    >>> len(t
-0000cf80: 7261 6e73 666f 726d 732e 696e 7665 7273  ransforms.invers
-0000cf90: 6528 696e 7075 7429 290a 2020 2020 320a  e(input)).    2.
-0000cfa0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-0000cfb0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0000cfc0: 2064 696d 3a20 696e 7429 202d 3e20 4e6f   dim: int) -> No
-0000cfd0: 6e65 3a0a 2020 2020 2020 2020 2222 2243  ne:.        """C
-0000cfe0: 7265 6174 6520 6120 4166 6669 6e65 2074  reate a Affine t
-0000cff0: 7261 6e73 666f 726d 206c 6179 6572 2e0a  ransform layer..
-0000d000: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0000d010: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-0000d020: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-0000d030: 696d 3a20 696e 740a 2020 2020 2020 2020  im: int.        
-0000d040: 2020 2020 5661 6c75 6520 6f66 2074 6865      Value of the
-0000d050: 204e 7468 2064 696d 656e 7369 6f6e 206f   Nth dimension o
-0000d060: 6620 7468 6520 6461 7461 7365 742e 0a0a  f the dataset...
-0000d070: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000d080: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
-0000d090: 6e69 745f 5f28 290a 2020 2020 2020 2020  nit__().        
-0000d0a0: 7365 6c66 2e64 696d 203d 2064 696d 0a20  self.dim = dim. 
-0000d0b0: 2020 2020 2020 2073 656c 662e 7363 616c         self.scal
-0000d0c0: 6520 3d20 6e6e 2e50 6172 616d 6574 6572  e = nn.Parameter
-0000d0d0: 2874 6f72 6368 2e7a 6572 6f73 2873 656c  (torch.zeros(sel
-0000d0e0: 662e 6469 6d29 290a 2020 2020 2020 2020  f.dim)).        
-0000d0f0: 7365 6c66 2e73 6869 6674 203d 206e 6e2e  self.shift = nn.
-0000d100: 5061 7261 6d65 7465 7228 746f 7263 682e  Parameter(torch.
-0000d110: 7a65 726f 7328 7365 6c66 2e64 696d 2929  zeros(self.dim))
-0000d120: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
-0000d130: 6428 7365 6c66 2c20 783a 2053 6571 7565  d(self, x: Seque
-0000d140: 6e63 6529 202d 3e20 5475 706c 655b 746f  nce) -> Tuple[to
-0000d150: 7263 682e 5465 6e73 6f72 2c20 746f 7263  rch.Tensor, torc
-0000d160: 682e 5465 6e73 6f72 5d3a 0a20 2020 2020  h.Tensor]:.     
-0000d170: 2020 2022 2222 5065 7266 6f72 6d73 2061     """Performs a
-0000d180: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
-0000d190: 6265 7477 6565 6e20 7477 6f20 6469 6666  between two diff
-0000d1a0: 6572 656e 7420 6469 7374 7269 6275 7469  erent distributi
-0000d1b0: 6f6e 732e 2054 6869 730a 2020 2020 2020  ons. This.      
-0000d1c0: 2020 7061 7274 6963 756c 6172 2074 7261    particular tra
-0000d1d0: 6e73 666f 726d 6174 696f 6e20 7265 7072  nsformation repr
-0000d1e0: 6573 656e 7473 2074 6865 2066 6f6c 6c6f  esents the follo
-0000d1f0: 7769 6e67 2066 756e 6374 696f 6e3a 0a20  wing function:. 
-0000d200: 2020 2020 2020 2079 203d 2078 202a 2065         y = x * e
-0000d210: 7870 2861 2920 2b20 622c 2077 6865 7265  xp(a) + b, where
-0000d220: 2061 2069 7320 7363 616c 6520 7061 7261   a is scale para
-0000d230: 6d65 7465 7220 616e 6420 6220 7065 7266  meter and b perf
-0000d240: 6f72 6d73 2061 2073 6869 6674 2e0a 2020  orms a shift..  
-0000d250: 2020 2020 2020 5468 6973 2063 6c61 7373        This class
-0000d260: 2061 6c73 6f20 7265 7475 726e 7320 7468   also returns th
-0000d270: 6520 6c6f 6761 7269 7468 6d20 6f66 2074  e logarithm of t
-0000d280: 6865 206a 6163 6f62 6961 6e73 2064 6574  he jacobians det
-0000d290: 6572 6d69 6e61 6e74 0a20 2020 2020 2020  erminant.       
-0000d2a0: 2077 6869 6368 2069 7320 7573 6566 756c   which is useful
-0000d2b0: 2077 6865 6e20 696e 7665 7274 2061 2074   when invert a t
-0000d2c0: 7261 6e73 666f 726d 6174 696f 6e20 616e  ransformation an
-0000d2d0: 6420 636f 6d70 7574 6520 7468 650a 2020  d compute the.  
-0000d2e0: 2020 2020 2020 7072 6f62 6162 696c 6974        probabilit
-0000d2f0: 7920 6f66 2074 6865 2074 7261 6e73 666f  y of the transfo
-0000d300: 726d 6174 696f 6e2e 0a0a 2020 2020 2020  rmation...      
-0000d310: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0000d320: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-0000d330: 2020 2020 2020 2020 7820 3a20 5365 7175          x : Sequ
-0000d340: 656e 6365 0a20 2020 2020 2020 2020 2020  ence.           
-0000d350: 2054 656e 736f 7220 7361 6d70 6c65 2077   Tensor sample w
-0000d360: 6974 6820 7468 6520 696e 6974 6961 6c20  ith the initial 
-0000d370: 6469 7374 7269 6275 7469 6f6e 2064 6174  distribution dat
-0000d380: 6120 7768 6963 6820 7769 6c6c 2070 6173  a which will pas
-0000d390: 7320 696e 746f 0a20 2020 2020 2020 2020  s into.         
-0000d3a0: 2020 2074 6865 206e 6f72 6d61 6c69 7a69     the normalizi
-0000d3b0: 6e67 2066 6c6f 7720 616c 676f 7269 7468  ng flow algorith
-0000d3c0: 6d2e 0a0a 2020 2020 2020 2020 5265 7475  m...        Retu
-0000d3d0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-0000d3e0: 2d2d 2d0a 2020 2020 2020 2020 7920 3a20  ---.        y : 
-0000d3f0: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-0000d400: 2020 2020 2020 2020 2054 7261 6e73 666f           Transfo
-0000d410: 726d 6564 2074 656e 736f 7220 6163 636f  rmed tensor acco
-0000d420: 7264 696e 6720 746f 2041 6666 696e 6520  rding to Affine 
-0000d430: 6c61 7965 7220 7769 7468 2074 6865 2073  layer with the s
-0000d440: 6861 7065 206f 6620 2778 272e 0a20 2020  hape of 'x'..   
-0000d450: 2020 2020 206c 6f67 5f64 6574 5f6a 6163       log_det_jac
-0000d460: 6f62 6961 6e20 3a20 746f 7263 682e 5465  obian : torch.Te
-0000d470: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-0000d480: 2054 656e 736f 7220 7768 6963 6820 7265   Tensor which re
-0000d490: 7072 6573 656e 7473 2074 6865 2069 6e66  presents the inf
-0000d4a0: 6f20 6162 6f75 7420 7468 6520 6465 7669  o about the devi
-0000d4b0: 6174 696f 6e20 6f66 2074 6865 2069 6e69  ation of the ini
-0000d4c0: 7469 616c 0a20 2020 2020 2020 2020 2020  tial.           
-0000d4d0: 2061 6e64 2074 6172 6765 7420 6469 7374   and target dist
-0000d4e0: 7269 6275 7469 6f6e 2e0a 0a20 2020 2020  ribution...     
-0000d4f0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-0000d500: 7920 3d20 746f 7263 682e 6578 7028 7365  y = torch.exp(se
-0000d510: 6c66 2e73 6361 6c65 2920 2a20 7820 2b20  lf.scale) * x + 
-0000d520: 7365 6c66 2e73 6869 6674 0a20 2020 2020  self.shift.     
-0000d530: 2020 2064 6574 5f6a 6163 6f62 6961 6e20     det_jacobian 
-0000d540: 3d20 746f 7263 682e 6578 7028 7365 6c66  = torch.exp(self
-0000d550: 2e73 6361 6c65 2e73 756d 2829 290a 2020  .scale.sum()).  
-0000d560: 2020 2020 2020 6c6f 675f 6465 745f 6a61        log_det_ja
-0000d570: 636f 6269 616e 203d 2074 6f72 6368 2e6f  cobian = torch.o
-0000d580: 6e65 7328 792e 7368 6170 655b 305d 2920  nes(y.shape[0]) 
-0000d590: 2a20 746f 7263 682e 6c6f 6728 6465 745f  * torch.log(det_
-0000d5a0: 6a61 636f 6269 616e 290a 0a20 2020 2020  jacobian)..     
-0000d5b0: 2020 2072 6574 7572 6e20 792c 206c 6f67     return y, log
-0000d5c0: 5f64 6574 5f6a 6163 6f62 6961 6e0a 0a20  _det_jacobian.. 
-0000d5d0: 2020 2064 6566 2069 6e76 6572 7365 2873     def inverse(s
-0000d5e0: 656c 662c 2079 3a20 5365 7175 656e 6365  elf, y: Sequence
-0000d5f0: 2920 2d3e 2054 7570 6c65 5b74 6f72 6368  ) -> Tuple[torch
-0000d600: 2e54 656e 736f 722c 2074 6f72 6368 2e54  .Tensor, torch.T
-0000d610: 656e 736f 725d 3a0a 2020 2020 2020 2020  ensor]:.        
-0000d620: 2222 2250 6572 666f 726d 7320 6120 7472  """Performs a tr
-0000d630: 616e 7366 6f72 6d61 7469 6f6e 2062 6574  ansformation bet
-0000d640: 7765 656e 2074 776f 2064 6966 6665 7265  ween two differe
-0000d650: 6e74 2064 6973 7472 6962 7574 696f 6e73  nt distributions
-0000d660: 2e0a 2020 2020 2020 2020 5468 6973 2074  ..        This t
-0000d670: 7261 6e73 666f 726d 6174 696f 6e20 7265  ransformation re
-0000d680: 7072 6573 656e 7473 2074 6865 2062 6163  presents the bac
-0000d690: 7761 7264 2070 6173 7320 6f66 2074 6865  ward pass of the
-0000d6a0: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
-0000d6b0: 2020 6d65 6e74 696f 6e20 6265 666f 7265    mention before
-0000d6c0: 2e20 4974 7320 6d61 7468 656d 6174 6963  . Its mathematic
-0000d6d0: 616c 2072 6570 7265 7365 6e74 6174 696f  al representatio
-0000d6e0: 6e20 6973 2078 203d 2028 7920 2d20 6229  n is x = (y - b)
-0000d6f0: 202f 2065 7870 2861 290a 2020 2020 2020   / exp(a).      
-0000d700: 2020 2c20 7768 6572 6520 2261 2220 6973    , where "a" is
-0000d710: 2073 6361 6c65 2070 6172 616d 6574 6572   scale parameter
-0000d720: 2061 6e64 2022 6222 2070 6572 666f 726d   and "b" perform
-0000d730: 7320 6120 7368 6966 742e 2054 6869 7320  s a shift. This 
-0000d740: 636c 6173 730a 2020 2020 2020 2020 616c  class.        al
-0000d750: 736f 2072 6574 7572 6e73 2074 6865 206c  so returns the l
-0000d760: 6f67 6172 6974 686d 206f 6620 7468 6520  ogarithm of the 
-0000d770: 6a61 636f 6269 616e 7320 6465 7465 726d  jacobians determ
-0000d780: 696e 616e 7420 7768 6963 6820 6973 0a20  inant which is. 
-0000d790: 2020 2020 2020 2075 7365 6675 6c20 7768         useful wh
-0000d7a0: 656e 2069 6e76 6572 7420 6120 7472 616e  en invert a tran
-0000d7b0: 7366 6f72 6d61 7469 6f6e 2061 6e64 2063  sformation and c
-0000d7c0: 6f6d 7075 7465 2074 6865 2070 726f 6261  ompute the proba
-0000d7d0: 6269 6c69 7479 206f 660a 2020 2020 2020  bility of.      
-0000d7e0: 2020 7468 6520 7472 616e 7366 6f72 6d61    the transforma
-0000d7f0: 7469 6f6e 2e0a 0a20 2020 2020 2020 2050  tion...        P
-0000d800: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-0000d810: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0000d820: 2020 2020 2079 203a 2053 6571 7565 6e63       y : Sequenc
-0000d830: 650a 2020 2020 2020 2020 2020 2020 5465  e.            Te
-0000d840: 6e73 6f72 2073 616d 706c 6520 7769 7468  nsor sample with
-0000d850: 2074 7261 6e73 666f 726d 6564 2064 6973   transformed dis
-0000d860: 7472 6962 7574 696f 6e20 6461 7461 2077  tribution data w
-0000d870: 6869 6368 2077 696c 6c20 6265 2075 7365  hich will be use
-0000d880: 6420 696e 0a20 2020 2020 2020 2020 2020  d in.           
-0000d890: 2074 6865 206e 6f72 6d61 6c69 7a69 6e67   the normalizing
-0000d8a0: 2061 6c67 6f72 6974 686d 2069 6e76 6572   algorithm inver
-0000d8b0: 7365 2070 6173 732e 0a0a 2020 2020 2020  se pass...      
-0000d8c0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-0000d8d0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-0000d8e0: 2020 7820 3a20 746f 7263 682e 5465 6e73    x : torch.Tens
-0000d8f0: 6f72 0a20 2020 2020 2020 2020 2020 2054  or.            T
-0000d900: 7261 6e73 666f 726d 6564 2074 656e 736f  ransformed tenso
-0000d910: 7220 6163 636f 7264 696e 6720 746f 2041  r according to A
-0000d920: 6666 696e 6520 6c61 7965 7220 7769 7468  ffine layer with
-0000d930: 2074 6865 2073 6861 7065 206f 6620 2779   the shape of 'y
-0000d940: 272e 0a20 2020 2020 2020 2069 6e76 6572  '..        inver
-0000d950: 7365 5f6c 6f67 5f64 6574 5f6a 6163 6f62  se_log_det_jacob
-0000d960: 6961 6e20 3a20 746f 7263 682e 5465 6e73  ian : torch.Tens
-0000d970: 6f72 0a20 2020 2020 2020 2020 2020 2054  or.            T
-0000d980: 656e 736f 7220 7768 6963 6820 7265 7072  ensor which repr
-0000d990: 6573 656e 7473 2074 6865 2069 6e66 6f72  esents the infor
-0000d9a0: 6d61 7469 6f6e 206f 6620 7468 6520 6465  mation of the de
-0000d9b0: 7669 6174 696f 6e20 6f66 2074 6865 2069  viation of the i
-0000d9c0: 6e69 7469 616c 0a20 2020 2020 2020 2020  nitial.         
-0000d9d0: 2020 2061 6e64 2074 6172 6765 7420 6469     and target di
-0000d9e0: 7374 7269 6275 7469 6f6e 2e0a 0a20 2020  stribution...   
-0000d9f0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0000da00: 2020 7820 3d20 2879 202d 2073 656c 662e    x = (y - self.
-0000da10: 7368 6966 7429 202f 2074 6f72 6368 2e65  shift) / torch.e
-0000da20: 7870 2873 656c 662e 7363 616c 6529 0a20  xp(self.scale). 
-0000da30: 2020 2020 2020 2064 6574 5f6a 6163 6f62         det_jacob
-0000da40: 6961 6e20 3d20 3120 2f20 746f 7263 682e  ian = 1 / torch.
-0000da50: 6578 7028 7365 6c66 2e73 6361 6c65 2e73  exp(self.scale.s
-0000da60: 756d 2829 290a 2020 2020 2020 2020 696e  um()).        in
-0000da70: 7665 7273 655f 6c6f 675f 6465 745f 6a61  verse_log_det_ja
-0000da80: 636f 6269 616e 203d 2074 6f72 6368 2e6f  cobian = torch.o
-0000da90: 6e65 7328 0a20 2020 2020 2020 2020 2020  nes(.           
-0000daa0: 2078 2e73 6861 7065 5b30 5d29 202a 2074   x.shape[0]) * t
-0000dab0: 6f72 6368 2e6c 6f67 2864 6574 5f6a 6163  orch.log(det_jac
-0000dac0: 6f62 6961 6e29 0a0a 2020 2020 2020 2020  obian)..        
-0000dad0: 7265 7475 726e 2078 2c20 696e 7665 7273  return x, invers
-0000dae0: 655f 6c6f 675f 6465 745f 6a61 636f 6269  e_log_det_jacobi
-0000daf0: 616e 0a0a 0a63 6c61 7373 2044 4d50 4e4e  an...class DMPNN
-0000db00: 456e 636f 6465 724c 6179 6572 286e 6e2e  EncoderLayer(nn.
-0000db10: 4d6f 6475 6c65 293a 0a20 2020 2022 2222  Module):.    """
-0000db20: 0a20 2020 2045 6e63 6f64 6572 206c 6179  .    Encoder lay
-0000db30: 6572 2066 6f72 2075 7365 2069 6e20 7468  er for use in th
-0000db40: 6520 4469 7265 6374 6564 204d 6573 7361  e Directed Messa
-0000db50: 6765 2050 6173 7369 6e67 204e 6575 7261  ge Passing Neura
-0000db60: 6c20 4e65 7477 6f72 6b20 2844 2d4d 504e  l Network (D-MPN
-0000db70: 4e29 205b 315d 5f2e 0a0a 2020 2020 5468  N) [1]_...    Th
-0000db80: 6520 726f 6c65 206f 6620 7468 6520 444d  e role of the DM
-0000db90: 504e 4e45 6e63 6f64 6572 4c61 7965 7220  PNNEncoderLayer 
-0000dba0: 636c 6173 7320 6973 2074 6f20 6765 6e65  class is to gene
-0000dbb0: 7261 7465 206d 6f6c 6563 756c 6520 656e  rate molecule en
-0000dbc0: 636f 6469 6e67 7320 696e 2066 6f6c 6c6f  codings in follo
-0000dbd0: 7769 6e67 2073 7465 7073 3a0a 0a20 2020  wing steps:..   
-0000dbe0: 202d 204d 6573 7361 6765 2070 6173 7369   - Message passi
-0000dbf0: 6e67 2070 6861 7365 0a20 2020 202d 2047  ng phase.    - G
-0000dc00: 6574 206e 6577 2061 746f 6d20 6869 6464  et new atom hidd
-0000dc10: 656e 2073 7461 7465 7320 616e 6420 7265  en states and re
-0000dc20: 6164 6f75 7420 7068 6173 650a 2020 2020  adout phase.    
-0000dc30: 2d20 436f 6e63 6174 656e 6174 6520 7468  - Concatenate th
-0000dc40: 6520 676c 6f62 616c 2066 6561 7475 7265  e global feature
-0000dc50: 730a 0a0a 2020 2020 4c65 7420 7468 6520  s...    Let the 
-0000dc60: 6469 6167 7261 6d20 6769 7665 6e20 6265  diagram given be
-0000dc70: 6c6f 7720 7265 7072 6573 656e 7420 6120  low represent a 
-0000dc80: 6d6f 6c65 6375 6c65 2063 6f6e 7461 696e  molecule contain
-0000dc90: 696e 6720 3520 6174 6f6d 7320 286e 6f64  ing 5 atoms (nod
-0000dca0: 6573 2920 616e 6420 3420 626f 6e64 7320  es) and 4 bonds 
-0000dcb0: 2865 6467 6573 293a 2d0a 0a20 2020 207c  (edges):-..    |
-0000dcc0: 2020 2031 202d 2d2d 2035 0a20 2020 207c     1 --- 5.    |
-0000dcd0: 2020 207c 0a20 2020 207c 2020 2032 202d     |.    |   2 -
-0000dce0: 2d2d 2034 0a20 2020 207c 2020 207c 0a20  -- 4.    |   |. 
-0000dcf0: 2020 207c 2020 2033 0a0a 2020 2020 4c65     |   3..    Le
-0000dd00: 7420 7468 6520 626f 6e64 7320 6672 6f6d  t the bonds from
-0000dd10: 2061 746f 6d73 2031 2d3e 3220 282a 2a42   atoms 1->2 (**B
-0000dd20: 5b31 325d 2a2a 2920 616e 6420 322d 3e31  [12]**) and 2->1
-0000dd30: 2028 2a2a 425b 3231 5d2a 2a29 2062 6520   (**B[21]**) be 
-0000dd40: 636f 6e73 6964 6572 6564 2061 7320 3220  considered as 2 
-0000dd50: 6469 6666 6572 656e 7420 626f 6e64 732e  different bonds.
-0000dd60: 0a20 2020 2048 656e 6365 2c20 6279 2063  .    Hence, by c
-0000dd70: 6f6e 7369 6465 7269 6e67 2074 6865 2073  onsidering the s
-0000dd80: 616d 6520 666f 7220 616c 6c20 6174 6f6d  ame for all atom
-0000dd90: 732c 2074 6865 2074 6f74 616c 206e 756d  s, the total num
-0000dda0: 6265 7220 6f66 2062 6f6e 6473 203d 2038  ber of bonds = 8
-0000ddb0: 2e0a 0a20 2020 204c 6574 3a0a 0a20 2020  ...    Let:..   
-0000ddc0: 202d 202a 2a61 746f 6d20 6665 6174 7572   - **atom featur
-0000ddd0: 6573 2a2a 203a 2060 6061 312c 2061 322c  es** : ``a1, a2,
-0000dde0: 2061 332c 2061 342c 2061 3560 600a 2020   a3, a4, a5``.  
-0000ddf0: 2020 2d20 2a2a 6869 6464 656e 2073 7461    - **hidden sta
-0000de00: 7465 7320 6f66 2061 746f 6d73 2a2a 203a  tes of atoms** :
-0000de10: 2060 6068 312c 2068 322c 2068 332c 2068   ``h1, h2, h3, h
-0000de20: 342c 2068 3560 600a 2020 2020 2d20 2a2a  4, h5``.    - **
-0000de30: 626f 6e64 2066 6561 7475 7265 7320 626f  bond features bo
-0000de40: 6e64 732a 2a20 3a20 6060 6231 322c 2062  nds** : ``b12, b
-0000de50: 3231 2c20 6232 332c 2062 3332 2c20 6232  21, b23, b32, b2
-0000de60: 342c 2062 3432 2c20 6231 352c 2062 3531  4, b42, b15, b51
-0000de70: 6060 0a20 2020 202d 202a 2a69 6e69 7469  ``.    - **initi
-0000de80: 616c 2068 6964 6465 6e20 7374 6174 6573  al hidden states
-0000de90: 206f 6620 626f 6e64 732a 2a20 3a20 6060   of bonds** : ``
-0000dea0: 2830 2968 3132 2c20 2830 2968 3231 2c20  (0)h12, (0)h21, 
-0000deb0: 2830 2968 3233 2c20 2830 2968 3332 2c20  (0)h23, (0)h32, 
-0000dec0: 2830 2968 3234 2c20 2830 2968 3432 2c20  (0)h24, (0)h42, 
-0000ded0: 2830 2968 3135 2c20 2830 2968 3531 6060  (0)h15, (0)h51``
-0000dee0: 0a0a 2020 2020 5468 6520 6869 6464 656e  ..    The hidden
-0000def0: 2073 7461 7465 206f 6620 6576 6572 7920   state of every 
-0000df00: 626f 6e64 2069 7320 6120 6675 6e63 7469  bond is a functi
-0000df10: 6f6e 206f 6620 7468 6520 636f 6e63 6174  on of the concat
-0000df20: 656e 6174 6564 2066 6561 7475 7265 2076  enated feature v
-0000df30: 6563 746f 7220 7768 6963 6820 636f 6e74  ector which cont
-0000df40: 6169 6e73 0a20 2020 2063 6f6e 6361 7465  ains.    concate
-0000df50: 6e61 7469 6f6e 206f 6620 7468 6520 2a2a  nation of the **
-0000df60: 6665 6174 7572 6573 206f 6620 696e 6974  features of init
-0000df70: 6961 6c20 6174 6f6d 206f 6620 7468 6520  ial atom of the 
-0000df80: 626f 6e64 2a2a 2061 6e64 202a 2a62 6f6e  bond** and **bon
-0000df90: 6420 6665 6174 7572 6573 2a2a 2e0a 0a20  d features**... 
-0000dfa0: 2020 2045 7861 6d70 6c65 3a20 6060 2830     Example: ``(0
-0000dfb0: 2968 3231 203d 2066 756e 6331 2863 6f6e  )h21 = func1(con
-0000dfc0: 6361 7428 6132 2c20 6232 3129 2960 600a  cat(a2, b21))``.
-0000dfd0: 0a20 2020 202e 2e20 6e6f 7465 3a3a 0a20  .    .. note::. 
-0000dfe0: 2020 2020 4865 7265 2066 756e 6331 2069      Here func1 i
-0000dff0: 7320 6060 7365 6c66 2e57 5f69 6060 0a0a  s ``self.W_i``..
-0000e000: 2020 2020 2a2a 5468 6520 4d65 7373 6167      **The Messag
-0000e010: 6520 7061 7373 696e 6720 7068 6173 652a  e passing phase*
-0000e020: 2a0a 0a20 2020 2054 6865 2067 6f61 6c20  *..    The goal 
-0000e030: 6f66 2074 6865 206d 6573 7361 6765 2d70  of the message-p
-0000e040: 6173 7369 6e67 2070 6861 7365 2069 7320  assing phase is 
-0000e050: 746f 2067 656e 6572 6174 6520 2a2a 6869  to generate **hi
-0000e060: 6464 656e 2073 7461 7465 7320 6f66 2061  dden states of a
-0000e070: 6c6c 2074 6865 2061 746f 6d73 2069 6e20  ll the atoms in 
-0000e080: 7468 6520 6d6f 6c65 6375 6c65 2a2a 2e0a  the molecule**..
-0000e090: 0a20 2020 2054 6865 2068 6964 6465 6e20  .    The hidden 
-0000e0a0: 7374 6174 6520 6f66 2061 6e20 6174 6f6d  state of an atom
-0000e0b0: 2069 7320 2a2a 6120 6675 6e63 7469 6f6e   is **a function
-0000e0c0: 206f 6620 636f 6e63 6174 656e 6174 696f   of concatenatio
-0000e0d0: 6e20 6f66 2061 746f 6d20 6665 6174 7572  n of atom featur
-0000e0e0: 6573 2061 6e64 206d 6573 7361 6765 7320  es and messages 
-0000e0f0: 2861 7420 5420 6465 7074 6829 2a2a 2e0a  (at T depth)**..
-0000e100: 0a20 2020 2041 206d 6573 7361 6765 2069  .    A message i
-0000e110: 7320 6120 7375 6d20 6f66 202a 2a68 6964  s a sum of **hid
-0000e120: 6465 6e20 7374 6174 6573 206f 6620 626f  den states of bo
-0000e130: 6e64 7320 636f 6d69 6e67 2074 6f20 7468  nds coming to th
-0000e140: 6520 6174 6f6d 2028 6174 2054 2064 6570  e atom (at T dep
-0000e150: 7468 292a 2a2e 0a0a 2020 2020 2e2e 206e  th)**...    .. n
-0000e160: 6f74 653a 3a0a 2020 2020 2044 6570 7468  ote::.     Depth
-0000e170: 2072 6566 6572 7320 746f 2074 6865 206e   refers to the n
-0000e180: 756d 6265 7220 6f66 2069 7465 7261 7469  umber of iterati
-0000e190: 6f6e 7320 696e 2074 6865 206d 6573 7361  ons in the messa
-0000e1a0: 6765 2070 6173 7369 6e67 2070 6861 7365  ge passing phase
-0000e1b0: 2028 6865 7265 2c20 5420 6974 6572 6174   (here, T iterat
-0000e1c0: 696f 6e73 292e 2041 6674 6572 2065 6163  ions). After eac
-0000e1d0: 6820 6974 6572 6174 696f 6e2c 2074 6865  h iteration, the
-0000e1e0: 2068 6964 6465 6e20 7374 6174 6573 206f   hidden states o
-0000e1f0: 6620 7468 6520 626f 6e64 7320 6172 6520  f the bonds are 
-0000e200: 7570 6461 7465 642e 0a0a 0a20 2020 2045  updated....    E
-0000e210: 7861 6d70 6c65 3a0a 2020 2020 6060 6831  xample:.    ``h1
-0000e220: 203d 2066 756e 6333 2863 6f6e 6361 7428   = func3(concat(
-0000e230: 6131 2c20 6d31 2929 6060 0a0a 2020 2020  a1, m1))``..    
-0000e240: 2e2e 206e 6f74 653a 3a0a 2020 2020 2048  .. note::.     H
-0000e250: 6572 6520 6675 6e63 3320 6973 2060 6073  ere func3 is ``s
-0000e260: 656c 662e 575f 6f60 602e 0a0a 2020 2020  elf.W_o``...    
-0000e270: 2060 6d31 6020 7265 6665 7273 2074 6f20   `m1` refers to 
-0000e280: 7468 6520 6d65 7373 6167 6520 636f 6d69  the message comi
-0000e290: 6e67 2074 6f20 7468 6520 6174 6f6d 2e0a  ng to the atom..
-0000e2a0: 0a20 2020 2060 606d 3120 3d20 2854 2d31  .    ``m1 = (T-1
-0000e2b0: 2968 3231 202b 2028 542d 3129 6835 3160  )h21 + (T-1)h51`
-0000e2c0: 600a 2020 2020 2868 6964 6465 6e20 7374  `.    (hidden st
-0000e2d0: 6174 6520 6f66 2062 6f6e 6420 322d 3e31  ate of bond 2->1
-0000e2e0: 202b 2068 6964 6465 6e20 7374 6174 6520   + hidden state 
-0000e2f0: 6f66 2062 6f6e 6420 352d 3e31 2920 2861  of bond 5->1) (a
-0000e300: 7420 5420 6465 7074 6829 0a0a 2020 2020  t T depth)..    
-0000e310: 666f 722c 2064 6570 7468 2054 203d 2032  for, depth T = 2
-0000e320: 3a0a 0a20 2020 202d 2074 6865 2068 6964  :..    - the hid
-0000e330: 6465 6e20 7374 6174 6573 206f 6620 7468  den states of th
-0000e340: 6520 626f 6e64 7320 4020 3173 7420 6974  e bonds @ 1st it
-0000e350: 6572 6174 696f 6e20 7769 6c6c 2062 6520  eration will be 
-0000e360: 3d3e 2028 3029 6832 312c 2028 3029 6835  => (0)h21, (0)h5
-0000e370: 310a 2020 2020 2d20 7468 6520 6869 6464  1.    - the hidd
-0000e380: 656e 2073 7461 7465 7320 6f66 2074 6865  en states of the
-0000e390: 2062 6f6e 6473 2040 2032 6e64 2069 7465   bonds @ 2nd ite
-0000e3a0: 7261 7469 6f6e 2077 696c 6c20 6265 203d  ration will be =
-0000e3b0: 3e20 2831 2968 3231 2c20 2831 2968 3531  > (1)h21, (1)h51
-0000e3c0: 0a0a 2020 2020 5468 6520 6869 6464 656e  ..    The hidden
-0000e3d0: 2073 7461 7465 7320 6f66 2074 6865 2062   states of the b
-0000e3e0: 6f6e 6473 2069 6e20 3173 7420 6974 6572  onds in 1st iter
-0000e3f0: 6174 696f 6e20 6172 6520 616c 7265 6164  ation are alread
-0000e400: 7920 6b6e 6f77 2e0a 2020 2020 466f 7220  y know..    For 
-0000e410: 6869 6464 656e 2073 7461 7465 7320 6f66  hidden states of
-0000e420: 2074 6865 2062 6f6e 6473 2069 6e20 326e   the bonds in 2n
-0000e430: 6420 6974 6572 6174 696f 6e2c 2077 6520  d iteration, we 
-0000e440: 666f 6c6c 6f77 2074 6865 2063 7269 7465  follow the crite
-0000e450: 7269 6f6e 2074 6861 743a 0a0a 2020 2020  rion that:..    
-0000e460: 2d20 6869 6464 656e 2073 7461 7465 206f  - hidden state o
-0000e470: 6620 7468 6520 626f 6e64 2069 7320 6120  f the bond is a 
-0000e480: 6675 6e63 7469 6f6e 206f 6620 2a2a 696e  function of **in
-0000e490: 6974 6961 6c20 6869 6464 656e 2073 7461  itial hidden sta
-0000e4a0: 7465 206f 6620 626f 6e64 2a2a 0a20 2020  te of bond**.   
-0000e4b0: 2061 6e64 202a 2a6d 6573 7361 6765 7320   and **messages 
-0000e4c0: 636f 6d69 6e67 2074 6f20 7468 6174 2062  coming to that b
-0000e4d0: 6f6e 6420 696e 2074 6861 7420 6974 6572  ond in that iter
-0000e4e0: 6174 696f 6e2a 2a0a 0a20 2020 2045 7861  ation**..    Exa
-0000e4f0: 6d70 6c65 3a0a 2020 2020 6060 2831 2968  mple:.    ``(1)h
-0000e500: 3231 203d 2066 756e 6332 2820 2830 2968  21 = func2( (0)h
-0000e510: 3231 202c 2028 3129 6d32 3120 2960 600a  21 , (1)m21 )``.
-0000e520: 0a20 2020 202e 2e20 6e6f 7465 3a3a 0a20  .    .. note::. 
-0000e530: 2020 2020 4865 7265 2066 756e 6332 2069      Here func2 i
-0000e540: 7320 6060 7365 6c66 2e57 5f68 6060 2e0a  s ``self.W_h``..
-0000e550: 0a20 2020 2020 6028 3129 6d32 3160 2072  .     `(1)m21` r
-0000e560: 6566 6572 7320 746f 2074 6865 206d 6573  efers to the mes
-0000e570: 7361 6765 7320 636f 6d69 6e67 2074 6f20  sages coming to 
-0000e580: 7468 6174 2062 6f6e 6420 322d 3e31 2069  that bond 2->1 i
-0000e590: 6e20 7468 6174 2032 6e64 2069 7465 7261  n that 2nd itera
-0000e5a0: 7469 6f6e 2e0a 0a20 2020 204d 6573 7361  tion...    Messa
-0000e5b0: 6765 7320 636f 6d69 6e67 2074 6f20 6120  ges coming to a 
-0000e5c0: 626f 6e64 2069 6e20 616e 2069 7465 7261  bond in an itera
-0000e5d0: 7469 6f6e 2069 7320 2a2a 6120 7375 6d20  tion is **a sum 
-0000e5e0: 6f66 2068 6964 6465 6e20 7374 6174 6573  of hidden states
-0000e5f0: 206f 6620 626f 6e64 7320 2866 726f 6d20   of bonds (from 
-0000e600: 7072 6576 696f 7573 2069 7465 7261 7469  previous iterati
-0000e610: 6f6e 2920 636f 6d69 6e67 2074 6f20 7468  on) coming to th
-0000e620: 6973 2062 6f6e 642a 2a2e 0a0a 2020 2020  is bond**...    
-0000e630: 4578 616d 706c 653a 0a20 2020 2060 6028  Example:.    ``(
-0000e640: 3129 6d32 3120 3d20 2830 2968 3332 202b  1)m21 = (0)h32 +
-0000e650: 2028 3029 6834 3260 600a 0a20 2020 207c   (0)h42``..    |
-0000e660: 2020 2032 203c 2d2d 2d20 330a 2020 2020     2 <--- 3.    
-0000e670: 7c20 2020 5e0a 2020 2020 7c20 2020 7c0a  |   ^.    |   |.
-0000e680: 2020 2020 7c20 2020 340a 0a20 2020 202a      |   4..    *
-0000e690: 2a43 6f6d 7075 7469 6e67 2074 6865 206d  *Computing the m
-0000e6a0: 6573 7361 6765 732a 2a0a 0a20 2020 202e  essages**..    .
-0000e6b0: 2e20 636f 6465 2d62 6c6f 636b 3a3a 2070  . code-block:: p
-0000e6c0: 7974 686f 6e0a 0a20 2020 2020 2020 2020  ython..         
+0000c7b0: 2020 2020 2020 2020 2020 2020 6564 6765              edge
+0000c7c0: 5f62 6174 6368 5f6d 6170 290a 0a20 2020  _batch_map)..   
+0000c7d0: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+0000c7e0: 756e 6469 7265 6374 6564 2069 7320 5472  undirected is Tr
+0000c7f0: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+0000c800: 2320 636f 6f6e 7665 7274 696e 6720 6564  # coonverting ed
+0000c810: 6765 2066 6561 7475 7265 7320 746f 2069  ge features to i
+0000c820: 7473 206f 7269 6769 6e61 6c20 7368 6170  ts original shap
+0000c830: 650a 2020 2020 2020 2020 2020 2020 7370  e.            sp
+0000c840: 6c69 7420 3d20 746f 7263 682e 7370 6c69  lit = torch.spli
+0000c850: 7428 6564 6765 5f66 6561 7475 7265 732c  t(edge_features,
+0000c860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c880: 205b 6564 6765 5f66 6561 7475 7265 735f   [edge_features_
+0000c890: 6c65 6e2c 2065 6467 655f 6665 6174 7572  len, edge_featur
+0000c8a0: 6573 5f6c 656e 5d29 0a20 2020 2020 2020  es_len]).       
+0000c8b0: 2020 2020 2065 6467 655f 6665 6174 7572       edge_featur
+0000c8c0: 6573 203d 2028 7370 6c69 745b 305d 202b  es = (split[0] +
+0000c8d0: 2073 706c 6974 5b31 5d29 202f 2032 0a0a   split[1]) / 2..
+0000c8e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000c8f0: 7265 7369 6475 616c 5f63 6f6e 6e65 6374  residual_connect
+0000c900: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+0000c910: 2065 6467 655f 6665 6174 7572 6573 202b   edge_features +
+0000c920: 3d20 6564 6765 5f66 6561 7475 7265 735f  = edge_features_
+0000c930: 636f 7079 0a20 2020 2020 2020 2020 2020  copy.           
+0000c940: 206e 6f64 655f 6665 6174 7572 6573 202b   node_features +
+0000c950: 3d20 6e6f 6465 5f66 6561 7475 7265 735f  = node_features_
+0000c960: 636f 7079 0a20 2020 2020 2020 2020 2020  copy.           
+0000c970: 2067 6c6f 6261 6c5f 6665 6174 7572 6573   global_features
+0000c980: 202b 3d20 676c 6f62 616c 5f66 6561 7475   += global_featu
+0000c990: 7265 735f 636f 7079 0a0a 2020 2020 2020  res_copy..      
+0000c9a0: 2020 7265 7475 726e 206e 6f64 655f 6665    return node_fe
+0000c9b0: 6174 7572 6573 2c20 6564 6765 5f66 6561  atures, edge_fea
+0000c9c0: 7475 7265 732c 2067 6c6f 6261 6c5f 6665  tures, global_fe
+0000c9d0: 6174 7572 6573 0a0a 2020 2020 6465 6620  atures..    def 
+0000c9e0: 5f5f 7265 7072 5f5f 2873 656c 6629 202d  __repr__(self) -
+0000c9f0: 3e20 7374 723a 0a20 2020 2020 2020 2072  > str:.        r
+0000ca00: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+0000ca10: 2020 2020 6627 7b73 656c 662e 5f5f 636c      f'{self.__cl
+0000ca20: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d28  ass__.__name__}(
+0000ca30: 6e5f 6e6f 6465 5f66 6561 7475 7265 733d  n_node_features=
+0000ca40: 7b73 656c 662e 6e5f 6e6f 6465 5f66 6561  {self.n_node_fea
+0000ca50: 7475 7265 737d 2c20 6e5f 6564 6765 5f66  tures}, n_edge_f
+0000ca60: 6561 7475 7265 733d 7b73 656c 662e 6e5f  eatures={self.n_
+0000ca70: 6564 6765 5f66 6561 7475 7265 737d 2c20  edge_features}, 
+0000ca80: 6e5f 676c 6f62 616c 5f66 6561 7475 7265  n_global_feature
+0000ca90: 733d 7b73 656c 662e 6e5f 676c 6f62 616c  s={self.n_global
+0000caa0: 5f66 6561 7475 7265 737d 2c20 6973 5f75  _features}, is_u
+0000cab0: 6e64 6972 6563 7465 643d 7b73 656c 662e  ndirected={self.
+0000cac0: 6973 5f75 6e64 6972 6563 7465 647d 2c20  is_undirected}, 
+0000cad0: 7265 7369 6475 616c 5f63 6f6e 6e65 6374  residual_connect
+0000cae0: 696f 6e3d 7b73 656c 662e 7265 7369 6475  ion={self.residu
+0000caf0: 616c 5f63 6f6e 6e65 6374 696f 6e7d 2927  al_connection})'
+0000cb00: 0a20 2020 2020 2020 2029 0a0a 0a63 6c61  .        )...cla
+0000cb10: 7373 2041 6666 696e 6528 6e6e 2e4d 6f64  ss Affine(nn.Mod
+0000cb20: 756c 6529 3a0a 2020 2020 2222 2243 6c61  ule):.    """Cla
+0000cb30: 7373 2077 6869 6368 2070 6572 666f 726d  ss which perform
+0000cb40: 7320 7468 6520 4166 6669 6e65 2074 7261  s the Affine tra
+0000cb50: 6e73 666f 726d 6174 696f 6e2e 0a0a 2020  nsformation...  
+0000cb60: 2020 5468 6973 2074 7261 6e73 666f 726d    This transform
+0000cb70: 6174 696f 6e20 6973 2062 6173 6564 206f  ation is based o
+0000cb80: 6e20 7468 6520 6166 6669 6e69 7479 206f  n the affinity o
+0000cb90: 6620 7468 6520 6261 7365 2064 6973 7472  f the base distr
+0000cba0: 6962 7574 696f 6e20 7769 7468 0a20 2020  ibution with.   
+0000cbb0: 2074 6865 2074 6172 6765 7420 6469 7374   the target dist
+0000cbc0: 7269 6275 7469 6f6e 2e20 4120 6765 6f6d  ribution. A geom
+0000cbd0: 6574 7269 6320 7472 616e 7366 6f72 6d61  etric transforma
+0000cbe0: 7469 6f6e 2069 7320 6170 706c 6965 6420  tion is applied 
+0000cbf0: 7768 6572 650a 2020 2020 7468 6520 7061  where.    the pa
+0000cc00: 7261 6d65 7465 7273 2070 6572 666f 726d  rameters perform
+0000cc10: 7320 6368 616e 6765 7320 6f6e 2074 6865  s changes on the
+0000cc20: 2073 6361 6c65 2061 6e64 2073 6869 6674   scale and shift
+0000cc30: 206f 6620 6120 6675 6e63 7469 6f6e 0a20   of a function. 
+0000cc40: 2020 2028 696e 7075 7473 292e 0a0a 2020     (inputs)...  
+0000cc50: 2020 4e6f 726d 616c 697a 696e 6720 466c    Normalizing Fl
+0000cc60: 6f77 2074 7261 6e73 666f 726d 6174 696f  ow transformatio
+0000cc70: 6e73 206d 7573 7420 6265 2062 696a 6563  ns must be bijec
+0000cc80: 7469 7665 2069 6e20 6f72 6465 7220 746f  tive in order to
+0000cc90: 2063 6f6d 7075 7465 0a20 2020 2074 6865   compute.    the
+0000cca0: 206c 6f67 6172 6974 686d 206f 6620 6a61   logarithm of ja
+0000ccb0: 636f 6269 616e 2773 2064 6574 6572 6d69  cobian's determi
+0000ccc0: 6e61 6e74 2e20 466f 7220 7468 6973 2072  nant. For this r
+0000ccd0: 6561 736f 6e2c 2074 7261 6e73 666f 726d  eason, transform
+0000cce0: 6174 696f 6e73 0a20 2020 206d 7573 7420  ations.    must 
+0000ccf0: 7065 7266 6f72 6d20 6120 666f 7277 6172  perform a forwar
+0000cd00: 6420 616e 6420 696e 7665 7273 6520 7061  d and inverse pa
+0000cd10: 7373 2e0a 0a20 2020 2045 7861 6d70 6c65  ss...    Example
+0000cd20: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+0000cd30: 2020 3e3e 3e20 696d 706f 7274 2064 6565    >>> import dee
+0000cd40: 7063 6865 6d20 6173 2064 630a 2020 2020  pchem as dc.    
+0000cd50: 3e3e 3e20 6672 6f6d 2064 6565 7063 6865  >>> from deepche
+0000cd60: 6d2e 6d6f 6465 6c73 2e74 6f72 6368 5f6d  m.models.torch_m
+0000cd70: 6f64 656c 732e 6c61 7965 7273 2069 6d70  odels.layers imp
+0000cd80: 6f72 7420 4166 6669 6e65 0a20 2020 203e  ort Affine.    >
+0000cd90: 3e3e 2069 6d70 6f72 7420 746f 7263 680a  >> import torch.
+0000cda0: 2020 2020 3e3e 3e20 6672 6f6d 2074 6f72      >>> from tor
+0000cdb0: 6368 2e64 6973 7472 6962 7574 696f 6e73  ch.distributions
+0000cdc0: 2069 6d70 6f72 7420 4d75 6c74 6976 6172   import Multivar
+0000cdd0: 6961 7465 4e6f 726d 616c 0a20 2020 203e  iateNormal.    >
+0000cde0: 3e3e 2023 2069 6e69 7469 616c 697a 6520  >> # initialize 
+0000cdf0: 7468 6520 7472 616e 7366 6f72 6d61 7469  the transformati
+0000ce00: 6f6e 206c 6179 6572 2773 2070 6172 616d  on layer's param
+0000ce10: 6574 6572 730a 2020 2020 3e3e 3e20 6469  eters.    >>> di
+0000ce20: 6d20 3d20 320a 2020 2020 3e3e 3e20 7361  m = 2.    >>> sa
+0000ce30: 6d70 6c65 7320 3d20 3936 0a20 2020 203e  mples = 96.    >
+0000ce40: 3e3e 2074 7261 6e73 666f 726d 7320 3d20  >> transforms = 
+0000ce50: 4166 6669 6e65 2864 696d 290a 2020 2020  Affine(dim).    
+0000ce60: 3e3e 3e20 2320 666f 7277 6172 6420 7061  >>> # forward pa
+0000ce70: 7373 2062 6173 6564 206f 6e20 6120 6769  ss based on a gi
+0000ce80: 7665 6e20 6469 7374 7269 6275 7469 6f6e  ven distribution
+0000ce90: 0a20 2020 203e 3e3e 2064 6973 7472 6962  .    >>> distrib
+0000cea0: 7574 696f 6e20 3d20 4d75 6c74 6976 6172  ution = Multivar
+0000ceb0: 6961 7465 4e6f 726d 616c 2874 6f72 6368  iateNormal(torch
+0000cec0: 2e7a 6572 6f73 2864 696d 292c 2074 6f72  .zeros(dim), tor
+0000ced0: 6368 2e65 7965 2864 696d 2929 0a20 2020  ch.eye(dim)).   
+0000cee0: 203e 3e3e 2069 6e70 7574 203d 2064 6973   >>> input = dis
+0000cef0: 7472 6962 7574 696f 6e2e 7361 6d70 6c65  tribution.sample
+0000cf00: 2874 6f72 6368 2e53 697a 6528 2873 616d  (torch.Size((sam
+0000cf10: 706c 6573 2c20 6469 6d29 2929 0a20 2020  ples, dim))).   
+0000cf20: 203e 3e3e 206c 656e 2874 7261 6e73 666f   >>> len(transfo
+0000cf30: 726d 732e 666f 7277 6172 6428 696e 7075  rms.forward(inpu
+0000cf40: 7429 290a 2020 2020 320a 2020 2020 3e3e  t)).    2.    >>
+0000cf50: 3e20 2320 696e 7665 7273 6520 7061 7373  > # inverse pass
+0000cf60: 2062 6173 6564 206f 6e20 6120 6469 7374   based on a dist
+0000cf70: 7269 6275 7469 6f6e 0a20 2020 203e 3e3e  ribution.    >>>
+0000cf80: 206c 656e 2874 7261 6e73 666f 726d 732e   len(transforms.
+0000cf90: 696e 7665 7273 6528 696e 7075 7429 290a  inverse(input)).
+0000cfa0: 2020 2020 320a 0a20 2020 2022 2222 0a0a      2..    """..
+0000cfb0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+0000cfc0: 2873 656c 662c 2064 696d 3a20 696e 7429  (self, dim: int)
+0000cfd0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000cfe0: 2020 2222 2243 7265 6174 6520 6120 4166    """Create a Af
+0000cff0: 6669 6e65 2074 7261 6e73 666f 726d 206c  fine transform l
+0000d000: 6179 6572 2e0a 0a20 2020 2020 2020 2050  ayer...        P
+0000d010: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0000d020: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0000d030: 2020 2020 2064 696d 3a20 696e 740a 2020       dim: int.  
+0000d040: 2020 2020 2020 2020 2020 5661 6c75 6520            Value 
+0000d050: 6f66 2074 6865 204e 7468 2064 696d 656e  of the Nth dimen
+0000d060: 7369 6f6e 206f 6620 7468 6520 6461 7461  sion of the data
+0000d070: 7365 742e 0a0a 2020 2020 2020 2020 2222  set...        ""
+0000d080: 220a 0a20 2020 2020 2020 2073 7570 6572  "..        super
+0000d090: 2829 2e5f 5f69 6e69 745f 5f28 290a 2020  ().__init__().  
+0000d0a0: 2020 2020 2020 7365 6c66 2e64 696d 203d        self.dim =
+0000d0b0: 2064 696d 0a20 2020 2020 2020 2073 656c   dim.        sel
+0000d0c0: 662e 7363 616c 6520 3d20 6e6e 2e50 6172  f.scale = nn.Par
+0000d0d0: 616d 6574 6572 2874 6f72 6368 2e7a 6572  ameter(torch.zer
+0000d0e0: 6f73 2873 656c 662e 6469 6d29 290a 2020  os(self.dim)).  
+0000d0f0: 2020 2020 2020 7365 6c66 2e73 6869 6674        self.shift
+0000d100: 203d 206e 6e2e 5061 7261 6d65 7465 7228   = nn.Parameter(
+0000d110: 746f 7263 682e 7a65 726f 7328 7365 6c66  torch.zeros(self
+0000d120: 2e64 696d 2929 0a0a 2020 2020 6465 6620  .dim))..    def 
+0000d130: 666f 7277 6172 6428 7365 6c66 2c20 783a  forward(self, x:
+0000d140: 2053 6571 7565 6e63 6529 202d 3e20 5475   Sequence) -> Tu
+0000d150: 706c 655b 746f 7263 682e 5465 6e73 6f72  ple[torch.Tensor
+0000d160: 2c20 746f 7263 682e 5465 6e73 6f72 5d3a  , torch.Tensor]:
+0000d170: 0a20 2020 2020 2020 2022 2222 5065 7266  .        """Perf
+0000d180: 6f72 6d73 2061 2074 7261 6e73 666f 726d  orms a transform
+0000d190: 6174 696f 6e20 6265 7477 6565 6e20 7477  ation between tw
+0000d1a0: 6f20 6469 6666 6572 656e 7420 6469 7374  o different dist
+0000d1b0: 7269 6275 7469 6f6e 732e 2054 6869 730a  ributions. This.
+0000d1c0: 2020 2020 2020 2020 7061 7274 6963 756c          particul
+0000d1d0: 6172 2074 7261 6e73 666f 726d 6174 696f  ar transformatio
+0000d1e0: 6e20 7265 7072 6573 656e 7473 2074 6865  n represents the
+0000d1f0: 2066 6f6c 6c6f 7769 6e67 2066 756e 6374   following funct
+0000d200: 696f 6e3a 0a20 2020 2020 2020 2079 203d  ion:.        y =
+0000d210: 2078 202a 2065 7870 2861 2920 2b20 622c   x * exp(a) + b,
+0000d220: 2077 6865 7265 2061 2069 7320 7363 616c   where a is scal
+0000d230: 6520 7061 7261 6d65 7465 7220 616e 6420  e parameter and 
+0000d240: 6220 7065 7266 6f72 6d73 2061 2073 6869  b performs a shi
+0000d250: 6674 2e0a 2020 2020 2020 2020 5468 6973  ft..        This
+0000d260: 2063 6c61 7373 2061 6c73 6f20 7265 7475   class also retu
+0000d270: 726e 7320 7468 6520 6c6f 6761 7269 7468  rns the logarith
+0000d280: 6d20 6f66 2074 6865 206a 6163 6f62 6961  m of the jacobia
+0000d290: 6e73 2064 6574 6572 6d69 6e61 6e74 0a20  ns determinant. 
+0000d2a0: 2020 2020 2020 2077 6869 6368 2069 7320         which is 
+0000d2b0: 7573 6566 756c 2077 6865 6e20 696e 7665  useful when inve
+0000d2c0: 7274 2061 2074 7261 6e73 666f 726d 6174  rt a transformat
+0000d2d0: 696f 6e20 616e 6420 636f 6d70 7574 6520  ion and compute 
+0000d2e0: 7468 650a 2020 2020 2020 2020 7072 6f62  the.        prob
+0000d2f0: 6162 696c 6974 7920 6f66 2074 6865 2074  ability of the t
+0000d300: 7261 6e73 666f 726d 6174 696f 6e2e 0a0a  ransformation...
+0000d310: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+0000d320: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+0000d330: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7820  -----.        x 
+0000d340: 3a20 5365 7175 656e 6365 0a20 2020 2020  : Sequence.     
+0000d350: 2020 2020 2020 2054 656e 736f 7220 7361         Tensor sa
+0000d360: 6d70 6c65 2077 6974 6820 7468 6520 696e  mple with the in
+0000d370: 6974 6961 6c20 6469 7374 7269 6275 7469  itial distributi
+0000d380: 6f6e 2064 6174 6120 7768 6963 6820 7769  on data which wi
+0000d390: 6c6c 2070 6173 7320 696e 746f 0a20 2020  ll pass into.   
+0000d3a0: 2020 2020 2020 2020 2074 6865 206e 6f72           the nor
+0000d3b0: 6d61 6c69 7a69 6e67 2066 6c6f 7720 616c  malizing flow al
+0000d3c0: 676f 7269 7468 6d2e 0a0a 2020 2020 2020  gorithm...      
+0000d3d0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+0000d3e0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+0000d3f0: 2020 7920 3a20 746f 7263 682e 5465 6e73    y : torch.Tens
+0000d400: 6f72 0a20 2020 2020 2020 2020 2020 2054  or.            T
+0000d410: 7261 6e73 666f 726d 6564 2074 656e 736f  ransformed tenso
+0000d420: 7220 6163 636f 7264 696e 6720 746f 2041  r according to A
+0000d430: 6666 696e 6520 6c61 7965 7220 7769 7468  ffine layer with
+0000d440: 2074 6865 2073 6861 7065 206f 6620 2778   the shape of 'x
+0000d450: 272e 0a20 2020 2020 2020 206c 6f67 5f64  '..        log_d
+0000d460: 6574 5f6a 6163 6f62 6961 6e20 3a20 746f  et_jacobian : to
+0000d470: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+0000d480: 2020 2020 2020 2054 656e 736f 7220 7768         Tensor wh
+0000d490: 6963 6820 7265 7072 6573 656e 7473 2074  ich represents t
+0000d4a0: 6865 2069 6e66 6f20 6162 6f75 7420 7468  he info about th
+0000d4b0: 6520 6465 7669 6174 696f 6e20 6f66 2074  e deviation of t
+0000d4c0: 6865 2069 6e69 7469 616c 0a20 2020 2020  he initial.     
+0000d4d0: 2020 2020 2020 2061 6e64 2074 6172 6765         and targe
+0000d4e0: 7420 6469 7374 7269 6275 7469 6f6e 2e0a  t distribution..
+0000d4f0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0000d500: 2020 2020 2020 7920 3d20 746f 7263 682e        y = torch.
+0000d510: 6578 7028 7365 6c66 2e73 6361 6c65 2920  exp(self.scale) 
+0000d520: 2a20 7820 2b20 7365 6c66 2e73 6869 6674  * x + self.shift
+0000d530: 0a20 2020 2020 2020 2064 6574 5f6a 6163  .        det_jac
+0000d540: 6f62 6961 6e20 3d20 746f 7263 682e 6578  obian = torch.ex
+0000d550: 7028 7365 6c66 2e73 6361 6c65 2e73 756d  p(self.scale.sum
+0000d560: 2829 290a 2020 2020 2020 2020 6c6f 675f  ()).        log_
+0000d570: 6465 745f 6a61 636f 6269 616e 203d 2074  det_jacobian = t
+0000d580: 6f72 6368 2e6f 6e65 7328 792e 7368 6170  orch.ones(y.shap
+0000d590: 655b 305d 2920 2a20 746f 7263 682e 6c6f  e[0]) * torch.lo
+0000d5a0: 6728 6465 745f 6a61 636f 6269 616e 290a  g(det_jacobian).
+0000d5b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000d5c0: 792c 206c 6f67 5f64 6574 5f6a 6163 6f62  y, log_det_jacob
+0000d5d0: 6961 6e0a 0a20 2020 2064 6566 2069 6e76  ian..    def inv
+0000d5e0: 6572 7365 2873 656c 662c 2079 3a20 5365  erse(self, y: Se
+0000d5f0: 7175 656e 6365 2920 2d3e 2054 7570 6c65  quence) -> Tuple
+0000d600: 5b74 6f72 6368 2e54 656e 736f 722c 2074  [torch.Tensor, t
+0000d610: 6f72 6368 2e54 656e 736f 725d 3a0a 2020  orch.Tensor]:.  
+0000d620: 2020 2020 2020 2222 2250 6572 666f 726d        """Perform
+0000d630: 7320 6120 7472 616e 7366 6f72 6d61 7469  s a transformati
+0000d640: 6f6e 2062 6574 7765 656e 2074 776f 2064  on between two d
+0000d650: 6966 6665 7265 6e74 2064 6973 7472 6962  ifferent distrib
+0000d660: 7574 696f 6e73 2e0a 2020 2020 2020 2020  utions..        
+0000d670: 5468 6973 2074 7261 6e73 666f 726d 6174  This transformat
+0000d680: 696f 6e20 7265 7072 6573 656e 7473 2074  ion represents t
+0000d690: 6865 2062 6163 7761 7264 2070 6173 7320  he bacward pass 
+0000d6a0: 6f66 2074 6865 2066 756e 6374 696f 6e0a  of the function.
+0000d6b0: 2020 2020 2020 2020 6d65 6e74 696f 6e20          mention 
+0000d6c0: 6265 666f 7265 2e20 4974 7320 6d61 7468  before. Its math
+0000d6d0: 656d 6174 6963 616c 2072 6570 7265 7365  ematical represe
+0000d6e0: 6e74 6174 696f 6e20 6973 2078 203d 2028  ntation is x = (
+0000d6f0: 7920 2d20 6229 202f 2065 7870 2861 290a  y - b) / exp(a).
+0000d700: 2020 2020 2020 2020 2c20 7768 6572 6520          , where 
+0000d710: 2261 2220 6973 2073 6361 6c65 2070 6172  "a" is scale par
+0000d720: 616d 6574 6572 2061 6e64 2022 6222 2070  ameter and "b" p
+0000d730: 6572 666f 726d 7320 6120 7368 6966 742e  erforms a shift.
+0000d740: 2054 6869 7320 636c 6173 730a 2020 2020   This class.    
+0000d750: 2020 2020 616c 736f 2072 6574 7572 6e73      also returns
+0000d760: 2074 6865 206c 6f67 6172 6974 686d 206f   the logarithm o
+0000d770: 6620 7468 6520 6a61 636f 6269 616e 7320  f the jacobians 
+0000d780: 6465 7465 726d 696e 616e 7420 7768 6963  determinant whic
+0000d790: 6820 6973 0a20 2020 2020 2020 2075 7365  h is.        use
+0000d7a0: 6675 6c20 7768 656e 2069 6e76 6572 7420  ful when invert 
+0000d7b0: 6120 7472 616e 7366 6f72 6d61 7469 6f6e  a transformation
+0000d7c0: 2061 6e64 2063 6f6d 7075 7465 2074 6865   and compute the
+0000d7d0: 2070 726f 6261 6269 6c69 7479 206f 660a   probability of.
+0000d7e0: 2020 2020 2020 2020 7468 6520 7472 616e          the tran
+0000d7f0: 7366 6f72 6d61 7469 6f6e 2e0a 0a20 2020  sformation...   
+0000d800: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+0000d810: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0000d820: 2d2d 0a20 2020 2020 2020 2079 203a 2053  --.        y : S
+0000d830: 6571 7565 6e63 650a 2020 2020 2020 2020  equence.        
+0000d840: 2020 2020 5465 6e73 6f72 2073 616d 706c      Tensor sampl
+0000d850: 6520 7769 7468 2074 7261 6e73 666f 726d  e with transform
+0000d860: 6564 2064 6973 7472 6962 7574 696f 6e20  ed distribution 
+0000d870: 6461 7461 2077 6869 6368 2077 696c 6c20  data which will 
+0000d880: 6265 2075 7365 6420 696e 0a20 2020 2020  be used in.     
+0000d890: 2020 2020 2020 2074 6865 206e 6f72 6d61         the norma
+0000d8a0: 6c69 7a69 6e67 2061 6c67 6f72 6974 686d  lizing algorithm
+0000d8b0: 2069 6e76 6572 7365 2070 6173 732e 0a0a   inverse pass...
+0000d8c0: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+0000d8d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+0000d8e0: 2020 2020 2020 2020 7820 3a20 746f 7263          x : torc
+0000d8f0: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+0000d900: 2020 2020 2054 7261 6e73 666f 726d 6564       Transformed
+0000d910: 2074 656e 736f 7220 6163 636f 7264 696e   tensor accordin
+0000d920: 6720 746f 2041 6666 696e 6520 6c61 7965  g to Affine laye
+0000d930: 7220 7769 7468 2074 6865 2073 6861 7065  r with the shape
+0000d940: 206f 6620 2779 272e 0a20 2020 2020 2020   of 'y'..       
+0000d950: 2069 6e76 6572 7365 5f6c 6f67 5f64 6574   inverse_log_det
+0000d960: 5f6a 6163 6f62 6961 6e20 3a20 746f 7263  _jacobian : torc
+0000d970: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+0000d980: 2020 2020 2054 656e 736f 7220 7768 6963       Tensor whic
+0000d990: 6820 7265 7072 6573 656e 7473 2074 6865  h represents the
+0000d9a0: 2069 6e66 6f72 6d61 7469 6f6e 206f 6620   information of 
+0000d9b0: 7468 6520 6465 7669 6174 696f 6e20 6f66  the deviation of
+0000d9c0: 2074 6865 2069 6e69 7469 616c 0a20 2020   the initial.   
+0000d9d0: 2020 2020 2020 2020 2061 6e64 2074 6172           and tar
+0000d9e0: 6765 7420 6469 7374 7269 6275 7469 6f6e  get distribution
+0000d9f0: 2e0a 0a20 2020 2020 2020 2022 2222 0a0a  ...        """..
+0000da00: 2020 2020 2020 2020 7820 3d20 2879 202d          x = (y -
+0000da10: 2073 656c 662e 7368 6966 7429 202f 2074   self.shift) / t
+0000da20: 6f72 6368 2e65 7870 2873 656c 662e 7363  orch.exp(self.sc
+0000da30: 616c 6529 0a20 2020 2020 2020 2064 6574  ale).        det
+0000da40: 5f6a 6163 6f62 6961 6e20 3d20 3120 2f20  _jacobian = 1 / 
+0000da50: 746f 7263 682e 6578 7028 7365 6c66 2e73  torch.exp(self.s
+0000da60: 6361 6c65 2e73 756d 2829 290a 2020 2020  cale.sum()).    
+0000da70: 2020 2020 696e 7665 7273 655f 6c6f 675f      inverse_log_
+0000da80: 6465 745f 6a61 636f 6269 616e 203d 2074  det_jacobian = t
+0000da90: 6f72 6368 2e6f 6e65 7328 0a20 2020 2020  orch.ones(.     
+0000daa0: 2020 2020 2020 2078 2e73 6861 7065 5b30         x.shape[0
+0000dab0: 5d29 202a 2074 6f72 6368 2e6c 6f67 2864  ]) * torch.log(d
+0000dac0: 6574 5f6a 6163 6f62 6961 6e29 0a0a 2020  et_jacobian)..  
+0000dad0: 2020 2020 2020 7265 7475 726e 2078 2c20        return x, 
+0000dae0: 696e 7665 7273 655f 6c6f 675f 6465 745f  inverse_log_det_
+0000daf0: 6a61 636f 6269 616e 0a0a 0a63 6c61 7373  jacobian...class
+0000db00: 2044 4d50 4e4e 456e 636f 6465 724c 6179   DMPNNEncoderLay
+0000db10: 6572 286e 6e2e 4d6f 6475 6c65 293a 0a20  er(nn.Module):. 
+0000db20: 2020 2022 2222 0a20 2020 2045 6e63 6f64     """.    Encod
+0000db30: 6572 206c 6179 6572 2066 6f72 2075 7365  er layer for use
+0000db40: 2069 6e20 7468 6520 4469 7265 6374 6564   in the Directed
+0000db50: 204d 6573 7361 6765 2050 6173 7369 6e67   Message Passing
+0000db60: 204e 6575 7261 6c20 4e65 7477 6f72 6b20   Neural Network 
+0000db70: 2844 2d4d 504e 4e29 205b 315d 5f2e 0a0a  (D-MPNN) [1]_...
+0000db80: 2020 2020 5468 6520 726f 6c65 206f 6620      The role of 
+0000db90: 7468 6520 444d 504e 4e45 6e63 6f64 6572  the DMPNNEncoder
+0000dba0: 4c61 7965 7220 636c 6173 7320 6973 2074  Layer class is t
+0000dbb0: 6f20 6765 6e65 7261 7465 206d 6f6c 6563  o generate molec
+0000dbc0: 756c 6520 656e 636f 6469 6e67 7320 696e  ule encodings in
+0000dbd0: 2066 6f6c 6c6f 7769 6e67 2073 7465 7073   following steps
+0000dbe0: 3a0a 0a20 2020 202d 204d 6573 7361 6765  :..    - Message
+0000dbf0: 2070 6173 7369 6e67 2070 6861 7365 0a20   passing phase. 
+0000dc00: 2020 202d 2047 6574 206e 6577 2061 746f     - Get new ato
+0000dc10: 6d20 6869 6464 656e 2073 7461 7465 7320  m hidden states 
+0000dc20: 616e 6420 7265 6164 6f75 7420 7068 6173  and readout phas
+0000dc30: 650a 2020 2020 2d20 436f 6e63 6174 656e  e.    - Concaten
+0000dc40: 6174 6520 7468 6520 676c 6f62 616c 2066  ate the global f
+0000dc50: 6561 7475 7265 730a 0a0a 2020 2020 4c65  eatures...    Le
+0000dc60: 7420 7468 6520 6469 6167 7261 6d20 6769  t the diagram gi
+0000dc70: 7665 6e20 6265 6c6f 7720 7265 7072 6573  ven below repres
+0000dc80: 656e 7420 6120 6d6f 6c65 6375 6c65 2063  ent a molecule c
+0000dc90: 6f6e 7461 696e 696e 6720 3520 6174 6f6d  ontaining 5 atom
+0000dca0: 7320 286e 6f64 6573 2920 616e 6420 3420  s (nodes) and 4 
+0000dcb0: 626f 6e64 7320 2865 6467 6573 293a 2d0a  bonds (edges):-.
+0000dcc0: 0a20 2020 207c 2020 2031 202d 2d2d 2035  .    |   1 --- 5
+0000dcd0: 0a20 2020 207c 2020 207c 0a20 2020 207c  .    |   |.    |
+0000dce0: 2020 2032 202d 2d2d 2034 0a20 2020 207c     2 --- 4.    |
+0000dcf0: 2020 207c 0a20 2020 207c 2020 2033 0a0a     |.    |   3..
+0000dd00: 2020 2020 4c65 7420 7468 6520 626f 6e64      Let the bond
+0000dd10: 7320 6672 6f6d 2061 746f 6d73 2031 2d3e  s from atoms 1->
+0000dd20: 3220 282a 2a42 5b31 325d 2a2a 2920 616e  2 (**B[12]**) an
+0000dd30: 6420 322d 3e31 2028 2a2a 425b 3231 5d2a  d 2->1 (**B[21]*
+0000dd40: 2a29 2062 6520 636f 6e73 6964 6572 6564  *) be considered
+0000dd50: 2061 7320 3220 6469 6666 6572 656e 7420   as 2 different 
+0000dd60: 626f 6e64 732e 0a20 2020 2048 656e 6365  bonds..    Hence
+0000dd70: 2c20 6279 2063 6f6e 7369 6465 7269 6e67  , by considering
+0000dd80: 2074 6865 2073 616d 6520 666f 7220 616c   the same for al
+0000dd90: 6c20 6174 6f6d 732c 2074 6865 2074 6f74  l atoms, the tot
+0000dda0: 616c 206e 756d 6265 7220 6f66 2062 6f6e  al number of bon
+0000ddb0: 6473 203d 2038 2e0a 0a20 2020 204c 6574  ds = 8...    Let
+0000ddc0: 3a0a 0a20 2020 202d 202a 2a61 746f 6d20  :..    - **atom 
+0000ddd0: 6665 6174 7572 6573 2a2a 203a 2060 6061  features** : ``a
+0000dde0: 312c 2061 322c 2061 332c 2061 342c 2061  1, a2, a3, a4, a
+0000ddf0: 3560 600a 2020 2020 2d20 2a2a 6869 6464  5``.    - **hidd
+0000de00: 656e 2073 7461 7465 7320 6f66 2061 746f  en states of ato
+0000de10: 6d73 2a2a 203a 2060 6068 312c 2068 322c  ms** : ``h1, h2,
+0000de20: 2068 332c 2068 342c 2068 3560 600a 2020   h3, h4, h5``.  
+0000de30: 2020 2d20 2a2a 626f 6e64 2066 6561 7475    - **bond featu
+0000de40: 7265 7320 626f 6e64 732a 2a20 3a20 6060  res bonds** : ``
+0000de50: 6231 322c 2062 3231 2c20 6232 332c 2062  b12, b21, b23, b
+0000de60: 3332 2c20 6232 342c 2062 3432 2c20 6231  32, b24, b42, b1
+0000de70: 352c 2062 3531 6060 0a20 2020 202d 202a  5, b51``.    - *
+0000de80: 2a69 6e69 7469 616c 2068 6964 6465 6e20  *initial hidden 
+0000de90: 7374 6174 6573 206f 6620 626f 6e64 732a  states of bonds*
+0000dea0: 2a20 3a20 6060 2830 2968 3132 2c20 2830  * : ``(0)h12, (0
+0000deb0: 2968 3231 2c20 2830 2968 3233 2c20 2830  )h21, (0)h23, (0
+0000dec0: 2968 3332 2c20 2830 2968 3234 2c20 2830  )h32, (0)h24, (0
+0000ded0: 2968 3432 2c20 2830 2968 3135 2c20 2830  )h42, (0)h15, (0
+0000dee0: 2968 3531 6060 0a0a 2020 2020 5468 6520  )h51``..    The 
+0000def0: 6869 6464 656e 2073 7461 7465 206f 6620  hidden state of 
+0000df00: 6576 6572 7920 626f 6e64 2069 7320 6120  every bond is a 
+0000df10: 6675 6e63 7469 6f6e 206f 6620 7468 6520  function of the 
+0000df20: 636f 6e63 6174 656e 6174 6564 2066 6561  concatenated fea
+0000df30: 7475 7265 2076 6563 746f 7220 7768 6963  ture vector whic
+0000df40: 6820 636f 6e74 6169 6e73 0a20 2020 2063  h contains.    c
+0000df50: 6f6e 6361 7465 6e61 7469 6f6e 206f 6620  oncatenation of 
+0000df60: 7468 6520 2a2a 6665 6174 7572 6573 206f  the **features o
+0000df70: 6620 696e 6974 6961 6c20 6174 6f6d 206f  f initial atom o
+0000df80: 6620 7468 6520 626f 6e64 2a2a 2061 6e64  f the bond** and
+0000df90: 202a 2a62 6f6e 6420 6665 6174 7572 6573   **bond features
+0000dfa0: 2a2a 2e0a 0a20 2020 2045 7861 6d70 6c65  **...    Example
+0000dfb0: 3a20 6060 2830 2968 3231 203d 2066 756e  : ``(0)h21 = fun
+0000dfc0: 6331 2863 6f6e 6361 7428 6132 2c20 6232  c1(concat(a2, b2
+0000dfd0: 3129 2960 600a 0a20 2020 202e 2e20 6e6f  1))``..    .. no
+0000dfe0: 7465 3a3a 0a20 2020 2020 4865 7265 2066  te::.     Here f
+0000dff0: 756e 6331 2069 7320 6060 7365 6c66 2e57  unc1 is ``self.W
+0000e000: 5f69 6060 0a0a 2020 2020 2a2a 5468 6520  _i``..    **The 
+0000e010: 4d65 7373 6167 6520 7061 7373 696e 6720  Message passing 
+0000e020: 7068 6173 652a 2a0a 0a20 2020 2054 6865  phase**..    The
+0000e030: 2067 6f61 6c20 6f66 2074 6865 206d 6573   goal of the mes
+0000e040: 7361 6765 2d70 6173 7369 6e67 2070 6861  sage-passing pha
+0000e050: 7365 2069 7320 746f 2067 656e 6572 6174  se is to generat
+0000e060: 6520 2a2a 6869 6464 656e 2073 7461 7465  e **hidden state
+0000e070: 7320 6f66 2061 6c6c 2074 6865 2061 746f  s of all the ato
+0000e080: 6d73 2069 6e20 7468 6520 6d6f 6c65 6375  ms in the molecu
+0000e090: 6c65 2a2a 2e0a 0a20 2020 2054 6865 2068  le**...    The h
+0000e0a0: 6964 6465 6e20 7374 6174 6520 6f66 2061  idden state of a
+0000e0b0: 6e20 6174 6f6d 2069 7320 2a2a 6120 6675  n atom is **a fu
+0000e0c0: 6e63 7469 6f6e 206f 6620 636f 6e63 6174  nction of concat
+0000e0d0: 656e 6174 696f 6e20 6f66 2061 746f 6d20  enation of atom 
+0000e0e0: 6665 6174 7572 6573 2061 6e64 206d 6573  features and mes
+0000e0f0: 7361 6765 7320 2861 7420 5420 6465 7074  sages (at T dept
+0000e100: 6829 2a2a 2e0a 0a20 2020 2041 206d 6573  h)**...    A mes
+0000e110: 7361 6765 2069 7320 6120 7375 6d20 6f66  sage is a sum of
+0000e120: 202a 2a68 6964 6465 6e20 7374 6174 6573   **hidden states
+0000e130: 206f 6620 626f 6e64 7320 636f 6d69 6e67   of bonds coming
+0000e140: 2074 6f20 7468 6520 6174 6f6d 2028 6174   to the atom (at
+0000e150: 2054 2064 6570 7468 292a 2a2e 0a0a 2020   T depth)**...  
+0000e160: 2020 2e2e 206e 6f74 653a 3a0a 2020 2020    .. note::.    
+0000e170: 2044 6570 7468 2072 6566 6572 7320 746f   Depth refers to
+0000e180: 2074 6865 206e 756d 6265 7220 6f66 2069   the number of i
+0000e190: 7465 7261 7469 6f6e 7320 696e 2074 6865  terations in the
+0000e1a0: 206d 6573 7361 6765 2070 6173 7369 6e67   message passing
+0000e1b0: 2070 6861 7365 2028 6865 7265 2c20 5420   phase (here, T 
+0000e1c0: 6974 6572 6174 696f 6e73 292e 2041 6674  iterations). Aft
+0000e1d0: 6572 2065 6163 6820 6974 6572 6174 696f  er each iteratio
+0000e1e0: 6e2c 2074 6865 2068 6964 6465 6e20 7374  n, the hidden st
+0000e1f0: 6174 6573 206f 6620 7468 6520 626f 6e64  ates of the bond
+0000e200: 7320 6172 6520 7570 6461 7465 642e 0a0a  s are updated...
+0000e210: 0a20 2020 2045 7861 6d70 6c65 3a0a 2020  .    Example:.  
+0000e220: 2020 6060 6831 203d 2066 756e 6333 2863    ``h1 = func3(c
+0000e230: 6f6e 6361 7428 6131 2c20 6d31 2929 6060  oncat(a1, m1))``
+0000e240: 0a0a 2020 2020 2e2e 206e 6f74 653a 3a0a  ..    .. note::.
+0000e250: 2020 2020 2048 6572 6520 6675 6e63 3320       Here func3 
+0000e260: 6973 2060 6073 656c 662e 575f 6f60 602e  is ``self.W_o``.
+0000e270: 0a0a 2020 2020 2060 6d31 6020 7265 6665  ..     `m1` refe
+0000e280: 7273 2074 6f20 7468 6520 6d65 7373 6167  rs to the messag
+0000e290: 6520 636f 6d69 6e67 2074 6f20 7468 6520  e coming to the 
+0000e2a0: 6174 6f6d 2e0a 0a20 2020 2060 606d 3120  atom...    ``m1 
+0000e2b0: 3d20 2854 2d31 2968 3231 202b 2028 542d  = (T-1)h21 + (T-
+0000e2c0: 3129 6835 3160 600a 2020 2020 2868 6964  1)h51``.    (hid
+0000e2d0: 6465 6e20 7374 6174 6520 6f66 2062 6f6e  den state of bon
+0000e2e0: 6420 322d 3e31 202b 2068 6964 6465 6e20  d 2->1 + hidden 
+0000e2f0: 7374 6174 6520 6f66 2062 6f6e 6420 352d  state of bond 5-
+0000e300: 3e31 2920 2861 7420 5420 6465 7074 6829  >1) (at T depth)
+0000e310: 0a0a 2020 2020 666f 722c 2064 6570 7468  ..    for, depth
+0000e320: 2054 203d 2032 3a0a 0a20 2020 202d 2074   T = 2:..    - t
+0000e330: 6865 2068 6964 6465 6e20 7374 6174 6573  he hidden states
+0000e340: 206f 6620 7468 6520 626f 6e64 7320 4020   of the bonds @ 
+0000e350: 3173 7420 6974 6572 6174 696f 6e20 7769  1st iteration wi
+0000e360: 6c6c 2062 6520 3d3e 2028 3029 6832 312c  ll be => (0)h21,
+0000e370: 2028 3029 6835 310a 2020 2020 2d20 7468   (0)h51.    - th
+0000e380: 6520 6869 6464 656e 2073 7461 7465 7320  e hidden states 
+0000e390: 6f66 2074 6865 2062 6f6e 6473 2040 2032  of the bonds @ 2
+0000e3a0: 6e64 2069 7465 7261 7469 6f6e 2077 696c  nd iteration wil
+0000e3b0: 6c20 6265 203d 3e20 2831 2968 3231 2c20  l be => (1)h21, 
+0000e3c0: 2831 2968 3531 0a0a 2020 2020 5468 6520  (1)h51..    The 
+0000e3d0: 6869 6464 656e 2073 7461 7465 7320 6f66  hidden states of
+0000e3e0: 2074 6865 2062 6f6e 6473 2069 6e20 3173   the bonds in 1s
+0000e3f0: 7420 6974 6572 6174 696f 6e20 6172 6520  t iteration are 
+0000e400: 616c 7265 6164 7920 6b6e 6f77 2e0a 2020  already know..  
+0000e410: 2020 466f 7220 6869 6464 656e 2073 7461    For hidden sta
+0000e420: 7465 7320 6f66 2074 6865 2062 6f6e 6473  tes of the bonds
+0000e430: 2069 6e20 326e 6420 6974 6572 6174 696f   in 2nd iteratio
+0000e440: 6e2c 2077 6520 666f 6c6c 6f77 2074 6865  n, we follow the
+0000e450: 2063 7269 7465 7269 6f6e 2074 6861 743a   criterion that:
+0000e460: 0a0a 2020 2020 2d20 6869 6464 656e 2073  ..    - hidden s
+0000e470: 7461 7465 206f 6620 7468 6520 626f 6e64  tate of the bond
+0000e480: 2069 7320 6120 6675 6e63 7469 6f6e 206f   is a function o
+0000e490: 6620 2a2a 696e 6974 6961 6c20 6869 6464  f **initial hidd
+0000e4a0: 656e 2073 7461 7465 206f 6620 626f 6e64  en state of bond
+0000e4b0: 2a2a 0a20 2020 2061 6e64 202a 2a6d 6573  **.    and **mes
+0000e4c0: 7361 6765 7320 636f 6d69 6e67 2074 6f20  sages coming to 
+0000e4d0: 7468 6174 2062 6f6e 6420 696e 2074 6861  that bond in tha
+0000e4e0: 7420 6974 6572 6174 696f 6e2a 2a0a 0a20  t iteration**.. 
+0000e4f0: 2020 2045 7861 6d70 6c65 3a0a 2020 2020     Example:.    
+0000e500: 6060 2831 2968 3231 203d 2066 756e 6332  ``(1)h21 = func2
+0000e510: 2820 2830 2968 3231 202c 2028 3129 6d32  ( (0)h21 , (1)m2
+0000e520: 3120 2960 600a 0a20 2020 202e 2e20 6e6f  1 )``..    .. no
+0000e530: 7465 3a3a 0a20 2020 2020 4865 7265 2066  te::.     Here f
+0000e540: 756e 6332 2069 7320 6060 7365 6c66 2e57  unc2 is ``self.W
+0000e550: 5f68 6060 2e0a 0a20 2020 2020 6028 3129  _h``...     `(1)
+0000e560: 6d32 3160 2072 6566 6572 7320 746f 2074  m21` refers to t
+0000e570: 6865 206d 6573 7361 6765 7320 636f 6d69  he messages comi
+0000e580: 6e67 2074 6f20 7468 6174 2062 6f6e 6420  ng to that bond 
+0000e590: 322d 3e31 2069 6e20 7468 6174 2032 6e64  2->1 in that 2nd
+0000e5a0: 2069 7465 7261 7469 6f6e 2e0a 0a20 2020   iteration...   
+0000e5b0: 204d 6573 7361 6765 7320 636f 6d69 6e67   Messages coming
+0000e5c0: 2074 6f20 6120 626f 6e64 2069 6e20 616e   to a bond in an
+0000e5d0: 2069 7465 7261 7469 6f6e 2069 7320 2a2a   iteration is **
+0000e5e0: 6120 7375 6d20 6f66 2068 6964 6465 6e20  a sum of hidden 
+0000e5f0: 7374 6174 6573 206f 6620 626f 6e64 7320  states of bonds 
+0000e600: 2866 726f 6d20 7072 6576 696f 7573 2069  (from previous i
+0000e610: 7465 7261 7469 6f6e 2920 636f 6d69 6e67  teration) coming
+0000e620: 2074 6f20 7468 6973 2062 6f6e 642a 2a2e   to this bond**.
+0000e630: 0a0a 2020 2020 4578 616d 706c 653a 0a20  ..    Example:. 
+0000e640: 2020 2060 6028 3129 6d32 3120 3d20 2830     ``(1)m21 = (0
+0000e650: 2968 3332 202b 2028 3029 6834 3260 600a  )h32 + (0)h42``.
+0000e660: 0a20 2020 207c 2020 2032 203c 2d2d 2d20  .    |   2 <--- 
+0000e670: 330a 2020 2020 7c20 2020 5e0a 2020 2020  3.    |   ^.    
+0000e680: 7c20 2020 7c0a 2020 2020 7c20 2020 340a  |   |.    |   4.
+0000e690: 0a20 2020 202a 2a43 6f6d 7075 7469 6e67  .    **Computing
+0000e6a0: 2074 6865 206d 6573 7361 6765 732a 2a0a   the messages**.
+0000e6b0: 0a20 2020 202e 2e20 636f 6465 2d62 6c6f  .    .. code-blo
+0000e6c0: 636b 3a3a 2070 7974 686f 6e0a 0a20 2020  ck:: python..   
 0000e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6e0: 2020 2020 4230 2020 2020 2020 4231 2020      B0      B1  
-0000e6f0: 2020 2020 4232 2020 2020 2020 4233 2020      B2      B3  
-0000e700: 2020 2020 4234 2020 2020 2020 4235 2020      B4      B5  
-0000e710: 2020 2020 4236 2020 2020 2020 4237 2020      B6      B7  
-0000e720: 2020 2020 4238 0a20 2020 2020 2020 2066      B8.        f
-0000e730: 5f69 6e69 5f61 746f 6d73 5f62 6f6e 6473  _ini_atoms_bonds
-0000e740: 203d 205b 2830 2968 3132 2c20 2830 2968   = [(0)h12, (0)h
-0000e750: 3231 2c20 2830 2968 3233 2c20 2830 2968  21, (0)h23, (0)h
-0000e760: 3332 2c20 2830 2968 3234 2c20 2830 2968  32, (0)h24, (0)h
-0000e770: 3432 2c20 2830 2968 3135 2c20 2830 2968  42, (0)h15, (0)h
-0000e780: 3531 2c20 6828 2d31 295d 0a0a 0a20 2020  51, h(-1)]...   
-0000e790: 202e 2e20 6e6f 7465 3a3a 0a20 2020 2020   .. note::.     
-0000e7a0: 6828 2d31 2920 6973 2061 6e20 656d 7074  h(-1) is an empt
-0000e7b0: 7920 6172 7261 7920 6f66 2074 6865 2073  y array of the s
-0000e7c0: 616d 6520 7369 7a65 2061 7320 6f74 6865  ame size as othe
-0000e7d0: 7220 6869 6464 656e 2073 7461 7465 7320  r hidden states 
-0000e7e0: 6f66 2062 6f6e 6420 7374 6174 6573 2e0a  of bond states..
-0000e7f0: 0a20 2020 202e 2e20 636f 6465 2d62 6c6f  .    .. code-blo
-0000e800: 636b 3a3a 2070 7974 686f 6e0a 0a20 2020  ck:: python..   
-0000e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e820: 2042 3020 2020 2020 2042 3120 2020 2020   B0      B1     
-0000e830: 2042 3220 2020 2020 2042 3320 2020 2020   B2      B3     
-0000e840: 2042 3420 2020 2020 2042 3520 2020 2020   B4      B5     
-0000e850: 2042 3620 2020 2020 2042 3720 2020 2020   B6      B7     
-0000e860: 2020 4238 0a20 2020 2020 2020 206d 6170    B8.        map
-0000e870: 7069 6e67 203d 205b 205b 2d31 2c42 375d  ping = [ [-1,B7]
-0000e880: 205b 4233 2c42 355d 205b 4230 2c42 355d   [B3,B5] [B0,B5]
-0000e890: 205b 2d31 2c2d 315d 205b 4230 2c42 335d   [-1,-1] [B0,B3]
-0000e8a0: 205b 2d31 2c2d 315d 205b 4231 2c2d 315d   [-1,-1] [B1,-1]
-0000e8b0: 205b 2d31 2c2d 315d 2020 5b2d 312c 2d31   [-1,-1]  [-1,-1
-0000e8c0: 5d20 5d0a 0a20 2020 204c 6174 6572 2c20  ] ]..    Later, 
-0000e8d0: 7468 6520 656e 636f 6465 7220 7769 6c6c  the encoder will
-0000e8e0: 206d 6170 2074 6865 2063 6f6e 6361 7465   map the concate
-0000e8f0: 6e61 7465 6420 6665 6174 7572 6573 2066  nated features f
-0000e900: 726f 6d20 7468 6520 6060 665f 696e 695f  rom the ``f_ini_
-0000e910: 6174 6f6d 735f 626f 6e64 7360 600a 2020  atoms_bonds``.  
-0000e920: 2020 746f 2060 606d 6170 7069 6e67 6060    to ``mapping``
-0000e930: 2069 6e20 6561 6368 2069 7465 7261 7469   in each iterati
-0000e940: 6f6e 2075 7074 6f20 5474 6820 6974 6572  on upto Tth iter
-0000e950: 6174 696f 6e2e 0a0a 2020 2020 4e65 7874  ation...    Next
-0000e960: 2074 6865 2065 6e63 6f64 6572 2077 696c   the encoder wil
-0000e970: 6c20 7375 6d2d 7570 2074 6865 2063 6f6e  l sum-up the con
-0000e980: 6361 7420 6665 6174 7572 6573 2077 6974  cat features wit
-0000e990: 6869 6e20 7361 6d65 2062 6f6e 6420 696e  hin same bond in
-0000e9a0: 6465 782e 0a0a 2020 2020 2e2e 2063 6f64  dex...    .. cod
-0000e9b0: 652d 626c 6f63 6b3a 3a20 7079 7468 6f6e  e-block:: python
-0000e9c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e9d0: 2020 2020 2020 2020 2020 2831 296d 3132            (1)m12
-0000e9e0: 2020 2020 2020 2020 2020 2028 3129 6d32             (1)m2
-0000e9f0: 3120 2020 2020 2020 2020 2020 2831 296d  1           (1)m
-0000ea00: 3233 2020 2020 2020 2020 2020 2020 2020  23              
-0000ea10: 2831 296d 3332 2020 2020 2020 2020 2020  (1)m32          
-0000ea20: 2831 296d 3234 2020 2020 2020 2020 2020  (1)m24          
-0000ea30: 2028 3129 6d34 3220 2020 2020 2020 2020   (1)m42         
-0000ea40: 2020 2831 296d 3135 2020 2020 2020 2020    (1)m15        
-0000ea50: 2020 2831 296d 3531 2020 2020 2020 2020    (1)m51        
-0000ea60: 2020 2020 6d28 2d31 290a 2020 2020 2020      m(-1).      
-0000ea70: 2020 6d65 7373 6167 6520 3d20 5b20 5b68    message = [ [h
-0000ea80: 282d 3129 202b 2028 3029 6835 315d 205b  (-1) + (0)h51] [
-0000ea90: 2830 2968 3332 202b 2028 3029 6834 325d  (0)h32 + (0)h42]
-0000eaa0: 205b 2830 2968 3132 202b 2028 3029 6834   [(0)h12 + (0)h4
-0000eab0: 325d 205b 6828 2d31 2920 2b20 6828 2d31  2] [h(-1) + h(-1
-0000eac0: 295d 205b 2830 2968 3132 202b 2028 3029  )] [(0)h12 + (0)
-0000ead0: 6833 325d 205b 6828 2d31 2920 2b20 6828  h32] [h(-1) + h(
-0000eae0: 2d31 295d 205b 2830 2968 3231 202b 2068  -1)] [(0)h21 + h
-0000eaf0: 282d 3129 5d20 5b68 282d 3129 202b 2068  (-1)] [h(-1) + h
-0000eb00: 282d 3129 5d20 205b 6828 2d31 2920 2b20  (-1)]  [h(-1) + 
-0000eb10: 6828 2d31 295d 205d 0a0a 2020 2020 4865  h(-1)] ]..    He
-0000eb20: 6e63 652c 2074 6869 7320 6973 2068 6f77  nce, this is how
-0000eb30: 2065 6e63 6f64 6572 2063 616e 2067 6574   encoder can get
-0000eb40: 206d 6573 7361 6765 7320 666f 7220 6d65   messages for me
-0000eb50: 7373 6167 652d 7061 7373 696e 6720 7374  ssage-passing st
-0000eb60: 6570 732e 0a0a 2020 2020 2a2a 4765 7420  eps...    **Get 
-0000eb70: 6e65 7720 6174 6f6d 2068 6964 6465 6e20  new atom hidden 
-0000eb80: 7374 6174 6573 2061 6e64 2072 6561 646f  states and reado
-0000eb90: 7574 2070 6861 7365 2a2a 0a0a 2020 2020  ut phase**..    
-0000eba0: 4865 6e63 6520 6e6f 7720 666f 7220 6831  Hence now for h1
-0000ebb0: 3a0a 0a20 2020 202e 2e20 636f 6465 2d62  :..    .. code-b
-0000ebc0: 6c6f 636b 3a3a 2070 7974 686f 6e0a 0a20  lock:: python.. 
-0000ebd0: 2020 2020 2020 2068 3120 3d20 6675 6e63         h1 = func
-0000ebe0: 3328 0a20 2020 2020 2020 2020 2020 2020  3(.             
-0000ebf0: 2020 2020 2020 2063 6f6e 6361 7428 0a20         concat(. 
-0000ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec10: 2020 2020 2020 2020 6131 2c0a 2020 2020          a1,.    
-0000ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec30: 2020 2020 205b 0a20 2020 2020 2020 2020       [.         
+0000e6e0: 2020 2020 2020 2020 2020 4230 2020 2020            B0    
+0000e6f0: 2020 4231 2020 2020 2020 4232 2020 2020    B1      B2    
+0000e700: 2020 4233 2020 2020 2020 4234 2020 2020    B3      B4    
+0000e710: 2020 4235 2020 2020 2020 4236 2020 2020    B5      B6    
+0000e720: 2020 4237 2020 2020 2020 4238 0a20 2020    B7      B8.   
+0000e730: 2020 2020 2066 5f69 6e69 5f61 746f 6d73       f_ini_atoms
+0000e740: 5f62 6f6e 6473 203d 205b 2830 2968 3132  _bonds = [(0)h12
+0000e750: 2c20 2830 2968 3231 2c20 2830 2968 3233  , (0)h21, (0)h23
+0000e760: 2c20 2830 2968 3332 2c20 2830 2968 3234  , (0)h32, (0)h24
+0000e770: 2c20 2830 2968 3432 2c20 2830 2968 3135  , (0)h42, (0)h15
+0000e780: 2c20 2830 2968 3531 2c20 6828 2d31 295d  , (0)h51, h(-1)]
+0000e790: 0a0a 0a20 2020 202e 2e20 6e6f 7465 3a3a  ...    .. note::
+0000e7a0: 0a20 2020 2020 6828 2d31 2920 6973 2061  .     h(-1) is a
+0000e7b0: 6e20 656d 7074 7920 6172 7261 7920 6f66  n empty array of
+0000e7c0: 2074 6865 2073 616d 6520 7369 7a65 2061   the same size a
+0000e7d0: 7320 6f74 6865 7220 6869 6464 656e 2073  s other hidden s
+0000e7e0: 7461 7465 7320 6f66 2062 6f6e 6420 7374  tates of bond st
+0000e7f0: 6174 6573 2e0a 0a20 2020 202e 2e20 636f  ates...    .. co
+0000e800: 6465 2d62 6c6f 636b 3a3a 2070 7974 686f  de-block:: pytho
+0000e810: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+0000e820: 2020 2020 2020 2042 3020 2020 2020 2042         B0      B
+0000e830: 3120 2020 2020 2042 3220 2020 2020 2042  1      B2      B
+0000e840: 3320 2020 2020 2042 3420 2020 2020 2042  3      B4      B
+0000e850: 3520 2020 2020 2042 3620 2020 2020 2042  5      B6      B
+0000e860: 3720 2020 2020 2020 4238 0a20 2020 2020  7       B8.     
+0000e870: 2020 206d 6170 7069 6e67 203d 205b 205b     mapping = [ [
+0000e880: 2d31 2c42 375d 205b 4233 2c42 355d 205b  -1,B7] [B3,B5] [
+0000e890: 4230 2c42 355d 205b 2d31 2c2d 315d 205b  B0,B5] [-1,-1] [
+0000e8a0: 4230 2c42 335d 205b 2d31 2c2d 315d 205b  B0,B3] [-1,-1] [
+0000e8b0: 4231 2c2d 315d 205b 2d31 2c2d 315d 2020  B1,-1] [-1,-1]  
+0000e8c0: 5b2d 312c 2d31 5d20 5d0a 0a20 2020 204c  [-1,-1] ]..    L
+0000e8d0: 6174 6572 2c20 7468 6520 656e 636f 6465  ater, the encode
+0000e8e0: 7220 7769 6c6c 206d 6170 2074 6865 2063  r will map the c
+0000e8f0: 6f6e 6361 7465 6e61 7465 6420 6665 6174  oncatenated feat
+0000e900: 7572 6573 2066 726f 6d20 7468 6520 6060  ures from the ``
+0000e910: 665f 696e 695f 6174 6f6d 735f 626f 6e64  f_ini_atoms_bond
+0000e920: 7360 600a 2020 2020 746f 2060 606d 6170  s``.    to ``map
+0000e930: 7069 6e67 6060 2069 6e20 6561 6368 2069  ping`` in each i
+0000e940: 7465 7261 7469 6f6e 2075 7074 6f20 5474  teration upto Tt
+0000e950: 6820 6974 6572 6174 696f 6e2e 0a0a 2020  h iteration...  
+0000e960: 2020 4e65 7874 2074 6865 2065 6e63 6f64    Next the encod
+0000e970: 6572 2077 696c 6c20 7375 6d2d 7570 2074  er will sum-up t
+0000e980: 6865 2063 6f6e 6361 7420 6665 6174 7572  he concat featur
+0000e990: 6573 2077 6974 6869 6e20 7361 6d65 2062  es within same b
+0000e9a0: 6f6e 6420 696e 6465 782e 0a0a 2020 2020  ond index...    
+0000e9b0: 2e2e 2063 6f64 652d 626c 6f63 6b3a 3a20  .. code-block:: 
+0000e9c0: 7079 7468 6f6e 0a0a 2020 2020 2020 2020  python..        
+0000e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9e0: 2831 296d 3132 2020 2020 2020 2020 2020  (1)m12          
+0000e9f0: 2028 3129 6d32 3120 2020 2020 2020 2020   (1)m21         
+0000ea00: 2020 2831 296d 3233 2020 2020 2020 2020    (1)m23        
+0000ea10: 2020 2020 2020 2831 296d 3332 2020 2020        (1)m32    
+0000ea20: 2020 2020 2020 2831 296d 3234 2020 2020        (1)m24    
+0000ea30: 2020 2020 2020 2028 3129 6d34 3220 2020         (1)m42   
+0000ea40: 2020 2020 2020 2020 2831 296d 3135 2020          (1)m15  
+0000ea50: 2020 2020 2020 2020 2831 296d 3531 2020          (1)m51  
+0000ea60: 2020 2020 2020 2020 2020 6d28 2d31 290a            m(-1).
+0000ea70: 2020 2020 2020 2020 6d65 7373 6167 6520          message 
+0000ea80: 3d20 5b20 5b68 282d 3129 202b 2028 3029  = [ [h(-1) + (0)
+0000ea90: 6835 315d 205b 2830 2968 3332 202b 2028  h51] [(0)h32 + (
+0000eaa0: 3029 6834 325d 205b 2830 2968 3132 202b  0)h42] [(0)h12 +
+0000eab0: 2028 3029 6834 325d 205b 6828 2d31 2920   (0)h42] [h(-1) 
+0000eac0: 2b20 6828 2d31 295d 205b 2830 2968 3132  + h(-1)] [(0)h12
+0000ead0: 202b 2028 3029 6833 325d 205b 6828 2d31   + (0)h32] [h(-1
+0000eae0: 2920 2b20 6828 2d31 295d 205b 2830 2968  ) + h(-1)] [(0)h
+0000eaf0: 3231 202b 2068 282d 3129 5d20 5b68 282d  21 + h(-1)] [h(-
+0000eb00: 3129 202b 2068 282d 3129 5d20 205b 6828  1) + h(-1)]  [h(
+0000eb10: 2d31 2920 2b20 6828 2d31 295d 205d 0a0a  -1) + h(-1)] ]..
+0000eb20: 2020 2020 4865 6e63 652c 2074 6869 7320      Hence, this 
+0000eb30: 6973 2068 6f77 2065 6e63 6f64 6572 2063  is how encoder c
+0000eb40: 616e 2067 6574 206d 6573 7361 6765 7320  an get messages 
+0000eb50: 666f 7220 6d65 7373 6167 652d 7061 7373  for message-pass
+0000eb60: 696e 6720 7374 6570 732e 0a0a 2020 2020  ing steps...    
+0000eb70: 2a2a 4765 7420 6e65 7720 6174 6f6d 2068  **Get new atom h
+0000eb80: 6964 6465 6e20 7374 6174 6573 2061 6e64  idden states and
+0000eb90: 2072 6561 646f 7574 2070 6861 7365 2a2a   readout phase**
+0000eba0: 0a0a 2020 2020 4865 6e63 6520 6e6f 7720  ..    Hence now 
+0000ebb0: 666f 7220 6831 3a0a 0a20 2020 202e 2e20  for h1:..    .. 
+0000ebc0: 636f 6465 2d62 6c6f 636b 3a3a 2070 7974  code-block:: pyt
+0000ebd0: 686f 6e0a 0a20 2020 2020 2020 2068 3120  hon..        h1 
+0000ebe0: 3d20 6675 6e63 3328 0a20 2020 2020 2020  = func3(.       
+0000ebf0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0000ec00: 6361 7428 0a20 2020 2020 2020 2020 2020  cat(.           
+0000ec10: 2020 2020 2020 2020 2020 2020 2020 6131                a1
+0000ec20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ec30: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
 0000ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec50: 2020 2066 756e 6332 2820 2830 2968 3231     func2( (0)h21
-0000ec60: 202c 2028 3029 6833 3220 2b20 2830 2968   , (0)h32 + (0)h
-0000ec70: 3432 2029 202b 0a20 2020 2020 2020 2020  42 ) +.         
+0000ec50: 2020 2020 2020 2020 2066 756e 6332 2820           func2( 
+0000ec60: 2830 2968 3231 202c 2028 3029 6833 3220  (0)h21 , (0)h32 
+0000ec70: 2b20 2830 2968 3432 2029 202b 0a20 2020  + (0)h42 ) +.   
 0000ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec90: 2020 2066 756e 6332 2820 2830 2968 3531     func2( (0)h51
-0000eca0: 202c 2030 2020 2020 2020 2020 2020 2020   , 0            
-0000ecb0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000ecc0: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
-0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ece0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000ecf0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000ed00: 2020 5369 6d69 6c61 726c 792c 2068 322c    Similarly, h2,
-0000ed10: 2068 332c 2068 3420 616e 6420 6835 2061   h3, h4 and h5 a
-0000ed20: 7265 2063 616c 6375 6c61 7465 642e 0a0a  re calculated...
-0000ed30: 2020 2020 4e65 7874 2c20 616c 6c20 6174      Next, all at
-0000ed40: 6f6d 2068 6964 6465 6e20 7374 6174 6573  om hidden states
-0000ed50: 2061 7265 2063 6f6e 6361 7465 6e61 7465   are concatenate
-0000ed60: 6420 746f 206d 616b 6520 6120 6665 6174  d to make a feat
-0000ed70: 7572 6520 7665 6374 6f72 206f 6620 7468  ure vector of th
-0000ed80: 6520 6d6f 6c65 6375 6c65 3a0a 0a20 2020  e molecule:..   
-0000ed90: 2060 606d 6f6c 5f65 6e63 6f64 696e 6773   ``mol_encodings
-0000eda0: 203d 205b 5b68 312c 2068 322c 2068 332c   = [[h1, h2, h3,
-0000edb0: 2068 342c 2068 355d 5d60 600a 0a20 2020   h4, h5]]``..   
-0000edc0: 202a 2a43 6f6e 6361 7465 6e61 7465 2074   **Concatenate t
-0000edd0: 6865 2067 6c6f 6261 6c20 6665 6174 7572  he global featur
-0000ede0: 6573 2a2a 0a0a 2020 2020 4c65 742c 0a20  es**..    Let,. 
-0000edf0: 2020 2060 6067 6c6f 6261 6c5f 6665 6174     ``global_feat
-0000ee00: 7572 6573 203d 205b 5b67 6631 2c20 6766  ures = [[gf1, gf
-0000ee10: 322c 2067 6633 5d5d 6060 0a20 2020 2054  2, gf3]]``.    T
-0000ee20: 6869 7320 6172 7261 7920 636f 6e74 6169  his array contai
-0000ee30: 6e73 206d 6f6c 6563 756c 6520 6c65 7665  ns molecule leve
-0000ee40: 6c20 6665 6174 7572 6573 2e20 496e 2063  l features. In c
-0000ee50: 6173 6520 6f66 2074 6869 7320 6578 616d  ase of this exam
-0000ee60: 706c 652c 2069 7420 636f 6e74 6169 6e73  ple, it contains
-0000ee70: 2033 2067 6c6f 6261 6c20 6665 6174 7572   3 global featur
-0000ee80: 6573 2e0a 0a20 2020 2048 656e 6365 2061  es...    Hence a
-0000ee90: 6674 6572 2063 6f6e 6361 7465 6e61 7469  fter concatenati
-0000eea0: 6f6e 2c0a 0a20 2020 2060 606d 6f6c 5f65  on,..    ``mol_e
-0000eeb0: 6e63 6f64 696e 6773 203d 205b 5b68 312c  ncodings = [[h1,
-0000eec0: 2068 322c 2068 332c 2068 342c 2068 352c   h2, h3, h4, h5,
-0000eed0: 2067 6631 2c20 6766 322c 2067 6633 5d5d   gf1, gf2, gf3]]
-0000eee0: 6060 0a20 2020 2028 4669 6e61 6c20 6f75  ``.    (Final ou
-0000eef0: 7470 7574 206f 6620 7468 6520 656e 636f  tput of the enco
-0000ef00: 6465 7229 0a0a 2020 2020 5265 6665 7265  der)..    Refere
-0000ef10: 6e63 6573 0a20 2020 202d 2d2d 2d2d 2d2d  nces.    -------
-0000ef20: 2d2d 2d0a 2020 2020 2e2e 205b 315d 2041  ---.    .. [1] A
-0000ef30: 6e61 6c79 7a69 6e67 204c 6561 726e 6564  nalyzing Learned
-0000ef40: 204d 6f6c 6563 756c 6172 2052 6570 7265   Molecular Repre
-0000ef50: 7365 6e74 6174 696f 6e73 2066 6f72 2050  sentations for P
-0000ef60: 726f 7065 7274 7920 5072 6564 6963 7469  roperty Predicti
-0000ef70: 6f6e 2068 7474 7073 3a2f 2f61 7278 6976  on https://arxiv
-0000ef80: 2e6f 7267 2f70 6466 2f31 3930 342e 3031  .org/pdf/1904.01
-0000ef90: 3536 312e 7064 660a 0a20 2020 2045 7861  561.pdf..    Exa
-0000efa0: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
-0000efb0: 2d2d 0a20 2020 203e 3e3e 2066 726f 6d20  --.    >>> from 
-0000efc0: 7264 6b69 7420 696d 706f 7274 2043 6865  rdkit import Che
-0000efd0: 6d0a 2020 2020 3e3e 3e20 696d 706f 7274  m.    >>> import
-0000efe0: 2074 6f72 6368 0a20 2020 203e 3e3e 2069   torch.    >>> i
-0000eff0: 6d70 6f72 7420 6465 6570 6368 656d 2061  mport deepchem a
-0000f000: 7320 6463 0a20 2020 203e 3e3e 2069 6e70  s dc.    >>> inp
-0000f010: 7574 5f73 6d69 6c65 203d 2022 4343 220a  ut_smile = "CC".
-0000f020: 2020 2020 3e3e 3e20 6665 6174 203d 2064      >>> feat = d
-0000f030: 632e 6665 6174 2e44 4d50 4e4e 4665 6174  c.feat.DMPNNFeat
-0000f040: 7572 697a 6572 2866 6561 7475 7265 735f  urizer(features_
-0000f050: 6765 6e65 7261 746f 7273 3d5b 276d 6f72  generators=['mor
-0000f060: 6761 6e27 5d29 0a20 2020 203e 3e3e 2067  gan']).    >>> g
-0000f070: 7261 7068 203d 2066 6561 742e 6665 6174  raph = feat.feat
-0000f080: 7572 697a 6528 696e 7075 745f 736d 696c  urize(input_smil
-0000f090: 6529 0a20 2020 203e 3e3e 2066 726f 6d20  e).    >>> from 
-0000f0a0: 6465 6570 6368 656d 2e6d 6f64 656c 732e  deepchem.models.
-0000f0b0: 746f 7263 685f 6d6f 6465 6c73 2e64 6d70  torch_models.dmp
-0000f0c0: 6e6e 2069 6d70 6f72 7420 5f4d 6170 7065  nn import _Mappe
-0000f0d0: 7244 4d50 4e4e 0a20 2020 203e 3e3e 206d  rDMPNN.    >>> m
-0000f0e0: 6170 7065 7220 3d20 5f4d 6170 7065 7244  apper = _MapperD
-0000f0f0: 4d50 4e4e 2867 7261 7068 5b30 5d29 0a20  MPNN(graph[0]). 
-0000f100: 2020 203e 3e3e 2061 746f 6d5f 6665 6174     >>> atom_feat
-0000f110: 7572 6573 2c20 665f 696e 695f 6174 6f6d  ures, f_ini_atom
-0000f120: 735f 626f 6e64 732c 2061 746f 6d5f 746f  s_bonds, atom_to
-0000f130: 5f69 6e63 6f6d 696e 675f 626f 6e64 732c  _incoming_bonds,
-0000f140: 206d 6170 7069 6e67 2c20 676c 6f62 616c   mapping, global
-0000f150: 5f66 6561 7475 7265 7320 3d20 6d61 7070  _features = mapp
-0000f160: 6572 2e76 616c 7565 730a 2020 2020 3e3e  er.values.    >>
-0000f170: 3e20 6174 6f6d 5f66 6561 7475 7265 7320  > atom_features 
-0000f180: 3d20 746f 7263 682e 6672 6f6d 5f6e 756d  = torch.from_num
-0000f190: 7079 2861 746f 6d5f 6665 6174 7572 6573  py(atom_features
-0000f1a0: 292e 666c 6f61 7428 290a 2020 2020 3e3e  ).float().    >>
-0000f1b0: 3e20 665f 696e 695f 6174 6f6d 735f 626f  > f_ini_atoms_bo
-0000f1c0: 6e64 7320 3d20 746f 7263 682e 6672 6f6d  nds = torch.from
-0000f1d0: 5f6e 756d 7079 2866 5f69 6e69 5f61 746f  _numpy(f_ini_ato
-0000f1e0: 6d73 5f62 6f6e 6473 292e 666c 6f61 7428  ms_bonds).float(
-0000f1f0: 290a 2020 2020 3e3e 3e20 6174 6f6d 5f74  ).    >>> atom_t
-0000f200: 6f5f 696e 636f 6d69 6e67 5f62 6f6e 6473  o_incoming_bonds
-0000f210: 203d 2074 6f72 6368 2e66 726f 6d5f 6e75   = torch.from_nu
-0000f220: 6d70 7928 6174 6f6d 5f74 6f5f 696e 636f  mpy(atom_to_inco
-0000f230: 6d69 6e67 5f62 6f6e 6473 290a 2020 2020  ming_bonds).    
-0000f240: 3e3e 3e20 6d61 7070 696e 6720 3d20 746f  >>> mapping = to
-0000f250: 7263 682e 6672 6f6d 5f6e 756d 7079 286d  rch.from_numpy(m
-0000f260: 6170 7069 6e67 290a 2020 2020 3e3e 3e20  apping).    >>> 
-0000f270: 676c 6f62 616c 5f66 6561 7475 7265 7320  global_features 
-0000f280: 3d20 746f 7263 682e 6672 6f6d 5f6e 756d  = torch.from_num
-0000f290: 7079 2867 6c6f 6261 6c5f 6665 6174 7572  py(global_featur
-0000f2a0: 6573 292e 666c 6f61 7428 290a 2020 2020  es).float().    
-0000f2b0: 3e3e 3e20 6d6f 6c65 6375 6c65 735f 756e  >>> molecules_un
-0000f2c0: 6261 7463 685f 6b65 7920 3d20 6c65 6e28  batch_key = len(
-0000f2d0: 6174 6f6d 5f66 6561 7475 7265 7329 0a20  atom_features). 
-0000f2e0: 2020 203e 3e3e 206c 6179 6572 203d 2044     >>> layer = D
-0000f2f0: 4d50 4e4e 456e 636f 6465 724c 6179 6572  MPNNEncoderLayer
-0000f300: 2864 5f68 6964 6465 6e3d 3229 0a20 2020  (d_hidden=2).   
-0000f310: 203e 3e3e 206f 7574 7075 7420 3d20 6c61   >>> output = la
-0000f320: 7965 7228 6174 6f6d 5f66 6561 7475 7265  yer(atom_feature
-0000f330: 732c 2066 5f69 6e69 5f61 746f 6d73 5f62  s, f_ini_atoms_b
-0000f340: 6f6e 6473 2c20 6174 6f6d 5f74 6f5f 696e  onds, atom_to_in
-0000f350: 636f 6d69 6e67 5f62 6f6e 6473 2c20 6d61  coming_bonds, ma
-0000f360: 7070 696e 672c 2067 6c6f 6261 6c5f 6665  pping, global_fe
-0000f370: 6174 7572 6573 2c20 6d6f 6c65 6375 6c65  atures, molecule
-0000f380: 735f 756e 6261 7463 685f 6b65 7929 0a20  s_unbatch_key). 
-0000f390: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-0000f3a0: 5f5f 696e 6974 5f5f 2873 656c 662c 0a20  __init__(self,. 
-0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3c0: 7573 655f 6465 6661 756c 745f 6664 696d  use_default_fdim
-0000f3d0: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-0000f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3f0: 6174 6f6d 5f66 6469 6d3a 2069 6e74 203d  atom_fdim: int =
-0000f400: 2031 3333 2c0a 2020 2020 2020 2020 2020   133,.          
-0000f410: 2020 2020 2020 2062 6f6e 645f 6664 696d         bond_fdim
-0000f420: 3a20 696e 7420 3d20 3134 2c0a 2020 2020  : int = 14,.    
-0000f430: 2020 2020 2020 2020 2020 2020 2064 5f68               d_h
-0000f440: 6964 6465 6e3a 2069 6e74 203d 2033 3030  idden: int = 300
-0000f450: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f460: 2020 2064 6570 7468 3a20 696e 7420 3d20     depth: int = 
-0000f470: 332c 0a20 2020 2020 2020 2020 2020 2020  3,.             
-0000f480: 2020 2020 6269 6173 3a20 626f 6f6c 203d      bias: bool =
-0000f490: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-0000f4a0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
-0000f4b0: 696f 6e3a 2073 7472 203d 2027 7265 6c75  ion: str = 'relu
-0000f4c0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0000f4d0: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
-0000f4e0: 6c6f 6174 203d 2030 2e30 2c0a 2020 2020  loat = 0.0,.    
-0000f4f0: 2020 2020 2020 2020 2020 2020 2061 6767               agg
-0000f500: 7265 6761 7469 6f6e 3a20 7374 7220 3d20  regation: str = 
-0000f510: 276d 6561 6e27 2c0a 2020 2020 2020 2020  'mean',.        
-0000f520: 2020 2020 2020 2020 2061 6767 7265 6761           aggrega
-0000f530: 7469 6f6e 5f6e 6f72 6d3a 2055 6e69 6f6e  tion_norm: Union
-0000f540: 5b69 6e74 2c20 666c 6f61 745d 203d 2031  [int, float] = 1
-0000f550: 3030 293a 0a20 2020 2020 2020 2022 2222  00):.        """
-0000f560: 496e 6974 6961 6c69 7a65 2061 2044 4d50  Initialize a DMP
-0000f570: 4e4e 456e 636f 6465 724c 6179 6572 206c  NNEncoderLayer l
-0000f580: 6179 6572 2e0a 0a20 2020 2020 2020 2050  ayer...        P
-0000f590: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-0000f5a0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0000f5b0: 2020 2020 2075 7365 5f64 6566 6175 6c74       use_default
-0000f5c0: 5f66 6469 6d3a 2062 6f6f 6c0a 2020 2020  _fdim: bool.    
-0000f5d0: 2020 2020 2020 2020 4966 2060 6054 7275          If ``Tru
-0000f5e0: 6560 602c 2060 6073 656c 662e 6174 6f6d  e``, ``self.atom
-0000f5f0: 5f66 6469 6d60 6020 616e 6420 6060 7365  _fdim`` and ``se
-0000f600: 6c66 2e62 6f6e 645f 6664 696d 6060 2061  lf.bond_fdim`` a
-0000f610: 7265 2069 6e69 7469 616c 697a 6564 2075  re initialized u
-0000f620: 7369 6e67 2076 616c 7565 7320 6672 6f6d  sing values from
-0000f630: 2074 6865 2047 7261 7068 436f 6e76 436f   the GraphConvCo
-0000f640: 6e73 7461 6e74 7320 636c 6173 732e 2049  nstants class. I
-0000f650: 6620 6060 4661 6c73 6560 602c 2060 6073  f ``False``, ``s
-0000f660: 656c 662e 6174 6f6d 5f66 6469 6d60 6020  elf.atom_fdim`` 
-0000f670: 616e 6420 6060 7365 6c66 2e62 6f6e 645f  and ``self.bond_
-0000f680: 6664 696d 6060 2061 7265 2069 6e69 7469  fdim`` are initi
-0000f690: 616c 697a 6564 2066 726f 6d20 7468 6520  alized from the 
-0000f6a0: 7661 6c75 6573 2070 726f 7669 6465 642e  values provided.
-0000f6b0: 0a20 2020 2020 2020 2061 746f 6d5f 6664  .        atom_fd
-0000f6c0: 696d 3a20 696e 740a 2020 2020 2020 2020  im: int.        
-0000f6d0: 2020 2020 4469 6d65 6e73 696f 6e20 6f66      Dimension of
-0000f6e0: 2061 746f 6d20 6665 6174 7572 6520 7665   atom feature ve
-0000f6f0: 6374 6f72 2e0a 2020 2020 2020 2020 626f  ctor..        bo
-0000f700: 6e64 5f66 6469 6d3a 2069 6e74 0a20 2020  nd_fdim: int.   
-0000f710: 2020 2020 2020 2020 2044 696d 656e 7369           Dimensi
-0000f720: 6f6e 206f 6620 626f 6e64 2066 6561 7475  on of bond featu
-0000f730: 7265 2076 6563 746f 722e 0a20 2020 2020  re vector..     
-0000f740: 2020 2064 5f68 6964 6465 6e3a 2069 6e74     d_hidden: int
-0000f750: 0a20 2020 2020 2020 2020 2020 2053 697a  .            Siz
-0000f760: 6520 6f66 2068 6964 6465 6e20 6c61 7965  e of hidden laye
-0000f770: 7220 696e 2074 6865 2065 6e63 6f64 6572  r in the encoder
-0000f780: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-0000f790: 6465 7074 683a 2069 6e74 0a20 2020 2020  depth: int.     
-0000f7a0: 2020 2020 2020 204e 6f20 6f66 206d 6573         No of mes
-0000f7b0: 7361 6765 2070 6173 7369 6e67 2073 7465  sage passing ste
-0000f7c0: 7073 2e0a 2020 2020 2020 2020 6269 6173  ps..        bias
-0000f7d0: 3a20 626f 6f6c 0a20 2020 2020 2020 2020  : bool.         
-0000f7e0: 2020 2049 6620 6060 5472 7565 6060 2c20     If ``True``, 
-0000f7f0: 6465 6e73 6520 6c61 7965 7273 2077 696c  dense layers wil
-0000f800: 6c20 7573 6520 6269 6173 2076 6563 746f  l use bias vecto
-0000f810: 7273 2e0a 2020 2020 2020 2020 6163 7469  rs..        acti
-0000f820: 7661 7469 6f6e 3a20 7374 720a 2020 2020  vation: str.    
-0000f830: 2020 2020 2020 2020 4163 7469 7661 7469          Activati
-0000f840: 6f6e 2066 756e 6374 696f 6e20 746f 2062  on function to b
-0000f850: 6520 7573 6564 2069 6e20 7468 6520 656e  e used in the en
-0000f860: 636f 6465 7220 6c61 7965 722e 0a20 2020  coder layer..   
-0000f870: 2020 2020 2020 2020 2043 616e 2063 686f           Can cho
-0000f880: 6f73 6520 6265 7477 6565 6e20 2772 656c  ose between 'rel
-0000f890: 7527 2066 6f72 2052 654c 552c 2027 6c65  u' for ReLU, 'le
-0000f8a0: 616b 7972 656c 7527 2066 6f72 204c 6561  akyrelu' for Lea
-0000f8b0: 6b79 5265 4c55 2c20 2770 7265 6c75 2720  kyReLU, 'prelu' 
-0000f8c0: 666f 7220 5052 654c 552c 0a20 2020 2020  for PReLU,.     
-0000f8d0: 2020 2020 2020 2027 7461 6e68 2720 666f         'tanh' fo
-0000f8e0: 7220 5461 6e48 2c20 2773 656c 7527 2066  r TanH, 'selu' f
-0000f8f0: 6f72 2053 454c 552c 2061 6e64 2027 656c  or SELU, and 'el
-0000f900: 7527 2066 6f72 2045 4c55 2e0a 2020 2020  u' for ELU..    
-0000f910: 2020 2020 6472 6f70 6f75 745f 703a 2066      dropout_p: f
-0000f920: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-0000f930: 2044 726f 706f 7574 2070 726f 6261 6269   Dropout probabi
-0000f940: 6c69 7479 2066 6f72 2074 6865 2065 6e63  lity for the enc
-0000f950: 6f64 6572 206c 6179 6572 2e0a 2020 2020  oder layer..    
-0000f960: 2020 2020 6167 6772 6567 6174 696f 6e3a      aggregation:
-0000f970: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
-0000f980: 2041 6767 7265 6761 7469 6f6e 2074 7970   Aggregation typ
-0000f990: 6520 746f 2062 6520 7573 6564 2069 6e20  e to be used in 
-0000f9a0: 7468 6520 656e 636f 6465 7220 6c61 7965  the encoder laye
-0000f9b0: 722e 0a20 2020 2020 2020 2020 2020 2043  r..            C
-0000f9c0: 616e 2063 686f 6f73 6520 6265 7477 6565  an choose betwee
-0000f9d0: 6e20 276d 6561 6e27 2c20 2773 756d 272c  n 'mean', 'sum',
-0000f9e0: 2061 6e64 2027 6e6f 726d 272e 0a20 2020   and 'norm'..   
-0000f9f0: 2020 2020 2061 6767 7265 6761 7469 6f6e       aggregation
-0000fa00: 5f6e 6f72 6d3a 2055 6e69 6f6e 5b69 6e74  _norm: Union[int
-0000fa10: 2c20 666c 6f61 745d 0a20 2020 2020 2020  , float].       
-0000fa20: 2020 2020 2056 616c 7565 2072 6571 7569       Value requi
-0000fa30: 7265 6420 6966 2060 6167 6772 6567 6174  red if `aggregat
-0000fa40: 696f 6e60 2074 7970 6520 6973 2027 6e6f  ion` type is 'no
-0000fa50: 726d 272e 0a20 2020 2020 2020 2022 2222  rm'..        """
-0000fa60: 0a20 2020 2020 2020 2073 7570 6572 2844  .        super(D
-0000fa70: 4d50 4e4e 456e 636f 6465 724c 6179 6572  MPNNEncoderLayer
-0000fa80: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-0000fa90: 2829 0a0a 2020 2020 2020 2020 6966 2075  ()..        if u
-0000faa0: 7365 5f64 6566 6175 6c74 5f66 6469 6d3a  se_default_fdim:
-0000fab0: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
-0000fac0: 6d20 6465 6570 6368 656d 2e66 6561 742e  m deepchem.feat.
-0000fad0: 6d6f 6c65 6375 6c65 5f66 6561 7475 7269  molecule_featuri
-0000fae0: 7a65 7273 2e64 6d70 6e6e 5f66 6561 7475  zers.dmpnn_featu
-0000faf0: 7269 7a65 7220 696d 706f 7274 2047 7261  rizer import Gra
-0000fb00: 7068 436f 6e76 436f 6e73 7461 6e74 730a  phConvConstants.
-0000fb10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000fb20: 2e61 746f 6d5f 6664 696d 3a20 696e 7420  .atom_fdim: int 
-0000fb30: 3d20 4772 6170 6843 6f6e 7643 6f6e 7374  = GraphConvConst
-0000fb40: 616e 7473 2e41 544f 4d5f 4644 494d 0a20  ants.ATOM_FDIM. 
-0000fb50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000fb60: 636f 6e63 6174 5f66 6469 6d3a 2069 6e74  concat_fdim: int
-0000fb70: 203d 2047 7261 7068 436f 6e76 436f 6e73   = GraphConvCons
-0000fb80: 7461 6e74 732e 4154 4f4d 5f46 4449 4d20  tants.ATOM_FDIM 
-0000fb90: 2b20 4772 6170 6843 6f6e 7643 6f6e 7374  + GraphConvConst
-0000fba0: 616e 7473 2e42 4f4e 445f 4644 494d 0a20  ants.BOND_FDIM. 
-0000fbb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000fbc0: 2020 2020 2020 2020 2073 656c 662e 6174           self.at
-0000fbd0: 6f6d 5f66 6469 6d20 3d20 6174 6f6d 5f66  om_fdim = atom_f
-0000fbe0: 6469 6d0a 2020 2020 2020 2020 2020 2020  dim.            
-0000fbf0: 7365 6c66 2e63 6f6e 6361 745f 6664 696d  self.concat_fdim
-0000fc00: 203d 2061 746f 6d5f 6664 696d 202b 2062   = atom_fdim + b
-0000fc10: 6f6e 645f 6664 696d 0a0a 2020 2020 2020  ond_fdim..      
-0000fc20: 2020 7365 6c66 2e64 6570 7468 3a20 696e    self.depth: in
-0000fc30: 7420 3d20 6465 7074 680a 2020 2020 2020  t = depth.      
-0000fc40: 2020 7365 6c66 2e61 6767 7265 6761 7469    self.aggregati
-0000fc50: 6f6e 3a20 7374 7220 3d20 6167 6772 6567  on: str = aggreg
-0000fc60: 6174 696f 6e0a 2020 2020 2020 2020 7365  ation.        se
-0000fc70: 6c66 2e61 6767 7265 6761 7469 6f6e 5f6e  lf.aggregation_n
-0000fc80: 6f72 6d3a 2055 6e69 6f6e 5b69 6e74 2c20  orm: Union[int, 
-0000fc90: 666c 6f61 745d 203d 2061 6767 7265 6761  float] = aggrega
-0000fca0: 7469 6f6e 5f6e 6f72 6d0a 0a20 2020 2020  tion_norm..     
-0000fcb0: 2020 2069 6620 6163 7469 7661 7469 6f6e     if activation
-0000fcc0: 203d 3d20 2772 656c 7527 3a0a 2020 2020   == 'relu':.    
-0000fcd0: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
-0000fce0: 6976 6174 696f 6e3a 206e 6e2e 6d6f 6475  ivation: nn.modu
-0000fcf0: 6c65 732e 6163 7469 7661 7469 6f6e 2e4d  les.activation.M
-0000fd00: 6f64 756c 6520 3d20 6e6e 2e52 654c 5528  odule = nn.ReLU(
-0000fd10: 290a 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0000fd20: 6163 7469 7661 7469 6f6e 203d 3d20 276c  activation == 'l
-0000fd30: 6561 6b79 7265 6c75 273a 0a20 2020 2020  eakyrelu':.     
-0000fd40: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
-0000fd50: 7661 7469 6f6e 203d 206e 6e2e 4c65 616b  vation = nn.Leak
-0000fd60: 7952 654c 5528 302e 3129 0a0a 2020 2020  yReLU(0.1)..    
-0000fd70: 2020 2020 656c 6966 2061 6374 6976 6174      elif activat
-0000fd80: 696f 6e20 3d3d 2027 7072 656c 7527 3a0a  ion == 'prelu':.
-0000fd90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000fda0: 2e61 6374 6976 6174 696f 6e20 3d20 6e6e  .activation = nn
-0000fdb0: 2e50 5265 4c55 2829 0a0a 2020 2020 2020  .PReLU()..      
-0000fdc0: 2020 656c 6966 2061 6374 6976 6174 696f    elif activatio
-0000fdd0: 6e20 3d3d 2027 7461 6e68 273a 0a20 2020  n == 'tanh':.   
-0000fde0: 2020 2020 2020 2020 2073 656c 662e 6163           self.ac
-0000fdf0: 7469 7661 7469 6f6e 203d 206e 6e2e 5461  tivation = nn.Ta
-0000fe00: 6e68 2829 0a0a 2020 2020 2020 2020 656c  nh()..        el
-0000fe10: 6966 2061 6374 6976 6174 696f 6e20 3d3d  if activation ==
-0000fe20: 2027 7365 6c75 273a 0a20 2020 2020 2020   'selu':.       
-0000fe30: 2020 2020 2073 656c 662e 6163 7469 7661       self.activa
-0000fe40: 7469 6f6e 203d 206e 6e2e 5345 4c55 2829  tion = nn.SELU()
-0000fe50: 0a0a 2020 2020 2020 2020 656c 6966 2061  ..        elif a
-0000fe60: 6374 6976 6174 696f 6e20 3d3d 2027 656c  ctivation == 'el
-0000fe70: 7527 3a0a 2020 2020 2020 2020 2020 2020  u':.            
-0000fe80: 7365 6c66 2e61 6374 6976 6174 696f 6e20  self.activation 
-0000fe90: 3d20 6e6e 2e45 4c55 2829 0a0a 2020 2020  = nn.ELU()..    
-0000fea0: 2020 2020 7365 6c66 2e64 726f 706f 7574      self.dropout
-0000feb0: 3a20 6e6e 2e6d 6f64 756c 6573 2e64 726f  : nn.modules.dro
-0000fec0: 706f 7574 2e4d 6f64 756c 6520 3d20 6e6e  pout.Module = nn
-0000fed0: 2e44 726f 706f 7574 2864 726f 706f 7574  .Dropout(dropout
-0000fee0: 5f70 290a 0a20 2020 2020 2020 2023 2049  _p)..        # I
-0000fef0: 6e70 7574 0a20 2020 2020 2020 2073 656c  nput.        sel
-0000ff00: 662e 575f 693a 206e 6e2e 4c69 6e65 6172  f.W_i: nn.Linear
-0000ff10: 203d 206e 6e2e 4c69 6e65 6172 2873 656c   = nn.Linear(sel
-0000ff20: 662e 636f 6e63 6174 5f66 6469 6d2c 2064  f.concat_fdim, d
-0000ff30: 5f68 6964 6465 6e2c 2062 6961 733d 6269  _hidden, bias=bi
-0000ff40: 6173 290a 0a20 2020 2020 2020 2023 2053  as)..        # S
-0000ff50: 6861 7265 6420 7765 6967 6874 206d 6174  hared weight mat
-0000ff60: 7269 7820 6163 726f 7373 2064 6570 7468  rix across depth
-0000ff70: 7320 2864 6566 6175 6c74 293a 0a20 2020  s (default):.   
-0000ff80: 2020 2020 2023 2046 6f72 206d 6573 7361       # For messa
-0000ff90: 6765 7320 6869 6464 656e 2073 7461 7465  ges hidden state
-0000ffa0: 730a 2020 2020 2020 2020 7365 6c66 2e57  s.        self.W
-0000ffb0: 5f68 3a20 6e6e 2e4c 696e 6561 7220 3d20  _h: nn.Linear = 
-0000ffc0: 6e6e 2e4c 696e 6561 7228 645f 6869 6464  nn.Linear(d_hidd
-0000ffd0: 656e 2c20 645f 6869 6464 656e 2c20 6269  en, d_hidden, bi
-0000ffe0: 6173 3d62 6961 7329 0a0a 2020 2020 2020  as=bias)..      
-0000fff0: 2020 2320 466f 7220 6174 6f6d 2068 6964    # For atom hid
-00010000: 6465 6e20 7374 6174 6573 0a20 2020 2020  den states.     
-00010010: 2020 2073 656c 662e 575f 6f3a 206e 6e2e     self.W_o: nn.
-00010020: 4c69 6e65 6172 203d 206e 6e2e 4c69 6e65  Linear = nn.Line
-00010030: 6172 2873 656c 662e 6174 6f6d 5f66 6469  ar(self.atom_fdi
-00010040: 6d20 2b20 645f 6869 6464 656e 2c20 645f  m + d_hidden, d_
-00010050: 6869 6464 656e 290a 0a20 2020 2064 6566  hidden)..    def
-00010060: 205f 6765 745f 7570 6461 7465 645f 6174   _get_updated_at
-00010070: 6f6d 735f 6869 6464 656e 5f73 7461 7465  oms_hidden_state
-00010080: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00010090: 6c66 2c20 6174 6f6d 5f66 6561 7475 7265  lf, atom_feature
-000100a0: 733a 2074 6f72 6368 2e54 656e 736f 722c  s: torch.Tensor,
-000100b0: 2068 5f6d 6573 7361 6765 3a20 746f 7263   h_message: torc
-000100c0: 682e 5465 6e73 6f72 2c0a 2020 2020 2020  h.Tensor,.      
-000100d0: 2020 2020 2020 6174 6f6d 5f74 6f5f 696e        atom_to_in
-000100e0: 636f 6d69 6e67 5f62 6f6e 6473 3a20 746f  coming_bonds: to
-000100f0: 7263 682e 5465 6e73 6f72 2920 2d3e 2074  rch.Tensor) -> t
-00010100: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
-00010110: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00010120: 204d 6574 686f 6420 746f 2063 6f6d 7075   Method to compu
-00010130: 7465 2061 746f 6d20 6869 6464 656e 2073  te atom hidden s
-00010140: 7461 7465 732e 0a0a 2020 2020 2020 2020  tates...        
-00010150: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00010160: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00010170: 2020 2020 2020 6174 6f6d 5f66 6561 7475        atom_featu
-00010180: 7265 733a 2074 6f72 6368 2e54 656e 736f  res: torch.Tenso
-00010190: 720a 2020 2020 2020 2020 2020 2020 5465  r.            Te
-000101a0: 6e73 6f72 2063 6f6e 7461 696e 696e 6720  nsor containing 
-000101b0: 6174 6f6d 7320 6665 6174 7572 6573 2e0a  atoms features..
-000101c0: 2020 2020 2020 2020 685f 6d65 7373 6167          h_messag
-000101d0: 653a 2074 6f72 6368 2e54 656e 736f 720a  e: torch.Tensor.
-000101e0: 2020 2020 2020 2020 2020 2020 5465 6e73              Tens
-000101f0: 6f72 2063 6f6e 7461 696e 696e 6720 6869  or containing hi
-00010200: 6464 656e 2073 7461 7465 7320 6f66 206d  dden states of m
-00010210: 6573 7361 6765 732e 0a20 2020 2020 2020  essages..       
-00010220: 2061 746f 6d5f 746f 5f69 6e63 6f6d 696e   atom_to_incomin
-00010230: 675f 626f 6e64 733a 2074 6f72 6368 2e54  g_bonds: torch.T
-00010240: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00010250: 2020 5465 6e73 6f72 2063 6f6e 7461 696e    Tensor contain
-00010260: 696e 6720 6d61 7070 696e 6720 6672 6f6d  ing mapping from
-00010270: 2061 746f 6d20 696e 6465 7820 746f 206c   atom index to l
-00010280: 6973 7420 6f66 2069 6e64 6963 6965 7320  ist of indicies 
-00010290: 6f66 2069 6e63 6f6d 696e 6720 626f 6e64  of incoming bond
-000102a0: 732e 0a0a 2020 2020 2020 2020 5265 7475  s...        Retu
-000102b0: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-000102c0: 2d2d 2d0a 2020 2020 2020 2020 6174 6f6d  ---.        atom
-000102d0: 735f 6869 6464 656e 5f73 7461 7465 733a  s_hidden_states:
-000102e0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-000102f0: 2020 2020 2020 2020 2020 5465 6e73 6f72            Tensor
-00010300: 2063 6f6e 7461 696e 696e 6720 6174 6f6d   containing atom
-00010310: 2068 6964 6465 6e20 7374 6174 6573 2e0a   hidden states..
-00010320: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010330: 2020 2020 6d65 7373 6167 6573 5f74 6f5f      messages_to_
-00010340: 6174 6f6d 733a 2074 6f72 6368 2e54 656e  atoms: torch.Ten
-00010350: 736f 7220 3d20 685f 6d65 7373 6167 655b  sor = h_message[
-00010360: 6174 6f6d 5f74 6f5f 696e 636f 6d69 6e67  atom_to_incoming
-00010370: 5f62 6f6e 6473 5d2e 7375 6d28 0a20 2020  _bonds].sum(.   
-00010380: 2020 2020 2020 2020 2031 2920 2023 206e           1)  # n
-00010390: 756d 5f61 746f 6d73 2078 2068 6964 6465  um_atoms x hidde
-000103a0: 6e5f 7369 7a65 0a20 2020 2020 2020 2061  n_size.        a
-000103b0: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
-000103c0: 6573 3a20 746f 7263 682e 5465 6e73 6f72  es: torch.Tensor
-000103d0: 203d 2073 656c 662e 575f 6f28 0a20 2020   = self.W_o(.   
-000103e0: 2020 2020 2020 2020 2074 6f72 6368 2e63           torch.c
-000103f0: 6174 2828 6174 6f6d 5f66 6561 7475 7265  at((atom_feature
-00010400: 732c 206d 6573 7361 6765 735f 746f 5f61  s, messages_to_a
-00010410: 746f 6d73 292c 0a20 2020 2020 2020 2020  toms),.         
-00010420: 2020 2020 2020 2020 2020 2020 2031 2929               1))
-00010430: 2020 2320 6e75 6d5f 6174 6f6d 7320 7820    # num_atoms x 
-00010440: 6869 6464 656e 5f73 697a 650a 2020 2020  hidden_size.    
-00010450: 2020 2020 6174 6f6d 735f 6869 6464 656e      atoms_hidden
-00010460: 5f73 7461 7465 7320 3d20 7365 6c66 2e61  _states = self.a
-00010470: 6374 6976 6174 696f 6e28 0a20 2020 2020  ctivation(.     
-00010480: 2020 2020 2020 2061 746f 6d73 5f68 6964         atoms_hid
-00010490: 6465 6e5f 7374 6174 6573 2920 2023 206e  den_states)  # n
-000104a0: 756d 5f61 746f 6d73 2078 2068 6964 6465  um_atoms x hidde
-000104b0: 6e5f 7369 7a65 0a20 2020 2020 2020 2061  n_size.        a
-000104c0: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
-000104d0: 6573 203d 2073 656c 662e 6472 6f70 6f75  es = self.dropou
-000104e0: 7428 0a20 2020 2020 2020 2020 2020 2061  t(.            a
-000104f0: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
-00010500: 6573 2920 2023 206e 756d 5f61 746f 6d73  es)  # num_atoms
-00010510: 2078 2068 6964 6465 6e5f 7369 7a65 0a20   x hidden_size. 
-00010520: 2020 2020 2020 2072 6574 7572 6e20 6174         return at
-00010530: 6f6d 735f 6869 6464 656e 5f73 7461 7465  oms_hidden_state
-00010540: 7320 2023 206e 756d 5f61 746f 6d73 2078  s  # num_atoms x
-00010550: 2068 6964 6465 6e5f 7369 7a65 0a0a 2020   hidden_size..  
-00010560: 2020 6465 6620 5f72 6561 646f 7574 2873    def _readout(s
-00010570: 656c 662c 2061 746f 6d73 5f68 6964 6465  elf, atoms_hidde
-00010580: 6e5f 7374 6174 6573 3a20 746f 7263 682e  n_states: torch.
-00010590: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
-000105a0: 2020 2020 2020 2020 206d 6f6c 6563 756c           molecul
-000105b0: 6573 5f75 6e62 6174 6368 5f6b 6579 3a20  es_unbatch_key: 
-000105c0: 4c69 7374 2920 2d3e 2074 6f72 6368 2e54  List) -> torch.T
-000105d0: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
-000105e0: 2222 0a20 2020 2020 2020 204d 6574 686f  "".        Metho
-000105f0: 6420 746f 2065 7865 6375 7465 2074 6865  d to execute the
-00010600: 2072 6561 646f 7574 2070 6861 7365 2e20   readout phase. 
-00010610: 2863 6f6d 7075 7465 206d 6f6c 6563 756c  (compute molecul
-00010620: 6573 2065 6e63 6f64 696e 6773 2066 726f  es encodings fro
-00010630: 6d20 6174 6f6d 2068 6964 6465 6e20 7374  m atom hidden st
-00010640: 6174 6573 290a 0a20 2020 2020 2020 2050  ates)..        P
-00010650: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00010660: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00010670: 2020 2020 2061 746f 6d73 5f68 6964 6465       atoms_hidde
-00010680: 6e5f 7374 6174 6573 3a20 746f 7263 682e  n_states: torch.
-00010690: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-000106a0: 2020 2054 656e 736f 7220 636f 6e74 6169     Tensor contai
-000106b0: 6e69 6e67 2061 746f 6d20 6869 6464 656e  ning atom hidden
-000106c0: 2073 7461 7465 732e 0a20 2020 2020 2020   states..       
-000106d0: 206d 6f6c 6563 756c 6573 5f75 6e62 6174   molecules_unbat
-000106e0: 6368 5f6b 6579 3a20 4c69 7374 0a20 2020  ch_key: List.   
-000106f0: 2020 2020 2020 2020 204c 6973 7420 636f           List co
-00010700: 6e74 6169 6e69 6e67 206e 756d 6265 7220  ntaining number 
-00010710: 6f66 2061 746f 6d73 2069 6e20 7661 7269  of atoms in vari
-00010720: 6f75 7320 6d6f 6c65 6375 6c65 7320 6f66  ous molecules of
-00010730: 2061 2062 6174 6368 0a0a 2020 2020 2020   a batch..      
-00010740: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00010750: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00010760: 2020 6d6f 6c65 6375 6c65 5f68 6964 6465    molecule_hidde
-00010770: 6e5f 7374 6174 653a 2074 6f72 6368 2e54  n_state: torch.T
-00010780: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00010790: 2020 5465 6e73 6f72 2063 6f6e 7461 696e    Tensor contain
-000107a0: 696e 6720 6d6f 6c65 6375 6c65 2065 6e63  ing molecule enc
-000107b0: 6f64 696e 6773 2e0a 2020 2020 2020 2020  odings..        
-000107c0: 2222 220a 2020 2020 2020 2020 6d6f 6c5f  """.        mol_
-000107d0: 7665 6373 3a20 4c69 7374 203d 205b 5d0a  vecs: List = [].
-000107e0: 2020 2020 2020 2020 6174 6f6d 735f 6869          atoms_hi
-000107f0: 6464 656e 5f73 7461 7465 735f 7370 6c69  dden_states_spli
-00010800: 743a 2053 6571 7565 6e63 655b 5465 6e73  t: Sequence[Tens
-00010810: 6f72 5d20 3d20 746f 7263 682e 7370 6c69  or] = torch.spli
-00010820: 7428 0a20 2020 2020 2020 2020 2020 2061  t(.            a
-00010830: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
-00010840: 6573 2c20 6d6f 6c65 6375 6c65 735f 756e  es, molecules_un
-00010850: 6261 7463 685f 6b65 7929 0a20 2020 2020  batch_key).     
-00010860: 2020 206d 6f6c 5f76 6563 3a20 746f 7263     mol_vec: torc
-00010870: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00010880: 2066 6f72 206d 6f6c 5f76 6563 2069 6e20   for mol_vec in 
-00010890: 6174 6f6d 735f 6869 6464 656e 5f73 7461  atoms_hidden_sta
-000108a0: 7465 735f 7370 6c69 743a 0a20 2020 2020  tes_split:.     
-000108b0: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
-000108c0: 6767 7265 6761 7469 6f6e 203d 3d20 276d  ggregation == 'm
-000108d0: 6561 6e27 3a0a 2020 2020 2020 2020 2020  ean':.          
-000108e0: 2020 2020 2020 6d6f 6c5f 7665 6320 3d20        mol_vec = 
-000108f0: 6d6f 6c5f 7665 632e 7375 6d28 6469 6d3d  mol_vec.sum(dim=
-00010900: 3029 202f 206c 656e 286d 6f6c 5f76 6563  0) / len(mol_vec
-00010910: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00010920: 6966 2073 656c 662e 6167 6772 6567 6174  if self.aggregat
-00010930: 696f 6e20 3d3d 2027 7375 6d27 3a0a 2020  ion == 'sum':.  
-00010940: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-00010950: 6c5f 7665 6320 3d20 6d6f 6c5f 7665 632e  l_vec = mol_vec.
-00010960: 7375 6d28 6469 6d3d 3029 0a20 2020 2020  sum(dim=0).     
-00010970: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00010980: 2e61 6767 7265 6761 7469 6f6e 203d 3d20  .aggregation == 
-00010990: 276e 6f72 6d27 3a0a 2020 2020 2020 2020  'norm':.        
-000109a0: 2020 2020 2020 2020 6d6f 6c5f 7665 6320          mol_vec 
-000109b0: 3d20 6d6f 6c5f 7665 632e 7375 6d28 6469  = mol_vec.sum(di
-000109c0: 6d3d 3029 202f 2073 656c 662e 6167 6772  m=0) / self.aggr
-000109d0: 6567 6174 696f 6e5f 6e6f 726d 0a20 2020  egation_norm.   
-000109e0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000109f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00010a00: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
-00010a10: 496e 7661 6c69 6420 6167 6772 6567 6174  Invalid aggregat
-00010a20: 696f 6e22 290a 2020 2020 2020 2020 2020  ion").          
-00010a30: 2020 6d6f 6c5f 7665 6373 2e61 7070 656e    mol_vecs.appen
-00010a40: 6428 6d6f 6c5f 7665 6329 0a0a 2020 2020  d(mol_vec)..    
-00010a50: 2020 2020 6d6f 6c65 6375 6c65 5f68 6964      molecule_hid
-00010a60: 6465 6e5f 7374 6174 653a 2074 6f72 6368  den_state: torch
-00010a70: 2e54 656e 736f 7220 3d20 746f 7263 682e  .Tensor = torch.
-00010a80: 7374 6163 6b28 6d6f 6c5f 7665 6373 2c20  stack(mol_vecs, 
-00010a90: 6469 6d3d 3029 0a20 2020 2020 2020 2072  dim=0).        r
-00010aa0: 6574 7572 6e20 6d6f 6c65 6375 6c65 5f68  eturn molecule_h
-00010ab0: 6964 6465 6e5f 7374 6174 6520 2023 206e  idden_state  # n
-00010ac0: 756d 5f6d 6f6c 6563 756c 6573 2078 2068  um_molecules x h
-00010ad0: 6964 6465 6e5f 7369 7a65 0a0a 2020 2020  idden_size..    
-00010ae0: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
-00010af0: 2c20 6174 6f6d 5f66 6561 7475 7265 733a  , atom_features:
-00010b00: 2074 6f72 6368 2e54 656e 736f 722c 0a20   torch.Tensor,. 
-00010b10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00010b20: 5f69 6e69 5f61 746f 6d73 5f62 6f6e 6473  _ini_atoms_bonds
-00010b30: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
-00010b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b50: 6174 6f6d 5f74 6f5f 696e 636f 6d69 6e67  atom_to_incoming
-00010b60: 5f62 6f6e 6473 3a20 746f 7263 682e 5465  _bonds: torch.Te
-00010b70: 6e73 6f72 2c20 6d61 7070 696e 673a 2074  nsor, mapping: t
-00010b80: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
-00010b90: 2020 2020 2020 2020 2020 2020 2067 6c6f               glo
-00010ba0: 6261 6c5f 6665 6174 7572 6573 3a20 746f  bal_features: to
-00010bb0: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
-00010bc0: 2020 2020 2020 2020 2020 2020 6d6f 6c65              mole
-00010bd0: 6375 6c65 735f 756e 6261 7463 685f 6b65  cules_unbatch_ke
-00010be0: 793a 204c 6973 7429 202d 3e20 746f 7263  y: List) -> torc
-00010bf0: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
-00010c00: 2020 2222 220a 2020 2020 2020 2020 4f75    """.        Ou
-00010c10: 7470 7574 2063 6f6d 7075 7461 7469 6f6e  tput computation
-00010c20: 2066 6f72 2074 6865 2044 4d50 4e4e 456e   for the DMPNNEn
-00010c30: 636f 6465 724c 6179 6572 2e0a 0a20 2020  coderLayer...   
-00010c40: 2020 2020 2053 7465 7073 3a0a 0a20 2020       Steps:..   
-00010c50: 2020 2020 202d 2047 6574 206f 7269 6769       - Get origi
-00010c60: 6e61 6c20 626f 6e64 2068 6964 6465 6e20  nal bond hidden 
-00010c70: 7374 6174 6573 2066 726f 6d20 636f 6e63  states from conc
-00010c80: 6174 656e 6174 696f 6e20 6f66 2069 6e69  atenation of ini
-00010c90: 7469 616c 2061 746f 6d20 616e 6420 626f  tial atom and bo
-00010ca0: 6e64 2066 6561 7475 7265 732e 2028 6060  nd features. (``
-00010cb0: 696e 7075 7460 6029 0a20 2020 2020 2020  input``).       
-00010cc0: 202d 2047 6574 2069 6e69 7469 616c 206d   - Get initial m
-00010cd0: 6573 7361 6765 7320 6869 6464 656e 2073  essages hidden s
-00010ce0: 7461 7465 732e 2028 6060 6d65 7373 6167  tates. (``messag
-00010cf0: 6560 6029 0a20 2020 2020 2020 202d 2045  e``).        - E
-00010d00: 7865 6375 7465 206d 6573 7361 6765 2070  xecute message p
-00010d10: 6173 7369 6e67 2073 7465 7020 666f 7220  assing step for 
-00010d20: 6060 7365 6c66 2e64 6570 7468 202d 2031  ``self.depth - 1
-00010d30: 6060 2069 7465 7261 7469 6f6e 732e 0a20  `` iterations.. 
-00010d40: 2020 2020 2020 202d 2047 6574 2061 746f         - Get ato
-00010d50: 6d20 6869 6464 656e 2073 7461 7465 7320  m hidden states 
-00010d60: 7573 696e 6720 6174 6f6d 2066 6561 7475  using atom featu
-00010d70: 7265 7320 616e 6420 6d65 7373 6167 6520  res and message 
-00010d80: 6869 6464 656e 2073 7461 7465 732e 0a20  hidden states.. 
-00010d90: 2020 2020 2020 202d 2047 6574 206d 6f6c         - Get mol
-00010da0: 6563 756c 6520 656e 636f 6469 6e67 732e  ecule encodings.
-00010db0: 0a20 2020 2020 2020 202d 2043 6f6e 6361  .        - Conca
-00010dc0: 7465 6e61 7465 2067 6c6f 6261 6c20 6d6f  tenate global mo
-00010dd0: 6c65 6375 6c61 7220 6665 6174 7572 6573  lecular features
-00010de0: 2061 6e64 206d 6f6c 6563 756c 6520 656e   and molecule en
-00010df0: 636f 6469 6e67 732e 0a0a 2020 2020 2020  codings...      
-00010e00: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00010e10: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00010e20: 2020 2020 2020 2020 6174 6f6d 5f66 6561          atom_fea
-00010e30: 7475 7265 733a 2074 6f72 6368 2e54 656e  tures: torch.Ten
-00010e40: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-00010e50: 5465 6e73 6f72 2063 6f6e 7461 696e 696e  Tensor containin
-00010e60: 6720 6174 6f6d 7320 6665 6174 7572 6573  g atoms features
-00010e70: 2e0a 2020 2020 2020 2020 665f 696e 695f  ..        f_ini_
-00010e80: 6174 6f6d 735f 626f 6e64 733a 2074 6f72  atoms_bonds: tor
-00010e90: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00010ea0: 2020 2020 2020 5465 6e73 6f72 2063 6f6e        Tensor con
-00010eb0: 7461 696e 696e 6720 636f 6e63 6174 656e  taining concaten
-00010ec0: 6174 6564 2066 6561 7475 7265 2076 6563  ated feature vec
-00010ed0: 746f 7220 7768 6963 6820 636f 6e74 6169  tor which contai
-00010ee0: 6e73 2063 6f6e 6361 7465 6e61 7469 6f6e  ns concatenation
-00010ef0: 206f 6620 696e 6974 6961 6c20 6174 6f6d   of initial atom
-00010f00: 2061 6e64 2062 6f6e 6420 6665 6174 7572   and bond featur
-00010f10: 6573 2e0a 2020 2020 2020 2020 6174 6f6d  es..        atom
-00010f20: 5f74 6f5f 696e 636f 6d69 6e67 5f62 6f6e  _to_incoming_bon
-00010f30: 6473 3a20 746f 7263 682e 5465 6e73 6f72  ds: torch.Tensor
-00010f40: 0a20 2020 2020 2020 2020 2020 2054 656e  .            Ten
-00010f50: 736f 7220 636f 6e74 6169 6e69 6e67 206d  sor containing m
-00010f60: 6170 7069 6e67 2066 726f 6d20 6174 6f6d  apping from atom
-00010f70: 2069 6e64 6578 2074 6f20 6c69 7374 206f   index to list o
-00010f80: 6620 696e 6469 6369 6573 206f 6620 696e  f indicies of in
-00010f90: 636f 6d69 6e67 2062 6f6e 6473 2e0a 2020  coming bonds..  
-00010fa0: 2020 2020 2020 6d61 7070 696e 673a 2074        mapping: t
-00010fb0: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
-00010fc0: 2020 2020 2020 2020 5465 6e73 6f72 2063          Tensor c
-00010fd0: 6f6e 7461 696e 696e 6720 7468 6520 6d61  ontaining the ma
-00010fe0: 7070 696e 6720 7468 6174 206d 6170 7320  pping that maps 
-00010ff0: 626f 6e64 2069 6e64 6578 2074 6f20 2761  bond index to 'a
-00011000: 7272 6179 206f 6620 696e 6469 6365 7320  rray of indices 
-00011010: 6f66 2074 6865 2062 6f6e 6473 270a 2020  of the bonds'.  
-00011020: 2020 2020 2020 2020 2020 696e 636f 6d69            incomi
-00011030: 6e67 2061 7420 7468 6520 696e 6974 6961  ng at the initia
-00011040: 6c20 6174 6f6d 206f 6620 7468 6520 626f  l atom of the bo
-00011050: 6e64 2028 6578 636c 7564 696e 6720 7468  nd (excluding th
-00011060: 6520 7265 7665 7273 6520 626f 6e64 7329  e reverse bonds)
-00011070: 2e0a 2020 2020 2020 2020 676c 6f62 616c  ..        global
-00011080: 5f66 6561 7475 7265 733a 2074 6f72 6368  _features: torch
-00011090: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-000110a0: 2020 2020 5465 6e73 6f72 2063 6f6e 7461      Tensor conta
-000110b0: 696e 696e 6720 6d6f 6c65 6375 6c65 2066  ining molecule f
-000110c0: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
-000110d0: 206d 6f6c 6563 756c 6573 5f75 6e62 6174   molecules_unbat
-000110e0: 6368 5f6b 6579 3a20 4c69 7374 0a20 2020  ch_key: List.   
-000110f0: 2020 2020 2020 2020 204c 6973 7420 636f           List co
-00011100: 6e74 6169 6e69 6e67 206e 756d 6265 7220  ntaining number 
-00011110: 6f66 2061 746f 6d73 2069 6e20 7661 7269  of atoms in vari
-00011120: 6f75 7320 6d6f 6c65 6375 6c65 7320 6f66  ous molecules of
-00011130: 2061 2062 6174 6368 0a0a 2020 2020 2020   a batch..      
-00011140: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00011150: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
-00011160: 2020 6f75 7470 7574 3a20 746f 7263 682e    output: torch.
-00011170: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-00011180: 2020 2054 656e 736f 7220 636f 6e74 6169     Tensor contai
-00011190: 6e69 6e67 2074 6865 2065 6e63 6f64 696e  ning the encodin
-000111a0: 6773 206f 6620 7468 6520 6d6f 6c65 6375  gs of the molecu
-000111b0: 6c65 732e 0a20 2020 2020 2020 2022 2222  les..        """
-000111c0: 0a20 2020 2020 2020 2069 6e70 7574 3a20  .        input: 
-000111d0: 746f 7263 682e 5465 6e73 6f72 203d 2073  torch.Tensor = s
-000111e0: 656c 662e 575f 6928 0a20 2020 2020 2020  elf.W_i(.       
-000111f0: 2020 2020 2066 5f69 6e69 5f61 746f 6d73       f_ini_atoms
-00011200: 5f62 6f6e 6473 2920 2023 206e 756d 5f62  _bonds)  # num_b
-00011210: 6f6e 6473 2078 2068 6964 6465 6e5f 7369  onds x hidden_si
-00011220: 7a65 0a20 2020 2020 2020 206d 6573 7361  ze.        messa
-00011230: 6765 3a20 746f 7263 682e 5465 6e73 6f72  ge: torch.Tensor
-00011240: 203d 2073 656c 662e 6163 7469 7661 7469   = self.activati
-00011250: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-00011260: 696e 7075 7429 2020 2320 6e75 6d5f 626f  input)  # num_bo
-00011270: 6e64 7320 7820 6869 6464 656e 5f73 697a  nds x hidden_siz
-00011280: 650a 0a20 2020 2020 2020 2066 6f72 205f  e..        for _
-00011290: 2069 6e20 7261 6e67 6528 312c 2073 656c   in range(1, sel
-000112a0: 662e 6465 7074 6829 3a0a 2020 2020 2020  f.depth):.      
-000112b0: 2020 2020 2020 6d65 7373 6167 6520 3d20        message = 
-000112c0: 6d65 7373 6167 655b 6d61 7070 696e 675d  message[mapping]
-000112d0: 2e73 756d 2831 2920 2023 206e 756d 5f62  .sum(1)  # num_b
-000112e0: 6f6e 6473 2078 2068 6964 6465 6e5f 7369  onds x hidden_si
-000112f0: 7a65 0a20 2020 2020 2020 2020 2020 2068  ze.            h
-00011300: 5f6d 6573 7361 6765 3a20 746f 7263 682e  _message: torch.
-00011310: 5465 6e73 6f72 203d 2069 6e70 7574 202b  Tensor = input +
-00011320: 2073 656c 662e 575f 6828 0a20 2020 2020   self.W_h(.     
-00011330: 2020 2020 2020 2020 2020 206d 6573 7361             messa
-00011340: 6765 2920 2023 206e 756d 5f62 6f6e 6473  ge)  # num_bonds
-00011350: 2078 2068 6964 6465 6e5f 7369 7a65 0a20   x hidden_size. 
-00011360: 2020 2020 2020 2020 2020 2068 5f6d 6573             h_mes
-00011370: 7361 6765 203d 2073 656c 662e 6163 7469  sage = self.acti
-00011380: 7661 7469 6f6e 2868 5f6d 6573 7361 6765  vation(h_message
-00011390: 2920 2023 206e 756d 5f62 6f6e 6473 2078  )  # num_bonds x
-000113a0: 2068 6964 6465 6e5f 7369 7a65 0a20 2020   hidden_size.   
-000113b0: 2020 2020 2020 2020 2068 5f6d 6573 7361           h_messa
-000113c0: 6765 203d 2073 656c 662e 6472 6f70 6f75  ge = self.dropou
-000113d0: 7428 685f 6d65 7373 6167 6529 2020 2320  t(h_message)  # 
-000113e0: 6e75 6d5f 626f 6e64 7320 7820 6869 6464  num_bonds x hidd
-000113f0: 656e 5f73 697a 650a 0a20 2020 2020 2020  en_size..       
-00011400: 2023 206e 756d 5f61 746f 6d73 2078 2068   # num_atoms x h
-00011410: 6964 6465 6e5f 7369 7a65 0a20 2020 2020  idden_size.     
-00011420: 2020 2061 746f 6d73 5f68 6964 6465 6e5f     atoms_hidden_
-00011430: 7374 6174 6573 3a20 746f 7263 682e 5465  states: torch.Te
-00011440: 6e73 6f72 203d 2073 656c 662e 5f67 6574  nsor = self._get
-00011450: 5f75 7064 6174 6564 5f61 746f 6d73 5f68  _updated_atoms_h
-00011460: 6964 6465 6e5f 7374 6174 6528 0a20 2020  idden_state(.   
-00011470: 2020 2020 2020 2020 2061 746f 6d5f 6665           atom_fe
-00011480: 6174 7572 6573 2c20 685f 6d65 7373 6167  atures, h_messag
-00011490: 652c 2061 746f 6d5f 746f 5f69 6e63 6f6d  e, atom_to_incom
-000114a0: 696e 675f 626f 6e64 7329 0a0a 2020 2020  ing_bonds)..    
-000114b0: 2020 2020 2320 6e75 6d5f 6d6f 6c65 6375      # num_molecu
-000114c0: 6c65 7320 7820 6869 6464 656e 5f73 697a  les x hidden_siz
-000114d0: 650a 2020 2020 2020 2020 6f75 7470 7574  e.        output
-000114e0: 3a20 746f 7263 682e 5465 6e73 6f72 203d  : torch.Tensor =
-000114f0: 2073 656c 662e 5f72 6561 646f 7574 2861   self._readout(a
-00011500: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
-00011510: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0000ec90: 2020 2020 2020 2020 2066 756e 6332 2820           func2( 
+0000eca0: 2830 2968 3531 202c 2030 2020 2020 2020  (0)h51 , 0      
+0000ecb0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecd0: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
+0000ece0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed00: 2029 0a0a 2020 2020 5369 6d69 6c61 726c   )..    Similarl
+0000ed10: 792c 2068 322c 2068 332c 2068 3420 616e  y, h2, h3, h4 an
+0000ed20: 6420 6835 2061 7265 2063 616c 6375 6c61  d h5 are calcula
+0000ed30: 7465 642e 0a0a 2020 2020 4e65 7874 2c20  ted...    Next, 
+0000ed40: 616c 6c20 6174 6f6d 2068 6964 6465 6e20  all atom hidden 
+0000ed50: 7374 6174 6573 2061 7265 2063 6f6e 6361  states are conca
+0000ed60: 7465 6e61 7465 6420 746f 206d 616b 6520  tenated to make 
+0000ed70: 6120 6665 6174 7572 6520 7665 6374 6f72  a feature vector
+0000ed80: 206f 6620 7468 6520 6d6f 6c65 6375 6c65   of the molecule
+0000ed90: 3a0a 0a20 2020 2060 606d 6f6c 5f65 6e63  :..    ``mol_enc
+0000eda0: 6f64 696e 6773 203d 205b 5b68 312c 2068  odings = [[h1, h
+0000edb0: 322c 2068 332c 2068 342c 2068 355d 5d60  2, h3, h4, h5]]`
+0000edc0: 600a 0a20 2020 202a 2a43 6f6e 6361 7465  `..    **Concate
+0000edd0: 6e61 7465 2074 6865 2067 6c6f 6261 6c20  nate the global 
+0000ede0: 6665 6174 7572 6573 2a2a 0a0a 2020 2020  features**..    
+0000edf0: 4c65 742c 0a20 2020 2060 6067 6c6f 6261  Let,.    ``globa
+0000ee00: 6c5f 6665 6174 7572 6573 203d 205b 5b67  l_features = [[g
+0000ee10: 6631 2c20 6766 322c 2067 6633 5d5d 6060  f1, gf2, gf3]]``
+0000ee20: 0a20 2020 2054 6869 7320 6172 7261 7920  .    This array 
+0000ee30: 636f 6e74 6169 6e73 206d 6f6c 6563 756c  contains molecul
+0000ee40: 6520 6c65 7665 6c20 6665 6174 7572 6573  e level features
+0000ee50: 2e20 496e 2063 6173 6520 6f66 2074 6869  . In case of thi
+0000ee60: 7320 6578 616d 706c 652c 2069 7420 636f  s example, it co
+0000ee70: 6e74 6169 6e73 2033 2067 6c6f 6261 6c20  ntains 3 global 
+0000ee80: 6665 6174 7572 6573 2e0a 0a20 2020 2048  features...    H
+0000ee90: 656e 6365 2061 6674 6572 2063 6f6e 6361  ence after conca
+0000eea0: 7465 6e61 7469 6f6e 2c0a 0a20 2020 2060  tenation,..    `
+0000eeb0: 606d 6f6c 5f65 6e63 6f64 696e 6773 203d  `mol_encodings =
+0000eec0: 205b 5b68 312c 2068 322c 2068 332c 2068   [[h1, h2, h3, h
+0000eed0: 342c 2068 352c 2067 6631 2c20 6766 322c  4, h5, gf1, gf2,
+0000eee0: 2067 6633 5d5d 6060 0a20 2020 2028 4669   gf3]]``.    (Fi
+0000eef0: 6e61 6c20 6f75 7470 7574 206f 6620 7468  nal output of th
+0000ef00: 6520 656e 636f 6465 7229 0a0a 2020 2020  e encoder)..    
+0000ef10: 5265 6665 7265 6e63 6573 0a20 2020 202d  References.    -
+0000ef20: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2e2e  ---------.    ..
+0000ef30: 205b 315d 2041 6e61 6c79 7a69 6e67 204c   [1] Analyzing L
+0000ef40: 6561 726e 6564 204d 6f6c 6563 756c 6172  earned Molecular
+0000ef50: 2052 6570 7265 7365 6e74 6174 696f 6e73   Representations
+0000ef60: 2066 6f72 2050 726f 7065 7274 7920 5072   for Property Pr
+0000ef70: 6564 6963 7469 6f6e 2068 7474 7073 3a2f  ediction https:/
+0000ef80: 2f61 7278 6976 2e6f 7267 2f70 6466 2f31  /arxiv.org/pdf/1
+0000ef90: 3930 342e 3031 3536 312e 7064 660a 0a20  904.01561.pdf.. 
+0000efa0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+0000efb0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e  --------.    >>>
+0000efc0: 2066 726f 6d20 7264 6b69 7420 696d 706f   from rdkit impo
+0000efd0: 7274 2043 6865 6d0a 2020 2020 3e3e 3e20  rt Chem.    >>> 
+0000efe0: 696d 706f 7274 2074 6f72 6368 0a20 2020  import torch.   
+0000eff0: 203e 3e3e 2069 6d70 6f72 7420 6465 6570   >>> import deep
+0000f000: 6368 656d 2061 7320 6463 0a20 2020 203e  chem as dc.    >
+0000f010: 3e3e 2069 6e70 7574 5f73 6d69 6c65 203d  >> input_smile =
+0000f020: 2022 4343 220a 2020 2020 3e3e 3e20 6665   "CC".    >>> fe
+0000f030: 6174 203d 2064 632e 6665 6174 2e44 4d50  at = dc.feat.DMP
+0000f040: 4e4e 4665 6174 7572 697a 6572 2866 6561  NNFeaturizer(fea
+0000f050: 7475 7265 735f 6765 6e65 7261 746f 7273  tures_generators
+0000f060: 3d5b 276d 6f72 6761 6e27 5d29 0a20 2020  =['morgan']).   
+0000f070: 203e 3e3e 2067 7261 7068 203d 2066 6561   >>> graph = fea
+0000f080: 742e 6665 6174 7572 697a 6528 696e 7075  t.featurize(inpu
+0000f090: 745f 736d 696c 6529 0a20 2020 203e 3e3e  t_smile).    >>>
+0000f0a0: 2066 726f 6d20 6465 6570 6368 656d 2e6d   from deepchem.m
+0000f0b0: 6f64 656c 732e 746f 7263 685f 6d6f 6465  odels.torch_mode
+0000f0c0: 6c73 2e64 6d70 6e6e 2069 6d70 6f72 7420  ls.dmpnn import 
+0000f0d0: 5f4d 6170 7065 7244 4d50 4e4e 0a20 2020  _MapperDMPNN.   
+0000f0e0: 203e 3e3e 206d 6170 7065 7220 3d20 5f4d   >>> mapper = _M
+0000f0f0: 6170 7065 7244 4d50 4e4e 2867 7261 7068  apperDMPNN(graph
+0000f100: 5b30 5d29 0a20 2020 203e 3e3e 2061 746f  [0]).    >>> ato
+0000f110: 6d5f 6665 6174 7572 6573 2c20 665f 696e  m_features, f_in
+0000f120: 695f 6174 6f6d 735f 626f 6e64 732c 2061  i_atoms_bonds, a
+0000f130: 746f 6d5f 746f 5f69 6e63 6f6d 696e 675f  tom_to_incoming_
+0000f140: 626f 6e64 732c 206d 6170 7069 6e67 2c20  bonds, mapping, 
+0000f150: 676c 6f62 616c 5f66 6561 7475 7265 7320  global_features 
+0000f160: 3d20 6d61 7070 6572 2e76 616c 7565 730a  = mapper.values.
+0000f170: 2020 2020 3e3e 3e20 6174 6f6d 5f66 6561      >>> atom_fea
+0000f180: 7475 7265 7320 3d20 746f 7263 682e 6672  tures = torch.fr
+0000f190: 6f6d 5f6e 756d 7079 2861 746f 6d5f 6665  om_numpy(atom_fe
+0000f1a0: 6174 7572 6573 292e 666c 6f61 7428 290a  atures).float().
+0000f1b0: 2020 2020 3e3e 3e20 665f 696e 695f 6174      >>> f_ini_at
+0000f1c0: 6f6d 735f 626f 6e64 7320 3d20 746f 7263  oms_bonds = torc
+0000f1d0: 682e 6672 6f6d 5f6e 756d 7079 2866 5f69  h.from_numpy(f_i
+0000f1e0: 6e69 5f61 746f 6d73 5f62 6f6e 6473 292e  ni_atoms_bonds).
+0000f1f0: 666c 6f61 7428 290a 2020 2020 3e3e 3e20  float().    >>> 
+0000f200: 6174 6f6d 5f74 6f5f 696e 636f 6d69 6e67  atom_to_incoming
+0000f210: 5f62 6f6e 6473 203d 2074 6f72 6368 2e66  _bonds = torch.f
+0000f220: 726f 6d5f 6e75 6d70 7928 6174 6f6d 5f74  rom_numpy(atom_t
+0000f230: 6f5f 696e 636f 6d69 6e67 5f62 6f6e 6473  o_incoming_bonds
+0000f240: 290a 2020 2020 3e3e 3e20 6d61 7070 696e  ).    >>> mappin
+0000f250: 6720 3d20 746f 7263 682e 6672 6f6d 5f6e  g = torch.from_n
+0000f260: 756d 7079 286d 6170 7069 6e67 290a 2020  umpy(mapping).  
+0000f270: 2020 3e3e 3e20 676c 6f62 616c 5f66 6561    >>> global_fea
+0000f280: 7475 7265 7320 3d20 746f 7263 682e 6672  tures = torch.fr
+0000f290: 6f6d 5f6e 756d 7079 2867 6c6f 6261 6c5f  om_numpy(global_
+0000f2a0: 6665 6174 7572 6573 292e 666c 6f61 7428  features).float(
+0000f2b0: 290a 2020 2020 3e3e 3e20 6d6f 6c65 6375  ).    >>> molecu
+0000f2c0: 6c65 735f 756e 6261 7463 685f 6b65 7920  les_unbatch_key 
+0000f2d0: 3d20 6c65 6e28 6174 6f6d 5f66 6561 7475  = len(atom_featu
+0000f2e0: 7265 7329 0a20 2020 203e 3e3e 206c 6179  res).    >>> lay
+0000f2f0: 6572 203d 2044 4d50 4e4e 456e 636f 6465  er = DMPNNEncode
+0000f300: 724c 6179 6572 2864 5f68 6964 6465 6e3d  rLayer(d_hidden=
+0000f310: 3229 0a20 2020 203e 3e3e 206f 7574 7075  2).    >>> outpu
+0000f320: 7420 3d20 6c61 7965 7228 6174 6f6d 5f66  t = layer(atom_f
+0000f330: 6561 7475 7265 732c 2066 5f69 6e69 5f61  eatures, f_ini_a
+0000f340: 746f 6d73 5f62 6f6e 6473 2c20 6174 6f6d  toms_bonds, atom
+0000f350: 5f74 6f5f 696e 636f 6d69 6e67 5f62 6f6e  _to_incoming_bon
+0000f360: 6473 2c20 6d61 7070 696e 672c 2067 6c6f  ds, mapping, glo
+0000f370: 6261 6c5f 6665 6174 7572 6573 2c20 6d6f  bal_features, mo
+0000f380: 6c65 6375 6c65 735f 756e 6261 7463 685f  lecules_unbatch_
+0000f390: 6b65 7929 0a20 2020 2022 2222 0a0a 2020  key).    """..  
+0000f3a0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+0000f3b0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+0000f3c0: 2020 2020 2020 7573 655f 6465 6661 756c        use_defaul
+0000f3d0: 745f 6664 696d 3a20 626f 6f6c 203d 2054  t_fdim: bool = T
+0000f3e0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+0000f3f0: 2020 2020 2020 6174 6f6d 5f66 6469 6d3a        atom_fdim:
+0000f400: 2069 6e74 203d 2031 3333 2c0a 2020 2020   int = 133,.    
+0000f410: 2020 2020 2020 2020 2020 2020 2062 6f6e               bon
+0000f420: 645f 6664 696d 3a20 696e 7420 3d20 3134  d_fdim: int = 14
+0000f430: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f440: 2020 2064 5f68 6964 6465 6e3a 2069 6e74     d_hidden: int
+0000f450: 203d 2033 3030 2c0a 2020 2020 2020 2020   = 300,.        
+0000f460: 2020 2020 2020 2020 2064 6570 7468 3a20           depth: 
+0000f470: 696e 7420 3d20 332c 0a20 2020 2020 2020  int = 3,.       
+0000f480: 2020 2020 2020 2020 2020 6269 6173 3a20            bias: 
+0000f490: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+0000f4a0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000f4b0: 6374 6976 6174 696f 6e3a 2073 7472 203d  ctivation: str =
+0000f4c0: 2027 7265 6c75 272c 0a20 2020 2020 2020   'relu',.       
+0000f4d0: 2020 2020 2020 2020 2020 6472 6f70 6f75            dropou
+0000f4e0: 745f 703a 2066 6c6f 6174 203d 2030 2e30  t_p: float = 0.0
+0000f4f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f500: 2020 2061 6767 7265 6761 7469 6f6e 3a20     aggregation: 
+0000f510: 7374 7220 3d20 276d 6561 6e27 2c0a 2020  str = 'mean',.  
+0000f520: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000f530: 6767 7265 6761 7469 6f6e 5f6e 6f72 6d3a  ggregation_norm:
+0000f540: 2055 6e69 6f6e 5b69 6e74 2c20 666c 6f61   Union[int, floa
+0000f550: 745d 203d 2031 3030 293a 0a20 2020 2020  t] = 100):.     
+0000f560: 2020 2022 2222 496e 6974 6961 6c69 7a65     """Initialize
+0000f570: 2061 2044 4d50 4e4e 456e 636f 6465 724c   a DMPNNEncoderL
+0000f580: 6179 6572 206c 6179 6572 2e0a 0a20 2020  ayer layer...   
+0000f590: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+0000f5a0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0000f5b0: 2d2d 0a20 2020 2020 2020 2075 7365 5f64  --.        use_d
+0000f5c0: 6566 6175 6c74 5f66 6469 6d3a 2062 6f6f  efault_fdim: boo
+0000f5d0: 6c0a 2020 2020 2020 2020 2020 2020 4966  l.            If
+0000f5e0: 2060 6054 7275 6560 602c 2060 6073 656c   ``True``, ``sel
+0000f5f0: 662e 6174 6f6d 5f66 6469 6d60 6020 616e  f.atom_fdim`` an
+0000f600: 6420 6060 7365 6c66 2e62 6f6e 645f 6664  d ``self.bond_fd
+0000f610: 696d 6060 2061 7265 2069 6e69 7469 616c  im`` are initial
+0000f620: 697a 6564 2075 7369 6e67 2076 616c 7565  ized using value
+0000f630: 7320 6672 6f6d 2074 6865 2047 7261 7068  s from the Graph
+0000f640: 436f 6e76 436f 6e73 7461 6e74 7320 636c  ConvConstants cl
+0000f650: 6173 732e 2049 6620 6060 4661 6c73 6560  ass. If ``False`
+0000f660: 602c 2060 6073 656c 662e 6174 6f6d 5f66  `, ``self.atom_f
+0000f670: 6469 6d60 6020 616e 6420 6060 7365 6c66  dim`` and ``self
+0000f680: 2e62 6f6e 645f 6664 696d 6060 2061 7265  .bond_fdim`` are
+0000f690: 2069 6e69 7469 616c 697a 6564 2066 726f   initialized fro
+0000f6a0: 6d20 7468 6520 7661 6c75 6573 2070 726f  m the values pro
+0000f6b0: 7669 6465 642e 0a20 2020 2020 2020 2061  vided..        a
+0000f6c0: 746f 6d5f 6664 696d 3a20 696e 740a 2020  tom_fdim: int.  
+0000f6d0: 2020 2020 2020 2020 2020 4469 6d65 6e73            Dimens
+0000f6e0: 696f 6e20 6f66 2061 746f 6d20 6665 6174  ion of atom feat
+0000f6f0: 7572 6520 7665 6374 6f72 2e0a 2020 2020  ure vector..    
+0000f700: 2020 2020 626f 6e64 5f66 6469 6d3a 2069      bond_fdim: i
+0000f710: 6e74 0a20 2020 2020 2020 2020 2020 2044  nt.            D
+0000f720: 696d 656e 7369 6f6e 206f 6620 626f 6e64  imension of bond
+0000f730: 2066 6561 7475 7265 2076 6563 746f 722e   feature vector.
+0000f740: 0a20 2020 2020 2020 2064 5f68 6964 6465  .        d_hidde
+0000f750: 6e3a 2069 6e74 0a20 2020 2020 2020 2020  n: int.         
+0000f760: 2020 2053 697a 6520 6f66 2068 6964 6465     Size of hidde
+0000f770: 6e20 6c61 7965 7220 696e 2074 6865 2065  n layer in the e
+0000f780: 6e63 6f64 6572 206c 6179 6572 2e0a 2020  ncoder layer..  
+0000f790: 2020 2020 2020 6465 7074 683a 2069 6e74        depth: int
+0000f7a0: 0a20 2020 2020 2020 2020 2020 204e 6f20  .            No 
+0000f7b0: 6f66 206d 6573 7361 6765 2070 6173 7369  of message passi
+0000f7c0: 6e67 2073 7465 7073 2e0a 2020 2020 2020  ng steps..      
+0000f7d0: 2020 6269 6173 3a20 626f 6f6c 0a20 2020    bias: bool.   
+0000f7e0: 2020 2020 2020 2020 2049 6620 6060 5472           If ``Tr
+0000f7f0: 7565 6060 2c20 6465 6e73 6520 6c61 7965  ue``, dense laye
+0000f800: 7273 2077 696c 6c20 7573 6520 6269 6173  rs will use bias
+0000f810: 2076 6563 746f 7273 2e0a 2020 2020 2020   vectors..      
+0000f820: 2020 6163 7469 7661 7469 6f6e 3a20 7374    activation: st
+0000f830: 720a 2020 2020 2020 2020 2020 2020 4163  r.            Ac
+0000f840: 7469 7661 7469 6f6e 2066 756e 6374 696f  tivation functio
+0000f850: 6e20 746f 2062 6520 7573 6564 2069 6e20  n to be used in 
+0000f860: 7468 6520 656e 636f 6465 7220 6c61 7965  the encoder laye
+0000f870: 722e 0a20 2020 2020 2020 2020 2020 2043  r..            C
+0000f880: 616e 2063 686f 6f73 6520 6265 7477 6565  an choose betwee
+0000f890: 6e20 2772 656c 7527 2066 6f72 2052 654c  n 'relu' for ReL
+0000f8a0: 552c 2027 6c65 616b 7972 656c 7527 2066  U, 'leakyrelu' f
+0000f8b0: 6f72 204c 6561 6b79 5265 4c55 2c20 2770  or LeakyReLU, 'p
+0000f8c0: 7265 6c75 2720 666f 7220 5052 654c 552c  relu' for PReLU,
+0000f8d0: 0a20 2020 2020 2020 2020 2020 2027 7461  .            'ta
+0000f8e0: 6e68 2720 666f 7220 5461 6e48 2c20 2773  nh' for TanH, 's
+0000f8f0: 656c 7527 2066 6f72 2053 454c 552c 2061  elu' for SELU, a
+0000f900: 6e64 2027 656c 7527 2066 6f72 2045 4c55  nd 'elu' for ELU
+0000f910: 2e0a 2020 2020 2020 2020 6472 6f70 6f75  ..        dropou
+0000f920: 745f 703a 2066 6c6f 6174 0a20 2020 2020  t_p: float.     
+0000f930: 2020 2020 2020 2044 726f 706f 7574 2070         Dropout p
+0000f940: 726f 6261 6269 6c69 7479 2066 6f72 2074  robability for t
+0000f950: 6865 2065 6e63 6f64 6572 206c 6179 6572  he encoder layer
+0000f960: 2e0a 2020 2020 2020 2020 6167 6772 6567  ..        aggreg
+0000f970: 6174 696f 6e3a 2073 7472 0a20 2020 2020  ation: str.     
+0000f980: 2020 2020 2020 2041 6767 7265 6761 7469         Aggregati
+0000f990: 6f6e 2074 7970 6520 746f 2062 6520 7573  on type to be us
+0000f9a0: 6564 2069 6e20 7468 6520 656e 636f 6465  ed in the encode
+0000f9b0: 7220 6c61 7965 722e 0a20 2020 2020 2020  r layer..       
+0000f9c0: 2020 2020 2043 616e 2063 686f 6f73 6520       Can choose 
+0000f9d0: 6265 7477 6565 6e20 276d 6561 6e27 2c20  between 'mean', 
+0000f9e0: 2773 756d 272c 2061 6e64 2027 6e6f 726d  'sum', and 'norm
+0000f9f0: 272e 0a20 2020 2020 2020 2061 6767 7265  '..        aggre
+0000fa00: 6761 7469 6f6e 5f6e 6f72 6d3a 2055 6e69  gation_norm: Uni
+0000fa10: 6f6e 5b69 6e74 2c20 666c 6f61 745d 0a20  on[int, float]. 
+0000fa20: 2020 2020 2020 2020 2020 2056 616c 7565             Value
+0000fa30: 2072 6571 7569 7265 6420 6966 2060 6167   required if `ag
+0000fa40: 6772 6567 6174 696f 6e60 2074 7970 6520  gregation` type 
+0000fa50: 6973 2027 6e6f 726d 272e 0a20 2020 2020  is 'norm'..     
+0000fa60: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+0000fa70: 7570 6572 2844 4d50 4e4e 456e 636f 6465  uper(DMPNNEncode
+0000fa80: 724c 6179 6572 2c20 7365 6c66 292e 5f5f  rLayer, self).__
+0000fa90: 696e 6974 5f5f 2829 0a0a 2020 2020 2020  init__()..      
+0000faa0: 2020 6966 2075 7365 5f64 6566 6175 6c74    if use_default
+0000fab0: 5f66 6469 6d3a 0a20 2020 2020 2020 2020  _fdim:.         
+0000fac0: 2020 2066 726f 6d20 6465 6570 6368 656d     from deepchem
+0000fad0: 2e66 6561 742e 6d6f 6c65 6375 6c65 5f66  .feat.molecule_f
+0000fae0: 6561 7475 7269 7a65 7273 2e64 6d70 6e6e  eaturizers.dmpnn
+0000faf0: 5f66 6561 7475 7269 7a65 7220 696d 706f  _featurizer impo
+0000fb00: 7274 2047 7261 7068 436f 6e76 436f 6e73  rt GraphConvCons
+0000fb10: 7461 6e74 730a 2020 2020 2020 2020 2020  tants.          
+0000fb20: 2020 7365 6c66 2e61 746f 6d5f 6664 696d    self.atom_fdim
+0000fb30: 3a20 696e 7420 3d20 4772 6170 6843 6f6e  : int = GraphCon
+0000fb40: 7643 6f6e 7374 616e 7473 2e41 544f 4d5f  vConstants.ATOM_
+0000fb50: 4644 494d 0a20 2020 2020 2020 2020 2020  FDIM.           
+0000fb60: 2073 656c 662e 636f 6e63 6174 5f66 6469   self.concat_fdi
+0000fb70: 6d3a 2069 6e74 203d 2047 7261 7068 436f  m: int = GraphCo
+0000fb80: 6e76 436f 6e73 7461 6e74 732e 4154 4f4d  nvConstants.ATOM
+0000fb90: 5f46 4449 4d20 2b20 4772 6170 6843 6f6e  _FDIM + GraphCon
+0000fba0: 7643 6f6e 7374 616e 7473 2e42 4f4e 445f  vConstants.BOND_
+0000fbb0: 4644 494d 0a20 2020 2020 2020 2065 6c73  FDIM.        els
+0000fbc0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+0000fbd0: 656c 662e 6174 6f6d 5f66 6469 6d20 3d20  elf.atom_fdim = 
+0000fbe0: 6174 6f6d 5f66 6469 6d0a 2020 2020 2020  atom_fdim.      
+0000fbf0: 2020 2020 2020 7365 6c66 2e63 6f6e 6361        self.conca
+0000fc00: 745f 6664 696d 203d 2061 746f 6d5f 6664  t_fdim = atom_fd
+0000fc10: 696d 202b 2062 6f6e 645f 6664 696d 0a0a  im + bond_fdim..
+0000fc20: 2020 2020 2020 2020 7365 6c66 2e64 6570          self.dep
+0000fc30: 7468 3a20 696e 7420 3d20 6465 7074 680a  th: int = depth.
+0000fc40: 2020 2020 2020 2020 7365 6c66 2e61 6767          self.agg
+0000fc50: 7265 6761 7469 6f6e 3a20 7374 7220 3d20  regation: str = 
+0000fc60: 6167 6772 6567 6174 696f 6e0a 2020 2020  aggregation.    
+0000fc70: 2020 2020 7365 6c66 2e61 6767 7265 6761      self.aggrega
+0000fc80: 7469 6f6e 5f6e 6f72 6d3a 2055 6e69 6f6e  tion_norm: Union
+0000fc90: 5b69 6e74 2c20 666c 6f61 745d 203d 2061  [int, float] = a
+0000fca0: 6767 7265 6761 7469 6f6e 5f6e 6f72 6d0a  ggregation_norm.
+0000fcb0: 0a20 2020 2020 2020 2069 6620 6163 7469  .        if acti
+0000fcc0: 7661 7469 6f6e 203d 3d20 2772 656c 7527  vation == 'relu'
+0000fcd0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000fce0: 6c66 2e61 6374 6976 6174 696f 6e3a 206e  lf.activation: n
+0000fcf0: 6e2e 6d6f 6475 6c65 732e 6163 7469 7661  n.modules.activa
+0000fd00: 7469 6f6e 2e4d 6f64 756c 6520 3d20 6e6e  tion.Module = nn
+0000fd10: 2e52 654c 5528 290a 0a20 2020 2020 2020  .ReLU()..       
+0000fd20: 2065 6c69 6620 6163 7469 7661 7469 6f6e   elif activation
+0000fd30: 203d 3d20 276c 6561 6b79 7265 6c75 273a   == 'leakyrelu':
+0000fd40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000fd50: 662e 6163 7469 7661 7469 6f6e 203d 206e  f.activation = n
+0000fd60: 6e2e 4c65 616b 7952 654c 5528 302e 3129  n.LeakyReLU(0.1)
+0000fd70: 0a0a 2020 2020 2020 2020 656c 6966 2061  ..        elif a
+0000fd80: 6374 6976 6174 696f 6e20 3d3d 2027 7072  ctivation == 'pr
+0000fd90: 656c 7527 3a0a 2020 2020 2020 2020 2020  elu':.          
+0000fda0: 2020 7365 6c66 2e61 6374 6976 6174 696f    self.activatio
+0000fdb0: 6e20 3d20 6e6e 2e50 5265 4c55 2829 0a0a  n = nn.PReLU()..
+0000fdc0: 2020 2020 2020 2020 656c 6966 2061 6374          elif act
+0000fdd0: 6976 6174 696f 6e20 3d3d 2027 7461 6e68  ivation == 'tanh
+0000fde0: 273a 0a20 2020 2020 2020 2020 2020 2073  ':.            s
+0000fdf0: 656c 662e 6163 7469 7661 7469 6f6e 203d  elf.activation =
+0000fe00: 206e 6e2e 5461 6e68 2829 0a0a 2020 2020   nn.Tanh()..    
+0000fe10: 2020 2020 656c 6966 2061 6374 6976 6174      elif activat
+0000fe20: 696f 6e20 3d3d 2027 7365 6c75 273a 0a20  ion == 'selu':. 
+0000fe30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000fe40: 6163 7469 7661 7469 6f6e 203d 206e 6e2e  activation = nn.
+0000fe50: 5345 4c55 2829 0a0a 2020 2020 2020 2020  SELU()..        
+0000fe60: 656c 6966 2061 6374 6976 6174 696f 6e20  elif activation 
+0000fe70: 3d3d 2027 656c 7527 3a0a 2020 2020 2020  == 'elu':.      
+0000fe80: 2020 2020 2020 7365 6c66 2e61 6374 6976        self.activ
+0000fe90: 6174 696f 6e20 3d20 6e6e 2e45 4c55 2829  ation = nn.ELU()
+0000fea0: 0a0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+0000feb0: 726f 706f 7574 3a20 6e6e 2e6d 6f64 756c  ropout: nn.modul
+0000fec0: 6573 2e64 726f 706f 7574 2e4d 6f64 756c  es.dropout.Modul
+0000fed0: 6520 3d20 6e6e 2e44 726f 706f 7574 2864  e = nn.Dropout(d
+0000fee0: 726f 706f 7574 5f70 290a 0a20 2020 2020  ropout_p)..     
+0000fef0: 2020 2023 2049 6e70 7574 0a20 2020 2020     # Input.     
+0000ff00: 2020 2073 656c 662e 575f 693a 206e 6e2e     self.W_i: nn.
+0000ff10: 4c69 6e65 6172 203d 206e 6e2e 4c69 6e65  Linear = nn.Line
+0000ff20: 6172 2873 656c 662e 636f 6e63 6174 5f66  ar(self.concat_f
+0000ff30: 6469 6d2c 2064 5f68 6964 6465 6e2c 2062  dim, d_hidden, b
+0000ff40: 6961 733d 6269 6173 290a 0a20 2020 2020  ias=bias)..     
+0000ff50: 2020 2023 2053 6861 7265 6420 7765 6967     # Shared weig
+0000ff60: 6874 206d 6174 7269 7820 6163 726f 7373  ht matrix across
+0000ff70: 2064 6570 7468 7320 2864 6566 6175 6c74   depths (default
+0000ff80: 293a 0a20 2020 2020 2020 2023 2046 6f72  ):.        # For
+0000ff90: 206d 6573 7361 6765 7320 6869 6464 656e   messages hidden
+0000ffa0: 2073 7461 7465 730a 2020 2020 2020 2020   states.        
+0000ffb0: 7365 6c66 2e57 5f68 3a20 6e6e 2e4c 696e  self.W_h: nn.Lin
+0000ffc0: 6561 7220 3d20 6e6e 2e4c 696e 6561 7228  ear = nn.Linear(
+0000ffd0: 645f 6869 6464 656e 2c20 645f 6869 6464  d_hidden, d_hidd
+0000ffe0: 656e 2c20 6269 6173 3d62 6961 7329 0a0a  en, bias=bias)..
+0000fff0: 2020 2020 2020 2020 2320 466f 7220 6174          # For at
+00010000: 6f6d 2068 6964 6465 6e20 7374 6174 6573  om hidden states
+00010010: 0a20 2020 2020 2020 2073 656c 662e 575f  .        self.W_
+00010020: 6f3a 206e 6e2e 4c69 6e65 6172 203d 206e  o: nn.Linear = n
+00010030: 6e2e 4c69 6e65 6172 2873 656c 662e 6174  n.Linear(self.at
+00010040: 6f6d 5f66 6469 6d20 2b20 645f 6869 6464  om_fdim + d_hidd
+00010050: 656e 2c20 645f 6869 6464 656e 290a 0a20  en, d_hidden).. 
+00010060: 2020 2064 6566 205f 6765 745f 7570 6461     def _get_upda
+00010070: 7465 645f 6174 6f6d 735f 6869 6464 656e  ted_atoms_hidden
+00010080: 5f73 7461 7465 280a 2020 2020 2020 2020  _state(.        
+00010090: 2020 2020 7365 6c66 2c20 6174 6f6d 5f66      self, atom_f
+000100a0: 6561 7475 7265 733a 2074 6f72 6368 2e54  eatures: torch.T
+000100b0: 656e 736f 722c 2068 5f6d 6573 7361 6765  ensor, h_message
+000100c0: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
+000100d0: 2020 2020 2020 2020 2020 2020 6174 6f6d              atom
+000100e0: 5f74 6f5f 696e 636f 6d69 6e67 5f62 6f6e  _to_incoming_bon
+000100f0: 6473 3a20 746f 7263 682e 5465 6e73 6f72  ds: torch.Tensor
+00010100: 2920 2d3e 2074 6f72 6368 2e54 656e 736f  ) -> torch.Tenso
+00010110: 723a 0a20 2020 2020 2020 2022 2222 0a20  r:.        """. 
+00010120: 2020 2020 2020 204d 6574 686f 6420 746f         Method to
+00010130: 2063 6f6d 7075 7465 2061 746f 6d20 6869   compute atom hi
+00010140: 6464 656e 2073 7461 7465 732e 0a0a 2020  dden states...  
+00010150: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00010160: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00010170: 2d2d 2d0a 2020 2020 2020 2020 6174 6f6d  ---.        atom
+00010180: 5f66 6561 7475 7265 733a 2074 6f72 6368  _features: torch
+00010190: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+000101a0: 2020 2020 5465 6e73 6f72 2063 6f6e 7461      Tensor conta
+000101b0: 696e 696e 6720 6174 6f6d 7320 6665 6174  ining atoms feat
+000101c0: 7572 6573 2e0a 2020 2020 2020 2020 685f  ures..        h_
+000101d0: 6d65 7373 6167 653a 2074 6f72 6368 2e54  message: torch.T
+000101e0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+000101f0: 2020 5465 6e73 6f72 2063 6f6e 7461 696e    Tensor contain
+00010200: 696e 6720 6869 6464 656e 2073 7461 7465  ing hidden state
+00010210: 7320 6f66 206d 6573 7361 6765 732e 0a20  s of messages.. 
+00010220: 2020 2020 2020 2061 746f 6d5f 746f 5f69         atom_to_i
+00010230: 6e63 6f6d 696e 675f 626f 6e64 733a 2074  ncoming_bonds: t
+00010240: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+00010250: 2020 2020 2020 2020 5465 6e73 6f72 2063          Tensor c
+00010260: 6f6e 7461 696e 696e 6720 6d61 7070 696e  ontaining mappin
+00010270: 6720 6672 6f6d 2061 746f 6d20 696e 6465  g from atom inde
+00010280: 7820 746f 206c 6973 7420 6f66 2069 6e64  x to list of ind
+00010290: 6963 6965 7320 6f66 2069 6e63 6f6d 696e  icies of incomin
+000102a0: 6720 626f 6e64 732e 0a0a 2020 2020 2020  g bonds...      
+000102b0: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+000102c0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+000102d0: 2020 6174 6f6d 735f 6869 6464 656e 5f73    atoms_hidden_s
+000102e0: 7461 7465 733a 2074 6f72 6368 2e54 656e  tates: torch.Ten
+000102f0: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+00010300: 5465 6e73 6f72 2063 6f6e 7461 696e 696e  Tensor containin
+00010310: 6720 6174 6f6d 2068 6964 6465 6e20 7374  g atom hidden st
+00010320: 6174 6573 2e0a 2020 2020 2020 2020 2222  ates..        ""
+00010330: 220a 2020 2020 2020 2020 6d65 7373 6167  ".        messag
+00010340: 6573 5f74 6f5f 6174 6f6d 733a 2074 6f72  es_to_atoms: tor
+00010350: 6368 2e54 656e 736f 7220 3d20 685f 6d65  ch.Tensor = h_me
+00010360: 7373 6167 655b 6174 6f6d 5f74 6f5f 696e  ssage[atom_to_in
+00010370: 636f 6d69 6e67 5f62 6f6e 6473 5d2e 7375  coming_bonds].su
+00010380: 6d28 0a20 2020 2020 2020 2020 2020 2031  m(.            1
+00010390: 2920 2023 206e 756d 5f61 746f 6d73 2078  )  # num_atoms x
+000103a0: 2068 6964 6465 6e5f 7369 7a65 0a20 2020   hidden_size.   
+000103b0: 2020 2020 2061 746f 6d73 5f68 6964 6465       atoms_hidde
+000103c0: 6e5f 7374 6174 6573 3a20 746f 7263 682e  n_states: torch.
+000103d0: 5465 6e73 6f72 203d 2073 656c 662e 575f  Tensor = self.W_
+000103e0: 6f28 0a20 2020 2020 2020 2020 2020 2074  o(.            t
+000103f0: 6f72 6368 2e63 6174 2828 6174 6f6d 5f66  orch.cat((atom_f
+00010400: 6561 7475 7265 732c 206d 6573 7361 6765  eatures, message
+00010410: 735f 746f 5f61 746f 6d73 292c 0a20 2020  s_to_atoms),.   
+00010420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010430: 2020 2031 2929 2020 2320 6e75 6d5f 6174     1))  # num_at
+00010440: 6f6d 7320 7820 6869 6464 656e 5f73 697a  oms x hidden_siz
+00010450: 650a 2020 2020 2020 2020 6174 6f6d 735f  e.        atoms_
+00010460: 6869 6464 656e 5f73 7461 7465 7320 3d20  hidden_states = 
+00010470: 7365 6c66 2e61 6374 6976 6174 696f 6e28  self.activation(
+00010480: 0a20 2020 2020 2020 2020 2020 2061 746f  .            ato
+00010490: 6d73 5f68 6964 6465 6e5f 7374 6174 6573  ms_hidden_states
+000104a0: 2920 2023 206e 756d 5f61 746f 6d73 2078  )  # num_atoms x
+000104b0: 2068 6964 6465 6e5f 7369 7a65 0a20 2020   hidden_size.   
+000104c0: 2020 2020 2061 746f 6d73 5f68 6964 6465       atoms_hidde
+000104d0: 6e5f 7374 6174 6573 203d 2073 656c 662e  n_states = self.
+000104e0: 6472 6f70 6f75 7428 0a20 2020 2020 2020  dropout(.       
+000104f0: 2020 2020 2061 746f 6d73 5f68 6964 6465       atoms_hidde
+00010500: 6e5f 7374 6174 6573 2920 2023 206e 756d  n_states)  # num
+00010510: 5f61 746f 6d73 2078 2068 6964 6465 6e5f  _atoms x hidden_
+00010520: 7369 7a65 0a20 2020 2020 2020 2072 6574  size.        ret
+00010530: 7572 6e20 6174 6f6d 735f 6869 6464 656e  urn atoms_hidden
+00010540: 5f73 7461 7465 7320 2023 206e 756d 5f61  _states  # num_a
+00010550: 746f 6d73 2078 2068 6964 6465 6e5f 7369  toms x hidden_si
+00010560: 7a65 0a0a 2020 2020 6465 6620 5f72 6561  ze..    def _rea
+00010570: 646f 7574 2873 656c 662c 2061 746f 6d73  dout(self, atoms
+00010580: 5f68 6964 6465 6e5f 7374 6174 6573 3a20  _hidden_states: 
+00010590: 746f 7263 682e 5465 6e73 6f72 2c0a 2020  torch.Tensor,.  
+000105a0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000105b0: 6f6c 6563 756c 6573 5f75 6e62 6174 6368  olecules_unbatch
+000105c0: 5f6b 6579 3a20 4c69 7374 2920 2d3e 2074  _key: List) -> t
+000105d0: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
+000105e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000105f0: 204d 6574 686f 6420 746f 2065 7865 6375   Method to execu
+00010600: 7465 2074 6865 2072 6561 646f 7574 2070  te the readout p
+00010610: 6861 7365 2e20 2863 6f6d 7075 7465 206d  hase. (compute m
+00010620: 6f6c 6563 756c 6573 2065 6e63 6f64 696e  olecules encodin
+00010630: 6773 2066 726f 6d20 6174 6f6d 2068 6964  gs from atom hid
+00010640: 6465 6e20 7374 6174 6573 290a 0a20 2020  den states)..   
+00010650: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00010660: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00010670: 2d2d 0a20 2020 2020 2020 2061 746f 6d73  --.        atoms
+00010680: 5f68 6964 6465 6e5f 7374 6174 6573 3a20  _hidden_states: 
+00010690: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+000106a0: 2020 2020 2020 2020 2054 656e 736f 7220           Tensor 
+000106b0: 636f 6e74 6169 6e69 6e67 2061 746f 6d20  containing atom 
+000106c0: 6869 6464 656e 2073 7461 7465 732e 0a20  hidden states.. 
+000106d0: 2020 2020 2020 206d 6f6c 6563 756c 6573         molecules
+000106e0: 5f75 6e62 6174 6368 5f6b 6579 3a20 4c69  _unbatch_key: Li
+000106f0: 7374 0a20 2020 2020 2020 2020 2020 204c  st.            L
+00010700: 6973 7420 636f 6e74 6169 6e69 6e67 206e  ist containing n
+00010710: 756d 6265 7220 6f66 2061 746f 6d73 2069  umber of atoms i
+00010720: 6e20 7661 7269 6f75 7320 6d6f 6c65 6375  n various molecu
+00010730: 6c65 7320 6f66 2061 2062 6174 6368 0a0a  les of a batch..
+00010740: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00010750: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+00010760: 2020 2020 2020 2020 6d6f 6c65 6375 6c65          molecule
+00010770: 5f68 6964 6465 6e5f 7374 6174 653a 2074  _hidden_state: t
+00010780: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+00010790: 2020 2020 2020 2020 5465 6e73 6f72 2063          Tensor c
+000107a0: 6f6e 7461 696e 696e 6720 6d6f 6c65 6375  ontaining molecu
+000107b0: 6c65 2065 6e63 6f64 696e 6773 2e0a 2020  le encodings..  
+000107c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000107d0: 2020 6d6f 6c5f 7665 6373 3a20 4c69 7374    mol_vecs: List
+000107e0: 203d 205b 5d0a 2020 2020 2020 2020 6174   = [].        at
+000107f0: 6f6d 735f 6869 6464 656e 5f73 7461 7465  oms_hidden_state
+00010800: 735f 7370 6c69 743a 2053 6571 7565 6e63  s_split: Sequenc
+00010810: 655b 5465 6e73 6f72 5d20 3d20 746f 7263  e[Tensor] = torc
+00010820: 682e 7370 6c69 7428 0a20 2020 2020 2020  h.split(.       
+00010830: 2020 2020 2061 746f 6d73 5f68 6964 6465       atoms_hidde
+00010840: 6e5f 7374 6174 6573 2c20 6d6f 6c65 6375  n_states, molecu
+00010850: 6c65 735f 756e 6261 7463 685f 6b65 7929  les_unbatch_key)
+00010860: 0a20 2020 2020 2020 206d 6f6c 5f76 6563  .        mol_vec
+00010870: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
+00010880: 2020 2020 2020 2066 6f72 206d 6f6c 5f76         for mol_v
+00010890: 6563 2069 6e20 6174 6f6d 735f 6869 6464  ec in atoms_hidd
+000108a0: 656e 5f73 7461 7465 735f 7370 6c69 743a  en_states_split:
+000108b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000108c0: 7365 6c66 2e61 6767 7265 6761 7469 6f6e  self.aggregation
+000108d0: 203d 3d20 276d 6561 6e27 3a0a 2020 2020   == 'mean':.    
+000108e0: 2020 2020 2020 2020 2020 2020 6d6f 6c5f              mol_
+000108f0: 7665 6320 3d20 6d6f 6c5f 7665 632e 7375  vec = mol_vec.su
+00010900: 6d28 6469 6d3d 3029 202f 206c 656e 286d  m(dim=0) / len(m
+00010910: 6f6c 5f76 6563 290a 2020 2020 2020 2020  ol_vec).        
+00010920: 2020 2020 656c 6966 2073 656c 662e 6167      elif self.ag
+00010930: 6772 6567 6174 696f 6e20 3d3d 2027 7375  gregation == 'su
+00010940: 6d27 3a0a 2020 2020 2020 2020 2020 2020  m':.            
+00010950: 2020 2020 6d6f 6c5f 7665 6320 3d20 6d6f      mol_vec = mo
+00010960: 6c5f 7665 632e 7375 6d28 6469 6d3d 3029  l_vec.sum(dim=0)
+00010970: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00010980: 6620 7365 6c66 2e61 6767 7265 6761 7469  f self.aggregati
+00010990: 6f6e 203d 3d20 276e 6f72 6d27 3a0a 2020  on == 'norm':.  
+000109a0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+000109b0: 6c5f 7665 6320 3d20 6d6f 6c5f 7665 632e  l_vec = mol_vec.
+000109c0: 7375 6d28 6469 6d3d 3029 202f 2073 656c  sum(dim=0) / sel
+000109d0: 662e 6167 6772 6567 6174 696f 6e5f 6e6f  f.aggregation_no
+000109e0: 726d 0a20 2020 2020 2020 2020 2020 2065  rm.            e
+000109f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00010a00: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+00010a10: 7469 6f6e 2822 496e 7661 6c69 6420 6167  tion("Invalid ag
+00010a20: 6772 6567 6174 696f 6e22 290a 2020 2020  gregation").    
+00010a30: 2020 2020 2020 2020 6d6f 6c5f 7665 6373          mol_vecs
+00010a40: 2e61 7070 656e 6428 6d6f 6c5f 7665 6329  .append(mol_vec)
+00010a50: 0a0a 2020 2020 2020 2020 6d6f 6c65 6375  ..        molecu
+00010a60: 6c65 5f68 6964 6465 6e5f 7374 6174 653a  le_hidden_state:
+00010a70: 2074 6f72 6368 2e54 656e 736f 7220 3d20   torch.Tensor = 
+00010a80: 746f 7263 682e 7374 6163 6b28 6d6f 6c5f  torch.stack(mol_
+00010a90: 7665 6373 2c20 6469 6d3d 3029 0a20 2020  vecs, dim=0).   
+00010aa0: 2020 2020 2072 6574 7572 6e20 6d6f 6c65       return mole
+00010ab0: 6375 6c65 5f68 6964 6465 6e5f 7374 6174  cule_hidden_stat
+00010ac0: 6520 2023 206e 756d 5f6d 6f6c 6563 756c  e  # num_molecul
+00010ad0: 6573 2078 2068 6964 6465 6e5f 7369 7a65  es x hidden_size
+00010ae0: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
+00010af0: 6428 7365 6c66 2c20 6174 6f6d 5f66 6561  d(self, atom_fea
+00010b00: 7475 7265 733a 2074 6f72 6368 2e54 656e  tures: torch.Ten
+00010b10: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
+00010b20: 2020 2020 2066 5f69 6e69 5f61 746f 6d73       f_ini_atoms
+00010b30: 5f62 6f6e 6473 3a20 746f 7263 682e 5465  _bonds: torch.Te
+00010b40: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
+00010b50: 2020 2020 2020 6174 6f6d 5f74 6f5f 696e        atom_to_in
+00010b60: 636f 6d69 6e67 5f62 6f6e 6473 3a20 746f  coming_bonds: to
+00010b70: 7263 682e 5465 6e73 6f72 2c20 6d61 7070  rch.Tensor, mapp
+00010b80: 696e 673a 2074 6f72 6368 2e54 656e 736f  ing: torch.Tenso
+00010b90: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00010ba0: 2020 2067 6c6f 6261 6c5f 6665 6174 7572     global_featur
+00010bb0: 6573 3a20 746f 7263 682e 5465 6e73 6f72  es: torch.Tensor
+00010bc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010bd0: 2020 6d6f 6c65 6375 6c65 735f 756e 6261    molecules_unba
+00010be0: 7463 685f 6b65 793a 204c 6973 7429 202d  tch_key: List) -
+00010bf0: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
+00010c00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010c10: 2020 2020 4f75 7470 7574 2063 6f6d 7075      Output compu
+00010c20: 7461 7469 6f6e 2066 6f72 2074 6865 2044  tation for the D
+00010c30: 4d50 4e4e 456e 636f 6465 724c 6179 6572  MPNNEncoderLayer
+00010c40: 2e0a 0a20 2020 2020 2020 2053 7465 7073  ...        Steps
+00010c50: 3a0a 0a20 2020 2020 2020 202d 2047 6574  :..        - Get
+00010c60: 206f 7269 6769 6e61 6c20 626f 6e64 2068   original bond h
+00010c70: 6964 6465 6e20 7374 6174 6573 2066 726f  idden states fro
+00010c80: 6d20 636f 6e63 6174 656e 6174 696f 6e20  m concatenation 
+00010c90: 6f66 2069 6e69 7469 616c 2061 746f 6d20  of initial atom 
+00010ca0: 616e 6420 626f 6e64 2066 6561 7475 7265  and bond feature
+00010cb0: 732e 2028 6060 696e 7075 7460 6029 0a20  s. (``input``). 
+00010cc0: 2020 2020 2020 202d 2047 6574 2069 6e69         - Get ini
+00010cd0: 7469 616c 206d 6573 7361 6765 7320 6869  tial messages hi
+00010ce0: 6464 656e 2073 7461 7465 732e 2028 6060  dden states. (``
+00010cf0: 6d65 7373 6167 6560 6029 0a20 2020 2020  message``).     
+00010d00: 2020 202d 2045 7865 6375 7465 206d 6573     - Execute mes
+00010d10: 7361 6765 2070 6173 7369 6e67 2073 7465  sage passing ste
+00010d20: 7020 666f 7220 6060 7365 6c66 2e64 6570  p for ``self.dep
+00010d30: 7468 202d 2031 6060 2069 7465 7261 7469  th - 1`` iterati
+00010d40: 6f6e 732e 0a20 2020 2020 2020 202d 2047  ons..        - G
+00010d50: 6574 2061 746f 6d20 6869 6464 656e 2073  et atom hidden s
+00010d60: 7461 7465 7320 7573 696e 6720 6174 6f6d  tates using atom
+00010d70: 2066 6561 7475 7265 7320 616e 6420 6d65   features and me
+00010d80: 7373 6167 6520 6869 6464 656e 2073 7461  ssage hidden sta
+00010d90: 7465 732e 0a20 2020 2020 2020 202d 2047  tes..        - G
+00010da0: 6574 206d 6f6c 6563 756c 6520 656e 636f  et molecule enco
+00010db0: 6469 6e67 732e 0a20 2020 2020 2020 202d  dings..        -
+00010dc0: 2043 6f6e 6361 7465 6e61 7465 2067 6c6f   Concatenate glo
+00010dd0: 6261 6c20 6d6f 6c65 6375 6c61 7220 6665  bal molecular fe
+00010de0: 6174 7572 6573 2061 6e64 206d 6f6c 6563  atures and molec
+00010df0: 756c 6520 656e 636f 6469 6e67 732e 0a0a  ule encodings...
+00010e00: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00010e10: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00010e20: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6174  -----.        at
+00010e30: 6f6d 5f66 6561 7475 7265 733a 2074 6f72  om_features: tor
+00010e40: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+00010e50: 2020 2020 2020 5465 6e73 6f72 2063 6f6e        Tensor con
+00010e60: 7461 696e 696e 6720 6174 6f6d 7320 6665  taining atoms fe
+00010e70: 6174 7572 6573 2e0a 2020 2020 2020 2020  atures..        
+00010e80: 665f 696e 695f 6174 6f6d 735f 626f 6e64  f_ini_atoms_bond
+00010e90: 733a 2074 6f72 6368 2e54 656e 736f 720a  s: torch.Tensor.
+00010ea0: 2020 2020 2020 2020 2020 2020 5465 6e73              Tens
+00010eb0: 6f72 2063 6f6e 7461 696e 696e 6720 636f  or containing co
+00010ec0: 6e63 6174 656e 6174 6564 2066 6561 7475  ncatenated featu
+00010ed0: 7265 2076 6563 746f 7220 7768 6963 6820  re vector which 
+00010ee0: 636f 6e74 6169 6e73 2063 6f6e 6361 7465  contains concate
+00010ef0: 6e61 7469 6f6e 206f 6620 696e 6974 6961  nation of initia
+00010f00: 6c20 6174 6f6d 2061 6e64 2062 6f6e 6420  l atom and bond 
+00010f10: 6665 6174 7572 6573 2e0a 2020 2020 2020  features..      
+00010f20: 2020 6174 6f6d 5f74 6f5f 696e 636f 6d69    atom_to_incomi
+00010f30: 6e67 5f62 6f6e 6473 3a20 746f 7263 682e  ng_bonds: torch.
+00010f40: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+00010f50: 2020 2054 656e 736f 7220 636f 6e74 6169     Tensor contai
+00010f60: 6e69 6e67 206d 6170 7069 6e67 2066 726f  ning mapping fro
+00010f70: 6d20 6174 6f6d 2069 6e64 6578 2074 6f20  m atom index to 
+00010f80: 6c69 7374 206f 6620 696e 6469 6369 6573  list of indicies
+00010f90: 206f 6620 696e 636f 6d69 6e67 2062 6f6e   of incoming bon
+00010fa0: 6473 2e0a 2020 2020 2020 2020 6d61 7070  ds..        mapp
+00010fb0: 696e 673a 2074 6f72 6368 2e54 656e 736f  ing: torch.Tenso
+00010fc0: 720a 2020 2020 2020 2020 2020 2020 5465  r.            Te
+00010fd0: 6e73 6f72 2063 6f6e 7461 696e 696e 6720  nsor containing 
+00010fe0: 7468 6520 6d61 7070 696e 6720 7468 6174  the mapping that
+00010ff0: 206d 6170 7320 626f 6e64 2069 6e64 6578   maps bond index
+00011000: 2074 6f20 2761 7272 6179 206f 6620 696e   to 'array of in
+00011010: 6469 6365 7320 6f66 2074 6865 2062 6f6e  dices of the bon
+00011020: 6473 270a 2020 2020 2020 2020 2020 2020  ds'.            
+00011030: 696e 636f 6d69 6e67 2061 7420 7468 6520  incoming at the 
+00011040: 696e 6974 6961 6c20 6174 6f6d 206f 6620  initial atom of 
+00011050: 7468 6520 626f 6e64 2028 6578 636c 7564  the bond (exclud
+00011060: 696e 6720 7468 6520 7265 7665 7273 6520  ing the reverse 
+00011070: 626f 6e64 7329 2e0a 2020 2020 2020 2020  bonds)..        
+00011080: 676c 6f62 616c 5f66 6561 7475 7265 733a  global_features:
+00011090: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+000110a0: 2020 2020 2020 2020 2020 5465 6e73 6f72            Tensor
+000110b0: 2063 6f6e 7461 696e 696e 6720 6d6f 6c65   containing mole
+000110c0: 6375 6c65 2066 6561 7475 7265 732e 0a20  cule features.. 
+000110d0: 2020 2020 2020 206d 6f6c 6563 756c 6573         molecules
+000110e0: 5f75 6e62 6174 6368 5f6b 6579 3a20 4c69  _unbatch_key: Li
+000110f0: 7374 0a20 2020 2020 2020 2020 2020 204c  st.            L
+00011100: 6973 7420 636f 6e74 6169 6e69 6e67 206e  ist containing n
+00011110: 756d 6265 7220 6f66 2061 746f 6d73 2069  umber of atoms i
+00011120: 6e20 7661 7269 6f75 7320 6d6f 6c65 6375  n various molecu
+00011130: 6c65 7320 6f66 2061 2062 6174 6368 0a0a  les of a batch..
+00011140: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00011150: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+00011160: 2020 2020 2020 2020 6f75 7470 7574 3a20          output: 
+00011170: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+00011180: 2020 2020 2020 2020 2054 656e 736f 7220           Tensor 
+00011190: 636f 6e74 6169 6e69 6e67 2074 6865 2065  containing the e
+000111a0: 6e63 6f64 696e 6773 206f 6620 7468 6520  ncodings of the 
+000111b0: 6d6f 6c65 6375 6c65 732e 0a20 2020 2020  molecules..     
+000111c0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+000111d0: 6e70 7574 3a20 746f 7263 682e 5465 6e73  nput: torch.Tens
+000111e0: 6f72 203d 2073 656c 662e 575f 6928 0a20  or = self.W_i(. 
+000111f0: 2020 2020 2020 2020 2020 2066 5f69 6e69             f_ini
+00011200: 5f61 746f 6d73 5f62 6f6e 6473 2920 2023  _atoms_bonds)  #
+00011210: 206e 756d 5f62 6f6e 6473 2078 2068 6964   num_bonds x hid
+00011220: 6465 6e5f 7369 7a65 0a20 2020 2020 2020  den_size.       
+00011230: 206d 6573 7361 6765 3a20 746f 7263 682e   message: torch.
+00011240: 5465 6e73 6f72 203d 2073 656c 662e 6163  Tensor = self.ac
+00011250: 7469 7661 7469 6f6e 280a 2020 2020 2020  tivation(.      
+00011260: 2020 2020 2020 696e 7075 7429 2020 2320        input)  # 
+00011270: 6e75 6d5f 626f 6e64 7320 7820 6869 6464  num_bonds x hidd
+00011280: 656e 5f73 697a 650a 0a20 2020 2020 2020  en_size..       
+00011290: 2066 6f72 205f 2069 6e20 7261 6e67 6528   for _ in range(
+000112a0: 312c 2073 656c 662e 6465 7074 6829 3a0a  1, self.depth):.
+000112b0: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
+000112c0: 6167 6520 3d20 6d65 7373 6167 655b 6d61  age = message[ma
+000112d0: 7070 696e 675d 2e73 756d 2831 2920 2023  pping].sum(1)  #
+000112e0: 206e 756d 5f62 6f6e 6473 2078 2068 6964   num_bonds x hid
+000112f0: 6465 6e5f 7369 7a65 0a20 2020 2020 2020  den_size.       
+00011300: 2020 2020 2068 5f6d 6573 7361 6765 3a20       h_message: 
+00011310: 746f 7263 682e 5465 6e73 6f72 203d 2069  torch.Tensor = i
+00011320: 6e70 7574 202b 2073 656c 662e 575f 6828  nput + self.W_h(
+00011330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011340: 206d 6573 7361 6765 2920 2023 206e 756d   message)  # num
+00011350: 5f62 6f6e 6473 2078 2068 6964 6465 6e5f  _bonds x hidden_
+00011360: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
+00011370: 2068 5f6d 6573 7361 6765 203d 2073 656c   h_message = sel
+00011380: 662e 6163 7469 7661 7469 6f6e 2868 5f6d  f.activation(h_m
+00011390: 6573 7361 6765 2920 2023 206e 756d 5f62  essage)  # num_b
+000113a0: 6f6e 6473 2078 2068 6964 6465 6e5f 7369  onds x hidden_si
+000113b0: 7a65 0a20 2020 2020 2020 2020 2020 2068  ze.            h
+000113c0: 5f6d 6573 7361 6765 203d 2073 656c 662e  _message = self.
+000113d0: 6472 6f70 6f75 7428 685f 6d65 7373 6167  dropout(h_messag
+000113e0: 6529 2020 2320 6e75 6d5f 626f 6e64 7320  e)  # num_bonds 
+000113f0: 7820 6869 6464 656e 5f73 697a 650a 0a20  x hidden_size.. 
+00011400: 2020 2020 2020 2023 206e 756d 5f61 746f         # num_ato
+00011410: 6d73 2078 2068 6964 6465 6e5f 7369 7a65  ms x hidden_size
+00011420: 0a20 2020 2020 2020 2061 746f 6d73 5f68  .        atoms_h
+00011430: 6964 6465 6e5f 7374 6174 6573 3a20 746f  idden_states: to
+00011440: 7263 682e 5465 6e73 6f72 203d 2073 656c  rch.Tensor = sel
+00011450: 662e 5f67 6574 5f75 7064 6174 6564 5f61  f._get_updated_a
+00011460: 746f 6d73 5f68 6964 6465 6e5f 7374 6174  toms_hidden_stat
+00011470: 6528 0a20 2020 2020 2020 2020 2020 2061  e(.            a
+00011480: 746f 6d5f 6665 6174 7572 6573 2c20 685f  tom_features, h_
+00011490: 6d65 7373 6167 652c 2061 746f 6d5f 746f  message, atom_to
+000114a0: 5f69 6e63 6f6d 696e 675f 626f 6e64 7329  _incoming_bonds)
+000114b0: 0a0a 2020 2020 2020 2020 2320 6e75 6d5f  ..        # num_
+000114c0: 6d6f 6c65 6375 6c65 7320 7820 6869 6464  molecules x hidd
+000114d0: 656e 5f73 697a 650a 2020 2020 2020 2020  en_size.        
+000114e0: 6f75 7470 7574 3a20 746f 7263 682e 5465  output: torch.Te
+000114f0: 6e73 6f72 203d 2073 656c 662e 5f72 6561  nsor = self._rea
+00011500: 646f 7574 2861 746f 6d73 5f68 6964 6465  dout(atoms_hidde
+00011510: 6e5f 7374 6174 6573 2c0a 2020 2020 2020  n_states,.      
 00011520: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011540: 206d 6f6c 6563 756c 6573 5f75 6e62 6174   molecules_unbat
-00011550: 6368 5f6b 6579 290a 0a20 2020 2020 2020  ch_key)..       
-00011560: 2023 2063 6f6e 6361 7420 676c 6f62 616c   # concat global
-00011570: 2066 6561 7475 7265 730a 2020 2020 2020   features.      
-00011580: 2020 6966 2067 6c6f 6261 6c5f 6665 6174    if global_feat
-00011590: 7572 6573 2e73 697a 6528 295b 305d 2021  ures.size()[0] !
-000115a0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-000115b0: 2069 6620 6c65 6e28 676c 6f62 616c 5f66   if len(global_f
-000115c0: 6561 7475 7265 732e 7368 6170 6529 203d  eatures.shape) =
-000115d0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-000115e0: 2020 2020 2067 6c6f 6261 6c5f 6665 6174       global_feat
-000115f0: 7572 6573 203d 2067 6c6f 6261 6c5f 6665  ures = global_fe
-00011600: 6174 7572 6573 2e76 6965 7728 6c65 6e28  atures.view(len(
-00011610: 6f75 7470 7574 292c 202d 3129 0a20 2020  output), -1).   
-00011620: 2020 2020 2020 2020 206f 7574 7075 7420           output 
-00011630: 3d20 746f 7263 682e 6361 7428 5b6f 7574  = torch.cat([out
-00011640: 7075 742c 2067 6c6f 6261 6c5f 6665 6174  put, global_feat
-00011650: 7572 6573 5d2c 2064 696d 3d31 290a 0a20  ures], dim=1).. 
-00011660: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
-00011670: 7470 7574 2020 2320 6e75 6d5f 6d6f 6c65  tput  # num_mole
-00011680: 6375 6c65 7320 7820 6869 6464 656e 5f73  cules x hidden_s
-00011690: 697a 650a 0a0a 636c 6173 7320 496e 7465  ize...class Inte
-000116a0: 7261 746f 6d69 634c 3244 6973 7461 6e63  ratomicL2Distanc
-000116b0: 6573 286e 6e2e 4d6f 6475 6c65 293a 0a20  es(nn.Module):. 
-000116c0: 2020 2022 2222 436f 6d70 7574 6520 2873     """Compute (s
-000116d0: 7175 6172 6564 2920 4c32 2044 6973 7461  quared) L2 Dista
-000116e0: 6e63 6573 2062 6574 7765 656e 2061 746f  nces between ato
-000116f0: 6d73 2067 6976 656e 206e 6569 6768 626f  ms given neighbo
-00011700: 7273 2e0a 0a20 2020 2054 6869 7320 636c  rs...    This cl
-00011710: 6173 7320 6973 2074 6865 2070 7974 6f72  ass is the pytor
-00011720: 6368 2069 6d70 6c65 6d65 6e74 6174 696f  ch implementatio
-00011730: 6e20 6f66 2074 6865 206f 7269 6769 6e61  n of the origina
-00011740: 6c20 496e 7465 7261 746f 6d69 634c 3244  l InteratomicL2D
-00011750: 6973 7461 6e63 6573 206c 6179 6572 2069  istances layer i
-00011760: 6d70 6c65 6d65 6e74 6564 2069 6e20 4b65  mplemented in Ke
-00011770: 7261 732e 0a20 2020 2050 6169 7277 6973  ras..    Pairwis
-00011780: 6520 6469 7374 616e 6365 2028 4c32 2920  e distance (L2) 
-00011790: 6973 2063 616c 6375 6c61 7465 6420 6265  is calculated be
-000117a0: 7477 6565 6e20 696e 7075 7420 6174 6f6d  tween input atom
-000117b0: 732c 2067 6976 656e 2074 6865 206e 756d  s, given the num
-000117c0: 6265 7220 6f66 206e 6569 6768 626f 7273  ber of neighbors
-000117d0: 2074 6f20 636f 6e73 6964 6572 2c20 616c   to consider, al
-000117e0: 6f6e 6720 7769 7468 2074 6865 206e 756d  ong with the num
-000117f0: 6265 7220 6f66 2064 6573 6372 6970 746f  ber of descripto
-00011800: 7273 2066 6f72 2065 7665 7279 2061 746f  rs for every ato
-00011810: 6d2e 0a0a 2020 2020 4578 616d 706c 6573  m...    Examples
-00011820: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-00011830: 2020 3e3e 3e20 6174 6f6d 7320 3d20 350a    >>> atoms = 5.
-00011840: 2020 2020 3e3e 3e20 6e65 6967 6862 6f72      >>> neighbor
-00011850: 7320 3d20 320a 2020 2020 3e3e 3e20 636f  s = 2.    >>> co
-00011860: 6f72 6473 203d 206e 702e 7261 6e64 6f6d  ords = np.random
-00011870: 2e72 616e 6428 6174 6f6d 732c 2033 290a  .rand(atoms, 3).
-00011880: 2020 2020 3e3e 3e20 6e65 6967 6862 6f72      >>> neighbor
-00011890: 5f6c 6973 7420 3d20 6e70 2e72 616e 646f  _list = np.rando
-000118a0: 6d2e 7261 6e64 696e 7428 302c 2061 746f  m.randint(0, ato
-000118b0: 6d73 2c20 7369 7a65 3d28 6174 6f6d 732c  ms, size=(atoms,
-000118c0: 206e 6569 6768 626f 7273 2929 0a20 2020   neighbors)).   
-000118d0: 203e 3e3e 206c 6179 6572 203d 2049 6e74   >>> layer = Int
-000118e0: 6572 6174 6f6d 6963 4c32 4469 7374 616e  eratomicL2Distan
-000118f0: 6365 7328 6174 6f6d 732c 206e 6569 6768  ces(atoms, neigh
-00011900: 626f 7273 2c20 3329 0a20 2020 203e 3e3e  bors, 3).    >>>
-00011910: 2072 6573 756c 7420 3d20 6e70 2e61 7272   result = np.arr
-00011920: 6179 286c 6179 6572 285b 636f 6f72 6473  ay(layer([coords
-00011930: 2c20 6e65 6967 6862 6f72 5f6c 6973 745d  , neighbor_list]
-00011940: 2929 0a20 2020 203e 3e3e 2072 6573 756c  )).    >>> resul
-00011950: 742e 7368 6170 650a 2020 2020 2835 2c20  t.shape.    (5, 
-00011960: 3229 0a0a 2020 2020 2222 220a 0a20 2020  2)..    """..   
-00011970: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00011980: 6c66 2c20 4e5f 6174 6f6d 733a 2069 6e74  lf, N_atoms: int
-00011990: 2c20 4d5f 6e62 7273 3a20 696e 742c 206e  , M_nbrs: int, n
-000119a0: 6469 6d3a 2069 6e74 2c20 2a2a 6b77 6172  dim: int, **kwar
-000119b0: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
-000119c0: 436f 6e73 7472 7563 746f 7220 666f 7220  Constructor for 
-000119d0: 7468 6973 206c 6179 6572 2e0a 0a20 2020  this layer...   
-000119e0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-000119f0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00011a00: 2d2d 0a20 2020 2020 2020 204e 5f61 746f  --.        N_ato
-00011a10: 6d73 3a20 696e 740a 2020 2020 2020 2020  ms: int.        
-00011a20: 2020 2020 4e75 6d62 6572 206f 6620 6174      Number of at
-00011a30: 6f6d 7320 696e 2074 6865 2073 7973 7465  oms in the syste
-00011a40: 6d20 746f 7461 6c2e 0a20 2020 2020 2020  m total..       
-00011a50: 204d 5f6e 6272 733a 2069 6e74 0a20 2020   M_nbrs: int.   
-00011a60: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
-00011a70: 6f66 206e 6569 6768 626f 7273 2074 6f20  of neighbors to 
-00011a80: 636f 6e73 6964 6572 2077 6865 6e20 636f  consider when co
-00011a90: 6d70 7574 696e 6720 6469 7374 616e 6365  mputing distance
-00011aa0: 732e 0a20 2020 2020 2020 206e 5f64 696d  s..        n_dim
-00011ab0: 3a20 2069 6e74 0a20 2020 2020 2020 2020  :  int.         
-00011ac0: 2020 204e 756d 6265 7220 6f66 2064 6573     Number of des
-00011ad0: 6372 6970 746f 7273 2066 6f72 2065 6163  criptors for eac
-00011ae0: 6820 6174 6f6d 2e0a 2020 2020 2020 2020  h atom..        
-00011af0: 2222 220a 2020 2020 2020 2020 7375 7065  """.        supe
-00011b00: 7228 496e 7465 7261 746f 6d69 634c 3244  r(InteratomicL2D
-00011b10: 6973 7461 6e63 6573 2c20 7365 6c66 292e  istances, self).
-00011b20: 5f5f 696e 6974 5f5f 282a 2a6b 7761 7267  __init__(**kwarg
-00011b30: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-00011b40: 4e5f 6174 6f6d 7320 3d20 4e5f 6174 6f6d  N_atoms = N_atom
-00011b50: 730a 2020 2020 2020 2020 7365 6c66 2e4d  s.        self.M
-00011b60: 5f6e 6272 7320 3d20 4d5f 6e62 7273 0a20  _nbrs = M_nbrs. 
-00011b70: 2020 2020 2020 2073 656c 662e 6e64 696d         self.ndim
-00011b80: 203d 206e 6469 6d0a 0a20 2020 2064 6566   = ndim..    def
-00011b90: 205f 5f72 6570 725f 5f28 7365 6c66 2920   __repr__(self) 
-00011ba0: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
-00011bb0: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-00011bc0: 2020 2020 2066 277b 7365 6c66 2e5f 5f63       f'{self.__c
-00011bd0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-00011be0: 284e 5f61 746f 6d73 3d7b 7365 6c66 2e4e  (N_atoms={self.N
-00011bf0: 5f61 746f 6d73 7d2c 204d 5f6e 6272 733d  _atoms}, M_nbrs=
-00011c00: 7b73 656c 662e 4d5f 6e62 7273 7d2c 206e  {self.M_nbrs}, n
-00011c10: 6469 6d3d 7b73 656c 662e 6e64 696d 7d29  dim={self.ndim})
-00011c20: 270a 2020 2020 2020 2020 290a 0a20 2020  '.        )..   
-00011c30: 2064 6566 2066 6f72 7761 7264 280a 2020   def forward(.  
-00011c40: 2020 2020 2020 7365 6c66 2c20 696e 7075        self, inpu
-00011c50: 7473 3a20 4c69 7374 5b55 6e69 6f6e 5b74  ts: List[Union[t
-00011c60: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
-00011c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c80: 2020 2020 2020 2020 2020 2020 2020 4c69                Li
-00011c90: 7374 5b55 6e69 6f6e 5b69 6e74 2c20 666c  st[Union[int, fl
-00011ca0: 6f61 745d 5d5d 5d29 202d 3e20 746f 7263  oat]]]]) -> torc
-00011cb0: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
-00011cc0: 2020 2222 2249 6e76 6f6b 6573 2074 6869    """Invokes thi
-00011cd0: 7320 6c61 7965 722e 0a0a 2020 2020 2020  s layer...      
-00011ce0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00011cf0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00011d00: 2020 2020 2020 2020 696e 7075 7473 3a20          inputs: 
-00011d10: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
-00011d20: 2053 686f 756c 6420 6265 206f 6620 666f   Should be of fo
-00011d30: 726d 2060 696e 7075 7473 3d5b 636f 6f72  rm `inputs=[coor
-00011d40: 6473 2c20 6e62 725f 6c69 7374 5d60 2077  ds, nbr_list]` w
-00011d50: 6865 7265 2060 636f 6f72 6473 6020 6973  here `coords` is
-00011d60: 2061 0a20 2020 2020 2020 2020 2020 2074   a.            t
-00011d70: 656e 736f 7220 6f66 2073 6861 7065 2060  ensor of shape `
-00011d80: 284e 6f6e 652c 204e 2c20 3329 6020 616e  (None, N, 3)` an
-00011d90: 6420 606e 6272 5f6c 6973 7460 2069 7320  d `nbr_list` is 
-00011da0: 6120 6c69 7374 2e0a 0a20 2020 2020 2020  a list...       
-00011db0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-00011dc0: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-00011dd0: 2054 656e 736f 7220 6f66 2073 6861 7065   Tensor of shape
-00011de0: 2060 284e 5f61 746f 6d73 2c20 4d5f 6e62   `(N_atoms, M_nb
-00011df0: 7273 2960 2077 6974 6820 696e 7465 7261  rs)` with intera
-00011e00: 746f 6d69 6320 6469 7374 616e 6365 732e  tomic distances.
-00011e10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00011e20: 2020 2020 2069 6620 6c65 6e28 696e 7075       if len(inpu
-00011e30: 7473 2920 213d 2032 3a0a 2020 2020 2020  ts) != 2:.      
-00011e40: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00011e50: 6545 7272 6f72 2822 496e 7465 7261 746f  eError("Interato
-00011e60: 6d69 6344 6973 7461 6e63 6573 2072 6571  micDistances req
-00011e70: 7569 7265 7320 636f 6f72 6473 2c6e 6272  uires coords,nbr
-00011e80: 5f6c 6973 7422 290a 2020 2020 2020 2020  _list").        
-00011e90: 636f 6f72 6473 2c20 6e62 725f 6c69 7374  coords, nbr_list
-00011ea0: 203d 2028 746f 7263 682e 7465 6e73 6f72   = (torch.tensor
-00011eb0: 2869 6e70 7574 735b 305d 292c 2074 6f72  (inputs[0]), tor
-00011ec0: 6368 2e74 656e 736f 7228 696e 7075 7473  ch.tensor(inputs
-00011ed0: 5b31 5d29 290a 2020 2020 2020 2020 4e5f  [1])).        N_
-00011ee0: 6174 6f6d 732c 204d 5f6e 6272 732c 206e  atoms, M_nbrs, n
-00011ef0: 6469 6d20 3d20 7365 6c66 2e4e 5f61 746f  dim = self.N_ato
-00011f00: 6d73 2c20 7365 6c66 2e4d 5f6e 6272 732c  ms, self.M_nbrs,
-00011f10: 2073 656c 662e 6e64 696d 0a20 2020 2020   self.ndim.     
-00011f20: 2020 2023 2053 6861 7065 2028 4e5f 6174     # Shape (N_at
-00011f30: 6f6d 732c 204d 5f6e 6272 732c 206e 6469  oms, M_nbrs, ndi
-00011f40: 6d29 0a20 2020 2020 2020 206e 6272 5f63  m).        nbr_c
-00011f50: 6f6f 7264 7320 3d20 636f 6f72 6473 5b6e  oords = coords[n
-00011f60: 6272 5f6c 6973 742e 6c6f 6e67 2829 5d0a  br_list.long()].
-00011f70: 2020 2020 2020 2020 2320 5368 6170 6520          # Shape 
-00011f80: 284e 5f61 746f 6d73 2c20 4d5f 6e62 7273  (N_atoms, M_nbrs
-00011f90: 2c20 6e64 696d 290a 2020 2020 2020 2020  , ndim).        
-00011fa0: 7469 6c65 645f 636f 6f72 6473 203d 2074  tiled_coords = t
-00011fb0: 6f72 6368 2e74 696c 6528 746f 7263 682e  orch.tile(torch.
-00011fc0: 7265 7368 6170 6528 636f 6f72 6473 2c20  reshape(coords, 
-00011fd0: 284e 5f61 746f 6d73 2c20 312c 206e 6469  (N_atoms, 1, ndi
-00011fe0: 6d29 292c 0a20 2020 2020 2020 2020 2020  m)),.           
+00011540: 2020 2020 2020 206d 6f6c 6563 756c 6573         molecules
+00011550: 5f75 6e62 6174 6368 5f6b 6579 290a 0a20  _unbatch_key).. 
+00011560: 2020 2020 2020 2023 2063 6f6e 6361 7420         # concat 
+00011570: 676c 6f62 616c 2066 6561 7475 7265 730a  global features.
+00011580: 2020 2020 2020 2020 6966 2067 6c6f 6261          if globa
+00011590: 6c5f 6665 6174 7572 6573 2e73 697a 6528  l_features.size(
+000115a0: 295b 305d 2021 3d20 303a 0a20 2020 2020  )[0] != 0:.     
+000115b0: 2020 2020 2020 2069 6620 6c65 6e28 676c         if len(gl
+000115c0: 6f62 616c 5f66 6561 7475 7265 732e 7368  obal_features.sh
+000115d0: 6170 6529 203d 3d20 313a 0a20 2020 2020  ape) == 1:.     
+000115e0: 2020 2020 2020 2020 2020 2067 6c6f 6261             globa
+000115f0: 6c5f 6665 6174 7572 6573 203d 2067 6c6f  l_features = glo
+00011600: 6261 6c5f 6665 6174 7572 6573 2e76 6965  bal_features.vie
+00011610: 7728 6c65 6e28 6f75 7470 7574 292c 202d  w(len(output), -
+00011620: 3129 0a20 2020 2020 2020 2020 2020 206f  1).            o
+00011630: 7574 7075 7420 3d20 746f 7263 682e 6361  utput = torch.ca
+00011640: 7428 5b6f 7574 7075 742c 2067 6c6f 6261  t([output, globa
+00011650: 6c5f 6665 6174 7572 6573 5d2c 2064 696d  l_features], dim
+00011660: 3d31 290a 0a20 2020 2020 2020 2072 6574  =1)..        ret
+00011670: 7572 6e20 6f75 7470 7574 2020 2320 6e75  urn output  # nu
+00011680: 6d5f 6d6f 6c65 6375 6c65 7320 7820 6869  m_molecules x hi
+00011690: 6464 656e 5f73 697a 650a 0a0a 636c 6173  dden_size...clas
+000116a0: 7320 496e 7465 7261 746f 6d69 634c 3244  s InteratomicL2D
+000116b0: 6973 7461 6e63 6573 286e 6e2e 4d6f 6475  istances(nn.Modu
+000116c0: 6c65 293a 0a20 2020 2022 2222 436f 6d70  le):.    """Comp
+000116d0: 7574 6520 2873 7175 6172 6564 2920 4c32  ute (squared) L2
+000116e0: 2044 6973 7461 6e63 6573 2062 6574 7765   Distances betwe
+000116f0: 656e 2061 746f 6d73 2067 6976 656e 206e  en atoms given n
+00011700: 6569 6768 626f 7273 2e0a 0a20 2020 2054  eighbors...    T
+00011710: 6869 7320 636c 6173 7320 6973 2074 6865  his class is the
+00011720: 2070 7974 6f72 6368 2069 6d70 6c65 6d65   pytorch impleme
+00011730: 6e74 6174 696f 6e20 6f66 2074 6865 206f  ntation of the o
+00011740: 7269 6769 6e61 6c20 496e 7465 7261 746f  riginal Interato
+00011750: 6d69 634c 3244 6973 7461 6e63 6573 206c  micL2Distances l
+00011760: 6179 6572 2069 6d70 6c65 6d65 6e74 6564  ayer implemented
+00011770: 2069 6e20 4b65 7261 732e 0a20 2020 2050   in Keras..    P
+00011780: 6169 7277 6973 6520 6469 7374 616e 6365  airwise distance
+00011790: 2028 4c32 2920 6973 2063 616c 6375 6c61   (L2) is calcula
+000117a0: 7465 6420 6265 7477 6565 6e20 696e 7075  ted between inpu
+000117b0: 7420 6174 6f6d 732c 2067 6976 656e 2074  t atoms, given t
+000117c0: 6865 206e 756d 6265 7220 6f66 206e 6569  he number of nei
+000117d0: 6768 626f 7273 2074 6f20 636f 6e73 6964  ghbors to consid
+000117e0: 6572 2c20 616c 6f6e 6720 7769 7468 2074  er, along with t
+000117f0: 6865 206e 756d 6265 7220 6f66 2064 6573  he number of des
+00011800: 6372 6970 746f 7273 2066 6f72 2065 7665  criptors for eve
+00011810: 7279 2061 746f 6d2e 0a0a 2020 2020 4578  ry atom...    Ex
+00011820: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
+00011830: 2d2d 2d0a 2020 2020 3e3e 3e20 6174 6f6d  ---.    >>> atom
+00011840: 7320 3d20 350a 2020 2020 3e3e 3e20 6e65  s = 5.    >>> ne
+00011850: 6967 6862 6f72 7320 3d20 320a 2020 2020  ighbors = 2.    
+00011860: 3e3e 3e20 636f 6f72 6473 203d 206e 702e  >>> coords = np.
+00011870: 7261 6e64 6f6d 2e72 616e 6428 6174 6f6d  random.rand(atom
+00011880: 732c 2033 290a 2020 2020 3e3e 3e20 6e65  s, 3).    >>> ne
+00011890: 6967 6862 6f72 5f6c 6973 7420 3d20 6e70  ighbor_list = np
+000118a0: 2e72 616e 646f 6d2e 7261 6e64 696e 7428  .random.randint(
+000118b0: 302c 2061 746f 6d73 2c20 7369 7a65 3d28  0, atoms, size=(
+000118c0: 6174 6f6d 732c 206e 6569 6768 626f 7273  atoms, neighbors
+000118d0: 2929 0a20 2020 203e 3e3e 206c 6179 6572  )).    >>> layer
+000118e0: 203d 2049 6e74 6572 6174 6f6d 6963 4c32   = InteratomicL2
+000118f0: 4469 7374 616e 6365 7328 6174 6f6d 732c  Distances(atoms,
+00011900: 206e 6569 6768 626f 7273 2c20 3329 0a20   neighbors, 3). 
+00011910: 2020 203e 3e3e 2072 6573 756c 7420 3d20     >>> result = 
+00011920: 6e70 2e61 7272 6179 286c 6179 6572 285b  np.array(layer([
+00011930: 636f 6f72 6473 2c20 6e65 6967 6862 6f72  coords, neighbor
+00011940: 5f6c 6973 745d 2929 0a20 2020 203e 3e3e  _list])).    >>>
+00011950: 2072 6573 756c 742e 7368 6170 650a 2020   result.shape.  
+00011960: 2020 2835 2c20 3229 0a0a 2020 2020 2222    (5, 2)..    ""
+00011970: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00011980: 745f 5f28 7365 6c66 2c20 4e5f 6174 6f6d  t__(self, N_atom
+00011990: 733a 2069 6e74 2c20 4d5f 6e62 7273 3a20  s: int, M_nbrs: 
+000119a0: 696e 742c 206e 6469 6d3a 2069 6e74 2c20  int, ndim: int, 
+000119b0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+000119c0: 2020 2022 2222 436f 6e73 7472 7563 746f     """Constructo
+000119d0: 7220 666f 7220 7468 6973 206c 6179 6572  r for this layer
+000119e0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+000119f0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00011a00: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00011a10: 204e 5f61 746f 6d73 3a20 696e 740a 2020   N_atoms: int.  
+00011a20: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
+00011a30: 206f 6620 6174 6f6d 7320 696e 2074 6865   of atoms in the
+00011a40: 2073 7973 7465 6d20 746f 7461 6c2e 0a20   system total.. 
+00011a50: 2020 2020 2020 204d 5f6e 6272 733a 2069         M_nbrs: i
+00011a60: 6e74 0a20 2020 2020 2020 2020 2020 204e  nt.            N
+00011a70: 756d 6265 7220 6f66 206e 6569 6768 626f  umber of neighbo
+00011a80: 7273 2074 6f20 636f 6e73 6964 6572 2077  rs to consider w
+00011a90: 6865 6e20 636f 6d70 7574 696e 6720 6469  hen computing di
+00011aa0: 7374 616e 6365 732e 0a20 2020 2020 2020  stances..       
+00011ab0: 206e 5f64 696d 3a20 2069 6e74 0a20 2020   n_dim:  int.   
+00011ac0: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
+00011ad0: 6f66 2064 6573 6372 6970 746f 7273 2066  of descriptors f
+00011ae0: 6f72 2065 6163 6820 6174 6f6d 2e0a 2020  or each atom..  
+00011af0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00011b00: 2020 7375 7065 7228 496e 7465 7261 746f    super(Interato
+00011b10: 6d69 634c 3244 6973 7461 6e63 6573 2c20  micL2Distances, 
+00011b20: 7365 6c66 292e 5f5f 696e 6974 5f5f 282a  self).__init__(*
+00011b30: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+00011b40: 2073 656c 662e 4e5f 6174 6f6d 7320 3d20   self.N_atoms = 
+00011b50: 4e5f 6174 6f6d 730a 2020 2020 2020 2020  N_atoms.        
+00011b60: 7365 6c66 2e4d 5f6e 6272 7320 3d20 4d5f  self.M_nbrs = M_
+00011b70: 6e62 7273 0a20 2020 2020 2020 2073 656c  nbrs.        sel
+00011b80: 662e 6e64 696d 203d 206e 6469 6d0a 0a20  f.ndim = ndim.. 
+00011b90: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+00011ba0: 7365 6c66 2920 2d3e 2073 7472 3a0a 2020  self) -> str:.  
+00011bb0: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
+00011bc0: 2020 2020 2020 2020 2020 2066 277b 7365             f'{se
+00011bd0: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
+00011be0: 616d 655f 5f7d 284e 5f61 746f 6d73 3d7b  ame__}(N_atoms={
+00011bf0: 7365 6c66 2e4e 5f61 746f 6d73 7d2c 204d  self.N_atoms}, M
+00011c00: 5f6e 6272 733d 7b73 656c 662e 4d5f 6e62  _nbrs={self.M_nb
+00011c10: 7273 7d2c 206e 6469 6d3d 7b73 656c 662e  rs}, ndim={self.
+00011c20: 6e64 696d 7d29 270a 2020 2020 2020 2020  ndim})'.        
+00011c30: 290a 0a20 2020 2064 6566 2066 6f72 7761  )..    def forwa
+00011c40: 7264 280a 2020 2020 2020 2020 7365 6c66  rd(.        self
+00011c50: 2c20 696e 7075 7473 3a20 4c69 7374 5b55  , inputs: List[U
+00011c60: 6e69 6f6e 5b74 6f72 6368 2e54 656e 736f  nion[torch.Tenso
+00011c70: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00011c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c90: 2020 2020 4c69 7374 5b55 6e69 6f6e 5b69      List[Union[i
+00011ca0: 6e74 2c20 666c 6f61 745d 5d5d 5d29 202d  nt, float]]]]) -
+00011cb0: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
+00011cc0: 2020 2020 2020 2020 2222 2249 6e76 6f6b          """Invok
+00011cd0: 6573 2074 6869 7320 6c61 7965 722e 0a0a  es this layer...
+00011ce0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00011cf0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00011d00: 2d2d 2d2d 2d0a 2020 2020 2020 2020 696e  -----.        in
+00011d10: 7075 7473 3a20 6c69 7374 0a20 2020 2020  puts: list.     
+00011d20: 2020 2020 2020 2053 686f 756c 6420 6265         Should be
+00011d30: 206f 6620 666f 726d 2060 696e 7075 7473   of form `inputs
+00011d40: 3d5b 636f 6f72 6473 2c20 6e62 725f 6c69  =[coords, nbr_li
+00011d50: 7374 5d60 2077 6865 7265 2060 636f 6f72  st]` where `coor
+00011d60: 6473 6020 6973 2061 0a20 2020 2020 2020  ds` is a.       
+00011d70: 2020 2020 2074 656e 736f 7220 6f66 2073       tensor of s
+00011d80: 6861 7065 2060 284e 6f6e 652c 204e 2c20  hape `(None, N, 
+00011d90: 3329 6020 616e 6420 606e 6272 5f6c 6973  3)` and `nbr_lis
+00011da0: 7460 2069 7320 6120 6c69 7374 2e0a 0a20  t` is a list... 
+00011db0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00011dc0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+00011dd0: 2020 2020 2020 2054 656e 736f 7220 6f66         Tensor of
+00011de0: 2073 6861 7065 2060 284e 5f61 746f 6d73   shape `(N_atoms
+00011df0: 2c20 4d5f 6e62 7273 2960 2077 6974 6820  , M_nbrs)` with 
+00011e00: 696e 7465 7261 746f 6d69 6320 6469 7374  interatomic dist
+00011e10: 616e 6365 732e 0a20 2020 2020 2020 2022  ances..        "
+00011e20: 2222 0a20 2020 2020 2020 2069 6620 6c65  "".        if le
+00011e30: 6e28 696e 7075 7473 2920 213d 2032 3a0a  n(inputs) != 2:.
+00011e40: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00011e50: 6520 5661 6c75 6545 7272 6f72 2822 496e  e ValueError("In
+00011e60: 7465 7261 746f 6d69 6344 6973 7461 6e63  teratomicDistanc
+00011e70: 6573 2072 6571 7569 7265 7320 636f 6f72  es requires coor
+00011e80: 6473 2c6e 6272 5f6c 6973 7422 290a 2020  ds,nbr_list").  
+00011e90: 2020 2020 2020 636f 6f72 6473 2c20 6e62        coords, nb
+00011ea0: 725f 6c69 7374 203d 2028 746f 7263 682e  r_list = (torch.
+00011eb0: 7465 6e73 6f72 2869 6e70 7574 735b 305d  tensor(inputs[0]
+00011ec0: 292c 2074 6f72 6368 2e74 656e 736f 7228  ), torch.tensor(
+00011ed0: 696e 7075 7473 5b31 5d29 290a 2020 2020  inputs[1])).    
+00011ee0: 2020 2020 4e5f 6174 6f6d 732c 204d 5f6e      N_atoms, M_n
+00011ef0: 6272 732c 206e 6469 6d20 3d20 7365 6c66  brs, ndim = self
+00011f00: 2e4e 5f61 746f 6d73 2c20 7365 6c66 2e4d  .N_atoms, self.M
+00011f10: 5f6e 6272 732c 2073 656c 662e 6e64 696d  _nbrs, self.ndim
+00011f20: 0a20 2020 2020 2020 2023 2053 6861 7065  .        # Shape
+00011f30: 2028 4e5f 6174 6f6d 732c 204d 5f6e 6272   (N_atoms, M_nbr
+00011f40: 732c 206e 6469 6d29 0a20 2020 2020 2020  s, ndim).       
+00011f50: 206e 6272 5f63 6f6f 7264 7320 3d20 636f   nbr_coords = co
+00011f60: 6f72 6473 5b6e 6272 5f6c 6973 742e 6c6f  ords[nbr_list.lo
+00011f70: 6e67 2829 5d0a 2020 2020 2020 2020 2320  ng()].        # 
+00011f80: 5368 6170 6520 284e 5f61 746f 6d73 2c20  Shape (N_atoms, 
+00011f90: 4d5f 6e62 7273 2c20 6e64 696d 290a 2020  M_nbrs, ndim).  
+00011fa0: 2020 2020 2020 7469 6c65 645f 636f 6f72        tiled_coor
+00011fb0: 6473 203d 2074 6f72 6368 2e74 696c 6528  ds = torch.tile(
+00011fc0: 746f 7263 682e 7265 7368 6170 6528 636f  torch.reshape(co
+00011fd0: 6f72 6473 2c20 284e 5f61 746f 6d73 2c20  ords, (N_atoms, 
+00011fe0: 312c 206e 6469 6d29 292c 0a20 2020 2020  1, ndim)),.     
 00011ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012000: 2020 2020 2020 2028 312c 204d 5f6e 6272         (1, M_nbr
-00012010: 732c 2031 2929 0a20 2020 2020 2020 2023  s, 1)).        #
-00012020: 2053 6861 7065 2028 4e5f 6174 6f6d 732c   Shape (N_atoms,
-00012030: 204d 5f6e 6272 7329 0a20 2020 2020 2020   M_nbrs).       
-00012040: 2072 6574 7572 6e20 746f 7263 682e 7375   return torch.su
-00012050: 6d28 2874 696c 6564 5f63 6f6f 7264 7320  m((tiled_coords 
-00012060: 2d20 6e62 725f 636f 6f72 6473 292a 2a32  - nbr_coords)**2
-00012070: 2c20 6469 6d3d 3229 0a0a 0a63 6c61 7373  , dim=2)...class
-00012080: 2052 6561 6c4e 5650 4c61 7965 7228 6e6e   RealNVPLayer(nn
-00012090: 2e4d 6f64 756c 6529 3a0a 2020 2020 2222  .Module):.    ""
-000120a0: 2252 6561 6c20 4e56 5020 5472 616e 7366  "Real NVP Transf
-000120b0: 6f72 6d61 7469 6f6e 204c 6179 6572 0a0a  ormation Layer..
-000120c0: 2020 2020 5468 6973 2063 6c61 7373 2063      This class c
-000120d0: 6c61 7373 2069 7320 6120 636f 6e73 7472  lass is a constr
-000120e0: 7563 746f 7220 7472 616e 7366 6f72 6d61  uctor transforma
-000120f0: 7469 6f6e 206c 6179 6572 2075 7365 6420  tion layer used 
-00012100: 6f6e 2061 0a20 2020 204e 6f72 6d61 6c69  on a.    Normali
-00012110: 7a69 6e67 464c 6f77 206d 6f64 656c 2e20  zingFLow model. 
-00012120: 2054 6865 2052 6561 6c20 4e6f 6e2d 5072   The Real Non-Pr
-00012130: 6573 6572 7669 6e67 2d56 6f6c 756d 656e  eserving-Volumen
-00012140: 2028 5265 616c 204e 5650 2920 6973 2061   (Real NVP) is a
-00012150: 2074 7970 650a 2020 2020 6f66 206e 6f72   type.    of nor
-00012160: 6d61 6c69 7a69 6e67 2066 6c6f 7720 6c61  malizing flow la
-00012170: 7965 7220 7768 6963 6820 6769 7665 7320  yer which gives 
-00012180: 6164 7661 6e74 6167 6573 206f 7665 7220  advantages over 
-00012190: 7468 6973 206d 6169 6e6c 7920 6265 6361  this mainly beca
-000121a0: 7573 6520 616e 0a20 2020 2065 6173 6520  use an.    ease 
-000121b0: 746f 2063 6f6d 7075 7465 2074 6865 2069  to compute the i
-000121c0: 6e76 6572 7365 2070 6173 7320 5b31 5d5f  nverse pass [1]_
-000121d0: 2c20 7468 6973 2069 7320 746f 206c 6561  , this is to lea
-000121e0: 726e 2061 2074 6172 6765 740a 2020 2020  rn a target.    
-000121f0: 6469 7374 7269 6275 7469 6f6e 2e0a 0a20  distribution... 
-00012200: 2020 2045 7861 6d70 6c65 0a20 2020 202d     Example.    -
-00012210: 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e 2069  ------.    >>> i
-00012220: 6d70 6f72 7420 746f 7263 680a 2020 2020  mport torch.    
-00012230: 3e3e 3e20 696d 706f 7274 2074 6f72 6368  >>> import torch
-00012240: 2e6e 6e20 6173 206e 6e0a 2020 2020 3e3e  .nn as nn.    >>
-00012250: 3e20 6672 6f6d 2074 6f72 6368 2e64 6973  > from torch.dis
-00012260: 7472 6962 7574 696f 6e73 2069 6d70 6f72  tributions impor
-00012270: 7420 4d75 6c74 6976 6172 6961 7465 4e6f  t MultivariateNo
-00012280: 726d 616c 0a20 2020 203e 3e3e 2066 726f  rmal.    >>> fro
-00012290: 6d20 6465 6570 6368 656d 2e6d 6f64 656c  m deepchem.model
-000122a0: 732e 746f 7263 685f 6d6f 6465 6c73 2e6c  s.torch_models.l
-000122b0: 6179 6572 7320 696d 706f 7274 2052 6561  ayers import Rea
-000122c0: 6c4e 5650 4c61 7965 720a 2020 2020 3e3e  lNVPLayer.    >>
-000122d0: 3e20 6469 6d20 3d20 320a 2020 2020 3e3e  > dim = 2.    >>
-000122e0: 3e20 7361 6d70 6c65 7320 3d20 3936 0a20  > samples = 96. 
-000122f0: 2020 203e 3e3e 2064 6174 6120 3d20 4d75     >>> data = Mu
-00012300: 6c74 6976 6172 6961 7465 4e6f 726d 616c  ltivariateNormal
-00012310: 2874 6f72 6368 2e7a 6572 6f73 2864 696d  (torch.zeros(dim
-00012320: 292c 2074 6f72 6368 2e65 7965 2864 696d  ), torch.eye(dim
-00012330: 2929 0a20 2020 203e 3e3e 2074 656e 736f  )).    >>> tenso
-00012340: 7220 3d20 6461 7461 2e73 616d 706c 6528  r = data.sample(
-00012350: 746f 7263 682e 5369 7a65 2828 7361 6d70  torch.Size((samp
-00012360: 6c65 732c 2064 696d 2929 290a 0a20 2020  les, dim)))..   
-00012370: 203e 3e3e 206c 6179 6572 7320 3d20 340a   >>> layers = 4.
-00012380: 2020 2020 3e3e 3e20 6869 6464 656e 5f73      >>> hidden_s
-00012390: 697a 6520 3d20 3136 0a20 2020 203e 3e3e  ize = 16.    >>>
-000123a0: 206d 6173 6b73 203d 2046 2e6f 6e65 5f68   masks = F.one_h
-000123b0: 6f74 2874 6f72 6368 2e74 656e 736f 7228  ot(torch.tensor(
-000123c0: 5b69 2025 2032 2066 6f72 2069 2069 6e20  [i % 2 for i in 
-000123d0: 7261 6e67 6528 6c61 7965 7273 295d 2929  range(layers)]))
-000123e0: 2e66 6c6f 6174 2829 0a20 2020 203e 3e3e  .float().    >>>
-000123f0: 206c 6179 6572 7320 3d20 6e6e 2e4d 6f64   layers = nn.Mod
-00012400: 756c 654c 6973 7428 5b52 6561 6c4e 5650  uleList([RealNVP
-00012410: 4c61 7965 7228 6d61 736b 2c20 6869 6464  Layer(mask, hidd
-00012420: 656e 5f73 697a 6529 2066 6f72 206d 6173  en_size) for mas
-00012430: 6b20 696e 206d 6173 6b73 5d29 0a0a 2020  k in masks])..  
-00012440: 2020 3e3e 3e20 666f 7220 6c61 7965 7220    >>> for layer 
-00012450: 696e 206c 6179 6572 733a 0a20 2020 202e  in layers:.    .
-00012460: 2e2e 2020 205f 2c20 696e 7665 7273 655f  ..   _, inverse_
-00012470: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
-00012480: 203d 206c 6179 6572 2e69 6e76 6572 7365   = layer.inverse
-00012490: 2874 656e 736f 7229 0a20 2020 202e 2e2e  (tensor).    ...
-000124a0: 2020 2069 6e76 6572 7365 5f6c 6f67 5f64     inverse_log_d
-000124b0: 6574 5f6a 6163 6f62 6961 6e20 3d20 696e  et_jacobian = in
-000124c0: 7665 7273 655f 6c6f 675f 6465 745f 6a61  verse_log_det_ja
-000124d0: 636f 6269 616e 2e64 6574 6163 6828 292e  cobian.detach().
-000124e0: 6e75 6d70 7928 290a 2020 2020 3e3e 3e20  numpy().    >>> 
-000124f0: 6c65 6e28 696e 7665 7273 655f 6c6f 675f  len(inverse_log_
-00012500: 6465 745f 6a61 636f 6269 616e 290a 2020  det_jacobian).  
-00012510: 2020 3936 0a0a 2020 2020 5265 6665 7265    96..    Refere
-00012520: 6e63 6573 0a20 2020 202d 2d2d 2d2d 2d2d  nces.    -------
-00012530: 2d2d 2d0a 2020 2020 2e2e 205b 315d 2053  ---.    .. [1] S
-00012540: 7469 6d70 6572 2c20 562e 2c20 5363 68c3  timper, V., Sch.
-00012550: b66c 6b6f 7066 2c20 422e 2c20 2620 4865  .lkopf, B., & He
-00012560: 726e c3a1 6e64 657a 2d4c 6f62 6174 6f2c  rn..ndez-Lobato,
-00012570: 204a 2e20 4d2e 2028 3230 3231 292e 2052   J. M. (2021). R
-00012580: 6573 616d 706c 696e 6720 4261 7365 0a20  esampling Base. 
-00012590: 2020 2044 6973 7472 6962 7574 696f 6e73     Distributions
-000125a0: 206f 6620 4e6f 726d 616c 697a 696e 6720   of Normalizing 
-000125b0: 466c 6f77 732e 2028 3230 3137 292e 2052  Flows. (2017). R
-000125c0: 6574 7269 6576 6564 2066 726f 6d20 6874  etrieved from ht
-000125d0: 7470 3a2f 2f61 7278 6976 2e6f 7267 2f61  tp://arxiv.org/a
-000125e0: 6273 2f32 3131 302e 3135 3832 380a 2020  bs/2110.15828.  
-000125f0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-00012600: 5f69 6e69 745f 5f28 7365 6c66 2c20 6d61  _init__(self, ma
-00012610: 736b 3a20 746f 7263 682e 5465 6e73 6f72  sk: torch.Tensor
-00012620: 2c20 6869 6464 656e 5f73 697a 653a 2069  , hidden_size: i
-00012630: 6e74 2920 2d3e 204e 6f6e 653a 0a20 2020  nt) -> None:.   
-00012640: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00012650: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00012660: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a      -----------.
-00012670: 2020 2020 2020 2020 6d61 736b 3a20 746f          mask: to
-00012680: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-00012690: 2020 2020 2020 2054 656e 736f 7220 7769         Tensor wi
-000126a0: 7468 207a 6572 6f73 2061 6e64 206f 6e65  th zeros and one
-000126b0: 7320 616e 6420 6974 7320 7369 7a65 2064  s and its size d
-000126c0: 6570 656e 6465 206f 6e20 7468 6520 6e75  epende on the nu
-000126d0: 6d62 6572 206f 6620 6c61 7965 7273 0a20  mber of layers. 
-000126e0: 2020 2020 2020 2020 2020 2061 6e64 2064             and d
-000126f0: 696d 656e 7373 696f 6e73 2074 6865 2075  imenssions the u
-00012700: 7365 7220 7265 7175 6573 742e 0a20 2020  ser request..   
-00012710: 2020 2020 2068 6964 6465 6e5f 7369 7a65       hidden_size
-00012720: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
-00012730: 2020 5468 6520 7369 7a65 206f 6620 7468    The size of th
-00012740: 6520 6f75 7470 7574 7320 616e 6420 696e  e outputs and in
-00012750: 7075 7473 2075 7365 6420 6f6e 2074 6865  puts used on the
-00012760: 2069 6e74 6572 6e61 6c20 6e6f 6465 7320   internal nodes 
-00012770: 6f66 2074 6865 0a20 2020 2020 2020 2020  of the.         
-00012780: 2020 2074 7261 6e73 666f 726d 6174 696f     transformatio
-00012790: 6e20 6c61 7965 722e 0a0a 2020 2020 2020  n layer...      
-000127a0: 2020 2222 220a 2020 2020 2020 2020 7375    """.        su
-000127b0: 7065 7228 5265 616c 4e56 504c 6179 6572  per(RealNVPLayer
-000127c0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-000127d0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-000127e0: 6d61 736b 203d 206e 6e2e 5061 7261 6d65  mask = nn.Parame
-000127f0: 7465 7228 6d61 736b 2c20 7265 7175 6972  ter(mask, requir
-00012800: 6573 5f67 7261 643d 4661 6c73 6529 0a20  es_grad=False). 
-00012810: 2020 2020 2020 2073 656c 662e 6469 6d20         self.dim 
-00012820: 3d20 6c65 6e28 6d61 736b 290a 0a20 2020  = len(mask)..   
-00012830: 2020 2020 2073 656c 662e 735f 6675 6e63       self.s_func
-00012840: 203d 206e 6e2e 5365 7175 656e 7469 616c   = nn.Sequential
-00012850: 280a 2020 2020 2020 2020 2020 2020 6e6e  (.            nn
-00012860: 2e4c 696e 6561 7228 696e 5f66 6561 7475  .Linear(in_featu
-00012870: 7265 733d 7365 6c66 2e64 696d 2c20 6f75  res=self.dim, ou
-00012880: 745f 6665 6174 7572 6573 3d68 6964 6465  t_features=hidde
-00012890: 6e5f 7369 7a65 292c 0a20 2020 2020 2020  n_size),.       
-000128a0: 2020 2020 206e 6e2e 4c65 616b 7952 654c       nn.LeakyReL
-000128b0: 5528 292c 0a20 2020 2020 2020 2020 2020  U(),.           
-000128c0: 206e 6e2e 4c69 6e65 6172 2869 6e5f 6665   nn.Linear(in_fe
-000128d0: 6174 7572 6573 3d68 6964 6465 6e5f 7369  atures=hidden_si
-000128e0: 7a65 2c20 6f75 745f 6665 6174 7572 6573  ze, out_features
-000128f0: 3d68 6964 6465 6e5f 7369 7a65 292c 0a20  =hidden_size),. 
-00012900: 2020 2020 2020 2020 2020 206e 6e2e 4c65             nn.Le
-00012910: 616b 7952 654c 5528 292c 0a20 2020 2020  akyReLU(),.     
-00012920: 2020 2020 2020 206e 6e2e 4c69 6e65 6172         nn.Linear
-00012930: 2869 6e5f 6665 6174 7572 6573 3d68 6964  (in_features=hid
-00012940: 6465 6e5f 7369 7a65 2c20 6f75 745f 6665  den_size, out_fe
-00012950: 6174 7572 6573 3d73 656c 662e 6469 6d29  atures=self.dim)
-00012960: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00012970: 7363 616c 6520 3d20 6e6e 2e50 6172 616d  scale = nn.Param
-00012980: 6574 6572 2874 6f72 6368 2e54 656e 736f  eter(torch.Tenso
-00012990: 7228 7365 6c66 2e64 696d 2929 0a0a 2020  r(self.dim))..  
-000129a0: 2020 2020 2020 7365 6c66 2e74 5f66 756e        self.t_fun
-000129b0: 6320 3d20 6e6e 2e53 6571 7565 6e74 6961  c = nn.Sequentia
-000129c0: 6c28 0a20 2020 2020 2020 2020 2020 206e  l(.            n
-000129d0: 6e2e 4c69 6e65 6172 2869 6e5f 6665 6174  n.Linear(in_feat
-000129e0: 7572 6573 3d73 656c 662e 6469 6d2c 206f  ures=self.dim, o
-000129f0: 7574 5f66 6561 7475 7265 733d 6869 6464  ut_features=hidd
-00012a00: 656e 5f73 697a 6529 2c0a 2020 2020 2020  en_size),.      
-00012a10: 2020 2020 2020 6e6e 2e4c 6561 6b79 5265        nn.LeakyRe
-00012a20: 4c55 2829 2c0a 2020 2020 2020 2020 2020  LU(),.          
-00012a30: 2020 6e6e 2e4c 696e 6561 7228 696e 5f66    nn.Linear(in_f
-00012a40: 6561 7475 7265 733d 6869 6464 656e 5f73  eatures=hidden_s
-00012a50: 697a 652c 206f 7574 5f66 6561 7475 7265  ize, out_feature
-00012a60: 733d 6869 6464 656e 5f73 697a 6529 2c0a  s=hidden_size),.
-00012a70: 2020 2020 2020 2020 2020 2020 6e6e 2e4c              nn.L
-00012a80: 6561 6b79 5265 4c55 2829 2c0a 2020 2020  eakyReLU(),.    
-00012a90: 2020 2020 2020 2020 6e6e 2e4c 696e 6561          nn.Linea
-00012aa0: 7228 696e 5f66 6561 7475 7265 733d 6869  r(in_features=hi
-00012ab0: 6464 656e 5f73 697a 652c 206f 7574 5f66  dden_size, out_f
-00012ac0: 6561 7475 7265 733d 7365 6c66 2e64 696d  eatures=self.dim
-00012ad0: 2929 0a0a 2020 2020 6465 6620 666f 7277  ))..    def forw
-00012ae0: 6172 6428 7365 6c66 2c20 783a 2053 6571  ard(self, x: Seq
-00012af0: 7565 6e63 6529 202d 3e20 5475 706c 655b  uence) -> Tuple[
-00012b00: 746f 7263 682e 5465 6e73 6f72 2c20 746f  torch.Tensor, to
-00012b10: 7263 682e 5465 6e73 6f72 5d3a 0a20 2020  rch.Tensor]:.   
-00012b20: 2020 2020 2022 2222 466f 7277 6172 6420       """Forward 
-00012b30: 7061 7373 2e0a 0a20 2020 2020 2020 2054  pass...        T
-00012b40: 6869 7320 7061 7274 6963 756c 6172 2074  his particular t
-00012b50: 7261 6e73 666f 726d 6174 696f 6e20 6973  ransformation is
-00012b60: 2072 6570 7265 7365 6e74 6564 2062 7920   represented by 
-00012b70: 7468 6520 666f 6c6c 6f77 696e 6720 6675  the following fu
-00012b80: 6e63 7469 6f6e 3a0a 2020 2020 2020 2020  nction:.        
-00012b90: 7920 3d20 7820 2b20 2831 202d 2078 2920  y = x + (1 - x) 
-00012ba0: 2a20 6578 7028 2073 2878 2929 202b 2074  * exp( s(x)) + t
-00012bb0: 2878 292c 2077 6865 7265 2074 2061 6e64  (x), where t and
-00012bc0: 2073 206e 6565 6473 2061 6e20 6163 7469   s needs an acti
-00012bd0: 7661 7469 6f6e 0a20 2020 2020 2020 2066  vation.        f
-00012be0: 756e 6374 696f 6e2e 2054 6869 7320 636c  unction. This cl
-00012bf0: 6173 7320 616c 736f 2072 6574 7572 6e73  ass also returns
-00012c00: 2074 6865 206c 6f67 6172 6974 686d 206f   the logarithm o
-00012c10: 6620 7468 6520 6a61 636f 6269 616e 730a  f the jacobians.
-00012c20: 2020 2020 2020 2020 6465 7465 726d 696e          determin
-00012c30: 616e 7420 7768 6963 6820 6973 2075 7365  ant which is use
-00012c40: 6675 6c20 7768 656e 2069 6e76 6572 7420  ful when invert 
-00012c50: 6120 7472 616e 7366 6f72 6d61 7469 6f6e  a transformation
-00012c60: 2061 6e64 2063 6f6d 7075 7465 0a20 2020   and compute.   
-00012c70: 2020 2020 2074 6865 2070 726f 6261 6269       the probabi
-00012c80: 6c69 7479 206f 6620 7468 6520 7472 616e  lity of the tran
-00012c90: 7366 6f72 6d61 7469 6f6e 2e0a 0a20 2020  sformation...   
-00012ca0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00012cb0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00012cc0: 2d2d 0a20 2020 2020 2020 2078 203a 2053  --.        x : S
-00012cd0: 6571 7565 6e63 650a 2020 2020 2020 2020  equence.        
-00012ce0: 2020 2020 5465 6e73 6f72 2073 616d 706c      Tensor sampl
-00012cf0: 6520 7769 7468 2074 6865 2069 6e69 7469  e with the initi
-00012d00: 616c 2064 6973 7472 6962 7574 696f 6e20  al distribution 
-00012d10: 6461 7461 2077 6869 6368 2077 696c 6c20  data which will 
-00012d20: 7061 7373 2069 6e74 6f0a 2020 2020 2020  pass into.      
-00012d30: 2020 2020 2020 7468 6520 6e6f 726d 616c        the normal
-00012d40: 697a 696e 6720 616c 676f 7269 7468 6d0a  izing algorithm.
-00012d50: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00012d60: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00012d70: 0a20 2020 2020 2020 2079 203a 2074 6f72  .        y : tor
-00012d80: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
-00012d90: 2020 2020 2020 5472 616e 7366 6f72 6d65        Transforme
-00012da0: 6420 7465 6e73 6f72 2061 6363 6f72 6469  d tensor accordi
-00012db0: 6e67 2074 6f20 5265 616c 204e 5650 206c  ng to Real NVP l
-00012dc0: 6179 6572 2077 6974 6820 7468 6520 7368  ayer with the sh
-00012dd0: 6170 6520 6f66 2027 7827 2e0a 2020 2020  ape of 'x'..    
-00012de0: 2020 2020 6c6f 675f 6465 745f 6a61 636f      log_det_jaco
-00012df0: 6269 616e 203a 2074 6f72 6368 2e54 656e  bian : torch.Ten
-00012e00: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-00012e10: 5465 6e73 6f72 2077 6869 6368 2072 6570  Tensor which rep
-00012e20: 7265 7365 6e74 7320 7468 6520 696e 666f  resents the info
-00012e30: 2061 626f 7574 2074 6865 2064 6576 6961   about the devia
-00012e40: 7469 6f6e 206f 6620 7468 6520 696e 6974  tion of the init
-00012e50: 6961 6c0a 2020 2020 2020 2020 2020 2020  ial.            
-00012e60: 616e 6420 7461 7267 6574 2064 6973 7472  and target distr
-00012e70: 6962 7574 696f 6e2e 0a0a 2020 2020 2020  ibution...      
-00012e80: 2020 2222 220a 2020 2020 2020 2020 785f    """.        x_
-00012e90: 6d61 736b 203d 2078 202a 2073 656c 662e  mask = x * self.
-00012ea0: 6d61 736b 0a20 2020 2020 2020 2073 203d  mask.        s =
-00012eb0: 2073 656c 662e 735f 6675 6e63 2878 5f6d   self.s_func(x_m
-00012ec0: 6173 6b29 202a 2073 656c 662e 7363 616c  ask) * self.scal
-00012ed0: 650a 2020 2020 2020 2020 7420 3d20 7365  e.        t = se
-00012ee0: 6c66 2e74 5f66 756e 6328 785f 6d61 736b  lf.t_func(x_mask
-00012ef0: 290a 0a20 2020 2020 2020 2079 203d 2078  )..        y = x
-00012f00: 5f6d 6173 6b20 2b20 2831 202d 2073 656c  _mask + (1 - sel
-00012f10: 662e 6d61 736b 2920 2a20 2878 202a 2074  f.mask) * (x * t
-00012f20: 6f72 6368 2e65 7870 2873 2920 2b20 7429  orch.exp(s) + t)
-00012f30: 0a0a 2020 2020 2020 2020 6c6f 675f 6465  ..        log_de
-00012f40: 745f 6a61 636f 6269 616e 203d 2028 2831  t_jacobian = ((1
-00012f50: 202d 2073 656c 662e 6d61 736b 2920 2a20   - self.mask) * 
-00012f60: 7329 2e73 756d 282d 3129 0a20 2020 2020  s).sum(-1).     
-00012f70: 2020 2072 6574 7572 6e20 792c 206c 6f67     return y, log
-00012f80: 5f64 6574 5f6a 6163 6f62 6961 6e0a 0a20  _det_jacobian.. 
-00012f90: 2020 2064 6566 2069 6e76 6572 7365 2873     def inverse(s
-00012fa0: 656c 662c 2079 3a20 5365 7175 656e 6365  elf, y: Sequence
-00012fb0: 2920 2d3e 2054 7570 6c65 5b74 6f72 6368  ) -> Tuple[torch
-00012fc0: 2e54 656e 736f 722c 2074 6f72 6368 2e54  .Tensor, torch.T
-00012fd0: 656e 736f 725d 3a0a 2020 2020 2020 2020  ensor]:.        
-00012fe0: 2222 2220 496e 7665 7273 6520 7061 7373  """ Inverse pass
-00012ff0: 0a0a 2020 2020 2020 2020 5468 6973 2063  ..        This c
-00013000: 6c61 7373 2070 6572 666f 726d 7320 7468  lass performs th
-00013010: 6520 696e 7665 7273 6520 6f66 2074 6865  e inverse of the
-00013020: 2070 7265 7669 6f75 7320 6d65 7468 6f64   previous method
-00013030: 2028 666f 726d 7761 7264 292e 0a20 2020   (formward)..   
-00013040: 2020 2020 2041 6c73 6f2c 2074 6869 7320       Also, this 
-00013050: 6d65 7465 686f 6420 7265 7475 726e 7320  metehod returns 
-00013060: 7468 6520 6c6f 6761 7269 7468 6d20 6f66  the logarithm of
-00013070: 2074 6865 206a 6163 6f62 6961 6e73 2064   the jacobians d
-00013080: 6574 6572 6d69 6e61 6e74 0a20 2020 2020  eterminant.     
-00013090: 2020 2077 6869 6368 2069 7320 7573 6566     which is usef
-000130a0: 756c 2074 6f20 636f 6d70 7574 6520 7468  ul to compute th
-000130b0: 6520 6c65 6172 6e65 6162 6c65 2066 6561  e learneable fea
-000130c0: 7475 7265 7320 6f66 2074 6172 6765 7420  tures of target 
-000130d0: 6469 7374 7269 6275 7469 6f6e 2e0a 0a20  distribution... 
-000130e0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-000130f0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00013100: 2d2d 2d2d 0a20 2020 2020 2020 2079 203a  ----.        y :
-00013110: 2053 6571 7565 6e63 650a 2020 2020 2020   Sequence.      
-00013120: 2020 2020 2020 5465 6e73 6f72 2073 616d        Tensor sam
-00013130: 706c 6520 7769 7468 2074 7261 6e73 666f  ple with transfo
-00013140: 726d 6564 2064 6973 7472 6962 7574 696f  rmed distributio
-00013150: 6e20 6461 7461 2077 6869 6368 2077 696c  n data which wil
-00013160: 6c20 6265 2075 7365 6420 696e 0a20 2020  l be used in.   
-00013170: 2020 2020 2020 2020 2074 6865 206e 6f72           the nor
-00013180: 6d61 6c69 7a69 6e67 2061 6c67 6f72 6974  malizing algorit
-00013190: 686d 2069 6e76 6572 7365 2070 6173 732e  hm inverse pass.
-000131a0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000131b0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-000131c0: 2d0a 2020 2020 2020 2020 7820 3a20 746f  -.        x : to
-000131d0: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-000131e0: 2020 2020 2020 2054 7261 6e73 666f 726d         Transform
-000131f0: 6564 2074 656e 736f 7220 6163 636f 7264  ed tensor accord
-00013200: 696e 6720 746f 2052 6561 6c20 4e56 5020  ing to Real NVP 
-00013210: 6c61 7965 7220 7769 7468 2074 6865 2073  layer with the s
-00013220: 6861 7065 206f 6620 2779 272e 0a20 2020  hape of 'y'..   
-00013230: 2020 2020 2069 6e76 6572 7365 5f6c 6f67       inverse_log
-00013240: 5f64 6574 5f6a 6163 6f62 6961 6e20 3a20  _det_jacobian : 
-00013250: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-00013260: 2020 2020 2020 2020 2054 656e 736f 7220           Tensor 
-00013270: 7768 6963 6820 7265 7072 6573 656e 7473  which represents
-00013280: 2074 6865 2069 6e66 6f72 6d61 7469 6f6e   the information
-00013290: 206f 6620 7468 6520 6465 7669 6174 696f   of the deviatio
-000132a0: 6e20 6f66 2074 6865 2069 6e69 7469 616c  n of the initial
-000132b0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-000132c0: 2074 6172 6765 7420 6469 7374 7269 6275   target distribu
-000132d0: 7469 6f6e 2e0a 0a20 2020 2020 2020 2022  tion...        "
-000132e0: 2222 0a20 2020 2020 2020 2079 5f6d 6173  "".        y_mas
-000132f0: 6b20 3d20 7920 2a20 7365 6c66 2e6d 6173  k = y * self.mas
-00013300: 6b0a 2020 2020 2020 2020 7320 3d20 7365  k.        s = se
-00013310: 6c66 2e73 5f66 756e 6328 795f 6d61 736b  lf.s_func(y_mask
-00013320: 2920 2a20 7365 6c66 2e73 6361 6c65 0a20  ) * self.scale. 
-00013330: 2020 2020 2020 2074 203d 2073 656c 662e         t = self.
-00013340: 745f 6675 6e63 2879 5f6d 6173 6b29 0a0a  t_func(y_mask)..
-00013350: 2020 2020 2020 2020 7820 3d20 795f 6d61          x = y_ma
-00013360: 736b 202b 2028 3120 2d20 7365 6c66 2e6d  sk + (1 - self.m
-00013370: 6173 6b29 202a 2028 7920 2d20 7429 202a  ask) * (y - t) *
-00013380: 2074 6f72 6368 2e65 7870 282d 7329 0a0a   torch.exp(-s)..
-00013390: 2020 2020 2020 2020 696e 7665 7273 655f          inverse_
-000133a0: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
-000133b0: 203d 2028 2831 202d 2073 656c 662e 6d61   = ((1 - self.ma
-000133c0: 736b 2920 2a20 2d73 292e 7375 6d28 2d31  sk) * -s).sum(-1
-000133d0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000133e0: 6e20 782c 2069 6e76 6572 7365 5f6c 6f67  n x, inverse_log
-000133f0: 5f64 6574 5f6a 6163 6f62 6961 6e0a 0a0a  _det_jacobian...
-00013400: 636c 6173 7320 4e65 6967 6862 6f72 4c69  class NeighborLi
-00013410: 7374 286e 6e2e 4d6f 6475 6c65 293a 0a20  st(nn.Module):. 
-00013420: 2020 2022 2222 436f 6d70 7574 6573 2061     """Computes a
-00013430: 206e 6569 6768 626f 722d 6c69 7374 2069   neighbor-list i
-00013440: 6e20 5079 546f 7263 682e 0a0a 2020 2020  n PyTorch...    
-00013450: 4e65 6967 6862 6f72 2d6c 6973 7473 2028  Neighbor-lists (
-00013460: 616c 736f 2063 616c 6c65 6420 5665 726c  also called Verl
-00013470: 6574 204c 6973 7473 2920 6172 6520 6120  et Lists) are a 
-00013480: 746f 6f6c 2066 6f72 2067 726f 7570 696e  tool for groupin
-00013490: 670a 2020 2020 6174 6f6d 7320 7768 6963  g.    atoms whic
-000134a0: 6820 6172 6520 636c 6f73 6520 746f 2065  h are close to e
-000134b0: 6163 6820 6f74 6865 7220 7370 6174 6961  ach other spatia
-000134c0: 6c6c 792e 2054 6869 7320 6c61 7965 7220  lly. This layer 
-000134d0: 636f 6d70 7574 6573 2061 0a20 2020 204e  computes a.    N
-000134e0: 6569 6768 626f 7220 4c69 7374 2066 726f  eighbor List fro
-000134f0: 6d20 6120 7072 6f76 6964 6564 2074 656e  m a provided ten
-00013500: 736f 7220 6f66 2061 746f 6d69 6320 636f  sor of atomic co
-00013510: 6f72 6469 6e61 7465 732e 2059 6f75 2063  ordinates. You c
-00013520: 616e 0a20 2020 2074 6869 6e6b 206f 6620  an.    think of 
-00013530: 7468 6973 2061 7320 6120 6765 6e65 7261  this as a genera
-00013540: 6c20 226b 2d6d 6561 6e73 2220 6c61 7965  l "k-means" laye
-00013550: 722c 2062 7574 206f 7074 696d 697a 6564  r, but optimized
-00013560: 2066 6f72 2074 6865 0a20 2020 2063 6173   for the.    cas
-00013570: 6520 606b 3d3d 3360 2e0a 0a20 2020 2045  e `k==3`...    E
-00013580: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
-00013590: 2d2d 2d2d 0a20 2020 203e 3e3e 204e 5f61  ----.    >>> N_a
-000135a0: 746f 6d73 203d 2035 0a20 2020 203e 3e3e  toms = 5.    >>>
-000135b0: 2073 7461 7274 203d 2030 0a20 2020 203e   start = 0.    >
-000135c0: 3e3e 2073 746f 7020 3d20 3132 0a20 2020  >> stop = 12.   
-000135d0: 203e 3e3e 206e 6272 5f63 7574 6f66 6620   >>> nbr_cutoff 
-000135e0: 3d20 330a 2020 2020 3e3e 3e20 6e64 696d  = 3.    >>> ndim
-000135f0: 203d 2033 0a20 2020 203e 3e3e 204d 5f6e   = 3.    >>> M_n
-00013600: 6272 7320 3d20 320a 2020 2020 3e3e 3e20  brs = 2.    >>> 
-00013610: 636f 6f72 6473 203d 2073 7461 7274 202b  coords = start +
-00013620: 206e 702e 7261 6e64 6f6d 2e72 616e 6428   np.random.rand(
-00013630: 4e5f 6174 6f6d 732c 206e 6469 6d29 202a  N_atoms, ndim) *
-00013640: 2028 7374 6f70 202d 2073 7461 7274 290a   (stop - start).
-00013650: 2020 2020 3e3e 3e20 636f 6f72 6473 203d      >>> coords =
-00013660: 2074 6f72 6368 2e61 735f 7465 6e73 6f72   torch.as_tensor
-00013670: 2863 6f6f 7264 732c 2064 7479 7065 3d74  (coords, dtype=t
-00013680: 6f72 6368 2e66 6c6f 6174 290a 2020 2020  orch.float).    
-00013690: 3e3e 3e20 6c61 7965 7220 3d20 4e65 6967  >>> layer = Neig
-000136a0: 6862 6f72 4c69 7374 284e 5f61 746f 6d73  hborList(N_atoms
-000136b0: 2c20 4d5f 6e62 7273 2c20 6e64 696d 2c20  , M_nbrs, ndim, 
-000136c0: 6e62 725f 6375 746f 6666 2c20 7374 6172  nbr_cutoff, star
-000136d0: 742c 0a20 2020 202e 2e2e 2020 2020 2020  t,.    ...      
+00012000: 2020 2020 2020 2020 2020 2020 2028 312c               (1,
+00012010: 204d 5f6e 6272 732c 2031 2929 0a20 2020   M_nbrs, 1)).   
+00012020: 2020 2020 2023 2053 6861 7065 2028 4e5f       # Shape (N_
+00012030: 6174 6f6d 732c 204d 5f6e 6272 7329 0a20  atoms, M_nbrs). 
+00012040: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
+00012050: 7263 682e 7375 6d28 2874 696c 6564 5f63  rch.sum((tiled_c
+00012060: 6f6f 7264 7320 2d20 6e62 725f 636f 6f72  oords - nbr_coor
+00012070: 6473 292a 2a32 2c20 6469 6d3d 3229 0a0a  ds)**2, dim=2)..
+00012080: 0a63 6c61 7373 2052 6561 6c4e 5650 4c61  .class RealNVPLa
+00012090: 7965 7228 6e6e 2e4d 6f64 756c 6529 3a0a  yer(nn.Module):.
+000120a0: 2020 2020 2222 2252 6561 6c20 4e56 5020      """Real NVP 
+000120b0: 5472 616e 7366 6f72 6d61 7469 6f6e 204c  Transformation L
+000120c0: 6179 6572 0a0a 2020 2020 5468 6973 2063  ayer..    This c
+000120d0: 6c61 7373 2063 6c61 7373 2069 7320 6120  lass class is a 
+000120e0: 636f 6e73 7472 7563 746f 7220 7472 616e  constructor tran
+000120f0: 7366 6f72 6d61 7469 6f6e 206c 6179 6572  sformation layer
+00012100: 2075 7365 6420 6f6e 2061 0a20 2020 204e   used on a.    N
+00012110: 6f72 6d61 6c69 7a69 6e67 464c 6f77 206d  ormalizingFLow m
+00012120: 6f64 656c 2e20 2054 6865 2052 6561 6c20  odel.  The Real 
+00012130: 4e6f 6e2d 5072 6573 6572 7669 6e67 2d56  Non-Preserving-V
+00012140: 6f6c 756d 656e 2028 5265 616c 204e 5650  olumen (Real NVP
+00012150: 2920 6973 2061 2074 7970 650a 2020 2020  ) is a type.    
+00012160: 6f66 206e 6f72 6d61 6c69 7a69 6e67 2066  of normalizing f
+00012170: 6c6f 7720 6c61 7965 7220 7768 6963 6820  low layer which 
+00012180: 6769 7665 7320 6164 7661 6e74 6167 6573  gives advantages
+00012190: 206f 7665 7220 7468 6973 206d 6169 6e6c   over this mainl
+000121a0: 7920 6265 6361 7573 6520 616e 0a20 2020  y because an.   
+000121b0: 2065 6173 6520 746f 2063 6f6d 7075 7465   ease to compute
+000121c0: 2074 6865 2069 6e76 6572 7365 2070 6173   the inverse pas
+000121d0: 7320 5b31 5d5f 2c20 7468 6973 2069 7320  s [1]_, this is 
+000121e0: 746f 206c 6561 726e 2061 2074 6172 6765  to learn a targe
+000121f0: 740a 2020 2020 6469 7374 7269 6275 7469  t.    distributi
+00012200: 6f6e 2e0a 0a20 2020 2045 7861 6d70 6c65  on...    Example
+00012210: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+00012220: 203e 3e3e 2069 6d70 6f72 7420 746f 7263   >>> import torc
+00012230: 680a 2020 2020 3e3e 3e20 696d 706f 7274  h.    >>> import
+00012240: 2074 6f72 6368 2e6e 6e20 6173 206e 6e0a   torch.nn as nn.
+00012250: 2020 2020 3e3e 3e20 6672 6f6d 2074 6f72      >>> from tor
+00012260: 6368 2e64 6973 7472 6962 7574 696f 6e73  ch.distributions
+00012270: 2069 6d70 6f72 7420 4d75 6c74 6976 6172   import Multivar
+00012280: 6961 7465 4e6f 726d 616c 0a20 2020 203e  iateNormal.    >
+00012290: 3e3e 2066 726f 6d20 6465 6570 6368 656d  >> from deepchem
+000122a0: 2e6d 6f64 656c 732e 746f 7263 685f 6d6f  .models.torch_mo
+000122b0: 6465 6c73 2e6c 6179 6572 7320 696d 706f  dels.layers impo
+000122c0: 7274 2052 6561 6c4e 5650 4c61 7965 720a  rt RealNVPLayer.
+000122d0: 2020 2020 3e3e 3e20 6469 6d20 3d20 320a      >>> dim = 2.
+000122e0: 2020 2020 3e3e 3e20 7361 6d70 6c65 7320      >>> samples 
+000122f0: 3d20 3936 0a20 2020 203e 3e3e 2064 6174  = 96.    >>> dat
+00012300: 6120 3d20 4d75 6c74 6976 6172 6961 7465  a = Multivariate
+00012310: 4e6f 726d 616c 2874 6f72 6368 2e7a 6572  Normal(torch.zer
+00012320: 6f73 2864 696d 292c 2074 6f72 6368 2e65  os(dim), torch.e
+00012330: 7965 2864 696d 2929 0a20 2020 203e 3e3e  ye(dim)).    >>>
+00012340: 2074 656e 736f 7220 3d20 6461 7461 2e73   tensor = data.s
+00012350: 616d 706c 6528 746f 7263 682e 5369 7a65  ample(torch.Size
+00012360: 2828 7361 6d70 6c65 732c 2064 696d 2929  ((samples, dim))
+00012370: 290a 0a20 2020 203e 3e3e 206c 6179 6572  )..    >>> layer
+00012380: 7320 3d20 340a 2020 2020 3e3e 3e20 6869  s = 4.    >>> hi
+00012390: 6464 656e 5f73 697a 6520 3d20 3136 0a20  dden_size = 16. 
+000123a0: 2020 203e 3e3e 206d 6173 6b73 203d 2046     >>> masks = F
+000123b0: 2e6f 6e65 5f68 6f74 2874 6f72 6368 2e74  .one_hot(torch.t
+000123c0: 656e 736f 7228 5b69 2025 2032 2066 6f72  ensor([i % 2 for
+000123d0: 2069 2069 6e20 7261 6e67 6528 6c61 7965   i in range(laye
+000123e0: 7273 295d 2929 2e66 6c6f 6174 2829 0a20  rs)])).float(). 
+000123f0: 2020 203e 3e3e 206c 6179 6572 7320 3d20     >>> layers = 
+00012400: 6e6e 2e4d 6f64 756c 654c 6973 7428 5b52  nn.ModuleList([R
+00012410: 6561 6c4e 5650 4c61 7965 7228 6d61 736b  ealNVPLayer(mask
+00012420: 2c20 6869 6464 656e 5f73 697a 6529 2066  , hidden_size) f
+00012430: 6f72 206d 6173 6b20 696e 206d 6173 6b73  or mask in masks
+00012440: 5d29 0a0a 2020 2020 3e3e 3e20 666f 7220  ])..    >>> for 
+00012450: 6c61 7965 7220 696e 206c 6179 6572 733a  layer in layers:
+00012460: 0a20 2020 202e 2e2e 2020 205f 2c20 696e  .    ...   _, in
+00012470: 7665 7273 655f 6c6f 675f 6465 745f 6a61  verse_log_det_ja
+00012480: 636f 6269 616e 203d 206c 6179 6572 2e69  cobian = layer.i
+00012490: 6e76 6572 7365 2874 656e 736f 7229 0a20  nverse(tensor). 
+000124a0: 2020 202e 2e2e 2020 2069 6e76 6572 7365     ...   inverse
+000124b0: 5f6c 6f67 5f64 6574 5f6a 6163 6f62 6961  _log_det_jacobia
+000124c0: 6e20 3d20 696e 7665 7273 655f 6c6f 675f  n = inverse_log_
+000124d0: 6465 745f 6a61 636f 6269 616e 2e64 6574  det_jacobian.det
+000124e0: 6163 6828 292e 6e75 6d70 7928 290a 2020  ach().numpy().  
+000124f0: 2020 3e3e 3e20 6c65 6e28 696e 7665 7273    >>> len(invers
+00012500: 655f 6c6f 675f 6465 745f 6a61 636f 6269  e_log_det_jacobi
+00012510: 616e 290a 2020 2020 3936 0a0a 2020 2020  an).    96..    
+00012520: 5265 6665 7265 6e63 6573 0a20 2020 202d  References.    -
+00012530: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2e2e  ---------.    ..
+00012540: 205b 315d 2053 7469 6d70 6572 2c20 562e   [1] Stimper, V.
+00012550: 2c20 5363 68c3 b66c 6b6f 7066 2c20 422e  , Sch..lkopf, B.
+00012560: 2c20 2620 4865 726e c3a1 6e64 657a 2d4c  , & Hern..ndez-L
+00012570: 6f62 6174 6f2c 204a 2e20 4d2e 2028 3230  obato, J. M. (20
+00012580: 3231 292e 2052 6573 616d 706c 696e 6720  21). Resampling 
+00012590: 4261 7365 0a20 2020 2044 6973 7472 6962  Base.    Distrib
+000125a0: 7574 696f 6e73 206f 6620 4e6f 726d 616c  utions of Normal
+000125b0: 697a 696e 6720 466c 6f77 732e 2028 3230  izing Flows. (20
+000125c0: 3137 292e 2052 6574 7269 6576 6564 2066  17). Retrieved f
+000125d0: 726f 6d20 6874 7470 3a2f 2f61 7278 6976  rom http://arxiv
+000125e0: 2e6f 7267 2f61 6273 2f32 3131 302e 3135  .org/abs/2110.15
+000125f0: 3832 380a 2020 2020 2222 220a 0a20 2020  828.    """..   
+00012600: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00012610: 6c66 2c20 6d61 736b 3a20 746f 7263 682e  lf, mask: torch.
+00012620: 5465 6e73 6f72 2c20 6869 6464 656e 5f73  Tensor, hidden_s
+00012630: 697a 653a 2069 6e74 2920 2d3e 204e 6f6e  ize: int) -> Non
+00012640: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00012650: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00012660: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00012670: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6d61  -----.        ma
+00012680: 736b 3a20 746f 7263 682e 5465 6e73 6f72  sk: torch.Tensor
+00012690: 0a20 2020 2020 2020 2020 2020 2054 656e  .            Ten
+000126a0: 736f 7220 7769 7468 207a 6572 6f73 2061  sor with zeros a
+000126b0: 6e64 206f 6e65 7320 616e 6420 6974 7320  nd ones and its 
+000126c0: 7369 7a65 2064 6570 656e 6465 206f 6e20  size depende on 
+000126d0: 7468 6520 6e75 6d62 6572 206f 6620 6c61  the number of la
+000126e0: 7965 7273 0a20 2020 2020 2020 2020 2020  yers.           
+000126f0: 2061 6e64 2064 696d 656e 7373 696f 6e73   and dimenssions
+00012700: 2074 6865 2075 7365 7220 7265 7175 6573   the user reques
+00012710: 742e 0a20 2020 2020 2020 2068 6964 6465  t..        hidde
+00012720: 6e5f 7369 7a65 3a20 696e 740a 2020 2020  n_size: int.    
+00012730: 2020 2020 2020 2020 5468 6520 7369 7a65          The size
+00012740: 206f 6620 7468 6520 6f75 7470 7574 7320   of the outputs 
+00012750: 616e 6420 696e 7075 7473 2075 7365 6420  and inputs used 
+00012760: 6f6e 2074 6865 2069 6e74 6572 6e61 6c20  on the internal 
+00012770: 6e6f 6465 7320 6f66 2074 6865 0a20 2020  nodes of the.   
+00012780: 2020 2020 2020 2020 2074 7261 6e73 666f           transfo
+00012790: 726d 6174 696f 6e20 6c61 7965 722e 0a0a  rmation layer...
+000127a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000127b0: 2020 2020 7375 7065 7228 5265 616c 4e56      super(RealNV
+000127c0: 504c 6179 6572 2c20 7365 6c66 292e 5f5f  PLayer, self).__
+000127d0: 696e 6974 5f5f 2829 0a20 2020 2020 2020  init__().       
+000127e0: 2073 656c 662e 6d61 736b 203d 206e 6e2e   self.mask = nn.
+000127f0: 5061 7261 6d65 7465 7228 6d61 736b 2c20  Parameter(mask, 
+00012800: 7265 7175 6972 6573 5f67 7261 643d 4661  requires_grad=Fa
+00012810: 6c73 6529 0a20 2020 2020 2020 2073 656c  lse).        sel
+00012820: 662e 6469 6d20 3d20 6c65 6e28 6d61 736b  f.dim = len(mask
+00012830: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00012840: 735f 6675 6e63 203d 206e 6e2e 5365 7175  s_func = nn.Sequ
+00012850: 656e 7469 616c 280a 2020 2020 2020 2020  ential(.        
+00012860: 2020 2020 6e6e 2e4c 696e 6561 7228 696e      nn.Linear(in
+00012870: 5f66 6561 7475 7265 733d 7365 6c66 2e64  _features=self.d
+00012880: 696d 2c20 6f75 745f 6665 6174 7572 6573  im, out_features
+00012890: 3d68 6964 6465 6e5f 7369 7a65 292c 0a20  =hidden_size),. 
+000128a0: 2020 2020 2020 2020 2020 206e 6e2e 4c65             nn.Le
+000128b0: 616b 7952 654c 5528 292c 0a20 2020 2020  akyReLU(),.     
+000128c0: 2020 2020 2020 206e 6e2e 4c69 6e65 6172         nn.Linear
+000128d0: 2869 6e5f 6665 6174 7572 6573 3d68 6964  (in_features=hid
+000128e0: 6465 6e5f 7369 7a65 2c20 6f75 745f 6665  den_size, out_fe
+000128f0: 6174 7572 6573 3d68 6964 6465 6e5f 7369  atures=hidden_si
+00012900: 7a65 292c 0a20 2020 2020 2020 2020 2020  ze),.           
+00012910: 206e 6e2e 4c65 616b 7952 654c 5528 292c   nn.LeakyReLU(),
+00012920: 0a20 2020 2020 2020 2020 2020 206e 6e2e  .            nn.
+00012930: 4c69 6e65 6172 2869 6e5f 6665 6174 7572  Linear(in_featur
+00012940: 6573 3d68 6964 6465 6e5f 7369 7a65 2c20  es=hidden_size, 
+00012950: 6f75 745f 6665 6174 7572 6573 3d73 656c  out_features=sel
+00012960: 662e 6469 6d29 290a 0a20 2020 2020 2020  f.dim))..       
+00012970: 2073 656c 662e 7363 616c 6520 3d20 6e6e   self.scale = nn
+00012980: 2e50 6172 616d 6574 6572 2874 6f72 6368  .Parameter(torch
+00012990: 2e54 656e 736f 7228 7365 6c66 2e64 696d  .Tensor(self.dim
+000129a0: 2929 0a0a 2020 2020 2020 2020 7365 6c66  ))..        self
+000129b0: 2e74 5f66 756e 6320 3d20 6e6e 2e53 6571  .t_func = nn.Seq
+000129c0: 7565 6e74 6961 6c28 0a20 2020 2020 2020  uential(.       
+000129d0: 2020 2020 206e 6e2e 4c69 6e65 6172 2869       nn.Linear(i
+000129e0: 6e5f 6665 6174 7572 6573 3d73 656c 662e  n_features=self.
+000129f0: 6469 6d2c 206f 7574 5f66 6561 7475 7265  dim, out_feature
+00012a00: 733d 6869 6464 656e 5f73 697a 6529 2c0a  s=hidden_size),.
+00012a10: 2020 2020 2020 2020 2020 2020 6e6e 2e4c              nn.L
+00012a20: 6561 6b79 5265 4c55 2829 2c0a 2020 2020  eakyReLU(),.    
+00012a30: 2020 2020 2020 2020 6e6e 2e4c 696e 6561          nn.Linea
+00012a40: 7228 696e 5f66 6561 7475 7265 733d 6869  r(in_features=hi
+00012a50: 6464 656e 5f73 697a 652c 206f 7574 5f66  dden_size, out_f
+00012a60: 6561 7475 7265 733d 6869 6464 656e 5f73  eatures=hidden_s
+00012a70: 697a 6529 2c0a 2020 2020 2020 2020 2020  ize),.          
+00012a80: 2020 6e6e 2e4c 6561 6b79 5265 4c55 2829    nn.LeakyReLU()
+00012a90: 2c0a 2020 2020 2020 2020 2020 2020 6e6e  ,.            nn
+00012aa0: 2e4c 696e 6561 7228 696e 5f66 6561 7475  .Linear(in_featu
+00012ab0: 7265 733d 6869 6464 656e 5f73 697a 652c  res=hidden_size,
+00012ac0: 206f 7574 5f66 6561 7475 7265 733d 7365   out_features=se
+00012ad0: 6c66 2e64 696d 2929 0a0a 2020 2020 6465  lf.dim))..    de
+00012ae0: 6620 666f 7277 6172 6428 7365 6c66 2c20  f forward(self, 
+00012af0: 783a 2053 6571 7565 6e63 6529 202d 3e20  x: Sequence) -> 
+00012b00: 5475 706c 655b 746f 7263 682e 5465 6e73  Tuple[torch.Tens
+00012b10: 6f72 2c20 746f 7263 682e 5465 6e73 6f72  or, torch.Tensor
+00012b20: 5d3a 0a20 2020 2020 2020 2022 2222 466f  ]:.        """Fo
+00012b30: 7277 6172 6420 7061 7373 2e0a 0a20 2020  rward pass...   
+00012b40: 2020 2020 2054 6869 7320 7061 7274 6963       This partic
+00012b50: 756c 6172 2074 7261 6e73 666f 726d 6174  ular transformat
+00012b60: 696f 6e20 6973 2072 6570 7265 7365 6e74  ion is represent
+00012b70: 6564 2062 7920 7468 6520 666f 6c6c 6f77  ed by the follow
+00012b80: 696e 6720 6675 6e63 7469 6f6e 3a0a 2020  ing function:.  
+00012b90: 2020 2020 2020 7920 3d20 7820 2b20 2831        y = x + (1
+00012ba0: 202d 2078 2920 2a20 6578 7028 2073 2878   - x) * exp( s(x
+00012bb0: 2929 202b 2074 2878 292c 2077 6865 7265  )) + t(x), where
+00012bc0: 2074 2061 6e64 2073 206e 6565 6473 2061   t and s needs a
+00012bd0: 6e20 6163 7469 7661 7469 6f6e 0a20 2020  n activation.   
+00012be0: 2020 2020 2066 756e 6374 696f 6e2e 2054       function. T
+00012bf0: 6869 7320 636c 6173 7320 616c 736f 2072  his class also r
+00012c00: 6574 7572 6e73 2074 6865 206c 6f67 6172  eturns the logar
+00012c10: 6974 686d 206f 6620 7468 6520 6a61 636f  ithm of the jaco
+00012c20: 6269 616e 730a 2020 2020 2020 2020 6465  bians.        de
+00012c30: 7465 726d 696e 616e 7420 7768 6963 6820  terminant which 
+00012c40: 6973 2075 7365 6675 6c20 7768 656e 2069  is useful when i
+00012c50: 6e76 6572 7420 6120 7472 616e 7366 6f72  nvert a transfor
+00012c60: 6d61 7469 6f6e 2061 6e64 2063 6f6d 7075  mation and compu
+00012c70: 7465 0a20 2020 2020 2020 2074 6865 2070  te.        the p
+00012c80: 726f 6261 6269 6c69 7479 206f 6620 7468  robability of th
+00012c90: 6520 7472 616e 7366 6f72 6d61 7469 6f6e  e transformation
+00012ca0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00012cb0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00012cc0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00012cd0: 2078 203a 2053 6571 7565 6e63 650a 2020   x : Sequence.  
+00012ce0: 2020 2020 2020 2020 2020 5465 6e73 6f72            Tensor
+00012cf0: 2073 616d 706c 6520 7769 7468 2074 6865   sample with the
+00012d00: 2069 6e69 7469 616c 2064 6973 7472 6962   initial distrib
+00012d10: 7574 696f 6e20 6461 7461 2077 6869 6368  ution data which
+00012d20: 2077 696c 6c20 7061 7373 2069 6e74 6f0a   will pass into.
+00012d30: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00012d40: 6e6f 726d 616c 697a 696e 6720 616c 676f  normalizing algo
+00012d50: 7269 7468 6d0a 0a20 2020 2020 2020 2052  rithm..        R
+00012d60: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+00012d70: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2079  ------.        y
+00012d80: 203a 2074 6f72 6368 2e54 656e 736f 720a   : torch.Tensor.
+00012d90: 2020 2020 2020 2020 2020 2020 5472 616e              Tran
+00012da0: 7366 6f72 6d65 6420 7465 6e73 6f72 2061  sformed tensor a
+00012db0: 6363 6f72 6469 6e67 2074 6f20 5265 616c  ccording to Real
+00012dc0: 204e 5650 206c 6179 6572 2077 6974 6820   NVP layer with 
+00012dd0: 7468 6520 7368 6170 6520 6f66 2027 7827  the shape of 'x'
+00012de0: 2e0a 2020 2020 2020 2020 6c6f 675f 6465  ..        log_de
+00012df0: 745f 6a61 636f 6269 616e 203a 2074 6f72  t_jacobian : tor
+00012e00: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+00012e10: 2020 2020 2020 5465 6e73 6f72 2077 6869        Tensor whi
+00012e20: 6368 2072 6570 7265 7365 6e74 7320 7468  ch represents th
+00012e30: 6520 696e 666f 2061 626f 7574 2074 6865  e info about the
+00012e40: 2064 6576 6961 7469 6f6e 206f 6620 7468   deviation of th
+00012e50: 6520 696e 6974 6961 6c0a 2020 2020 2020  e initial.      
+00012e60: 2020 2020 2020 616e 6420 7461 7267 6574        and target
+00012e70: 2064 6973 7472 6962 7574 696f 6e2e 0a0a   distribution...
+00012e80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012e90: 2020 2020 785f 6d61 736b 203d 2078 202a      x_mask = x *
+00012ea0: 2073 656c 662e 6d61 736b 0a20 2020 2020   self.mask.     
+00012eb0: 2020 2073 203d 2073 656c 662e 735f 6675     s = self.s_fu
+00012ec0: 6e63 2878 5f6d 6173 6b29 202a 2073 656c  nc(x_mask) * sel
+00012ed0: 662e 7363 616c 650a 2020 2020 2020 2020  f.scale.        
+00012ee0: 7420 3d20 7365 6c66 2e74 5f66 756e 6328  t = self.t_func(
+00012ef0: 785f 6d61 736b 290a 0a20 2020 2020 2020  x_mask)..       
+00012f00: 2079 203d 2078 5f6d 6173 6b20 2b20 2831   y = x_mask + (1
+00012f10: 202d 2073 656c 662e 6d61 736b 2920 2a20   - self.mask) * 
+00012f20: 2878 202a 2074 6f72 6368 2e65 7870 2873  (x * torch.exp(s
+00012f30: 2920 2b20 7429 0a0a 2020 2020 2020 2020  ) + t)..        
+00012f40: 6c6f 675f 6465 745f 6a61 636f 6269 616e  log_det_jacobian
+00012f50: 203d 2028 2831 202d 2073 656c 662e 6d61   = ((1 - self.ma
+00012f60: 736b 2920 2a20 7329 2e73 756d 282d 3129  sk) * s).sum(-1)
+00012f70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012f80: 792c 206c 6f67 5f64 6574 5f6a 6163 6f62  y, log_det_jacob
+00012f90: 6961 6e0a 0a20 2020 2064 6566 2069 6e76  ian..    def inv
+00012fa0: 6572 7365 2873 656c 662c 2079 3a20 5365  erse(self, y: Se
+00012fb0: 7175 656e 6365 2920 2d3e 2054 7570 6c65  quence) -> Tuple
+00012fc0: 5b74 6f72 6368 2e54 656e 736f 722c 2074  [torch.Tensor, t
+00012fd0: 6f72 6368 2e54 656e 736f 725d 3a0a 2020  orch.Tensor]:.  
+00012fe0: 2020 2020 2020 2222 2220 496e 7665 7273        """ Invers
+00012ff0: 6520 7061 7373 0a0a 2020 2020 2020 2020  e pass..        
+00013000: 5468 6973 2063 6c61 7373 2070 6572 666f  This class perfo
+00013010: 726d 7320 7468 6520 696e 7665 7273 6520  rms the inverse 
+00013020: 6f66 2074 6865 2070 7265 7669 6f75 7320  of the previous 
+00013030: 6d65 7468 6f64 2028 666f 726d 7761 7264  method (formward
+00013040: 292e 0a20 2020 2020 2020 2041 6c73 6f2c  )..        Also,
+00013050: 2074 6869 7320 6d65 7465 686f 6420 7265   this metehod re
+00013060: 7475 726e 7320 7468 6520 6c6f 6761 7269  turns the logari
+00013070: 7468 6d20 6f66 2074 6865 206a 6163 6f62  thm of the jacob
+00013080: 6961 6e73 2064 6574 6572 6d69 6e61 6e74  ians determinant
+00013090: 0a20 2020 2020 2020 2077 6869 6368 2069  .        which i
+000130a0: 7320 7573 6566 756c 2074 6f20 636f 6d70  s useful to comp
+000130b0: 7574 6520 7468 6520 6c65 6172 6e65 6162  ute the learneab
+000130c0: 6c65 2066 6561 7475 7265 7320 6f66 2074  le features of t
+000130d0: 6172 6765 7420 6469 7374 7269 6275 7469  arget distributi
+000130e0: 6f6e 2e0a 0a20 2020 2020 2020 2050 6172  on...        Par
+000130f0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+00013100: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00013110: 2020 2079 203a 2053 6571 7565 6e63 650a     y : Sequence.
+00013120: 2020 2020 2020 2020 2020 2020 5465 6e73              Tens
+00013130: 6f72 2073 616d 706c 6520 7769 7468 2074  or sample with t
+00013140: 7261 6e73 666f 726d 6564 2064 6973 7472  ransformed distr
+00013150: 6962 7574 696f 6e20 6461 7461 2077 6869  ibution data whi
+00013160: 6368 2077 696c 6c20 6265 2075 7365 6420  ch will be used 
+00013170: 696e 0a20 2020 2020 2020 2020 2020 2074  in.            t
+00013180: 6865 206e 6f72 6d61 6c69 7a69 6e67 2061  he normalizing a
+00013190: 6c67 6f72 6974 686d 2069 6e76 6572 7365  lgorithm inverse
+000131a0: 2070 6173 732e 0a0a 2020 2020 2020 2020   pass...        
+000131b0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+000131c0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+000131d0: 7820 3a20 746f 7263 682e 5465 6e73 6f72  x : torch.Tensor
+000131e0: 0a20 2020 2020 2020 2020 2020 2054 7261  .            Tra
+000131f0: 6e73 666f 726d 6564 2074 656e 736f 7220  nsformed tensor 
+00013200: 6163 636f 7264 696e 6720 746f 2052 6561  according to Rea
+00013210: 6c20 4e56 5020 6c61 7965 7220 7769 7468  l NVP layer with
+00013220: 2074 6865 2073 6861 7065 206f 6620 2779   the shape of 'y
+00013230: 272e 0a20 2020 2020 2020 2069 6e76 6572  '..        inver
+00013240: 7365 5f6c 6f67 5f64 6574 5f6a 6163 6f62  se_log_det_jacob
+00013250: 6961 6e20 3a20 746f 7263 682e 5465 6e73  ian : torch.Tens
+00013260: 6f72 0a20 2020 2020 2020 2020 2020 2054  or.            T
+00013270: 656e 736f 7220 7768 6963 6820 7265 7072  ensor which repr
+00013280: 6573 656e 7473 2074 6865 2069 6e66 6f72  esents the infor
+00013290: 6d61 7469 6f6e 206f 6620 7468 6520 6465  mation of the de
+000132a0: 7669 6174 696f 6e20 6f66 2074 6865 2069  viation of the i
+000132b0: 6e69 7469 616c 0a20 2020 2020 2020 2020  nitial.         
+000132c0: 2020 2061 6e64 2074 6172 6765 7420 6469     and target di
+000132d0: 7374 7269 6275 7469 6f6e 2e0a 0a20 2020  stribution...   
+000132e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000132f0: 2079 5f6d 6173 6b20 3d20 7920 2a20 7365   y_mask = y * se
+00013300: 6c66 2e6d 6173 6b0a 2020 2020 2020 2020  lf.mask.        
+00013310: 7320 3d20 7365 6c66 2e73 5f66 756e 6328  s = self.s_func(
+00013320: 795f 6d61 736b 2920 2a20 7365 6c66 2e73  y_mask) * self.s
+00013330: 6361 6c65 0a20 2020 2020 2020 2074 203d  cale.        t =
+00013340: 2073 656c 662e 745f 6675 6e63 2879 5f6d   self.t_func(y_m
+00013350: 6173 6b29 0a0a 2020 2020 2020 2020 7820  ask)..        x 
+00013360: 3d20 795f 6d61 736b 202b 2028 3120 2d20  = y_mask + (1 - 
+00013370: 7365 6c66 2e6d 6173 6b29 202a 2028 7920  self.mask) * (y 
+00013380: 2d20 7429 202a 2074 6f72 6368 2e65 7870  - t) * torch.exp
+00013390: 282d 7329 0a0a 2020 2020 2020 2020 696e  (-s)..        in
+000133a0: 7665 7273 655f 6c6f 675f 6465 745f 6a61  verse_log_det_ja
+000133b0: 636f 6269 616e 203d 2028 2831 202d 2073  cobian = ((1 - s
+000133c0: 656c 662e 6d61 736b 2920 2a20 2d73 292e  elf.mask) * -s).
+000133d0: 7375 6d28 2d31 290a 0a20 2020 2020 2020  sum(-1)..       
+000133e0: 2072 6574 7572 6e20 782c 2069 6e76 6572   return x, inver
+000133f0: 7365 5f6c 6f67 5f64 6574 5f6a 6163 6f62  se_log_det_jacob
+00013400: 6961 6e0a 0a0a 636c 6173 7320 4e65 6967  ian...class Neig
+00013410: 6862 6f72 4c69 7374 286e 6e2e 4d6f 6475  hborList(nn.Modu
+00013420: 6c65 293a 0a20 2020 2022 2222 436f 6d70  le):.    """Comp
+00013430: 7574 6573 2061 206e 6569 6768 626f 722d  utes a neighbor-
+00013440: 6c69 7374 2069 6e20 5079 546f 7263 682e  list in PyTorch.
+00013450: 0a0a 2020 2020 4e65 6967 6862 6f72 2d6c  ..    Neighbor-l
+00013460: 6973 7473 2028 616c 736f 2063 616c 6c65  ists (also calle
+00013470: 6420 5665 726c 6574 204c 6973 7473 2920  d Verlet Lists) 
+00013480: 6172 6520 6120 746f 6f6c 2066 6f72 2067  are a tool for g
+00013490: 726f 7570 696e 670a 2020 2020 6174 6f6d  rouping.    atom
+000134a0: 7320 7768 6963 6820 6172 6520 636c 6f73  s which are clos
+000134b0: 6520 746f 2065 6163 6820 6f74 6865 7220  e to each other 
+000134c0: 7370 6174 6961 6c6c 792e 2054 6869 7320  spatially. This 
+000134d0: 6c61 7965 7220 636f 6d70 7574 6573 2061  layer computes a
+000134e0: 0a20 2020 204e 6569 6768 626f 7220 4c69  .    Neighbor Li
+000134f0: 7374 2066 726f 6d20 6120 7072 6f76 6964  st from a provid
+00013500: 6564 2074 656e 736f 7220 6f66 2061 746f  ed tensor of ato
+00013510: 6d69 6320 636f 6f72 6469 6e61 7465 732e  mic coordinates.
+00013520: 2059 6f75 2063 616e 0a20 2020 2074 6869   You can.    thi
+00013530: 6e6b 206f 6620 7468 6973 2061 7320 6120  nk of this as a 
+00013540: 6765 6e65 7261 6c20 226b 2d6d 6561 6e73  general "k-means
+00013550: 2220 6c61 7965 722c 2062 7574 206f 7074  " layer, but opt
+00013560: 696d 697a 6564 2066 6f72 2074 6865 0a20  imized for the. 
+00013570: 2020 2063 6173 6520 606b 3d3d 3360 2e0a     case `k==3`..
+00013580: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
+00013590: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
+000135a0: 3e3e 204e 5f61 746f 6d73 203d 2035 0a20  >> N_atoms = 5. 
+000135b0: 2020 203e 3e3e 2073 7461 7274 203d 2030     >>> start = 0
+000135c0: 0a20 2020 203e 3e3e 2073 746f 7020 3d20  .    >>> stop = 
+000135d0: 3132 0a20 2020 203e 3e3e 206e 6272 5f63  12.    >>> nbr_c
+000135e0: 7574 6f66 6620 3d20 330a 2020 2020 3e3e  utoff = 3.    >>
+000135f0: 3e20 6e64 696d 203d 2033 0a20 2020 203e  > ndim = 3.    >
+00013600: 3e3e 204d 5f6e 6272 7320 3d20 320a 2020  >> M_nbrs = 2.  
+00013610: 2020 3e3e 3e20 636f 6f72 6473 203d 2073    >>> coords = s
+00013620: 7461 7274 202b 206e 702e 7261 6e64 6f6d  tart + np.random
+00013630: 2e72 616e 6428 4e5f 6174 6f6d 732c 206e  .rand(N_atoms, n
+00013640: 6469 6d29 202a 2028 7374 6f70 202d 2073  dim) * (stop - s
+00013650: 7461 7274 290a 2020 2020 3e3e 3e20 636f  tart).    >>> co
+00013660: 6f72 6473 203d 2074 6f72 6368 2e61 735f  ords = torch.as_
+00013670: 7465 6e73 6f72 2863 6f6f 7264 732c 2064  tensor(coords, d
+00013680: 7479 7065 3d74 6f72 6368 2e66 6c6f 6174  type=torch.float
+00013690: 290a 2020 2020 3e3e 3e20 6c61 7965 7220  ).    >>> layer 
+000136a0: 3d20 4e65 6967 6862 6f72 4c69 7374 284e  = NeighborList(N
+000136b0: 5f61 746f 6d73 2c20 4d5f 6e62 7273 2c20  _atoms, M_nbrs, 
+000136c0: 6e64 696d 2c20 6e62 725f 6375 746f 6666  ndim, nbr_cutoff
+000136d0: 2c20 7374 6172 742c 0a20 2020 202e 2e2e  , start,.    ...
 000136e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136f0: 7374 6f70 290a 2020 2020 3e3e 3e20 7265  stop).    >>> re
-00013700: 7375 6c74 203d 206c 6179 6572 2863 6f6f  sult = layer(coo
-00013710: 7264 7329 0a20 2020 203e 3e3e 2072 6573  rds).    >>> res
-00013720: 756c 742e 7368 6170 650a 2020 2020 746f  ult.shape.    to
-00013730: 7263 682e 5369 7a65 285b 352c 2032 5d29  rch.Size([5, 2])
-00013740: 0a0a 2020 2020 544f 444f 2872 6268 6172  ..    TODO(rbhar
-00013750: 6174 6829 3a20 4d61 6b65 2074 6869 7320  ath): Make this 
-00013760: 6c61 7965 7220 7375 7070 6f72 7420 6261  layer support ba
-00013770: 7463 6869 6e67 2e0a 2020 2020 2222 220a  tching..    """.
-00013780: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00013790: 5f28 7365 6c66 2c20 4e5f 6174 6f6d 733a  _(self, N_atoms:
-000137a0: 2069 6e74 2c20 4d5f 6e62 7273 3a20 696e   int, M_nbrs: in
-000137b0: 742c 206e 6469 6d3a 2069 6e74 2c0a 2020  t, ndim: int,.  
-000137c0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000137d0: 6272 5f63 7574 6f66 663a 2055 6e69 6f6e  br_cutoff: Union
-000137e0: 5b69 6e74 2c0a 2020 2020 2020 2020 2020  [int,.          
+000136f0: 2020 2020 2020 7374 6f70 290a 2020 2020        stop).    
+00013700: 3e3e 3e20 7265 7375 6c74 203d 206c 6179  >>> result = lay
+00013710: 6572 2863 6f6f 7264 7329 0a20 2020 203e  er(coords).    >
+00013720: 3e3e 2072 6573 756c 742e 7368 6170 650a  >> result.shape.
+00013730: 2020 2020 746f 7263 682e 5369 7a65 285b      torch.Size([
+00013740: 352c 2032 5d29 0a0a 2020 2020 544f 444f  5, 2])..    TODO
+00013750: 2872 6268 6172 6174 6829 3a20 4d61 6b65  (rbharath): Make
+00013760: 2074 6869 7320 6c61 7965 7220 7375 7070   this layer supp
+00013770: 6f72 7420 6261 7463 6869 6e67 2e0a 2020  ort batching..  
+00013780: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+00013790: 5f69 6e69 745f 5f28 7365 6c66 2c20 4e5f  _init__(self, N_
+000137a0: 6174 6f6d 733a 2069 6e74 2c20 4d5f 6e62  atoms: int, M_nb
+000137b0: 7273 3a20 696e 742c 206e 6469 6d3a 2069  rs: int, ndim: i
+000137c0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+000137d0: 2020 2020 206e 6272 5f63 7574 6f66 663a       nbr_cutoff:
+000137e0: 2055 6e69 6f6e 5b69 6e74 2c0a 2020 2020   Union[int,.    
 000137f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013800: 2020 2020 2020 2020 2066 6c6f 6174 5d2c           float],
-00013810: 2073 7461 7274 3a20 696e 742c 2073 746f   start: int, sto
-00013820: 703a 2069 6e74 2c20 2a2a 6b77 6172 6773  p: int, **kwargs
-00013830: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00013840: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00013850: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00013860: 2d2d 2d2d 0a20 2020 2020 2020 204e 5f61  ----.        N_a
-00013870: 746f 6d73 3a20 696e 740a 2020 2020 2020  toms: int.      
-00013880: 2020 2020 2020 4d61 7869 6d75 6d20 6e75        Maximum nu
-00013890: 6d62 6572 206f 6620 6174 6f6d 7320 7468  mber of atoms th
-000138a0: 6973 206c 6179 6572 2077 696c 6c20 6e65  is layer will ne
-000138b0: 6967 6862 6f72 2d6c 6973 742e 0a20 2020  ighbor-list..   
-000138c0: 2020 2020 204d 5f6e 6272 733a 2069 6e74       M_nbrs: int
-000138d0: 0a20 2020 2020 2020 2020 2020 204d 6178  .            Max
-000138e0: 696d 756d 206e 756d 6265 7220 6f66 2073  imum number of s
-000138f0: 7061 7469 616c 206e 6569 6768 626f 7273  patial neighbors
-00013900: 2070 6f73 7369 626c 6520 666f 7220 6174   possible for at
-00013910: 6f6d 2e0a 2020 2020 2020 2020 6e64 696d  om..        ndim
-00013920: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
-00013930: 2020 4469 6d65 6e73 696f 6e61 6c69 7479    Dimensionality
-00013940: 206f 6620 7370 6163 6520 6174 6f6d 7320   of space atoms 
-00013950: 6c69 7665 2069 6e2e 2028 5479 7069 6361  live in. (Typica
-00013960: 6c6c 7920 3344 2c20 6275 7420 736f 6d65  lly 3D, but some
-00013970: 7469 6d65 7320 7769 6c6c 0a20 2020 2020  times will.     
-00013980: 2020 2020 2020 2077 616e 7420 746f 2075         want to u
-00013990: 7365 2068 6967 6865 7220 6469 6d65 6e73  se higher dimens
-000139a0: 696f 6e61 6c20 6465 7363 7269 7074 6f72  ional descriptor
-000139b0: 7320 666f 7220 6174 6f6d 7329 2e0a 2020  s for atoms)..  
-000139c0: 2020 2020 2020 6e62 725f 6375 746f 6666        nbr_cutoff
-000139d0: 3a20 696e 7420 6f72 2066 6c6f 6174 0a20  : int or float. 
-000139e0: 2020 2020 2020 2020 2020 204c 656e 6774             Lengt
-000139f0: 6820 696e 2041 6e67 7374 726f 6d73 2028  h in Angstroms (
-00013a00: 3f29 2061 7420 7768 6963 6820 6174 6f6d  ?) at which atom
-00013a10: 2062 6f78 6573 2061 7265 2067 7269 6464   boxes are gridd
-00013a20: 6564 2e0a 2020 2020 2020 2020 7374 6172  ed..        star
-00013a30: 743a 2069 6e74 0a20 2020 2020 2020 2020  t: int.         
-00013a40: 2020 2053 7461 7274 206f 6620 7261 6e67     Start of rang
-00013a50: 6520 666f 7220 7468 6520 626f 7820 696e  e for the box in
-00013a60: 2077 6869 6368 2074 6865 206c 6f63 6174   which the locat
-00013a70: 696f 6e73 206f 6620 616c 6c20 6772 6964  ions of all grid
-00013a80: 2070 6f69 6e74 7320 7769 6c6c 2062 6520   points will be 
-00013a90: 6361 6c63 756c 6174 6564 2069 6e20 6073  calculated in `s
-00013aa0: 656c 662e 6765 745f 6365 6c6c 7328 2960  elf.get_cells()`
-00013ab0: 2e0a 2020 2020 2020 2020 7374 6f70 3a20  ..        stop: 
-00013ac0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-00013ad0: 456e 6420 6f66 2072 616e 6765 2066 6f72  End of range for
-00013ae0: 2074 6865 2062 6f78 2069 6e20 7768 6963   the box in whic
-00013af0: 6820 7468 6520 6c6f 6361 7469 6f6e 7320  h the locations 
-00013b00: 6f66 2061 6c6c 2067 7269 6420 706f 696e  of all grid poin
-00013b10: 7473 2077 696c 6c20 6265 2063 616c 6375  ts will be calcu
-00013b20: 6c61 7465 6420 696e 2060 7365 6c66 2e67  lated in `self.g
-00013b30: 6574 5f63 656c 6c73 2829 602e 0a20 2020  et_cells()`..   
-00013b40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00013b50: 2073 7570 6572 284e 6569 6768 626f 724c   super(NeighborL
-00013b60: 6973 742c 2073 656c 6629 2e5f 5f69 6e69  ist, self).__ini
-00013b70: 745f 5f28 2a2a 6b77 6172 6773 290a 2020  t__(**kwargs).  
-00013b80: 2020 2020 2020 7365 6c66 2e4e 5f61 746f        self.N_ato
-00013b90: 6d73 203d 204e 5f61 746f 6d73 0a20 2020  ms = N_atoms.   
-00013ba0: 2020 2020 2073 656c 662e 4d5f 6e62 7273       self.M_nbrs
-00013bb0: 203d 204d 5f6e 6272 730a 2020 2020 2020   = M_nbrs.      
-00013bc0: 2020 7365 6c66 2e6e 6469 6d20 3d20 6e64    self.ndim = nd
-00013bd0: 696d 0a20 2020 2020 2020 2023 204e 756d  im.        # Num
-00013be0: 6265 7220 6f66 2067 7269 6420 6365 6c6c  ber of grid cell
-00013bf0: 730a 2020 2020 2020 2020 6e5f 6365 6c6c  s.        n_cell
-00013c00: 7320 3d20 696e 7428 2828 7374 6f70 202d  s = int(((stop -
-00013c10: 2073 7461 7274 2920 2f20 6e62 725f 6375   start) / nbr_cu
-00013c20: 746f 6666 292a 2a6e 6469 6d29 0a20 2020  toff)**ndim).   
-00013c30: 2020 2020 2073 656c 662e 6e5f 6365 6c6c       self.n_cell
-00013c40: 7320 3d20 6e5f 6365 6c6c 730a 2020 2020  s = n_cells.    
-00013c50: 2020 2020 7365 6c66 2e6e 6272 5f63 7574      self.nbr_cut
-00013c60: 6f66 6620 3d20 6e62 725f 6375 746f 6666  off = nbr_cutoff
-00013c70: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-00013c80: 6172 7420 3d20 7374 6172 740a 2020 2020  art = start.    
-00013c90: 2020 2020 7365 6c66 2e73 746f 7020 3d20      self.stop = 
-00013ca0: 7374 6f70 0a0a 2020 2020 6465 6620 5f5f  stop..    def __
-00013cb0: 7265 7072 5f5f 2873 656c 6629 202d 3e20  repr__(self) -> 
-00013cc0: 7374 723a 0a20 2020 2020 2020 2072 6574  str:.        ret
-00013cd0: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
-00013ce0: 2020 6627 7b73 656c 662e 5f5f 636c 6173    f'{self.__clas
-00013cf0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d28 4e5f  s__.__name__}(N_
-00013d00: 6174 6f6d 733d 7b73 656c 662e 4e5f 6174  atoms={self.N_at
-00013d10: 6f6d 737d 2c20 4d5f 6e62 7273 3d7b 7365  oms}, M_nbrs={se
-00013d20: 6c66 2e4d 5f6e 6272 737d 2c20 6e64 696d  lf.M_nbrs}, ndim
-00013d30: 3d7b 7365 6c66 2e6e 6469 6d7d 2c20 6e5f  ={self.ndim}, n_
-00013d40: 6365 6c6c 733d 7b73 656c 662e 6e5f 6365  cells={self.n_ce
-00013d50: 6c6c 737d 2c20 6e62 725f 6375 746f 6666  lls}, nbr_cutoff
-00013d60: 3d7b 7365 6c66 2e6e 6272 5f63 7574 6f66  ={self.nbr_cutof
-00013d70: 667d 2c20 7374 6172 743d 7b73 656c 662e  f}, start={self.
-00013d80: 7374 6172 747d 2c20 7374 6f70 3d7b 7365  start}, stop={se
-00013d90: 6c66 2e73 746f 707d 2927 0a20 2020 2020  lf.stop})'.     
-00013da0: 2020 2029 0a0a 2020 2020 6465 6620 666f     )..    def fo
-00013db0: 7277 6172 6428 7365 6c66 2c20 696e 7075  rward(self, inpu
-00013dc0: 7473 3a20 746f 7263 682e 5465 6e73 6f72  ts: torch.Tensor
-00013dd0: 2920 2d3e 2074 6f72 6368 2e54 656e 736f  ) -> torch.Tenso
-00013de0: 723a 0a20 2020 2020 2020 2022 2222 496e  r:.        """In
-00013df0: 766f 6b65 7320 7468 6973 206c 6179 6572  vokes this layer
-00013e00: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00013e10: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00013e20: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00013e30: 2069 6e70 7574 733a 2074 6f72 6368 2e54   inputs: torch.T
-00013e40: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00013e50: 2020 5368 6170 6520 286e 756d 5f61 746f    Shape (num_ato
-00013e60: 6d73 2c20 6e64 696d 290a 0a20 2020 2020  ms, ndim)..     
-00013e70: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-00013e80: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-00013e90: 2020 206e 6569 6768 626f 725f 6c69 7374     neighbor_list
-00013ea0: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
-00013eb0: 2020 2020 2020 2020 2020 2053 6861 7065             Shape
-00013ec0: 2060 284e 5f61 746f 6d73 2c20 4d5f 6e62   `(N_atoms, M_nb
-00013ed0: 7273 2960 0a20 2020 2020 2020 2022 2222  rs)`.        """
-00013ee0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00013ef0: 7374 616e 6365 2869 6e70 7574 732c 2053  stance(inputs, S
-00013f00: 6571 7565 6e63 6543 6f6c 6c65 6374 696f  equenceCollectio
-00013f10: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
-00013f20: 6966 206c 656e 2869 6e70 7574 7329 2021  if len(inputs) !
-00013f30: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00013f40: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00013f50: 4572 726f 7228 224e 6569 6768 626f 724c  Error("NeighborL
-00013f60: 6973 7420 6361 6e20 6f6e 6c79 2068 6176  ist can only hav
-00013f70: 6520 6f6e 6520 696e 7075 7422 290a 2020  e one input").  
-00013f80: 2020 2020 2020 2020 2020 696e 7075 7473            inputs
-00013f90: 203d 2069 6e70 7574 735b 305d 0a20 2020   = inputs[0].   
-00013fa0: 2020 2020 2069 6620 6c65 6e28 696e 7075       if len(inpu
-00013fb0: 7473 2e73 6861 7065 2920 213d 2032 3a0a  ts.shape) != 2:.
-00013fc0: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
-00013fd0: 444f 2872 6268 6172 6174 6829 3a20 5375  DO(rbharath): Su
-00013fe0: 7070 6f72 7420 6261 7463 6869 6e67 0a20  pport batching. 
-00013ff0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00014000: 2056 616c 7565 4572 726f 7228 2250 6172   ValueError("Par
-00014010: 656e 7420 7465 6e73 6f72 206d 7573 7420  ent tensor must 
-00014020: 6265 2028 6e75 6d5f 6174 6f6d 732c 206e  be (num_atoms, n
-00014030: 6475 6d29 2229 0a20 2020 2020 2020 2072  dum)").        r
-00014040: 6574 7572 6e20 7365 6c66 2e63 6f6d 7075  eturn self.compu
-00014050: 7465 5f6e 6272 5f6c 6973 7428 696e 7075  te_nbr_list(inpu
-00014060: 7473 290a 0a20 2020 2064 6566 2063 6f6d  ts)..    def com
-00014070: 7075 7465 5f6e 6272 5f6c 6973 7428 7365  pute_nbr_list(se
-00014080: 6c66 2c20 636f 6f72 6473 3a20 746f 7263  lf, coords: torc
-00014090: 682e 5465 6e73 6f72 2920 2d3e 2074 6f72  h.Tensor) -> tor
-000140a0: 6368 2e54 656e 736f 723a 0a20 2020 2020  ch.Tensor:.     
-000140b0: 2020 2022 2222 4765 7420 636c 6f73 6573     """Get closes
-000140c0: 7420 6e65 6967 6862 6f72 7320 666f 7220  t neighbors for 
-000140d0: 6174 6f6d 732e 0a0a 2020 2020 2020 2020  atoms...        
-000140e0: 4e65 6564 7320 746f 2068 616e 646c 6520  Needs to handle 
-000140f0: 7061 6464 696e 6720 666f 7220 6174 6f6d  padding for atom
-00014100: 7320 7769 7468 206e 6f20 6e65 6967 6862  s with no neighb
-00014110: 6f72 732e 0a0a 2020 2020 2020 2020 5061  ors...        Pa
-00014120: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00014130: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00014140: 2020 2020 636f 6f72 6473 3a20 746f 7263      coords: torc
-00014150: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00014160: 2020 2020 2053 6861 7065 2028 4e5f 6174       Shape (N_at
-00014170: 6f6d 732c 206e 6469 6d29 0a0a 2020 2020  oms, ndim)..    
-00014180: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00014190: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-000141a0: 2020 2020 6e62 725f 6c69 7374 3a20 746f      nbr_list: to
-000141b0: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-000141c0: 2020 2020 2020 2053 6861 7065 2028 4e5f         Shape (N_
-000141d0: 6174 6f6d 732c 204d 5f6e 6272 7329 206f  atoms, M_nbrs) o
-000141e0: 6620 6174 6f6d 2069 6e64 6963 6573 0a20  f atom indices. 
-000141f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00014200: 2020 2023 2053 6861 7065 2028 6e5f 6365     # Shape (n_ce
-00014210: 6c6c 732c 206e 6469 6d29 0a20 2020 2020  lls, ndim).     
-00014220: 2020 2063 656c 6c73 203d 2073 656c 662e     cells = self.
-00014230: 6765 745f 6365 6c6c 7328 290a 0a20 2020  get_cells()..   
-00014240: 2020 2020 2023 204c 6973 7420 6f66 206c       # List of l
-00014250: 656e 6774 6820 4e5f 6174 6f6d 732c 2065  ength N_atoms, e
-00014260: 6163 6820 656c 656d 656e 7420 6f66 2064  ach element of d
-00014270: 6966 6665 7265 6e74 206c 656e 6774 6820  ifferent length 
-00014280: 756e 6971 7565 735f 690a 2020 2020 2020  uniques_i.      
-00014290: 2020 6e62 7273 203d 2073 656c 662e 6765    nbrs = self.ge
-000142a0: 745f 6174 6f6d 735f 696e 5f6e 6272 7328  t_atoms_in_nbrs(
-000142b0: 636f 6f72 6473 2c20 6365 6c6c 7329 0a20  coords, cells). 
-000142c0: 2020 2020 2020 2070 6164 6469 6e67 203d         padding =
-000142d0: 2074 6f72 6368 2e66 756c 6c28 2873 656c   torch.full((sel
-000142e0: 662e 4d5f 6e62 7273 2c29 2c20 2d31 290a  f.M_nbrs,), -1).
-000142f0: 2020 2020 2020 2020 7061 6464 6564 5f6e          padded_n
-00014300: 6272 7320 3d20 5b0a 2020 2020 2020 2020  brs = [.        
-00014310: 2020 2020 746f 7263 682e 636f 6e63 6174      torch.concat
-00014320: 285b 756e 6971 7565 5f6e 6272 732c 2070  ([unique_nbrs, p
-00014330: 6164 6469 6e67 5d2c 2030 2920 666f 7220  adding], 0) for 
-00014340: 756e 6971 7565 5f6e 6272 7320 696e 206e  unique_nbrs in n
-00014350: 6272 730a 2020 2020 2020 2020 5d0a 0a20  brs.        ].. 
-00014360: 2020 2020 2020 2023 204c 6973 7420 6f66         # List of
-00014370: 206c 656e 6774 6820 4e5f 6174 6f6d 732c   length N_atoms,
-00014380: 2065 6163 6820 656c 656d 656e 7420 6f66   each element of
-00014390: 2064 6966 6665 7265 6e74 206c 656e 6774   different lengt
-000143a0: 6820 756e 6971 7565 735f 690a 2020 2020  h uniques_i.    
-000143b0: 2020 2020 2320 4c69 7374 206f 6620 6c65      # List of le
-000143c0: 6e67 7468 204e 5f61 746f 6d73 2c20 6561  ngth N_atoms, ea
-000143d0: 6368 2061 2074 656e 736f 7220 6f66 2073  ch a tensor of s
-000143e0: 6861 7065 0a20 2020 2020 2020 2023 2028  hape.        # (
-000143f0: 756e 6971 7565 735f 692c 206e 6469 6d29  uniques_i, ndim)
-00014400: 0a20 2020 2020 2020 206e 6272 5f63 6f6f  .        nbr_coo
-00014410: 7264 7320 3d20 5b0a 2020 2020 2020 2020  rds = [.        
-00014420: 2020 2020 746f 7263 682e 696e 6465 785f      torch.index_
-00014430: 7365 6c65 6374 2863 6f6f 7264 732c 2030  select(coords, 0
-00014440: 2c20 6174 6f6d 5f6e 6272 7329 2066 6f72  , atom_nbrs) for
-00014450: 2061 746f 6d5f 6e62 7273 2069 6e20 6e62   atom_nbrs in nb
-00014460: 7273 0a20 2020 2020 2020 205d 0a0a 2020  rs.        ]..  
-00014470: 2020 2020 2020 2320 4164 6420 7068 616e        # Add phan
-00014480: 746f 6d20 6174 6f6d 7320 7468 6174 2065  tom atoms that e
-00014490: 7869 7374 2066 6172 206f 7574 7369 6465  xist far outside
-000144a0: 2074 6865 2062 6f78 0a20 2020 2020 2020   the box.       
-000144b0: 2063 6f6f 7264 5f70 6164 6469 6e67 203d   coord_padding =
-000144c0: 2074 6f72 6368 2e66 756c 6c28 2873 656c   torch.full((sel
-000144d0: 662e 4d5f 6e62 7273 2c20 7365 6c66 2e6e  f.M_nbrs, self.n
-000144e0: 6469 6d29 2c0a 2020 2020 2020 2020 2020  dim),.          
+00013800: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00013810: 6c6f 6174 5d2c 2073 7461 7274 3a20 696e  loat], start: in
+00013820: 742c 2073 746f 703a 2069 6e74 2c20 2a2a  t, stop: int, **
+00013830: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+00013840: 2022 2222 0a20 2020 2020 2020 2050 6172   """.        Par
+00013850: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+00013860: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00013870: 2020 204e 5f61 746f 6d73 3a20 696e 740a     N_atoms: int.
+00013880: 2020 2020 2020 2020 2020 2020 4d61 7869              Maxi
+00013890: 6d75 6d20 6e75 6d62 6572 206f 6620 6174  mum number of at
+000138a0: 6f6d 7320 7468 6973 206c 6179 6572 2077  oms this layer w
+000138b0: 696c 6c20 6e65 6967 6862 6f72 2d6c 6973  ill neighbor-lis
+000138c0: 742e 0a20 2020 2020 2020 204d 5f6e 6272  t..        M_nbr
+000138d0: 733a 2069 6e74 0a20 2020 2020 2020 2020  s: int.         
+000138e0: 2020 204d 6178 696d 756d 206e 756d 6265     Maximum numbe
+000138f0: 7220 6f66 2073 7061 7469 616c 206e 6569  r of spatial nei
+00013900: 6768 626f 7273 2070 6f73 7369 626c 6520  ghbors possible 
+00013910: 666f 7220 6174 6f6d 2e0a 2020 2020 2020  for atom..      
+00013920: 2020 6e64 696d 3a20 696e 740a 2020 2020    ndim: int.    
+00013930: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
+00013940: 6e61 6c69 7479 206f 6620 7370 6163 6520  nality of space 
+00013950: 6174 6f6d 7320 6c69 7665 2069 6e2e 2028  atoms live in. (
+00013960: 5479 7069 6361 6c6c 7920 3344 2c20 6275  Typically 3D, bu
+00013970: 7420 736f 6d65 7469 6d65 7320 7769 6c6c  t sometimes will
+00013980: 0a20 2020 2020 2020 2020 2020 2077 616e  .            wan
+00013990: 7420 746f 2075 7365 2068 6967 6865 7220  t to use higher 
+000139a0: 6469 6d65 6e73 696f 6e61 6c20 6465 7363  dimensional desc
+000139b0: 7269 7074 6f72 7320 666f 7220 6174 6f6d  riptors for atom
+000139c0: 7329 2e0a 2020 2020 2020 2020 6e62 725f  s)..        nbr_
+000139d0: 6375 746f 6666 3a20 696e 7420 6f72 2066  cutoff: int or f
+000139e0: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+000139f0: 204c 656e 6774 6820 696e 2041 6e67 7374   Length in Angst
+00013a00: 726f 6d73 2028 3f29 2061 7420 7768 6963  roms (?) at whic
+00013a10: 6820 6174 6f6d 2062 6f78 6573 2061 7265  h atom boxes are
+00013a20: 2067 7269 6464 6564 2e0a 2020 2020 2020   gridded..      
+00013a30: 2020 7374 6172 743a 2069 6e74 0a20 2020    start: int.   
+00013a40: 2020 2020 2020 2020 2053 7461 7274 206f           Start o
+00013a50: 6620 7261 6e67 6520 666f 7220 7468 6520  f range for the 
+00013a60: 626f 7820 696e 2077 6869 6368 2074 6865  box in which the
+00013a70: 206c 6f63 6174 696f 6e73 206f 6620 616c   locations of al
+00013a80: 6c20 6772 6964 2070 6f69 6e74 7320 7769  l grid points wi
+00013a90: 6c6c 2062 6520 6361 6c63 756c 6174 6564  ll be calculated
+00013aa0: 2069 6e20 6073 656c 662e 6765 745f 6365   in `self.get_ce
+00013ab0: 6c6c 7328 2960 2e0a 2020 2020 2020 2020  lls()`..        
+00013ac0: 7374 6f70 3a20 696e 740a 2020 2020 2020  stop: int.      
+00013ad0: 2020 2020 2020 456e 6420 6f66 2072 616e        End of ran
+00013ae0: 6765 2066 6f72 2074 6865 2062 6f78 2069  ge for the box i
+00013af0: 6e20 7768 6963 6820 7468 6520 6c6f 6361  n which the loca
+00013b00: 7469 6f6e 7320 6f66 2061 6c6c 2067 7269  tions of all gri
+00013b10: 6420 706f 696e 7473 2077 696c 6c20 6265  d points will be
+00013b20: 2063 616c 6375 6c61 7465 6420 696e 2060   calculated in `
+00013b30: 7365 6c66 2e67 6574 5f63 656c 6c73 2829  self.get_cells()
+00013b40: 602e 0a20 2020 2020 2020 2022 2222 0a20  `..        """. 
+00013b50: 2020 2020 2020 2073 7570 6572 284e 6569         super(Nei
+00013b60: 6768 626f 724c 6973 742c 2073 656c 6629  ghborList, self)
+00013b70: 2e5f 5f69 6e69 745f 5f28 2a2a 6b77 6172  .__init__(**kwar
+00013b80: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
+00013b90: 2e4e 5f61 746f 6d73 203d 204e 5f61 746f  .N_atoms = N_ato
+00013ba0: 6d73 0a20 2020 2020 2020 2073 656c 662e  ms.        self.
+00013bb0: 4d5f 6e62 7273 203d 204d 5f6e 6272 730a  M_nbrs = M_nbrs.
+00013bc0: 2020 2020 2020 2020 7365 6c66 2e6e 6469          self.ndi
+00013bd0: 6d20 3d20 6e64 696d 0a20 2020 2020 2020  m = ndim.       
+00013be0: 2023 204e 756d 6265 7220 6f66 2067 7269   # Number of gri
+00013bf0: 6420 6365 6c6c 730a 2020 2020 2020 2020  d cells.        
+00013c00: 6e5f 6365 6c6c 7320 3d20 696e 7428 2828  n_cells = int(((
+00013c10: 7374 6f70 202d 2073 7461 7274 2920 2f20  stop - start) / 
+00013c20: 6e62 725f 6375 746f 6666 292a 2a6e 6469  nbr_cutoff)**ndi
+00013c30: 6d29 0a20 2020 2020 2020 2073 656c 662e  m).        self.
+00013c40: 6e5f 6365 6c6c 7320 3d20 6e5f 6365 6c6c  n_cells = n_cell
+00013c50: 730a 2020 2020 2020 2020 7365 6c66 2e6e  s.        self.n
+00013c60: 6272 5f63 7574 6f66 6620 3d20 6e62 725f  br_cutoff = nbr_
+00013c70: 6375 746f 6666 0a20 2020 2020 2020 2073  cutoff.        s
+00013c80: 656c 662e 7374 6172 7420 3d20 7374 6172  elf.start = star
+00013c90: 740a 2020 2020 2020 2020 7365 6c66 2e73  t.        self.s
+00013ca0: 746f 7020 3d20 7374 6f70 0a0a 2020 2020  top = stop..    
+00013cb0: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+00013cc0: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
+00013cd0: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
+00013ce0: 2020 2020 2020 2020 6627 7b73 656c 662e          f'{self.
+00013cf0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00013d00: 5f5f 7d28 4e5f 6174 6f6d 733d 7b73 656c  __}(N_atoms={sel
+00013d10: 662e 4e5f 6174 6f6d 737d 2c20 4d5f 6e62  f.N_atoms}, M_nb
+00013d20: 7273 3d7b 7365 6c66 2e4d 5f6e 6272 737d  rs={self.M_nbrs}
+00013d30: 2c20 6e64 696d 3d7b 7365 6c66 2e6e 6469  , ndim={self.ndi
+00013d40: 6d7d 2c20 6e5f 6365 6c6c 733d 7b73 656c  m}, n_cells={sel
+00013d50: 662e 6e5f 6365 6c6c 737d 2c20 6e62 725f  f.n_cells}, nbr_
+00013d60: 6375 746f 6666 3d7b 7365 6c66 2e6e 6272  cutoff={self.nbr
+00013d70: 5f63 7574 6f66 667d 2c20 7374 6172 743d  _cutoff}, start=
+00013d80: 7b73 656c 662e 7374 6172 747d 2c20 7374  {self.start}, st
+00013d90: 6f70 3d7b 7365 6c66 2e73 746f 707d 2927  op={self.stop})'
+00013da0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00013db0: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
+00013dc0: 2c20 696e 7075 7473 3a20 746f 7263 682e  , inputs: torch.
+00013dd0: 5465 6e73 6f72 2920 2d3e 2074 6f72 6368  Tensor) -> torch
+00013de0: 2e54 656e 736f 723a 0a20 2020 2020 2020  .Tensor:.       
+00013df0: 2022 2222 496e 766f 6b65 7320 7468 6973   """Invokes this
+00013e00: 206c 6179 6572 2e0a 0a20 2020 2020 2020   layer...       
+00013e10: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00013e20: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00013e30: 2020 2020 2020 2069 6e70 7574 733a 2074         inputs: t
+00013e40: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+00013e50: 2020 2020 2020 2020 5368 6170 6520 286e          Shape (n
+00013e60: 756d 5f61 746f 6d73 2c20 6e64 696d 290a  um_atoms, ndim).
+00013e70: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00013e80: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00013e90: 0a20 2020 2020 2020 206e 6569 6768 626f  .        neighbo
+00013ea0: 725f 6c69 7374 3a20 746f 7263 682e 5465  r_list: torch.Te
+00013eb0: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
+00013ec0: 2053 6861 7065 2060 284e 5f61 746f 6d73   Shape `(N_atoms
+00013ed0: 2c20 4d5f 6e62 7273 2960 0a20 2020 2020  , M_nbrs)`.     
+00013ee0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00013ef0: 6620 6973 696e 7374 616e 6365 2869 6e70  f isinstance(inp
+00013f00: 7574 732c 2053 6571 7565 6e63 6543 6f6c  uts, SequenceCol
+00013f10: 6c65 6374 696f 6e29 3a0a 2020 2020 2020  lection):.      
+00013f20: 2020 2020 2020 6966 206c 656e 2869 6e70        if len(inp
+00013f30: 7574 7329 2021 3d20 313a 0a20 2020 2020  uts) != 1:.     
+00013f40: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00013f50: 2056 616c 7565 4572 726f 7228 224e 6569   ValueError("Nei
+00013f60: 6768 626f 724c 6973 7420 6361 6e20 6f6e  ghborList can on
+00013f70: 6c79 2068 6176 6520 6f6e 6520 696e 7075  ly have one inpu
+00013f80: 7422 290a 2020 2020 2020 2020 2020 2020  t").            
+00013f90: 696e 7075 7473 203d 2069 6e70 7574 735b  inputs = inputs[
+00013fa0: 305d 0a20 2020 2020 2020 2069 6620 6c65  0].        if le
+00013fb0: 6e28 696e 7075 7473 2e73 6861 7065 2920  n(inputs.shape) 
+00013fc0: 213d 2032 3a0a 2020 2020 2020 2020 2020  != 2:.          
+00013fd0: 2020 2320 544f 444f 2872 6268 6172 6174    # TODO(rbharat
+00013fe0: 6829 3a20 5375 7070 6f72 7420 6261 7463  h): Support batc
+00013ff0: 6869 6e67 0a20 2020 2020 2020 2020 2020  hing.           
+00014000: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00014010: 7228 2250 6172 656e 7420 7465 6e73 6f72  r("Parent tensor
+00014020: 206d 7573 7420 6265 2028 6e75 6d5f 6174   must be (num_at
+00014030: 6f6d 732c 206e 6475 6d29 2229 0a20 2020  oms, ndum)").   
+00014040: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00014050: 2e63 6f6d 7075 7465 5f6e 6272 5f6c 6973  .compute_nbr_lis
+00014060: 7428 696e 7075 7473 290a 0a20 2020 2064  t(inputs)..    d
+00014070: 6566 2063 6f6d 7075 7465 5f6e 6272 5f6c  ef compute_nbr_l
+00014080: 6973 7428 7365 6c66 2c20 636f 6f72 6473  ist(self, coords
+00014090: 3a20 746f 7263 682e 5465 6e73 6f72 2920  : torch.Tensor) 
+000140a0: 2d3e 2074 6f72 6368 2e54 656e 736f 723a  -> torch.Tensor:
+000140b0: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+000140c0: 636c 6f73 6573 7420 6e65 6967 6862 6f72  closest neighbor
+000140d0: 7320 666f 7220 6174 6f6d 732e 0a0a 2020  s for atoms...  
+000140e0: 2020 2020 2020 4e65 6564 7320 746f 2068        Needs to h
+000140f0: 616e 646c 6520 7061 6464 696e 6720 666f  andle padding fo
+00014100: 7220 6174 6f6d 7320 7769 7468 206e 6f20  r atoms with no 
+00014110: 6e65 6967 6862 6f72 732e 0a0a 2020 2020  neighbors...    
+00014120: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00014130: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00014140: 2d0a 2020 2020 2020 2020 636f 6f72 6473  -.        coords
+00014150: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
+00014160: 2020 2020 2020 2020 2020 2053 6861 7065             Shape
+00014170: 2028 4e5f 6174 6f6d 732c 206e 6469 6d29   (N_atoms, ndim)
+00014180: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00014190: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+000141a0: 2d0a 2020 2020 2020 2020 6e62 725f 6c69  -.        nbr_li
+000141b0: 7374 3a20 746f 7263 682e 5465 6e73 6f72  st: torch.Tensor
+000141c0: 0a20 2020 2020 2020 2020 2020 2053 6861  .            Sha
+000141d0: 7065 2028 4e5f 6174 6f6d 732c 204d 5f6e  pe (N_atoms, M_n
+000141e0: 6272 7329 206f 6620 6174 6f6d 2069 6e64  brs) of atom ind
+000141f0: 6963 6573 0a20 2020 2020 2020 2022 2222  ices.        """
+00014200: 0a20 2020 2020 2020 2023 2053 6861 7065  .        # Shape
+00014210: 2028 6e5f 6365 6c6c 732c 206e 6469 6d29   (n_cells, ndim)
+00014220: 0a20 2020 2020 2020 2063 656c 6c73 203d  .        cells =
+00014230: 2073 656c 662e 6765 745f 6365 6c6c 7328   self.get_cells(
+00014240: 290a 0a20 2020 2020 2020 2023 204c 6973  )..        # Lis
+00014250: 7420 6f66 206c 656e 6774 6820 4e5f 6174  t of length N_at
+00014260: 6f6d 732c 2065 6163 6820 656c 656d 656e  oms, each elemen
+00014270: 7420 6f66 2064 6966 6665 7265 6e74 206c  t of different l
+00014280: 656e 6774 6820 756e 6971 7565 735f 690a  ength uniques_i.
+00014290: 2020 2020 2020 2020 6e62 7273 203d 2073          nbrs = s
+000142a0: 656c 662e 6765 745f 6174 6f6d 735f 696e  elf.get_atoms_in
+000142b0: 5f6e 6272 7328 636f 6f72 6473 2c20 6365  _nbrs(coords, ce
+000142c0: 6c6c 7329 0a20 2020 2020 2020 2070 6164  lls).        pad
+000142d0: 6469 6e67 203d 2074 6f72 6368 2e66 756c  ding = torch.ful
+000142e0: 6c28 2873 656c 662e 4d5f 6e62 7273 2c29  l((self.M_nbrs,)
+000142f0: 2c20 2d31 290a 2020 2020 2020 2020 7061  , -1).        pa
+00014300: 6464 6564 5f6e 6272 7320 3d20 5b0a 2020  dded_nbrs = [.  
+00014310: 2020 2020 2020 2020 2020 746f 7263 682e            torch.
+00014320: 636f 6e63 6174 285b 756e 6971 7565 5f6e  concat([unique_n
+00014330: 6272 732c 2070 6164 6469 6e67 5d2c 2030  brs, padding], 0
+00014340: 2920 666f 7220 756e 6971 7565 5f6e 6272  ) for unique_nbr
+00014350: 7320 696e 206e 6272 730a 2020 2020 2020  s in nbrs.      
+00014360: 2020 5d0a 0a20 2020 2020 2020 2023 204c    ]..        # L
+00014370: 6973 7420 6f66 206c 656e 6774 6820 4e5f  ist of length N_
+00014380: 6174 6f6d 732c 2065 6163 6820 656c 656d  atoms, each elem
+00014390: 656e 7420 6f66 2064 6966 6665 7265 6e74  ent of different
+000143a0: 206c 656e 6774 6820 756e 6971 7565 735f   length uniques_
+000143b0: 690a 2020 2020 2020 2020 2320 4c69 7374  i.        # List
+000143c0: 206f 6620 6c65 6e67 7468 204e 5f61 746f   of length N_ato
+000143d0: 6d73 2c20 6561 6368 2061 2074 656e 736f  ms, each a tenso
+000143e0: 7220 6f66 2073 6861 7065 0a20 2020 2020  r of shape.     
+000143f0: 2020 2023 2028 756e 6971 7565 735f 692c     # (uniques_i,
+00014400: 206e 6469 6d29 0a20 2020 2020 2020 206e   ndim).        n
+00014410: 6272 5f63 6f6f 7264 7320 3d20 5b0a 2020  br_coords = [.  
+00014420: 2020 2020 2020 2020 2020 746f 7263 682e            torch.
+00014430: 696e 6465 785f 7365 6c65 6374 2863 6f6f  index_select(coo
+00014440: 7264 732c 2030 2c20 6174 6f6d 5f6e 6272  rds, 0, atom_nbr
+00014450: 7329 2066 6f72 2061 746f 6d5f 6e62 7273  s) for atom_nbrs
+00014460: 2069 6e20 6e62 7273 0a20 2020 2020 2020   in nbrs.       
+00014470: 205d 0a0a 2020 2020 2020 2020 2320 4164   ]..        # Ad
+00014480: 6420 7068 616e 746f 6d20 6174 6f6d 7320  d phantom atoms 
+00014490: 7468 6174 2065 7869 7374 2066 6172 206f  that exist far o
+000144a0: 7574 7369 6465 2074 6865 2062 6f78 0a20  utside the box. 
+000144b0: 2020 2020 2020 2063 6f6f 7264 5f70 6164         coord_pad
+000144c0: 6469 6e67 203d 2074 6f72 6368 2e66 756c  ding = torch.ful
+000144d0: 6c28 2873 656c 662e 4d5f 6e62 7273 2c20  l((self.M_nbrs, 
+000144e0: 7365 6c66 2e6e 6469 6d29 2c0a 2020 2020  self.ndim),.    
 000144f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014500: 2020 2020 2020 2020 2032 202a 2073 656c           2 * sel
-00014510: 662e 7374 6f70 292e 746f 2874 6f72 6368  f.stop).to(torch
-00014520: 2e66 6c6f 6174 290a 2020 2020 2020 2020  .float).        
-00014530: 7061 6464 6564 5f6e 6272 5f63 6f6f 7264  padded_nbr_coord
-00014540: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-00014550: 2020 746f 7263 682e 6361 7428 5b6e 6272    torch.cat([nbr
-00014560: 5f63 6f6f 7264 2c20 636f 6f72 645f 7061  _coord, coord_pa
-00014570: 6464 696e 675d 2c20 3029 2066 6f72 206e  dding], 0) for n
-00014580: 6272 5f63 6f6f 7264 2069 6e20 6e62 725f  br_coord in nbr_
-00014590: 636f 6f72 6473 0a20 2020 2020 2020 205d  coords.        ]
-000145a0: 0a0a 2020 2020 2020 2020 2320 4c69 7374  ..        # List
-000145b0: 206f 6620 6c65 6e67 7468 204e 5f61 746f   of length N_ato
-000145c0: 6d73 2c20 6561 6368 206f 6620 7368 6170  ms, each of shap
-000145d0: 6520 2831 2c20 6e64 696d 290a 2020 2020  e (1, ndim).    
-000145e0: 2020 2020 6174 6f6d 5f63 6f6f 7264 7320      atom_coords 
-000145f0: 3d20 746f 7263 682e 7465 6e73 6f72 5f73  = torch.tensor_s
-00014600: 706c 6974 2863 6f6f 7264 732c 2073 656c  plit(coords, sel
-00014610: 662e 4e5f 6174 6f6d 7329 0a0a 2020 2020  f.N_atoms)..    
-00014620: 2020 2020 2320 544f 444f 2872 6268 6172      # TODO(rbhar
-00014630: 6174 6829 3a20 486f 7720 646f 6573 2064  ath): How does d
-00014640: 6973 7461 6e63 6520 6e65 6564 2074 6f20  istance need to 
-00014650: 6265 206d 6f64 6966 6965 6420 6865 7265  be modified here
-00014660: 2074 6f0a 2020 2020 2020 2020 2320 6163   to.        # ac
-00014670: 636f 756e 7420 666f 7220 7065 7269 6f64  count for period
-00014680: 6963 2062 6f75 6e64 6172 7920 636f 6e64  ic boundary cond
-00014690: 6974 696f 6e73 3f0a 2020 2020 2020 2020  itions?.        
-000146a0: 2320 4c69 7374 206f 6620 6c65 6e67 7468  # List of length
-000146b0: 204e 5f61 746f 6d73 2065 6163 6820 6f66   N_atoms each of
-000146c0: 2073 6861 7065 2028 4d5f 6e62 7273 290a   shape (M_nbrs).
-000146d0: 2020 2020 2020 2020 7061 6464 6564 5f64          padded_d
-000146e0: 6973 7473 203d 205b 0a20 2020 2020 2020  ists = [.       
-000146f0: 2020 2020 2074 6f72 6368 2e73 756d 2828       torch.sum((
-00014700: 6174 6f6d 5f63 6f6f 7264 202d 2070 6164  atom_coord - pad
-00014710: 6465 645f 6e62 725f 636f 6f72 6429 2a2a  ded_nbr_coord)**
-00014720: 322c 2064 696d 3d2d 3129 0a20 2020 2020  2, dim=-1).     
-00014730: 2020 2020 2020 2066 6f72 2028 6174 6f6d         for (atom
-00014740: 5f63 6f6f 7264 2c0a 2020 2020 2020 2020  _coord,.        
-00014750: 2020 2020 2020 2020 2070 6164 6465 645f           padded_
-00014760: 6e62 725f 636f 6f72 6429 2069 6e20 7a69  nbr_coord) in zi
-00014770: 7028 6174 6f6d 5f63 6f6f 7264 732c 2070  p(atom_coords, p
-00014780: 6164 6465 645f 6e62 725f 636f 6f72 6473  added_nbr_coords
-00014790: 290a 2020 2020 2020 2020 5d0a 0a20 2020  ).        ]..   
-000147a0: 2020 2020 2070 6164 6465 645f 636c 6f73       padded_clos
-000147b0: 6573 745f 6e62 7273 203d 205b 0a20 2020  est_nbrs = [.   
-000147c0: 2020 2020 2020 2020 2074 6f72 6368 2e74           torch.t
-000147d0: 6f70 6b28 7061 6464 6564 5f64 6973 742c  opk(padded_dist,
-000147e0: 206b 3d73 656c 662e 4d5f 6e62 7273 2c20   k=self.M_nbrs, 
-000147f0: 6c61 7267 6573 743d 4661 6c73 6529 5b31  largest=False)[1
-00014800: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
-00014810: 7220 7061 6464 6564 5f64 6973 7420 696e  r padded_dist in
-00014820: 2070 6164 6465 645f 6469 7374 730a 2020   padded_dists.  
-00014830: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
-00014840: 2023 204e 5f61 746f 6d73 2065 6c74 7320   # N_atoms elts 
-00014850: 6f66 2073 697a 6520 284d 5f6e 6272 732c  of size (M_nbrs,
-00014860: 2920 6561 6368 0a20 2020 2020 2020 2070  ) each.        p
-00014870: 6164 6465 645f 6e65 6967 6862 6f72 5f6c  added_neighbor_l
-00014880: 6973 7420 3d20 5b0a 2020 2020 2020 2020  ist = [.        
-00014890: 2020 2020 746f 7263 682e 6761 7468 6572      torch.gather
-000148a0: 2870 6164 6465 645f 6174 6f6d 5f6e 6272  (padded_atom_nbr
-000148b0: 732c 2030 2c20 7061 6464 6564 5f63 6c6f  s, 0, padded_clo
-000148c0: 7365 7374 5f6e 6272 290a 2020 2020 2020  sest_nbr).      
-000148d0: 2020 2020 2020 666f 7220 2870 6164 6465        for (padde
-000148e0: 645f 6174 6f6d 5f6e 6272 732c 0a20 2020  d_atom_nbrs,.   
-000148f0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00014900: 6464 6564 5f63 6c6f 7365 7374 5f6e 6272  dded_closest_nbr
-00014910: 2920 696e 207a 6970 2870 6164 6465 645f  ) in zip(padded_
-00014920: 6e62 7273 2c20 7061 6464 6564 5f63 6c6f  nbrs, padded_clo
-00014930: 7365 7374 5f6e 6272 7329 0a20 2020 2020  sest_nbrs).     
-00014940: 2020 205d 0a0a 2020 2020 2020 2020 6e65     ]..        ne
-00014950: 6967 6862 6f72 5f6c 6973 7420 3d20 746f  ighbor_list = to
-00014960: 7263 682e 7374 6163 6b28 7061 6464 6564  rch.stack(padded
-00014970: 5f6e 6569 6768 626f 725f 6c69 7374 290a  _neighbor_list).
-00014980: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00014990: 6e65 6967 6862 6f72 5f6c 6973 740a 0a20  neighbor_list.. 
-000149a0: 2020 2064 6566 2067 6574 5f61 746f 6d73     def get_atoms
-000149b0: 5f69 6e5f 6e62 7273 2873 656c 662c 2063  _in_nbrs(self, c
-000149c0: 6f6f 7264 733a 2074 6f72 6368 2e54 656e  oords: torch.Ten
-000149d0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
-000149e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000149f0: 656c 6c73 3a20 746f 7263 682e 5465 6e73  ells: torch.Tens
-00014a00: 6f72 2920 2d3e 204c 6973 745b 746f 7263  or) -> List[torc
-00014a10: 682e 5465 6e73 6f72 5d3a 0a20 2020 2020  h.Tensor]:.     
-00014a20: 2020 2022 2222 4765 7420 7468 6520 6174     """Get the at
-00014a30: 6f6d 7320 696e 206e 6569 6768 626f 7269  oms in neighbori
-00014a40: 6e67 2063 656c 6c73 2066 6f72 2065 6163  ng cells for eac
-00014a50: 6820 6365 6c6c 732e 0a0a 2020 2020 2020  h cells...      
-00014a60: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00014a70: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00014a80: 2020 2020 2020 2020 636f 6f72 6473 3a20          coords: 
-00014a90: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
-00014aa0: 2020 2020 2020 2020 2053 6861 7065 2028           Shape (
-00014ab0: 4e5f 6174 6f6d 732c 206e 6469 6d29 0a20  N_atoms, ndim). 
-00014ac0: 2020 2020 2020 2063 656c 6c73 3a20 746f         cells: to
-00014ad0: 7263 682e 5465 6e73 6f72 0a0a 2020 2020  rch.Tensor..    
-00014ae0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-00014af0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00014b00: 2020 2020 6174 6f6d 735f 696e 5f6e 6272      atoms_in_nbr
-00014b10: 733a 204c 6973 745b 746f 7263 682e 5465  s: List[torch.Te
-00014b20: 6e73 6f72 5d0a 2020 2020 2020 2020 2020  nsor].          
-00014b30: 2020 284e 5f61 746f 6d73 2c20 6e5f 6e62    (N_atoms, n_nb
-00014b40: 725f 6365 6c6c 732c 204d 5f6e 6272 7329  r_cells, M_nbrs)
-00014b50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00014b60: 2020 2020 2023 2053 6861 7065 2028 4e5f       # Shape (N_
-00014b70: 6174 6f6d 732c 2031 290a 2020 2020 2020  atoms, 1).      
-00014b80: 2020 6365 6c6c 735f 666f 725f 6174 6f6d    cells_for_atom
-00014b90: 7320 3d20 7365 6c66 2e67 6574 5f63 656c  s = self.get_cel
-00014ba0: 6c73 5f66 6f72 5f61 746f 6d73 2863 6f6f  ls_for_atoms(coo
-00014bb0: 7264 732c 2063 656c 6c73 290a 0a20 2020  rds, cells)..   
-00014bc0: 2020 2020 2023 2046 696e 6420 4d5f 6e62       # Find M_nb
-00014bd0: 7273 2061 746f 6d73 2063 6c6f 7365 7374  rs atoms closest
-00014be0: 2074 6f20 6561 6368 2063 656c 6c0a 2020   to each cell.  
-00014bf0: 2020 2020 2020 2320 5368 6170 6520 286e        # Shape (n
-00014c00: 5f63 656c 6c73 2c20 4d5f 6e62 7273 290a  _cells, M_nbrs).
-00014c10: 2020 2020 2020 2020 636c 6f73 6573 745f          closest_
-00014c20: 6174 6f6d 7320 3d20 7365 6c66 2e67 6574  atoms = self.get
-00014c30: 5f63 6c6f 7365 7374 5f61 746f 6d73 2863  _closest_atoms(c
-00014c40: 6f6f 7264 732c 2063 656c 6c73 290a 0a20  oords, cells).. 
-00014c50: 2020 2020 2020 2023 2041 7373 6f63 6961         # Associa
-00014c60: 7465 2065 6163 6820 6365 6c6c 2077 6974  te each cell wit
-00014c70: 6820 6974 7320 6e65 6967 6862 6f72 2063  h its neighbor c
-00014c80: 656c 6c73 2e20 4173 7375 6d65 7320 7065  ells. Assumes pe
-00014c90: 7269 6f64 6963 2062 6f75 6e64 6172 790a  riodic boundary.
-00014ca0: 2020 2020 2020 2020 2320 636f 6e64 6974          # condit
-00014cb0: 696f 6e73 2c20 736f 2064 6f65 7320 7772  ions, so does wr
-00014cc0: 6170 726f 756e 642e 204f 2863 6f6e 7374  apround. O(const
-00014cd0: 616e 7429 0a20 2020 2020 2020 2023 2053  ant).        # S
-00014ce0: 6861 7065 2028 6e5f 6365 6c6c 732c 206e  hape (n_cells, n
-00014cf0: 5f6e 6272 5f63 656c 6c73 290a 2020 2020  _nbr_cells).    
-00014d00: 2020 2020 6e65 6967 6862 6f72 5f63 656c      neighbor_cel
-00014d10: 6c73 203d 2073 656c 662e 6765 745f 6e65  ls = self.get_ne
-00014d20: 6967 6862 6f72 5f63 656c 6c73 2863 656c  ighbor_cells(cel
-00014d30: 6c73 290a 0a20 2020 2020 2020 2023 2053  ls)..        # S
-00014d40: 6861 7065 2028 4e5f 6174 6f6d 732c 206e  hape (N_atoms, n
-00014d50: 5f6e 6272 5f63 656c 6c73 290a 2020 2020  _nbr_cells).    
-00014d60: 2020 2020 6e65 6967 6862 6f72 5f63 656c      neighbor_cel
-00014d70: 6c73 203d 2074 6f72 6368 2e73 7175 6565  ls = torch.squee
-00014d80: 7a65 280a 2020 2020 2020 2020 2020 2020  ze(.            
-00014d90: 746f 7263 682e 696e 6465 785f 7365 6c65  torch.index_sele
-00014da0: 6374 286e 6569 6768 626f 725f 6365 6c6c  ct(neighbor_cell
-00014db0: 732c 2030 2c0a 2020 2020 2020 2020 2020  s, 0,.          
+00014500: 2020 2020 2020 2020 2020 2020 2020 2032                 2
+00014510: 202a 2073 656c 662e 7374 6f70 292e 746f   * self.stop).to
+00014520: 2874 6f72 6368 2e66 6c6f 6174 290a 2020  (torch.float).  
+00014530: 2020 2020 2020 7061 6464 6564 5f6e 6272        padded_nbr
+00014540: 5f63 6f6f 7264 7320 3d20 5b0a 2020 2020  _coords = [.    
+00014550: 2020 2020 2020 2020 746f 7263 682e 6361          torch.ca
+00014560: 7428 5b6e 6272 5f63 6f6f 7264 2c20 636f  t([nbr_coord, co
+00014570: 6f72 645f 7061 6464 696e 675d 2c20 3029  ord_padding], 0)
+00014580: 2066 6f72 206e 6272 5f63 6f6f 7264 2069   for nbr_coord i
+00014590: 6e20 6e62 725f 636f 6f72 6473 0a20 2020  n nbr_coords.   
+000145a0: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
+000145b0: 2320 4c69 7374 206f 6620 6c65 6e67 7468  # List of length
+000145c0: 204e 5f61 746f 6d73 2c20 6561 6368 206f   N_atoms, each o
+000145d0: 6620 7368 6170 6520 2831 2c20 6e64 696d  f shape (1, ndim
+000145e0: 290a 2020 2020 2020 2020 6174 6f6d 5f63  ).        atom_c
+000145f0: 6f6f 7264 7320 3d20 746f 7263 682e 7465  oords = torch.te
+00014600: 6e73 6f72 5f73 706c 6974 2863 6f6f 7264  nsor_split(coord
+00014610: 732c 2073 656c 662e 4e5f 6174 6f6d 7329  s, self.N_atoms)
+00014620: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
+00014630: 2872 6268 6172 6174 6829 3a20 486f 7720  (rbharath): How 
+00014640: 646f 6573 2064 6973 7461 6e63 6520 6e65  does distance ne
+00014650: 6564 2074 6f20 6265 206d 6f64 6966 6965  ed to be modifie
+00014660: 6420 6865 7265 2074 6f0a 2020 2020 2020  d here to.      
+00014670: 2020 2320 6163 636f 756e 7420 666f 7220    # account for 
+00014680: 7065 7269 6f64 6963 2062 6f75 6e64 6172  periodic boundar
+00014690: 7920 636f 6e64 6974 696f 6e73 3f0a 2020  y conditions?.  
+000146a0: 2020 2020 2020 2320 4c69 7374 206f 6620        # List of 
+000146b0: 6c65 6e67 7468 204e 5f61 746f 6d73 2065  length N_atoms e
+000146c0: 6163 6820 6f66 2073 6861 7065 2028 4d5f  ach of shape (M_
+000146d0: 6e62 7273 290a 2020 2020 2020 2020 7061  nbrs).        pa
+000146e0: 6464 6564 5f64 6973 7473 203d 205b 0a20  dded_dists = [. 
+000146f0: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
+00014700: 2e73 756d 2828 6174 6f6d 5f63 6f6f 7264  .sum((atom_coord
+00014710: 202d 2070 6164 6465 645f 6e62 725f 636f   - padded_nbr_co
+00014720: 6f72 6429 2a2a 322c 2064 696d 3d2d 3129  ord)**2, dim=-1)
+00014730: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00014740: 2028 6174 6f6d 5f63 6f6f 7264 2c0a 2020   (atom_coord,.  
+00014750: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00014760: 6164 6465 645f 6e62 725f 636f 6f72 6429  added_nbr_coord)
+00014770: 2069 6e20 7a69 7028 6174 6f6d 5f63 6f6f   in zip(atom_coo
+00014780: 7264 732c 2070 6164 6465 645f 6e62 725f  rds, padded_nbr_
+00014790: 636f 6f72 6473 290a 2020 2020 2020 2020  coords).        
+000147a0: 5d0a 0a20 2020 2020 2020 2070 6164 6465  ]..        padde
+000147b0: 645f 636c 6f73 6573 745f 6e62 7273 203d  d_closest_nbrs =
+000147c0: 205b 0a20 2020 2020 2020 2020 2020 2074   [.            t
+000147d0: 6f72 6368 2e74 6f70 6b28 7061 6464 6564  orch.topk(padded
+000147e0: 5f64 6973 742c 206b 3d73 656c 662e 4d5f  _dist, k=self.M_
+000147f0: 6e62 7273 2c20 6c61 7267 6573 743d 4661  nbrs, largest=Fa
+00014800: 6c73 6529 5b31 5d0a 2020 2020 2020 2020  lse)[1].        
+00014810: 2020 2020 666f 7220 7061 6464 6564 5f64      for padded_d
+00014820: 6973 7420 696e 2070 6164 6465 645f 6469  ist in padded_di
+00014830: 7374 730a 2020 2020 2020 2020 5d0a 0a20  sts.        ].. 
+00014840: 2020 2020 2020 2023 204e 5f61 746f 6d73         # N_atoms
+00014850: 2065 6c74 7320 6f66 2073 697a 6520 284d   elts of size (M
+00014860: 5f6e 6272 732c 2920 6561 6368 0a20 2020  _nbrs,) each.   
+00014870: 2020 2020 2070 6164 6465 645f 6e65 6967       padded_neig
+00014880: 6862 6f72 5f6c 6973 7420 3d20 5b0a 2020  hbor_list = [.  
+00014890: 2020 2020 2020 2020 2020 746f 7263 682e            torch.
+000148a0: 6761 7468 6572 2870 6164 6465 645f 6174  gather(padded_at
+000148b0: 6f6d 5f6e 6272 732c 2030 2c20 7061 6464  om_nbrs, 0, padd
+000148c0: 6564 5f63 6c6f 7365 7374 5f6e 6272 290a  ed_closest_nbr).
+000148d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000148e0: 2870 6164 6465 645f 6174 6f6d 5f6e 6272  (padded_atom_nbr
+000148f0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00014900: 2020 2020 7061 6464 6564 5f63 6c6f 7365      padded_close
+00014910: 7374 5f6e 6272 2920 696e 207a 6970 2870  st_nbr) in zip(p
+00014920: 6164 6465 645f 6e62 7273 2c20 7061 6464  added_nbrs, padd
+00014930: 6564 5f63 6c6f 7365 7374 5f6e 6272 7329  ed_closest_nbrs)
+00014940: 0a20 2020 2020 2020 205d 0a0a 2020 2020  .        ]..    
+00014950: 2020 2020 6e65 6967 6862 6f72 5f6c 6973      neighbor_lis
+00014960: 7420 3d20 746f 7263 682e 7374 6163 6b28  t = torch.stack(
+00014970: 7061 6464 6564 5f6e 6569 6768 626f 725f  padded_neighbor_
+00014980: 6c69 7374 290a 0a20 2020 2020 2020 2072  list)..        r
+00014990: 6574 7572 6e20 6e65 6967 6862 6f72 5f6c  eturn neighbor_l
+000149a0: 6973 740a 0a20 2020 2064 6566 2067 6574  ist..    def get
+000149b0: 5f61 746f 6d73 5f69 6e5f 6e62 7273 2873  _atoms_in_nbrs(s
+000149c0: 656c 662c 2063 6f6f 7264 733a 2074 6f72  elf, coords: tor
+000149d0: 6368 2e54 656e 736f 722c 0a20 2020 2020  ch.Tensor,.     
+000149e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149f0: 2020 2020 2063 656c 6c73 3a20 746f 7263       cells: torc
+00014a00: 682e 5465 6e73 6f72 2920 2d3e 204c 6973  h.Tensor) -> Lis
+00014a10: 745b 746f 7263 682e 5465 6e73 6f72 5d3a  t[torch.Tensor]:
+00014a20: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+00014a30: 7468 6520 6174 6f6d 7320 696e 206e 6569  the atoms in nei
+00014a40: 6768 626f 7269 6e67 2063 656c 6c73 2066  ghboring cells f
+00014a50: 6f72 2065 6163 6820 6365 6c6c 732e 0a0a  or each cells...
+00014a60: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00014a70: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00014a80: 2d2d 2d2d 2d0a 2020 2020 2020 2020 636f  -----.        co
+00014a90: 6f72 6473 3a20 746f 7263 682e 5465 6e73  ords: torch.Tens
+00014aa0: 6f72 0a20 2020 2020 2020 2020 2020 2053  or.            S
+00014ab0: 6861 7065 2028 4e5f 6174 6f6d 732c 206e  hape (N_atoms, n
+00014ac0: 6469 6d29 0a20 2020 2020 2020 2063 656c  dim).        cel
+00014ad0: 6c73 3a20 746f 7263 682e 5465 6e73 6f72  ls: torch.Tensor
+00014ae0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00014af0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00014b00: 2d0a 2020 2020 2020 2020 6174 6f6d 735f  -.        atoms_
+00014b10: 696e 5f6e 6272 733a 204c 6973 745b 746f  in_nbrs: List[to
+00014b20: 7263 682e 5465 6e73 6f72 5d0a 2020 2020  rch.Tensor].    
+00014b30: 2020 2020 2020 2020 284e 5f61 746f 6d73          (N_atoms
+00014b40: 2c20 6e5f 6e62 725f 6365 6c6c 732c 204d  , n_nbr_cells, M
+00014b50: 5f6e 6272 7329 0a20 2020 2020 2020 2022  _nbrs).        "
+00014b60: 2222 0a20 2020 2020 2020 2023 2053 6861  "".        # Sha
+00014b70: 7065 2028 4e5f 6174 6f6d 732c 2031 290a  pe (N_atoms, 1).
+00014b80: 2020 2020 2020 2020 6365 6c6c 735f 666f          cells_fo
+00014b90: 725f 6174 6f6d 7320 3d20 7365 6c66 2e67  r_atoms = self.g
+00014ba0: 6574 5f63 656c 6c73 5f66 6f72 5f61 746f  et_cells_for_ato
+00014bb0: 6d73 2863 6f6f 7264 732c 2063 656c 6c73  ms(coords, cells
+00014bc0: 290a 0a20 2020 2020 2020 2023 2046 696e  )..        # Fin
+00014bd0: 6420 4d5f 6e62 7273 2061 746f 6d73 2063  d M_nbrs atoms c
+00014be0: 6c6f 7365 7374 2074 6f20 6561 6368 2063  losest to each c
+00014bf0: 656c 6c0a 2020 2020 2020 2020 2320 5368  ell.        # Sh
+00014c00: 6170 6520 286e 5f63 656c 6c73 2c20 4d5f  ape (n_cells, M_
+00014c10: 6e62 7273 290a 2020 2020 2020 2020 636c  nbrs).        cl
+00014c20: 6f73 6573 745f 6174 6f6d 7320 3d20 7365  osest_atoms = se
+00014c30: 6c66 2e67 6574 5f63 6c6f 7365 7374 5f61  lf.get_closest_a
+00014c40: 746f 6d73 2863 6f6f 7264 732c 2063 656c  toms(coords, cel
+00014c50: 6c73 290a 0a20 2020 2020 2020 2023 2041  ls)..        # A
+00014c60: 7373 6f63 6961 7465 2065 6163 6820 6365  ssociate each ce
+00014c70: 6c6c 2077 6974 6820 6974 7320 6e65 6967  ll with its neig
+00014c80: 6862 6f72 2063 656c 6c73 2e20 4173 7375  hbor cells. Assu
+00014c90: 6d65 7320 7065 7269 6f64 6963 2062 6f75  mes periodic bou
+00014ca0: 6e64 6172 790a 2020 2020 2020 2020 2320  ndary.        # 
+00014cb0: 636f 6e64 6974 696f 6e73 2c20 736f 2064  conditions, so d
+00014cc0: 6f65 7320 7772 6170 726f 756e 642e 204f  oes wrapround. O
+00014cd0: 2863 6f6e 7374 616e 7429 0a20 2020 2020  (constant).     
+00014ce0: 2020 2023 2053 6861 7065 2028 6e5f 6365     # Shape (n_ce
+00014cf0: 6c6c 732c 206e 5f6e 6272 5f63 656c 6c73  lls, n_nbr_cells
+00014d00: 290a 2020 2020 2020 2020 6e65 6967 6862  ).        neighb
+00014d10: 6f72 5f63 656c 6c73 203d 2073 656c 662e  or_cells = self.
+00014d20: 6765 745f 6e65 6967 6862 6f72 5f63 656c  get_neighbor_cel
+00014d30: 6c73 2863 656c 6c73 290a 0a20 2020 2020  ls(cells)..     
+00014d40: 2020 2023 2053 6861 7065 2028 4e5f 6174     # Shape (N_at
+00014d50: 6f6d 732c 206e 5f6e 6272 5f63 656c 6c73  oms, n_nbr_cells
+00014d60: 290a 2020 2020 2020 2020 6e65 6967 6862  ).        neighb
+00014d70: 6f72 5f63 656c 6c73 203d 2074 6f72 6368  or_cells = torch
+00014d80: 2e73 7175 6565 7a65 280a 2020 2020 2020  .squeeze(.      
+00014d90: 2020 2020 2020 746f 7263 682e 696e 6465        torch.inde
+00014da0: 785f 7365 6c65 6374 286e 6569 6768 626f  x_select(neighbo
+00014db0: 725f 6365 6c6c 732c 2030 2c0a 2020 2020  r_cells, 0,.    
 00014dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014dd0: 2020 2020 2074 6f72 6368 2e73 7175 6565       torch.squee
-00014de0: 7a65 2863 656c 6c73 5f66 6f72 5f61 746f  ze(cells_for_ato
-00014df0: 6d73 2929 290a 0a20 2020 2020 2020 2023  ms)))..        #
-00014e00: 2053 6861 7065 2028 4e5f 6174 6f6d 732c   Shape (N_atoms,
-00014e10: 206e 5f6e 6272 5f63 656c 6c73 2c20 4d5f   n_nbr_cells, M_
-00014e20: 6e62 7273 290a 2020 2020 2020 2020 6174  nbrs).        at
-00014e30: 6f6d 735f 696e 5f6e 6272 7320 3d20 746f  oms_in_nbrs = to
-00014e40: 7263 682e 696e 6465 785f 7365 6c65 6374  rch.index_select
-00014e50: 2863 6c6f 7365 7374 5f61 746f 6d73 2c20  (closest_atoms, 
-00014e60: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+00014dd0: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
+00014de0: 2e73 7175 6565 7a65 2863 656c 6c73 5f66  .squeeze(cells_f
+00014df0: 6f72 5f61 746f 6d73 2929 290a 0a20 2020  or_atoms)))..   
+00014e00: 2020 2020 2023 2053 6861 7065 2028 4e5f       # Shape (N_
+00014e10: 6174 6f6d 732c 206e 5f6e 6272 5f63 656c  atoms, n_nbr_cel
+00014e20: 6c73 2c20 4d5f 6e62 7273 290a 2020 2020  ls, M_nbrs).    
+00014e30: 2020 2020 6174 6f6d 735f 696e 5f6e 6272      atoms_in_nbr
+00014e40: 7320 3d20 746f 7263 682e 696e 6465 785f  s = torch.index_
+00014e50: 7365 6c65 6374 2863 6c6f 7365 7374 5f61  select(closest_a
+00014e60: 746f 6d73 2c20 302c 0a20 2020 2020 2020  toms, 0,.       
 00014e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e80: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00014e90: 6967 6862 6f72 5f63 656c 6c73 2e66 6c61  ighbor_cells.fla
-00014ea0: 7474 656e 2829 290a 0a20 2020 2020 2020  tten())..       
-00014eb0: 2023 2053 6861 7065 2028 4e5f 6174 6f6d   # Shape (N_atom
-00014ec0: 732c 206e 5f6e 6272 5f63 656c 6c73 2a4d  s, n_nbr_cells*M
-00014ed0: 5f6e 6272 7329 0a20 2020 2020 2020 2061  _nbrs).        a
-00014ee0: 746f 6d73 5f69 6e5f 6e62 7273 203d 2074  toms_in_nbrs = t
-00014ef0: 6f72 6368 2e72 6573 6861 7065 2861 746f  orch.reshape(ato
-00014f00: 6d73 5f69 6e5f 6e62 7273 2c20 5b73 656c  ms_in_nbrs, [sel
-00014f10: 662e 4e5f 6174 6f6d 732c 202d 315d 290a  f.N_atoms, -1]).
-00014f20: 0a20 2020 2020 2020 2023 204c 6973 7420  .        # List 
-00014f30: 6f66 206c 656e 6774 6820 4e5f 6174 6f6d  of length N_atom
-00014f40: 732c 2065 6163 6820 656c 656d 656e 7420  s, each element 
-00014f50: 6c65 6e67 7468 2075 6e69 7175 6573 5f69  length uniques_i
-00014f60: 0a20 2020 2020 2020 206e 6272 735f 7065  .        nbrs_pe
-00014f70: 725f 6174 6f6d 203d 2074 6f72 6368 2e73  r_atom = torch.s
-00014f80: 706c 6974 2861 746f 6d73 5f69 6e5f 6e62  plit(atoms_in_nb
-00014f90: 7273 2c20 7365 6c66 2e4e 5f61 746f 6d73  rs, self.N_atoms
-00014fa0: 290a 0a20 2020 2020 2020 2075 6e69 7175  )..        uniqu
-00014fb0: 6573 203d 205b 0a20 2020 2020 2020 2020  es = [.         
-00014fc0: 2020 2074 6f72 6368 2e75 6e69 7175 6528     torch.unique(
-00014fd0: 6174 6f6d 5f6e 6272 732c 2073 6f72 7465  atom_nbrs, sorte
-00014fe0: 643d 4661 6c73 6529 0a20 2020 2020 2020  d=False).       
-00014ff0: 2020 2020 2066 6f72 2061 746f 6d5f 6e62       for atom_nb
-00015000: 7273 2069 6e20 6e62 7273 5f70 6572 5f61  rs in nbrs_per_a
-00015010: 746f 6d5b 305d 0a20 2020 2020 2020 205d  tom[0].        ]
-00015020: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
-00015030: 2872 6268 6172 6174 6829 3a20 4652 4147  (rbharath): FRAG
-00015040: 494c 4521 2055 7365 7320 6661 6374 2074  ILE! Uses fact t
-00015050: 6861 7420 6964 656e 7469 7479 2073 6565  hat identity see
-00015060: 6d73 2074 6f20 6265 2074 6865 2066 6972  ms to be the fir
-00015070: 7374 0a20 2020 2020 2020 2023 2065 6c65  st.        # ele
-00015080: 6d65 6e74 2072 656d 6f76 6564 2074 6f20  ment removed to 
-00015090: 7265 6d6f 7665 2073 656c 6620 6672 6f6d  remove self from
-000150a0: 206c 6973 7420 6f66 206e 6569 6768 626f   list of neighbo
-000150b0: 7273 2e20 4e65 6564 2074 6f20 7665 7269  rs. Need to veri
-000150c0: 6679 0a20 2020 2020 2020 2023 2074 6869  fy.        # thi
-000150d0: 7320 686f 6c64 7320 6d6f 7265 2062 726f  s holds more bro
-000150e0: 6164 6c79 206f 7220 636f 6d65 2075 7020  adly or come up 
-000150f0: 7769 7468 2072 6f62 7573 7420 616c 7465  with robust alte
-00015100: 726e 6174 6976 652e 0a20 2020 2020 2020  rnative..       
-00015110: 2075 6e69 7175 6573 203d 205b 756e 6971   uniques = [uniq
-00015120: 7565 5b31 3a5d 2066 6f72 2075 6e69 7175  ue[1:] for uniqu
-00015130: 6520 696e 2075 6e69 7175 6573 5d0a 0a20  e in uniques].. 
-00015140: 2020 2020 2020 2072 6574 7572 6e20 756e         return un
-00015150: 6971 7565 730a 0a20 2020 2064 6566 2067  iques..    def g
-00015160: 6574 5f63 6c6f 7365 7374 5f61 746f 6d73  et_closest_atoms
-00015170: 2873 656c 662c 2063 6f6f 7264 733a 2074  (self, coords: t
-00015180: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
-00015190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151a0: 2020 2020 2020 2063 656c 6c73 3a20 746f         cells: to
-000151b0: 7263 682e 5465 6e73 6f72 2920 2d3e 2074  rch.Tensor) -> t
-000151c0: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
-000151d0: 2020 2020 2022 2222 466f 7220 6561 6368       """For each
-000151e0: 2063 656c 6c2c 2066 696e 6420 4d5f 6e62   cell, find M_nb
-000151f0: 7273 2063 6c6f 7365 7374 2061 746f 6d73  rs closest atoms
-00015200: 2e0a 0a20 2020 2020 2020 204c 6574 204e  ...        Let N
-00015210: 5f61 746f 6d73 2062 6520 7468 6520 6e75  _atoms be the nu
-00015220: 6d62 6572 206f 6620 6174 6f6d 732e 0a0a  mber of atoms...
-00015230: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00015240: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00015250: 2d2d 2d2d 2d0a 2020 2020 2020 2020 636f  -----.        co
-00015260: 6f72 6473 3a20 746f 7263 682e 5465 6e73  ords: torch.Tens
-00015270: 6f72 0a20 2020 2020 2020 2020 2020 2028  or.            (
-00015280: 4e5f 6174 6f6d 732c 206e 6469 6d29 2073  N_atoms, ndim) s
-00015290: 6861 7065 2e0a 2020 2020 2020 2020 6365  hape..        ce
-000152a0: 6c6c 733a 2074 6f72 6368 2e54 656e 736f  lls: torch.Tenso
-000152b0: 720a 2020 2020 2020 2020 2020 2020 286e  r.            (n
-000152c0: 5f63 656c 6c73 2c20 6e64 696d 2920 7368  _cells, ndim) sh
-000152d0: 6170 652e 0a0a 2020 2020 2020 2020 5265  ape...        Re
-000152e0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-000152f0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 636c  -----.        cl
-00015300: 6f73 6573 745f 696e 6473 3a20 746f 7263  osest_inds: torc
-00015310: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00015320: 2020 2020 204f 6620 7368 6170 6520 286e       Of shape (n
-00015330: 5f63 656c 6c73 2c20 4d5f 6e62 7273 290a  _cells, M_nbrs).
-00015340: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00015350: 2020 2020 4e5f 6174 6f6d 732c 206e 5f63      N_atoms, n_c
-00015360: 656c 6c73 2c20 6e64 696d 2c20 4d5f 6e62  ells, ndim, M_nb
-00015370: 7273 203d 2028 7365 6c66 2e4e 5f61 746f  rs = (self.N_ato
-00015380: 6d73 2c20 7365 6c66 2e6e 5f63 656c 6c73  ms, self.n_cells
-00015390: 2c20 7365 6c66 2e6e 6469 6d2c 0a20 2020  , self.ndim,.   
-000153a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e90: 2020 2020 6e65 6967 6862 6f72 5f63 656c      neighbor_cel
+00014ea0: 6c73 2e66 6c61 7474 656e 2829 290a 0a20  ls.flatten()).. 
+00014eb0: 2020 2020 2020 2023 2053 6861 7065 2028         # Shape (
+00014ec0: 4e5f 6174 6f6d 732c 206e 5f6e 6272 5f63  N_atoms, n_nbr_c
+00014ed0: 656c 6c73 2a4d 5f6e 6272 7329 0a20 2020  ells*M_nbrs).   
+00014ee0: 2020 2020 2061 746f 6d73 5f69 6e5f 6e62       atoms_in_nb
+00014ef0: 7273 203d 2074 6f72 6368 2e72 6573 6861  rs = torch.resha
+00014f00: 7065 2861 746f 6d73 5f69 6e5f 6e62 7273  pe(atoms_in_nbrs
+00014f10: 2c20 5b73 656c 662e 4e5f 6174 6f6d 732c  , [self.N_atoms,
+00014f20: 202d 315d 290a 0a20 2020 2020 2020 2023   -1])..        #
+00014f30: 204c 6973 7420 6f66 206c 656e 6774 6820   List of length 
+00014f40: 4e5f 6174 6f6d 732c 2065 6163 6820 656c  N_atoms, each el
+00014f50: 656d 656e 7420 6c65 6e67 7468 2075 6e69  ement length uni
+00014f60: 7175 6573 5f69 0a20 2020 2020 2020 206e  ques_i.        n
+00014f70: 6272 735f 7065 725f 6174 6f6d 203d 2074  brs_per_atom = t
+00014f80: 6f72 6368 2e73 706c 6974 2861 746f 6d73  orch.split(atoms
+00014f90: 5f69 6e5f 6e62 7273 2c20 7365 6c66 2e4e  _in_nbrs, self.N
+00014fa0: 5f61 746f 6d73 290a 0a20 2020 2020 2020  _atoms)..       
+00014fb0: 2075 6e69 7175 6573 203d 205b 0a20 2020   uniques = [.   
+00014fc0: 2020 2020 2020 2020 2074 6f72 6368 2e75           torch.u
+00014fd0: 6e69 7175 6528 6174 6f6d 5f6e 6272 732c  nique(atom_nbrs,
+00014fe0: 2073 6f72 7465 643d 4661 6c73 6529 0a20   sorted=False). 
+00014ff0: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
+00015000: 746f 6d5f 6e62 7273 2069 6e20 6e62 7273  tom_nbrs in nbrs
+00015010: 5f70 6572 5f61 746f 6d5b 305d 0a20 2020  _per_atom[0].   
+00015020: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
+00015030: 2320 544f 444f 2872 6268 6172 6174 6829  # TODO(rbharath)
+00015040: 3a20 4652 4147 494c 4521 2055 7365 7320  : FRAGILE! Uses 
+00015050: 6661 6374 2074 6861 7420 6964 656e 7469  fact that identi
+00015060: 7479 2073 6565 6d73 2074 6f20 6265 2074  ty seems to be t
+00015070: 6865 2066 6972 7374 0a20 2020 2020 2020  he first.       
+00015080: 2023 2065 6c65 6d65 6e74 2072 656d 6f76   # element remov
+00015090: 6564 2074 6f20 7265 6d6f 7665 2073 656c  ed to remove sel
+000150a0: 6620 6672 6f6d 206c 6973 7420 6f66 206e  f from list of n
+000150b0: 6569 6768 626f 7273 2e20 4e65 6564 2074  eighbors. Need t
+000150c0: 6f20 7665 7269 6679 0a20 2020 2020 2020  o verify.       
+000150d0: 2023 2074 6869 7320 686f 6c64 7320 6d6f   # this holds mo
+000150e0: 7265 2062 726f 6164 6c79 206f 7220 636f  re broadly or co
+000150f0: 6d65 2075 7020 7769 7468 2072 6f62 7573  me up with robus
+00015100: 7420 616c 7465 726e 6174 6976 652e 0a20  t alternative.. 
+00015110: 2020 2020 2020 2075 6e69 7175 6573 203d         uniques =
+00015120: 205b 756e 6971 7565 5b31 3a5d 2066 6f72   [unique[1:] for
+00015130: 2075 6e69 7175 6520 696e 2075 6e69 7175   unique in uniqu
+00015140: 6573 5d0a 0a20 2020 2020 2020 2072 6574  es]..        ret
+00015150: 7572 6e20 756e 6971 7565 730a 0a20 2020  urn uniques..   
+00015160: 2064 6566 2067 6574 5f63 6c6f 7365 7374   def get_closest
+00015170: 5f61 746f 6d73 2873 656c 662c 2063 6f6f  _atoms(self, coo
+00015180: 7264 733a 2074 6f72 6368 2e54 656e 736f  rds: torch.Tenso
+00015190: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+000151a0: 2020 2020 2020 2020 2020 2020 2063 656c               cel
+000151b0: 6c73 3a20 746f 7263 682e 5465 6e73 6f72  ls: torch.Tensor
+000151c0: 2920 2d3e 2074 6f72 6368 2e54 656e 736f  ) -> torch.Tenso
+000151d0: 723a 0a20 2020 2020 2020 2022 2222 466f  r:.        """Fo
+000151e0: 7220 6561 6368 2063 656c 6c2c 2066 696e  r each cell, fin
+000151f0: 6420 4d5f 6e62 7273 2063 6c6f 7365 7374  d M_nbrs closest
+00015200: 2061 746f 6d73 2e0a 0a20 2020 2020 2020   atoms...       
+00015210: 204c 6574 204e 5f61 746f 6d73 2062 6520   Let N_atoms be 
+00015220: 7468 6520 6e75 6d62 6572 206f 6620 6174  the number of at
+00015230: 6f6d 732e 0a0a 2020 2020 2020 2020 5061  oms...        Pa
+00015240: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00015250: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00015260: 2020 2020 636f 6f72 6473 3a20 746f 7263      coords: torc
+00015270: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00015280: 2020 2020 2028 4e5f 6174 6f6d 732c 206e       (N_atoms, n
+00015290: 6469 6d29 2073 6861 7065 2e0a 2020 2020  dim) shape..    
+000152a0: 2020 2020 6365 6c6c 733a 2074 6f72 6368      cells: torch
+000152b0: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+000152c0: 2020 2020 286e 5f63 656c 6c73 2c20 6e64      (n_cells, nd
+000152d0: 696d 2920 7368 6170 652e 0a0a 2020 2020  im) shape...    
+000152e0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+000152f0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00015300: 2020 2020 636c 6f73 6573 745f 696e 6473      closest_inds
+00015310: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
+00015320: 2020 2020 2020 2020 2020 204f 6620 7368             Of sh
+00015330: 6170 6520 286e 5f63 656c 6c73 2c20 4d5f  ape (n_cells, M_
+00015340: 6e62 7273 290a 2020 2020 2020 2020 2222  nbrs).        ""
+00015350: 220a 2020 2020 2020 2020 4e5f 6174 6f6d  ".        N_atom
+00015360: 732c 206e 5f63 656c 6c73 2c20 6e64 696d  s, n_cells, ndim
+00015370: 2c20 4d5f 6e62 7273 203d 2028 7365 6c66  , M_nbrs = (self
+00015380: 2e4e 5f61 746f 6d73 2c20 7365 6c66 2e6e  .N_atoms, self.n
+00015390: 5f63 656c 6c73 2c20 7365 6c66 2e6e 6469  _cells, self.ndi
+000153a0: 6d2c 0a20 2020 2020 2020 2020 2020 2020  m,.             
 000153b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153c0: 2020 2020 2020 2073 656c 662e 4d5f 6e62         self.M_nb
-000153d0: 7273 290a 2020 2020 2020 2020 2320 5469  rs).        # Ti
-000153e0: 6c65 2062 6f74 6820 6365 6c6c 7320 616e  le both cells an
-000153f0: 6420 636f 6f72 6473 2074 6f20 666f 726d  d coords to form
-00015400: 2061 7272 6179 7320 6f66 2073 697a 6520   arrays of size 
-00015410: 284e 5f61 746f 6d73 2a6e 5f63 656c 6c73  (N_atoms*n_cells
-00015420: 2c20 6e64 696d 290a 2020 2020 2020 2020  , ndim).        
-00015430: 7469 6c65 645f 6365 6c6c 7320 3d20 746f  tiled_cells = to
-00015440: 7263 682e 7265 7368 6170 6528 746f 7263  rch.reshape(torc
-00015450: 682e 7469 6c65 2863 656c 6c73 2c20 2831  h.tile(cells, (1
-00015460: 2c20 4e5f 6174 6f6d 7329 292c 0a20 2020  , N_atoms)),.   
-00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000153d0: 662e 4d5f 6e62 7273 290a 2020 2020 2020  f.M_nbrs).      
+000153e0: 2020 2320 5469 6c65 2062 6f74 6820 6365    # Tile both ce
+000153f0: 6c6c 7320 616e 6420 636f 6f72 6473 2074  lls and coords t
+00015400: 6f20 666f 726d 2061 7272 6179 7320 6f66  o form arrays of
+00015410: 2073 697a 6520 284e 5f61 746f 6d73 2a6e   size (N_atoms*n
+00015420: 5f63 656c 6c73 2c20 6e64 696d 290a 2020  _cells, ndim).  
+00015430: 2020 2020 2020 7469 6c65 645f 6365 6c6c        tiled_cell
+00015440: 7320 3d20 746f 7263 682e 7265 7368 6170  s = torch.reshap
+00015450: 6528 746f 7263 682e 7469 6c65 2863 656c  e(torch.tile(cel
+00015460: 6c73 2c20 2831 2c20 4e5f 6174 6f6d 7329  ls, (1, N_atoms)
+00015470: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
 00015480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015490: 2028 4e5f 6174 6f6d 7320 2a20 6e5f 6365   (N_atoms * n_ce
-000154a0: 6c6c 732c 206e 6469 6d29 290a 0a20 2020  lls, ndim))..   
-000154b0: 2020 2020 2023 2053 6861 7065 2028 4e5f       # Shape (N_
-000154c0: 6174 6f6d 732a 6e5f 6365 6c6c 732c 206e  atoms*n_cells, n
-000154d0: 6469 6d29 2061 6674 6572 2074 696c 650a  dim) after tile.
-000154e0: 2020 2020 2020 2020 7469 6c65 645f 636f          tiled_co
-000154f0: 6f72 6473 203d 2074 6f72 6368 2e74 696c  ords = torch.til
-00015500: 6528 636f 6f72 6473 2c20 286e 5f63 656c  e(coords, (n_cel
-00015510: 6c73 2c20 3129 290a 0a20 2020 2020 2020  ls, 1))..       
-00015520: 2023 2053 6861 7065 2028 4e5f 6174 6f6d   # Shape (N_atom
-00015530: 732a 6e5f 6365 6c6c 7329 0a20 2020 2020  s*n_cells).     
-00015540: 2020 2063 6f6f 7264 735f 7665 6320 3d20     coords_vec = 
-00015550: 746f 7263 682e 7375 6d28 2874 696c 6564  torch.sum((tiled
-00015560: 5f63 6f6f 7264 7320 2d20 7469 6c65 645f  _coords - tiled_
-00015570: 6365 6c6c 7329 2a2a 322c 2064 696d 3d2d  cells)**2, dim=-
-00015580: 3129 0a20 2020 2020 2020 2023 2053 6861  1).        # Sha
-00015590: 7065 2028 6e5f 6365 6c6c 732c 204e 5f61  pe (n_cells, N_a
-000155a0: 746f 6d73 290a 2020 2020 2020 2020 636f  toms).        co
-000155b0: 6f72 6473 5f6e 6f72 6d20 3d20 746f 7263  ords_norm = torc
-000155c0: 682e 7265 7368 6170 6528 636f 6f72 6473  h.reshape(coords
-000155d0: 5f76 6563 2c20 286e 5f63 656c 6c73 2c20  _vec, (n_cells, 
-000155e0: 4e5f 6174 6f6d 7329 290a 0a20 2020 2020  N_atoms))..     
-000155f0: 2020 2023 2046 696e 6420 6b20 6174 6f6d     # Find k atom
-00015600: 7320 636c 6f73 6573 7420 746f 2074 6869  s closest to thi
-00015610: 7320 6365 6c6c 2e0a 2020 2020 2020 2020  s cell..        
-00015620: 2320 5465 6e73 6f72 206f 6620 7368 6170  # Tensor of shap
-00015630: 6520 286e 5f63 656c 6c73 2c20 4d5f 6e62  e (n_cells, M_nb
-00015640: 7273 290a 2020 2020 2020 2020 636c 6f73  rs).        clos
-00015650: 6573 745f 696e 6473 203d 2074 6f72 6368  est_inds = torch
-00015660: 2e74 6f70 6b28 636f 6f72 6473 5f6e 6f72  .topk(coords_nor
-00015670: 6d2c 206b 3d4d 5f6e 6272 732c 206c 6172  m, k=M_nbrs, lar
-00015680: 6765 7374 3d46 616c 7365 295b 315d 0a0a  gest=False)[1]..
-00015690: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-000156a0: 6c6f 7365 7374 5f69 6e64 730a 0a20 2020  losest_inds..   
-000156b0: 2064 6566 2067 6574 5f63 656c 6c73 5f66   def get_cells_f
-000156c0: 6f72 5f61 746f 6d73 2873 656c 662c 2063  or_atoms(self, c
-000156d0: 6f6f 7264 733a 2074 6f72 6368 2e54 656e  oords: torch.Ten
-000156e0: 736f 722c 0a20 2020 2020 2020 2020 2020  sor,.           
+00015490: 2020 2020 2020 2028 4e5f 6174 6f6d 7320         (N_atoms 
+000154a0: 2a20 6e5f 6365 6c6c 732c 206e 6469 6d29  * n_cells, ndim)
+000154b0: 290a 0a20 2020 2020 2020 2023 2053 6861  )..        # Sha
+000154c0: 7065 2028 4e5f 6174 6f6d 732a 6e5f 6365  pe (N_atoms*n_ce
+000154d0: 6c6c 732c 206e 6469 6d29 2061 6674 6572  lls, ndim) after
+000154e0: 2074 696c 650a 2020 2020 2020 2020 7469   tile.        ti
+000154f0: 6c65 645f 636f 6f72 6473 203d 2074 6f72  led_coords = tor
+00015500: 6368 2e74 696c 6528 636f 6f72 6473 2c20  ch.tile(coords, 
+00015510: 286e 5f63 656c 6c73 2c20 3129 290a 0a20  (n_cells, 1)).. 
+00015520: 2020 2020 2020 2023 2053 6861 7065 2028         # Shape (
+00015530: 4e5f 6174 6f6d 732a 6e5f 6365 6c6c 7329  N_atoms*n_cells)
+00015540: 0a20 2020 2020 2020 2063 6f6f 7264 735f  .        coords_
+00015550: 7665 6320 3d20 746f 7263 682e 7375 6d28  vec = torch.sum(
+00015560: 2874 696c 6564 5f63 6f6f 7264 7320 2d20  (tiled_coords - 
+00015570: 7469 6c65 645f 6365 6c6c 7329 2a2a 322c  tiled_cells)**2,
+00015580: 2064 696d 3d2d 3129 0a20 2020 2020 2020   dim=-1).       
+00015590: 2023 2053 6861 7065 2028 6e5f 6365 6c6c   # Shape (n_cell
+000155a0: 732c 204e 5f61 746f 6d73 290a 2020 2020  s, N_atoms).    
+000155b0: 2020 2020 636f 6f72 6473 5f6e 6f72 6d20      coords_norm 
+000155c0: 3d20 746f 7263 682e 7265 7368 6170 6528  = torch.reshape(
+000155d0: 636f 6f72 6473 5f76 6563 2c20 286e 5f63  coords_vec, (n_c
+000155e0: 656c 6c73 2c20 4e5f 6174 6f6d 7329 290a  ells, N_atoms)).
+000155f0: 0a20 2020 2020 2020 2023 2046 696e 6420  .        # Find 
+00015600: 6b20 6174 6f6d 7320 636c 6f73 6573 7420  k atoms closest 
+00015610: 746f 2074 6869 7320 6365 6c6c 2e0a 2020  to this cell..  
+00015620: 2020 2020 2020 2320 5465 6e73 6f72 206f        # Tensor o
+00015630: 6620 7368 6170 6520 286e 5f63 656c 6c73  f shape (n_cells
+00015640: 2c20 4d5f 6e62 7273 290a 2020 2020 2020  , M_nbrs).      
+00015650: 2020 636c 6f73 6573 745f 696e 6473 203d    closest_inds =
+00015660: 2074 6f72 6368 2e74 6f70 6b28 636f 6f72   torch.topk(coor
+00015670: 6473 5f6e 6f72 6d2c 206b 3d4d 5f6e 6272  ds_norm, k=M_nbr
+00015680: 732c 206c 6172 6765 7374 3d46 616c 7365  s, largest=False
+00015690: 295b 315d 0a0a 2020 2020 2020 2020 7265  )[1]..        re
+000156a0: 7475 726e 2063 6c6f 7365 7374 5f69 6e64  turn closest_ind
+000156b0: 730a 0a20 2020 2064 6566 2067 6574 5f63  s..    def get_c
+000156c0: 656c 6c73 5f66 6f72 5f61 746f 6d73 2873  ells_for_atoms(s
+000156d0: 656c 662c 2063 6f6f 7264 733a 2074 6f72  elf, coords: tor
+000156e0: 6368 2e54 656e 736f 722c 0a20 2020 2020  ch.Tensor,.     
 000156f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015700: 2063 656c 6c73 3a20 746f 7263 682e 5465   cells: torch.Te
-00015710: 6e73 6f72 2920 2d3e 2074 6f72 6368 2e54  nsor) -> torch.T
-00015720: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
-00015730: 2222 436f 6d70 7574 6520 7468 6520 6365  ""Compute the ce
-00015740: 6c6c 7320 6561 6368 2061 746f 6d20 6265  lls each atom be
-00015750: 6c6f 6e67 7320 746f 2e0a 0a20 2020 2020  longs to...     
-00015760: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00015770: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00015780: 0a20 2020 2020 2020 2063 6f6f 7264 733a  .        coords:
-00015790: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-000157a0: 2020 2020 2020 2020 2020 5368 6170 6520            Shape 
-000157b0: 284e 5f61 746f 6d73 2c20 6e64 696d 290a  (N_atoms, ndim).
-000157c0: 2020 2020 2020 2020 6365 6c6c 733a 2074          cells: t
-000157d0: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
-000157e0: 2020 2020 2020 2020 286e 5f63 656c 6c73          (n_cells
-000157f0: 2c20 6e64 696d 2920 7368 6170 652e 0a20  , ndim) shape.. 
-00015800: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00015810: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00015820: 2020 2020 2020 2063 656c 6c73 5f66 6f72         cells_for
-00015830: 5f61 746f 6d73 3a20 746f 7263 682e 5465  _atoms: torch.Te
-00015840: 6e73 6f72 0a20 2020 2020 2020 2020 2020  nsor.           
-00015850: 2053 6861 7065 2028 4e5f 6174 6f6d 732c   Shape (N_atoms,
-00015860: 2031 290a 2020 2020 2020 2020 2222 220a   1).        """.
-00015870: 2020 2020 2020 2020 4e5f 6174 6f6d 732c          N_atoms,
-00015880: 206e 5f63 656c 6c73 2c20 6e64 696d 203d   n_cells, ndim =
-00015890: 2073 656c 662e 4e5f 6174 6f6d 732c 2073   self.N_atoms, s
-000158a0: 656c 662e 6e5f 6365 6c6c 732c 2073 656c  elf.n_cells, sel
-000158b0: 662e 6e64 696d 0a20 2020 2020 2020 206e  f.ndim.        n
-000158c0: 5f63 656c 6c73 203d 2069 6e74 286e 5f63  _cells = int(n_c
-000158d0: 656c 6c73 290a 2020 2020 2020 2020 2320  ells).        # 
-000158e0: 5469 6c65 2062 6f74 6820 6365 6c6c 7320  Tile both cells 
-000158f0: 616e 6420 636f 6f72 6473 2074 6f20 666f  and coords to fo
-00015900: 726d 2061 7272 6179 7320 6f66 2073 697a  rm arrays of siz
-00015910: 6520 284e 5f61 746f 6d73 2a6e 5f63 656c  e (N_atoms*n_cel
-00015920: 6c73 2c20 6e64 696d 290a 2020 2020 2020  ls, ndim).      
-00015930: 2020 7469 6c65 645f 6365 6c6c 7320 3d20    tiled_cells = 
-00015940: 746f 7263 682e 7469 6c65 2863 656c 6c73  torch.tile(cells
-00015950: 2c20 284e 5f61 746f 6d73 2c20 3129 290a  , (N_atoms, 1)).
-00015960: 0a20 2020 2020 2020 2023 2053 6861 7065  .        # Shape
-00015970: 2028 4e5f 6174 6f6d 732a 6e5f 6365 6c6c   (N_atoms*n_cell
-00015980: 732c 2031 2920 6166 7465 7220 7469 6c65  s, 1) after tile
-00015990: 0a20 2020 2020 2020 2074 696c 6564 5f63  .        tiled_c
-000159a0: 6f6f 7264 7320 3d20 746f 7263 682e 7265  oords = torch.re
-000159b0: 7368 6170 6528 746f 7263 682e 7469 6c65  shape(torch.tile
-000159c0: 2863 6f6f 7264 732c 2028 312c 206e 5f63  (coords, (1, n_c
-000159d0: 656c 6c73 2929 2c0a 2020 2020 2020 2020  ells)),.        
+00015700: 2020 2020 2020 2063 656c 6c73 3a20 746f         cells: to
+00015710: 7263 682e 5465 6e73 6f72 2920 2d3e 2074  rch.Tensor) -> t
+00015720: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
+00015730: 2020 2020 2022 2222 436f 6d70 7574 6520       """Compute 
+00015740: 7468 6520 6365 6c6c 7320 6561 6368 2061  the cells each a
+00015750: 746f 6d20 6265 6c6f 6e67 7320 746f 2e0a  tom belongs to..
+00015760: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00015770: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00015780: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2063  ------.        c
+00015790: 6f6f 7264 733a 2074 6f72 6368 2e54 656e  oords: torch.Ten
+000157a0: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+000157b0: 5368 6170 6520 284e 5f61 746f 6d73 2c20  Shape (N_atoms, 
+000157c0: 6e64 696d 290a 2020 2020 2020 2020 6365  ndim).        ce
+000157d0: 6c6c 733a 2074 6f72 6368 2e54 656e 736f  lls: torch.Tenso
+000157e0: 720a 2020 2020 2020 2020 2020 2020 286e  r.            (n
+000157f0: 5f63 656c 6c73 2c20 6e64 696d 2920 7368  _cells, ndim) sh
+00015800: 6170 652e 0a20 2020 2020 2020 2052 6574  ape..        Ret
+00015810: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00015820: 2d2d 2d2d 0a20 2020 2020 2020 2063 656c  ----.        cel
+00015830: 6c73 5f66 6f72 5f61 746f 6d73 3a20 746f  ls_for_atoms: to
+00015840: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+00015850: 2020 2020 2020 2053 6861 7065 2028 4e5f         Shape (N_
+00015860: 6174 6f6d 732c 2031 290a 2020 2020 2020  atoms, 1).      
+00015870: 2020 2222 220a 2020 2020 2020 2020 4e5f    """.        N_
+00015880: 6174 6f6d 732c 206e 5f63 656c 6c73 2c20  atoms, n_cells, 
+00015890: 6e64 696d 203d 2073 656c 662e 4e5f 6174  ndim = self.N_at
+000158a0: 6f6d 732c 2073 656c 662e 6e5f 6365 6c6c  oms, self.n_cell
+000158b0: 732c 2073 656c 662e 6e64 696d 0a20 2020  s, self.ndim.   
+000158c0: 2020 2020 206e 5f63 656c 6c73 203d 2069       n_cells = i
+000158d0: 6e74 286e 5f63 656c 6c73 290a 2020 2020  nt(n_cells).    
+000158e0: 2020 2020 2320 5469 6c65 2062 6f74 6820      # Tile both 
+000158f0: 6365 6c6c 7320 616e 6420 636f 6f72 6473  cells and coords
+00015900: 2074 6f20 666f 726d 2061 7272 6179 7320   to form arrays 
+00015910: 6f66 2073 697a 6520 284e 5f61 746f 6d73  of size (N_atoms
+00015920: 2a6e 5f63 656c 6c73 2c20 6e64 696d 290a  *n_cells, ndim).
+00015930: 2020 2020 2020 2020 7469 6c65 645f 6365          tiled_ce
+00015940: 6c6c 7320 3d20 746f 7263 682e 7469 6c65  lls = torch.tile
+00015950: 2863 656c 6c73 2c20 284e 5f61 746f 6d73  (cells, (N_atoms
+00015960: 2c20 3129 290a 0a20 2020 2020 2020 2023  , 1))..        #
+00015970: 2053 6861 7065 2028 4e5f 6174 6f6d 732a   Shape (N_atoms*
+00015980: 6e5f 6365 6c6c 732c 2031 2920 6166 7465  n_cells, 1) afte
+00015990: 7220 7469 6c65 0a20 2020 2020 2020 2074  r tile.        t
+000159a0: 696c 6564 5f63 6f6f 7264 7320 3d20 746f  iled_coords = to
+000159b0: 7263 682e 7265 7368 6170 6528 746f 7263  rch.reshape(torc
+000159c0: 682e 7469 6c65 2863 6f6f 7264 732c 2028  h.tile(coords, (
+000159d0: 312c 206e 5f63 656c 6c73 2929 2c0a 2020  1, n_cells)),.  
 000159e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000159f0: 2020 2020 2020 2020 2020 2020 2028 6e5f               (n_
-00015a00: 6365 6c6c 7320 2a20 4e5f 6174 6f6d 732c  cells * N_atoms,
-00015a10: 206e 6469 6d29 290a 2020 2020 2020 2020   ndim)).        
-00015a20: 636f 6f72 6473 5f76 6563 203d 2074 6f72  coords_vec = tor
-00015a30: 6368 2e73 756d 2828 7469 6c65 645f 636f  ch.sum((tiled_co
-00015a40: 6f72 6473 202d 2074 696c 6564 5f63 656c  ords - tiled_cel
-00015a50: 6c73 292a 2a32 2c20 6469 6d3d 2d31 290a  ls)**2, dim=-1).
-00015a60: 2020 2020 2020 2020 636f 6f72 6473 5f6e          coords_n
-00015a70: 6f72 6d20 3d20 746f 7263 682e 7265 7368  orm = torch.resh
-00015a80: 6170 6528 636f 6f72 6473 5f76 6563 2c20  ape(coords_vec, 
-00015a90: 284e 5f61 746f 6d73 2c20 6e5f 6365 6c6c  (N_atoms, n_cell
-00015aa0: 7329 290a 0a20 2020 2020 2020 2063 6c6f  s))..        clo
-00015ab0: 7365 7374 5f69 6e64 7320 3d20 746f 7263  sest_inds = torc
-00015ac0: 682e 746f 706b 2863 6f6f 7264 735f 6e6f  h.topk(coords_no
-00015ad0: 726d 2c20 6b3d 312c 206c 6172 6765 7374  rm, k=1, largest
-00015ae0: 3d46 616c 7365 295b 315d 0a0a 2020 2020  =False)[1]..    
-00015af0: 2020 2020 7265 7475 726e 2063 6c6f 7365      return close
-00015b00: 7374 5f69 6e64 730a 0a20 2020 2064 6566  st_inds..    def
-00015b10: 205f 6765 745f 6e75 6d5f 6e62 7273 2873   _get_num_nbrs(s
-00015b20: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
-00015b30: 2020 2020 2022 2222 4765 7420 6e75 6d62       """Get numb
-00015b40: 6572 206f 6620 6e65 6967 6862 6f72 7320  er of neighbors 
-00015b50: 696e 2063 7572 7265 6e74 2064 696d 656e  in current dimen
-00015b60: 7369 6f6e 616c 6974 7920 7370 6163 652e  sionality space.
-00015b70: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00015b80: 726e 2033 2a2a 7365 6c66 2e6e 6469 6d0a  rn 3**self.ndim.
-00015b90: 0a20 2020 2064 6566 2067 6574 5f6e 6569  .    def get_nei
-00015ba0: 6768 626f 725f 6365 6c6c 7328 7365 6c66  ghbor_cells(self
-00015bb0: 2c20 6365 6c6c 733a 2074 6f72 6368 2e54  , cells: torch.T
-00015bc0: 656e 736f 7229 202d 3e20 746f 7263 682e  ensor) -> torch.
-00015bd0: 5465 6e73 6f72 3a0a 2020 2020 2020 2020  Tensor:.        
-00015be0: 2222 2243 6f6d 7075 7465 206e 6569 6768  """Compute neigh
-00015bf0: 626f 7273 206f 6620 6365 6c6c 7320 696e  bors of cells in
-00015c00: 2067 7269 642e 0a0a 2020 2020 2020 2020   grid...        
-00015c10: 2320 544f 444f 2872 6268 6172 6174 6829  # TODO(rbharath)
-00015c20: 3a20 446f 2077 6520 6e65 6564 2074 6f20  : Do we need to 
-00015c30: 6861 6e64 6c65 2070 6572 696f 6469 6320  handle periodic 
-00015c40: 626f 756e 6461 7279 2063 6f6e 6469 7469  boundary conditi
-00015c50: 6f6e 730a 2020 2020 2020 2020 7072 6f70  ons.        prop
-00015c60: 6572 6c79 2068 6572 653f 0a20 2020 2020  erly here?.     
-00015c70: 2020 2023 2054 4f44 4f28 7262 6861 7261     # TODO(rbhara
-00015c80: 7468 293a 2054 6869 7320 646f 6573 6e27  th): This doesn'
-00015c90: 7420 6861 6e64 6c65 2062 6f75 6e64 6172  t handle boundar
-00015ca0: 6965 7320 7765 6c6c 2e20 5765 2068 6172  ies well. We har
-00015cb0: 642d 636f 6465 0a20 2020 2020 2020 2023  d-code.        #
-00015cc0: 206c 6f6f 6b69 6e67 2066 6f72 206e 5f6e   looking for n_n
-00015cd0: 6272 5f63 656c 6c73 206e 6569 6768 626f  br_cells neighbo
-00015ce0: 7273 2c20 7768 6963 6820 6973 6e27 7420  rs, which isn't 
-00015cf0: 7269 6768 7420 666f 7220 626f 756e 6461  right for bounda
-00015d00: 7279 2063 656c 6c73 2069 6e0a 2020 2020  ry cells in.    
-00015d10: 2020 2020 2320 7468 6520 6375 6265 2e0a      # the cube..
-00015d20: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00015d30: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00015d40: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2063  ------.        c
-00015d50: 656c 6c73 3a20 746f 7263 682e 5465 6e73  ells: torch.Tens
-00015d60: 6f72 0a20 2020 2020 2020 2020 2020 2028  or.            (
-00015d70: 6e5f 6365 6c6c 732c 206e 6469 6d29 2073  n_cells, ndim) s
-00015d80: 6861 7065 2e0a 2020 2020 2020 2020 5265  hape..        Re
-00015d90: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-00015da0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6e62  -----.        nb
-00015db0: 725f 6365 6c6c 733a 2074 6f72 6368 2e54  r_cells: torch.T
-00015dc0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-00015dd0: 2020 286e 5f63 656c 6c73 2c20 6e5f 6e62    (n_cells, n_nb
-00015de0: 725f 6365 6c6c 7329 0a20 2020 2020 2020  r_cells).       
-00015df0: 2022 2222 0a20 2020 2020 2020 206e 6469   """.        ndi
-00015e00: 6d2c 206e 5f63 656c 6c73 203d 2073 656c  m, n_cells = sel
-00015e10: 662e 6e64 696d 2c20 7365 6c66 2e6e 5f63  f.ndim, self.n_c
-00015e20: 656c 6c73 0a20 2020 2020 2020 206e 5f6e  ells.        n_n
-00015e30: 6272 5f63 656c 6c73 203d 2073 656c 662e  br_cells = self.
-00015e40: 5f67 6574 5f6e 756d 5f6e 6272 7328 290a  _get_num_nbrs().
-00015e50: 2020 2020 2020 2020 2320 5469 6c65 2063          # Tile c
-00015e60: 656c 6c73 2074 6f20 666f 726d 2061 7272  ells to form arr
-00015e70: 6179 7320 6f66 2073 697a 6520 286e 5f63  ays of size (n_c
-00015e80: 656c 6c73 2a6e 5f63 656c 6c73 2c20 6e64  ells*n_cells, nd
-00015e90: 696d 290a 2020 2020 2020 2020 2320 5477  im).        # Tw
-00015ea0: 6f20 7469 6c69 6e67 7320 2861 2c20 622c  o tilings (a, b,
-00015eb0: 2063 2c20 612c 2062 2c20 632c 202e 2e2e   c, a, b, c, ...
-00015ec0: 2920 7673 2e20 2861 2c20 612c 2061 2c20  ) vs. (a, a, a, 
-00015ed0: 622c 2062 2c20 622c 2065 7463 2e29 0a20  b, b, b, etc.). 
-00015ee0: 2020 2020 2020 2023 2054 696c 6520 2861         # Tile (a
-00015ef0: 2c20 612c 2061 2c20 622c 2062 2c20 622c  , a, a, b, b, b,
-00015f00: 2065 7463 2e29 0a20 2020 2020 2020 2074   etc.).        t
-00015f10: 696c 6564 5f63 656e 7465 7273 203d 2074  iled_centers = t
-00015f20: 6f72 6368 2e72 6573 6861 7065 2874 6f72  orch.reshape(tor
-00015f30: 6368 2e74 696c 6528 6365 6c6c 732c 2028  ch.tile(cells, (
-00015f40: 312c 206e 5f63 656c 6c73 2929 2c0a 2020  1, n_cells)),.  
-00015f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a00: 2020 2028 6e5f 6365 6c6c 7320 2a20 4e5f     (n_cells * N_
+00015a10: 6174 6f6d 732c 206e 6469 6d29 290a 2020  atoms, ndim)).  
+00015a20: 2020 2020 2020 636f 6f72 6473 5f76 6563        coords_vec
+00015a30: 203d 2074 6f72 6368 2e73 756d 2828 7469   = torch.sum((ti
+00015a40: 6c65 645f 636f 6f72 6473 202d 2074 696c  led_coords - til
+00015a50: 6564 5f63 656c 6c73 292a 2a32 2c20 6469  ed_cells)**2, di
+00015a60: 6d3d 2d31 290a 2020 2020 2020 2020 636f  m=-1).        co
+00015a70: 6f72 6473 5f6e 6f72 6d20 3d20 746f 7263  ords_norm = torc
+00015a80: 682e 7265 7368 6170 6528 636f 6f72 6473  h.reshape(coords
+00015a90: 5f76 6563 2c20 284e 5f61 746f 6d73 2c20  _vec, (N_atoms, 
+00015aa0: 6e5f 6365 6c6c 7329 290a 0a20 2020 2020  n_cells))..     
+00015ab0: 2020 2063 6c6f 7365 7374 5f69 6e64 7320     closest_inds 
+00015ac0: 3d20 746f 7263 682e 746f 706b 2863 6f6f  = torch.topk(coo
+00015ad0: 7264 735f 6e6f 726d 2c20 6b3d 312c 206c  rds_norm, k=1, l
+00015ae0: 6172 6765 7374 3d46 616c 7365 295b 315d  argest=False)[1]
+00015af0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00015b00: 2063 6c6f 7365 7374 5f69 6e64 730a 0a20   closest_inds.. 
+00015b10: 2020 2064 6566 205f 6765 745f 6e75 6d5f     def _get_num_
+00015b20: 6e62 7273 2873 656c 6629 202d 3e20 696e  nbrs(self) -> in
+00015b30: 743a 0a20 2020 2020 2020 2022 2222 4765  t:.        """Ge
+00015b40: 7420 6e75 6d62 6572 206f 6620 6e65 6967  t number of neig
+00015b50: 6862 6f72 7320 696e 2063 7572 7265 6e74  hbors in current
+00015b60: 2064 696d 656e 7369 6f6e 616c 6974 7920   dimensionality 
+00015b70: 7370 6163 652e 2222 220a 2020 2020 2020  space.""".      
+00015b80: 2020 7265 7475 726e 2033 2a2a 7365 6c66    return 3**self
+00015b90: 2e6e 6469 6d0a 0a20 2020 2064 6566 2067  .ndim..    def g
+00015ba0: 6574 5f6e 6569 6768 626f 725f 6365 6c6c  et_neighbor_cell
+00015bb0: 7328 7365 6c66 2c20 6365 6c6c 733a 2074  s(self, cells: t
+00015bc0: 6f72 6368 2e54 656e 736f 7229 202d 3e20  orch.Tensor) -> 
+00015bd0: 746f 7263 682e 5465 6e73 6f72 3a0a 2020  torch.Tensor:.  
+00015be0: 2020 2020 2020 2222 2243 6f6d 7075 7465        """Compute
+00015bf0: 206e 6569 6768 626f 7273 206f 6620 6365   neighbors of ce
+00015c00: 6c6c 7320 696e 2067 7269 642e 0a0a 2020  lls in grid...  
+00015c10: 2020 2020 2020 2320 544f 444f 2872 6268        # TODO(rbh
+00015c20: 6172 6174 6829 3a20 446f 2077 6520 6e65  arath): Do we ne
+00015c30: 6564 2074 6f20 6861 6e64 6c65 2070 6572  ed to handle per
+00015c40: 696f 6469 6320 626f 756e 6461 7279 2063  iodic boundary c
+00015c50: 6f6e 6469 7469 6f6e 730a 2020 2020 2020  onditions.      
+00015c60: 2020 7072 6f70 6572 6c79 2068 6572 653f    properly here?
+00015c70: 0a20 2020 2020 2020 2023 2054 4f44 4f28  .        # TODO(
+00015c80: 7262 6861 7261 7468 293a 2054 6869 7320  rbharath): This 
+00015c90: 646f 6573 6e27 7420 6861 6e64 6c65 2062  doesn't handle b
+00015ca0: 6f75 6e64 6172 6965 7320 7765 6c6c 2e20  oundaries well. 
+00015cb0: 5765 2068 6172 642d 636f 6465 0a20 2020  We hard-code.   
+00015cc0: 2020 2020 2023 206c 6f6f 6b69 6e67 2066       # looking f
+00015cd0: 6f72 206e 5f6e 6272 5f63 656c 6c73 206e  or n_nbr_cells n
+00015ce0: 6569 6768 626f 7273 2c20 7768 6963 6820  eighbors, which 
+00015cf0: 6973 6e27 7420 7269 6768 7420 666f 7220  isn't right for 
+00015d00: 626f 756e 6461 7279 2063 656c 6c73 2069  boundary cells i
+00015d10: 6e0a 2020 2020 2020 2020 2320 7468 6520  n.        # the 
+00015d20: 6375 6265 2e0a 0a20 2020 2020 2020 2050  cube...        P
+00015d30: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00015d40: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00015d50: 2020 2020 2063 656c 6c73 3a20 746f 7263       cells: torc
+00015d60: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
+00015d70: 2020 2020 2028 6e5f 6365 6c6c 732c 206e       (n_cells, n
+00015d80: 6469 6d29 2073 6861 7065 2e0a 2020 2020  dim) shape..    
+00015d90: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00015da0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00015db0: 2020 2020 6e62 725f 6365 6c6c 733a 2074      nbr_cells: t
+00015dc0: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+00015dd0: 2020 2020 2020 2020 286e 5f63 656c 6c73          (n_cells
+00015de0: 2c20 6e5f 6e62 725f 6365 6c6c 7329 0a20  , n_nbr_cells). 
+00015df0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00015e00: 2020 206e 6469 6d2c 206e 5f63 656c 6c73     ndim, n_cells
+00015e10: 203d 2073 656c 662e 6e64 696d 2c20 7365   = self.ndim, se
+00015e20: 6c66 2e6e 5f63 656c 6c73 0a20 2020 2020  lf.n_cells.     
+00015e30: 2020 206e 5f6e 6272 5f63 656c 6c73 203d     n_nbr_cells =
+00015e40: 2073 656c 662e 5f67 6574 5f6e 756d 5f6e   self._get_num_n
+00015e50: 6272 7328 290a 2020 2020 2020 2020 2320  brs().        # 
+00015e60: 5469 6c65 2063 656c 6c73 2074 6f20 666f  Tile cells to fo
+00015e70: 726d 2061 7272 6179 7320 6f66 2073 697a  rm arrays of siz
+00015e80: 6520 286e 5f63 656c 6c73 2a6e 5f63 656c  e (n_cells*n_cel
+00015e90: 6c73 2c20 6e64 696d 290a 2020 2020 2020  ls, ndim).      
+00015ea0: 2020 2320 5477 6f20 7469 6c69 6e67 7320    # Two tilings 
+00015eb0: 2861 2c20 622c 2063 2c20 612c 2062 2c20  (a, b, c, a, b, 
+00015ec0: 632c 202e 2e2e 2920 7673 2e20 2861 2c20  c, ...) vs. (a, 
+00015ed0: 612c 2061 2c20 622c 2062 2c20 622c 2065  a, a, b, b, b, e
+00015ee0: 7463 2e29 0a20 2020 2020 2020 2023 2054  tc.).        # T
+00015ef0: 696c 6520 2861 2c20 612c 2061 2c20 622c  ile (a, a, a, b,
+00015f00: 2062 2c20 622c 2065 7463 2e29 0a20 2020   b, b, etc.).   
+00015f10: 2020 2020 2074 696c 6564 5f63 656e 7465       tiled_cente
+00015f20: 7273 203d 2074 6f72 6368 2e72 6573 6861  rs = torch.resha
+00015f30: 7065 2874 6f72 6368 2e74 696c 6528 6365  pe(torch.tile(ce
+00015f40: 6c6c 732c 2028 312c 206e 5f63 656c 6c73  lls, (1, n_cells
+00015f50: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
 00015f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f70: 2020 2020 286e 5f63 656c 6c73 202a 206e      (n_cells * n
-00015f80: 5f63 656c 6c73 2c20 6e64 696d 2929 0a20  _cells, ndim)). 
-00015f90: 2020 2020 2020 2023 2054 696c 6520 2861         # Tile (a
-00015fa0: 2c20 622c 2063 2c20 612c 2062 2c20 632c  , b, c, a, b, c,
-00015fb0: 202e 2e2e 290a 2020 2020 2020 2020 7469   ...).        ti
-00015fc0: 6c65 645f 6365 6c6c 7320 3d20 746f 7263  led_cells = torc
-00015fd0: 682e 7469 6c65 2863 656c 6c73 2c20 286e  h.tile(cells, (n
-00015fe0: 5f63 656c 6c73 2c20 3129 290a 0a20 2020  _cells, 1))..   
-00015ff0: 2020 2020 2063 6f6f 7264 735f 7665 6320       coords_vec 
-00016000: 3d20 746f 7263 682e 7375 6d28 2874 696c  = torch.sum((til
-00016010: 6564 5f63 656e 7465 7273 202d 2074 696c  ed_centers - til
-00016020: 6564 5f63 656c 6c73 292a 2a32 2c20 6469  ed_cells)**2, di
-00016030: 6d3d 2d31 290a 2020 2020 2020 2020 636f  m=-1).        co
-00016040: 6f72 6473 5f6e 6f72 6d20 3d20 746f 7263  ords_norm = torc
-00016050: 682e 7265 7368 6170 6528 636f 6f72 6473  h.reshape(coords
-00016060: 5f76 6563 2c20 286e 5f63 656c 6c73 2c20  _vec, (n_cells, 
-00016070: 6e5f 6365 6c6c 7329 290a 2020 2020 2020  n_cells)).      
-00016080: 2020 636c 6f73 6573 745f 696e 6473 203d    closest_inds =
-00016090: 2074 6f72 6368 2e74 6f70 6b28 636f 6f72   torch.topk(coor
-000160a0: 6473 5f6e 6f72 6d2c 206b 3d6e 5f6e 6272  ds_norm, k=n_nbr
-000160b0: 5f63 656c 6c73 2c20 6c61 7267 6573 743d  _cells, largest=
-000160c0: 4661 6c73 6529 5b31 5d0a 0a20 2020 2020  False)[1]..     
-000160d0: 2020 2072 6574 7572 6e20 636c 6f73 6573     return closes
-000160e0: 745f 696e 6473 0a0a 2020 2020 6465 6620  t_inds..    def 
-000160f0: 6765 745f 6365 6c6c 7328 7365 6c66 2920  get_cells(self) 
-00016100: 2d3e 2074 6f72 6368 2e54 656e 736f 723a  -> torch.Tensor:
-00016110: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00016120: 726e 7320 7468 6520 6c6f 6361 7469 6f6e  rns the location
-00016130: 7320 6f66 2061 6c6c 2067 7269 6420 706f  s of all grid po
-00016140: 696e 7473 2069 6e20 626f 782e 0a0a 2020  ints in box...  
-00016150: 2020 2020 2020 5375 7070 6f73 6520 7374        Suppose st
-00016160: 6172 7420 6973 202d 3130 2041 6e67 7374  art is -10 Angst
-00016170: 726f 6d2c 2073 746f 7020 6973 2031 3020  rom, stop is 10 
-00016180: 416e 6773 7472 6f6d 2c20 6e62 725f 6375  Angstrom, nbr_cu
-00016190: 746f 6666 2069 7320 312e 0a20 2020 2020  toff is 1..     
-000161a0: 2020 2054 6865 6e20 776f 756c 6420 7265     Then would re
-000161b0: 7475 726e 2061 206c 6973 7420 6f66 206c  turn a list of l
-000161c0: 656e 6774 6820 3230 5e33 2077 686f 7365  ength 20^3 whose
-000161d0: 2065 6e74 7269 6573 2077 6f75 6c64 2062   entries would b
-000161e0: 650a 2020 2020 2020 2020 5b28 2d31 302c  e.        [(-10,
-000161f0: 202d 3130 2c20 2d31 3029 2c20 282d 3130   -10, -10), (-10
-00016200: 2c20 2d31 302c 202d 3929 2c20 2e2e 2e2c  , -10, -9), ...,
-00016210: 2028 392c 2039 2c20 3929 5d0a 0a20 2020   (9, 9, 9)]..   
-00016220: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00016230: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00016240: 2020 2020 2063 656c 6c73 3a20 746f 7263       cells: torc
-00016250: 682e 5465 6e73 6f72 0a20 2020 2020 2020  h.Tensor.       
-00016260: 2020 2028 6e5f 6365 6c6c 732c 206e 6469     (n_cells, ndi
-00016270: 6d29 2073 6861 7065 2e0a 2020 2020 2020  m) shape..      
-00016280: 2020 2222 220a 2020 2020 2020 2020 7374    """.        st
-00016290: 6172 742c 2073 746f 702c 206e 6272 5f63  art, stop, nbr_c
-000162a0: 7574 6f66 6620 3d20 7365 6c66 2e73 7461  utoff = self.sta
-000162b0: 7274 2c20 7365 6c66 2e73 746f 702c 2073  rt, self.stop, s
-000162c0: 656c 662e 6e62 725f 6375 746f 6666 0a20  elf.nbr_cutoff. 
-000162d0: 2020 2020 2020 206d 6573 685f 6172 6773         mesh_args
-000162e0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-000162f0: 2074 6f72 6368 2e61 7261 6e67 6528 7374   torch.arange(st
-00016300: 6172 742c 2073 746f 702c 206e 6272 5f63  art, stop, nbr_c
-00016310: 7574 6f66 6629 2066 6f72 205f 2069 6e20  utoff) for _ in 
-00016320: 7261 6e67 6528 7365 6c66 2e6e 6469 6d29  range(self.ndim)
-00016330: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
-00016340: 2020 2072 6574 7572 6e20 746f 7263 682e     return torch.
-00016350: 7265 7368 6170 6528 0a20 2020 2020 2020  reshape(.       
-00016360: 2020 2020 2074 6f72 6368 2e70 6572 6d75       torch.permu
-00016370: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
-00016380: 2020 2020 746f 7263 682e 7374 6163 6b28      torch.stack(
-00016390: 746f 7263 682e 6d65 7368 6772 6964 282a  torch.meshgrid(*
-000163a0: 6d65 7368 5f61 7267 732c 2069 6e64 6578  mesh_args, index
-000163b0: 696e 673d 2778 7927 2929 2c0a 2020 2020  ing='xy')),.    
-000163c0: 2020 2020 2020 2020 2020 2020 7475 706c              tupl
-000163d0: 6528 7261 6e67 6528 7365 6c66 2e6e 6469  e(range(self.ndi
-000163e0: 6d2c 202d 312c 202d 3129 2929 2c0a 2020  m, -1, -1))),.  
-000163f0: 2020 2020 2020 2020 2020 2873 656c 662e            (self.
-00016400: 6e5f 6365 6c6c 732c 2073 656c 662e 6e64  n_cells, self.nd
-00016410: 696d 2929 2e74 6f28 746f 7263 682e 666c  im)).to(torch.fl
-00016420: 6f61 7429 0a0a 0a63 6c61 7373 204c 5354  oat)...class LST
-00016430: 4d53 7465 7028 6e6e 2e4d 6f64 756c 6529  MStep(nn.Module)
-00016440: 3a0a 2020 2020 2222 224c 6179 6572 2074  :.    """Layer t
-00016450: 6861 7420 7065 7266 6f72 6d73 2061 2073  hat performs a s
-00016460: 696e 676c 6520 7374 6570 204c 5354 4d20  ingle step LSTM 
-00016470: 7570 6461 7465 2e0a 0a20 2020 2054 6869  update...    Thi
-00016480: 7320 6973 2074 6865 2054 6f72 6368 2065  s is the Torch e
-00016490: 7175 6976 616c 656e 7420 6f66 2074 6865  quivalent of the
-000164a0: 206f 7269 6769 6e61 6c20 696d 706c 656d   original implem
-000164b0: 656e 7461 7469 6f6e 2075 7369 6e67 204b  entation using K
-000164c0: 6572 6173 2e0a 2020 2020 2222 220a 0a20  eras..    """.. 
-000164d0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-000164e0: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-000164f0: 2020 2020 2020 206f 7574 7075 745f 6469         output_di
-00016500: 6d2c 0a20 2020 2020 2020 2020 2020 2020  m,.             
-00016510: 2020 2020 696e 7075 745f 6469 6d2c 0a20      input_dim,. 
-00016520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016530: 696e 6974 5f66 6e3d 2778 6176 6965 725f  init_fn='xavier_
-00016540: 756e 6966 6f72 6d5f 272c 0a20 2020 2020  uniform_',.     
-00016550: 2020 2020 2020 2020 2020 2020 696e 6e65              inne
-00016560: 725f 696e 6974 5f66 6e3d 276f 7274 686f  r_init_fn='ortho
-00016570: 676f 6e61 6c5f 272c 0a20 2020 2020 2020  gonal_',.       
-00016580: 2020 2020 2020 2020 2020 6163 7469 7661            activa
-00016590: 7469 6f6e 5f66 6e3d 2774 616e 6827 2c0a  tion_fn='tanh',.
-000165a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165b0: 2069 6e6e 6572 5f61 6374 6976 6174 696f   inner_activatio
-000165c0: 6e5f 666e 3d27 6861 7264 7369 676d 6f69  n_fn='hardsigmoi
-000165d0: 6427 2c0a 2020 2020 2020 2020 2020 2020  d',.            
-000165e0: 2020 2020 202a 2a6b 7761 7267 7329 3a0a       **kwargs):.
-000165f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00016600: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00016610: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00016620: 2d0a 2020 2020 2020 2020 6f75 7470 7574  -.        output
-00016630: 5f64 696d 3a20 696e 740a 2020 2020 2020  _dim: int.      
-00016640: 2020 2020 2020 4469 6d65 6e73 696f 6e61        Dimensiona
-00016650: 6c69 7479 206f 6620 6f75 7470 7574 2076  lity of output v
-00016660: 6563 746f 7273 2e0a 2020 2020 2020 2020  ectors..        
-00016670: 696e 7075 745f 6469 6d3a 2069 6e74 0a20  input_dim: int. 
-00016680: 2020 2020 2020 2020 2020 2044 696d 656e             Dimen
-00016690: 7369 6f6e 616c 6974 7920 6f66 2069 6e70  sionality of inp
-000166a0: 7574 2076 6563 746f 7273 2e0a 2020 2020  ut vectors..    
-000166b0: 2020 2020 696e 6974 5f66 6e3a 2073 7472      init_fn: str
-000166c0: 0a20 2020 2020 2020 2020 2020 2050 7954  .            PyT
-000166d0: 6f72 6368 2069 6e69 7469 616c 697a 6174  orch initializat
-000166e0: 696f 6e20 746f 2075 7365 2066 6f72 2057  ion to use for W
-000166f0: 2e0a 2020 2020 2020 2020 696e 6e65 725f  ..        inner_
-00016700: 696e 6974 5f66 6e3a 2073 7472 0a20 2020  init_fn: str.   
-00016710: 2020 2020 2020 2020 2050 7954 6f72 6368           PyTorch
-00016720: 2069 6e69 7469 616c 697a 6174 696f 6e20   initialization 
-00016730: 746f 2075 7365 2066 6f72 2055 2e0a 2020  to use for U..  
-00016740: 2020 2020 2020 6163 7469 7661 7469 6f6e        activation
-00016750: 5f66 6e3a 2073 7472 0a20 2020 2020 2020  _fn: str.       
-00016760: 2020 2020 2050 7954 6f72 6368 2061 6374       PyTorch act
-00016770: 6976 6174 696f 6e20 746f 2075 7365 2066  ivation to use f
-00016780: 6f72 206f 7574 7075 742e 0a20 2020 2020  or output..     
-00016790: 2020 2069 6e6e 6572 5f61 6374 6976 6174     inner_activat
-000167a0: 696f 6e5f 666e 3a20 7374 720a 2020 2020  ion_fn: str.    
-000167b0: 2020 2020 2020 2020 5079 546f 7263 6820          PyTorch 
-000167c0: 6163 7469 7661 7469 6f6e 2074 6f20 7573  activation to us
-000167d0: 6520 666f 7220 696e 6e65 7220 7374 6570  e for inner step
-000167e0: 732e 0a20 2020 2020 2020 2022 2222 0a0a  s..        """..
-000167f0: 2020 2020 2020 2020 7375 7065 7228 4c53          super(LS
-00016800: 544d 5374 6570 2c20 7365 6c66 292e 5f5f  TMStep, self).__
-00016810: 696e 6974 5f5f 282a 2a6b 7761 7267 7329  init__(**kwargs)
-00016820: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-00016830: 6974 203d 2069 6e69 745f 666e 0a20 2020  it = init_fn.   
-00016840: 2020 2020 2073 656c 662e 696e 6e65 725f       self.inner_
-00016850: 696e 6974 203d 2069 6e6e 6572 5f69 6e69  init = inner_ini
-00016860: 745f 666e 0a20 2020 2020 2020 2073 656c  t_fn.        sel
-00016870: 662e 6f75 7470 7574 5f64 696d 203d 206f  f.output_dim = o
-00016880: 7574 7075 745f 6469 6d0a 2020 2020 2020  utput_dim.      
-00016890: 2020 2320 4e6f 206f 7468 6572 2066 6f72    # No other for
-000168a0: 6765 7420 6269 6173 6573 2073 7570 706f  get biases suppo
-000168b0: 7274 6564 2072 6967 6874 206e 6f77 2e0a  rted right now..
-000168c0: 2020 2020 2020 2020 7365 6c66 2e61 6374          self.act
-000168d0: 6976 6174 696f 6e20 3d20 6163 7469 7661  ivation = activa
-000168e0: 7469 6f6e 5f66 6e0a 2020 2020 2020 2020  tion_fn.        
-000168f0: 7365 6c66 2e69 6e6e 6572 5f61 6374 6976  self.inner_activ
-00016900: 6174 696f 6e20 3d20 696e 6e65 725f 6163  ation = inner_ac
-00016910: 7469 7661 7469 6f6e 5f66 6e0a 2020 2020  tivation_fn.    
-00016920: 2020 2020 7365 6c66 2e61 6374 6976 6174      self.activat
-00016930: 696f 6e5f 666e 203d 2067 6574 5f61 6374  ion_fn = get_act
-00016940: 6976 6174 696f 6e28 6163 7469 7661 7469  ivation(activati
-00016950: 6f6e 5f66 6e29 0a20 2020 2020 2020 2073  on_fn).        s
-00016960: 656c 662e 696e 6e65 725f 6163 7469 7661  elf.inner_activa
-00016970: 7469 6f6e 5f66 6e20 3d20 6765 745f 6163  tion_fn = get_ac
-00016980: 7469 7661 7469 6f6e 2869 6e6e 6572 5f61  tivation(inner_a
-00016990: 6374 6976 6174 696f 6e5f 666e 290a 2020  ctivation_fn).  
-000169a0: 2020 2020 2020 7365 6c66 2e69 6e70 7574        self.input
-000169b0: 5f64 696d 203d 2069 6e70 7574 5f64 696d  _dim = input_dim
-000169c0: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
-000169d0: 696c 6428 290a 0a20 2020 2064 6566 2067  ild()..    def g
-000169e0: 6574 5f63 6f6e 6669 6728 7365 6c66 293a  et_config(self):
-000169f0: 0a20 2020 2020 2020 2063 6f6e 6669 6720  .        config 
-00016a00: 3d20 7375 7065 7228 4c53 544d 5374 6570  = super(LSTMStep
-00016a10: 2c20 7365 6c66 292e 6765 745f 636f 6e66  , self).get_conf
-00016a20: 6967 2829 0a20 2020 2020 2020 2063 6f6e  ig().        con
-00016a30: 6669 675b 276f 7574 7075 745f 6469 6d27  fig['output_dim'
-00016a40: 5d20 3d20 7365 6c66 2e6f 7574 7075 745f  ] = self.output_
-00016a50: 6469 6d0a 2020 2020 2020 2020 636f 6e66  dim.        conf
-00016a60: 6967 5b27 696e 7075 745f 6469 6d27 5d20  ig['input_dim'] 
-00016a70: 3d20 7365 6c66 2e69 6e70 7574 5f64 696d  = self.input_dim
-00016a80: 0a20 2020 2020 2020 2063 6f6e 6669 675b  .        config[
-00016a90: 2769 6e69 745f 666e 275d 203d 2073 656c  'init_fn'] = sel
-00016aa0: 662e 696e 6974 0a20 2020 2020 2020 2063  f.init.        c
-00016ab0: 6f6e 6669 675b 2769 6e6e 6572 5f69 6e69  onfig['inner_ini
-00016ac0: 745f 666e 275d 203d 2073 656c 662e 696e  t_fn'] = self.in
-00016ad0: 6e65 725f 696e 6974 0a20 2020 2020 2020  ner_init.       
-00016ae0: 2063 6f6e 6669 675b 2761 6374 6976 6174   config['activat
-00016af0: 696f 6e5f 666e 275d 203d 2073 656c 662e  ion_fn'] = self.
-00016b00: 6163 7469 7661 7469 6f6e 0a20 2020 2020  activation.     
-00016b10: 2020 2063 6f6e 6669 675b 2769 6e6e 6572     config['inner
-00016b20: 5f61 6374 6976 6174 696f 6e5f 666e 275d  _activation_fn']
-00016b30: 203d 2073 656c 662e 696e 6e65 725f 6163   = self.inner_ac
-00016b40: 7469 7661 7469 6f6e 0a20 2020 2020 2020  tivation.       
-00016b50: 2072 6574 7572 6e20 636f 6e66 6967 0a0a   return config..
-00016b60: 2020 2020 6465 6620 6765 745f 696e 6974      def get_init
-00016b70: 6961 6c5f 7374 6174 6573 2873 656c 662c  ial_states(self,
-00016b80: 2069 6e70 7574 5f73 6861 7065 293a 0a20   input_shape):. 
-00016b90: 2020 2020 2020 2072 6574 7572 6e20 5b74         return [t
-00016ba0: 6f72 6368 2e7a 6572 6f73 2869 6e70 7574  orch.zeros(input
-00016bb0: 5f73 6861 7065 292c 2074 6f72 6368 2e7a  _shape), torch.z
-00016bc0: 6572 6f73 2869 6e70 7574 5f73 6861 7065  eros(input_shape
-00016bd0: 295d 0a0a 2020 2020 6465 6620 6275 696c  )]..    def buil
-00016be0: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
-00016bf0: 2022 2222 436f 6e73 7472 7563 7473 206c   """Constructs l
-00016c00: 6561 726e 6162 6c65 2077 6569 6768 7473  earnable weights
-00016c10: 2066 6f72 2074 6869 7320 6c61 7965 722e   for this layer.
-00016c20: 2222 220a 2020 2020 2020 2020 696e 6974  """.        init
-00016c30: 203d 2067 6574 6174 7472 2869 6e69 7469   = getattr(initi
-00016c40: 616c 697a 6572 732c 2073 656c 662e 696e  alizers, self.in
-00016c50: 6974 290a 2020 2020 2020 2020 696e 6e65  it).        inne
-00016c60: 725f 696e 6974 203d 2067 6574 6174 7472  r_init = getattr
-00016c70: 2869 6e69 7469 616c 697a 6572 732c 2073  (initializers, s
-00016c80: 656c 662e 696e 6e65 725f 696e 6974 290a  elf.inner_init).
-00016c90: 2020 2020 2020 2020 7365 6c66 2e57 203d          self.W =
-00016ca0: 2069 6e69 7428 746f 7263 682e 656d 7074   init(torch.empt
-00016cb0: 7928 7365 6c66 2e69 6e70 7574 5f64 696d  y(self.input_dim
-00016cc0: 2c20 3420 2a20 7365 6c66 2e6f 7574 7075  , 4 * self.outpu
-00016cd0: 745f 6469 6d29 290a 2020 2020 2020 2020  t_dim)).        
-00016ce0: 7365 6c66 2e55 203d 2069 6e6e 6572 5f69  self.U = inner_i
-00016cf0: 6e69 7428 746f 7263 682e 656d 7074 7928  nit(torch.empty(
-00016d00: 7365 6c66 2e6f 7574 7075 745f 6469 6d2c  self.output_dim,
-00016d10: 2034 202a 2073 656c 662e 6f75 7470 7574   4 * self.output
-00016d20: 5f64 696d 2929 0a0a 2020 2020 2020 2020  _dim))..        
-00016d30: 7365 6c66 2e62 203d 2074 6f72 6368 2e74  self.b = torch.t
-00016d40: 656e 736f 7228 6e70 2e68 7374 6163 6b28  ensor(np.hstack(
-00016d50: 0a20 2020 2020 2020 2020 2020 2028 6e70  .            (np
-00016d60: 2e7a 6572 6f73 2873 656c 662e 6f75 7470  .zeros(self.outp
-00016d70: 7574 5f64 696d 292c 206e 702e 6f6e 6573  ut_dim), np.ones
-00016d80: 2873 656c 662e 6f75 7470 7574 5f64 696d  (self.output_dim
-00016d90: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00016da0: 6e70 2e7a 6572 6f73 2873 656c 662e 6f75  np.zeros(self.ou
-00016db0: 7470 7574 5f64 696d 292c 206e 702e 7a65  tput_dim), np.ze
-00016dc0: 726f 7328 7365 6c66 2e6f 7574 7075 745f  ros(self.output_
-00016dd0: 6469 6d29 2929 2c0a 2020 2020 2020 2020  dim))),.        
+00015f70: 2020 2020 2020 2020 2020 286e 5f63 656c            (n_cel
+00015f80: 6c73 202a 206e 5f63 656c 6c73 2c20 6e64  ls * n_cells, nd
+00015f90: 696d 2929 0a20 2020 2020 2020 2023 2054  im)).        # T
+00015fa0: 696c 6520 2861 2c20 622c 2063 2c20 612c  ile (a, b, c, a,
+00015fb0: 2062 2c20 632c 202e 2e2e 290a 2020 2020   b, c, ...).    
+00015fc0: 2020 2020 7469 6c65 645f 6365 6c6c 7320      tiled_cells 
+00015fd0: 3d20 746f 7263 682e 7469 6c65 2863 656c  = torch.tile(cel
+00015fe0: 6c73 2c20 286e 5f63 656c 6c73 2c20 3129  ls, (n_cells, 1)
+00015ff0: 290a 0a20 2020 2020 2020 2063 6f6f 7264  )..        coord
+00016000: 735f 7665 6320 3d20 746f 7263 682e 7375  s_vec = torch.su
+00016010: 6d28 2874 696c 6564 5f63 656e 7465 7273  m((tiled_centers
+00016020: 202d 2074 696c 6564 5f63 656c 6c73 292a   - tiled_cells)*
+00016030: 2a32 2c20 6469 6d3d 2d31 290a 2020 2020  *2, dim=-1).    
+00016040: 2020 2020 636f 6f72 6473 5f6e 6f72 6d20      coords_norm 
+00016050: 3d20 746f 7263 682e 7265 7368 6170 6528  = torch.reshape(
+00016060: 636f 6f72 6473 5f76 6563 2c20 286e 5f63  coords_vec, (n_c
+00016070: 656c 6c73 2c20 6e5f 6365 6c6c 7329 290a  ells, n_cells)).
+00016080: 2020 2020 2020 2020 636c 6f73 6573 745f          closest_
+00016090: 696e 6473 203d 2074 6f72 6368 2e74 6f70  inds = torch.top
+000160a0: 6b28 636f 6f72 6473 5f6e 6f72 6d2c 206b  k(coords_norm, k
+000160b0: 3d6e 5f6e 6272 5f63 656c 6c73 2c20 6c61  =n_nbr_cells, la
+000160c0: 7267 6573 743d 4661 6c73 6529 5b31 5d0a  rgest=False)[1].
+000160d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000160e0: 636c 6f73 6573 745f 696e 6473 0a0a 2020  closest_inds..  
+000160f0: 2020 6465 6620 6765 745f 6365 6c6c 7328    def get_cells(
+00016100: 7365 6c66 2920 2d3e 2074 6f72 6368 2e54  self) -> torch.T
+00016110: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
+00016120: 2222 5265 7475 726e 7320 7468 6520 6c6f  ""Returns the lo
+00016130: 6361 7469 6f6e 7320 6f66 2061 6c6c 2067  cations of all g
+00016140: 7269 6420 706f 696e 7473 2069 6e20 626f  rid points in bo
+00016150: 782e 0a0a 2020 2020 2020 2020 5375 7070  x...        Supp
+00016160: 6f73 6520 7374 6172 7420 6973 202d 3130  ose start is -10
+00016170: 2041 6e67 7374 726f 6d2c 2073 746f 7020   Angstrom, stop 
+00016180: 6973 2031 3020 416e 6773 7472 6f6d 2c20  is 10 Angstrom, 
+00016190: 6e62 725f 6375 746f 6666 2069 7320 312e  nbr_cutoff is 1.
+000161a0: 0a20 2020 2020 2020 2054 6865 6e20 776f  .        Then wo
+000161b0: 756c 6420 7265 7475 726e 2061 206c 6973  uld return a lis
+000161c0: 7420 6f66 206c 656e 6774 6820 3230 5e33  t of length 20^3
+000161d0: 2077 686f 7365 2065 6e74 7269 6573 2077   whose entries w
+000161e0: 6f75 6c64 2062 650a 2020 2020 2020 2020  ould be.        
+000161f0: 5b28 2d31 302c 202d 3130 2c20 2d31 3029  [(-10, -10, -10)
+00016200: 2c20 282d 3130 2c20 2d31 302c 202d 3929  , (-10, -10, -9)
+00016210: 2c20 2e2e 2e2c 2028 392c 2039 2c20 3929  , ..., (9, 9, 9)
+00016220: 5d0a 0a20 2020 2020 2020 2052 6574 7572  ]..        Retur
+00016230: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00016240: 2d2d 0a20 2020 2020 2020 2063 656c 6c73  --.        cells
+00016250: 3a20 746f 7263 682e 5465 6e73 6f72 0a20  : torch.Tensor. 
+00016260: 2020 2020 2020 2020 2028 6e5f 6365 6c6c           (n_cell
+00016270: 732c 206e 6469 6d29 2073 6861 7065 2e0a  s, ndim) shape..
+00016280: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016290: 2020 2020 7374 6172 742c 2073 746f 702c      start, stop,
+000162a0: 206e 6272 5f63 7574 6f66 6620 3d20 7365   nbr_cutoff = se
+000162b0: 6c66 2e73 7461 7274 2c20 7365 6c66 2e73  lf.start, self.s
+000162c0: 746f 702c 2073 656c 662e 6e62 725f 6375  top, self.nbr_cu
+000162d0: 746f 6666 0a20 2020 2020 2020 206d 6573  toff.        mes
+000162e0: 685f 6172 6773 203d 205b 0a20 2020 2020  h_args = [.     
+000162f0: 2020 2020 2020 2074 6f72 6368 2e61 7261         torch.ara
+00016300: 6e67 6528 7374 6172 742c 2073 746f 702c  nge(start, stop,
+00016310: 206e 6272 5f63 7574 6f66 6629 2066 6f72   nbr_cutoff) for
+00016320: 205f 2069 6e20 7261 6e67 6528 7365 6c66   _ in range(self
+00016330: 2e6e 6469 6d29 0a20 2020 2020 2020 205d  .ndim).        ]
+00016340: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00016350: 746f 7263 682e 7265 7368 6170 6528 0a20  torch.reshape(. 
+00016360: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
+00016370: 2e70 6572 6d75 7465 280a 2020 2020 2020  .permute(.      
+00016380: 2020 2020 2020 2020 2020 746f 7263 682e            torch.
+00016390: 7374 6163 6b28 746f 7263 682e 6d65 7368  stack(torch.mesh
+000163a0: 6772 6964 282a 6d65 7368 5f61 7267 732c  grid(*mesh_args,
+000163b0: 2069 6e64 6578 696e 673d 2778 7927 2929   indexing='xy'))
+000163c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000163d0: 2020 7475 706c 6528 7261 6e67 6528 7365    tuple(range(se
+000163e0: 6c66 2e6e 6469 6d2c 202d 312c 202d 3129  lf.ndim, -1, -1)
+000163f0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+00016400: 2873 656c 662e 6e5f 6365 6c6c 732c 2073  (self.n_cells, s
+00016410: 656c 662e 6e64 696d 2929 2e74 6f28 746f  elf.ndim)).to(to
+00016420: 7263 682e 666c 6f61 7429 0a0a 0a63 6c61  rch.float)...cla
+00016430: 7373 204c 5354 4d53 7465 7028 6e6e 2e4d  ss LSTMStep(nn.M
+00016440: 6f64 756c 6529 3a0a 2020 2020 2222 224c  odule):.    """L
+00016450: 6179 6572 2074 6861 7420 7065 7266 6f72  ayer that perfor
+00016460: 6d73 2061 2073 696e 676c 6520 7374 6570  ms a single step
+00016470: 204c 5354 4d20 7570 6461 7465 2e0a 0a20   LSTM update... 
+00016480: 2020 2054 6869 7320 6973 2074 6865 2054     This is the T
+00016490: 6f72 6368 2065 7175 6976 616c 656e 7420  orch equivalent 
+000164a0: 6f66 2074 6865 206f 7269 6769 6e61 6c20  of the original 
+000164b0: 696d 706c 656d 656e 7461 7469 6f6e 2075  implementation u
+000164c0: 7369 6e67 204b 6572 6173 2e0a 2020 2020  sing Keras..    
+000164d0: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
+000164e0: 6e69 745f 5f28 7365 6c66 2c0a 2020 2020  nit__(self,.    
+000164f0: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00016500: 7075 745f 6469 6d2c 0a20 2020 2020 2020  put_dim,.       
+00016510: 2020 2020 2020 2020 2020 696e 7075 745f            input_
+00016520: 6469 6d2c 0a20 2020 2020 2020 2020 2020  dim,.           
+00016530: 2020 2020 2020 696e 6974 5f66 6e3d 2778        init_fn='x
+00016540: 6176 6965 725f 756e 6966 6f72 6d5f 272c  avier_uniform_',
+00016550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016560: 2020 696e 6e65 725f 696e 6974 5f66 6e3d    inner_init_fn=
+00016570: 276f 7274 686f 676f 6e61 6c5f 272c 0a20  'orthogonal_',. 
+00016580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016590: 6163 7469 7661 7469 6f6e 5f66 6e3d 2774  activation_fn='t
+000165a0: 616e 6827 2c0a 2020 2020 2020 2020 2020  anh',.          
+000165b0: 2020 2020 2020 2069 6e6e 6572 5f61 6374         inner_act
+000165c0: 6976 6174 696f 6e5f 666e 3d27 6861 7264  ivation_fn='hard
+000165d0: 7369 676d 6f69 6427 2c0a 2020 2020 2020  sigmoid',.      
+000165e0: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
+000165f0: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+00016600: 220a 2020 2020 2020 2020 5061 7261 6d65  ".        Parame
+00016610: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+00016620: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00016630: 6f75 7470 7574 5f64 696d 3a20 696e 740a  output_dim: int.
+00016640: 2020 2020 2020 2020 2020 2020 4469 6d65              Dime
+00016650: 6e73 696f 6e61 6c69 7479 206f 6620 6f75  nsionality of ou
+00016660: 7470 7574 2076 6563 746f 7273 2e0a 2020  tput vectors..  
+00016670: 2020 2020 2020 696e 7075 745f 6469 6d3a        input_dim:
+00016680: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
+00016690: 2044 696d 656e 7369 6f6e 616c 6974 7920   Dimensionality 
+000166a0: 6f66 2069 6e70 7574 2076 6563 746f 7273  of input vectors
+000166b0: 2e0a 2020 2020 2020 2020 696e 6974 5f66  ..        init_f
+000166c0: 6e3a 2073 7472 0a20 2020 2020 2020 2020  n: str.         
+000166d0: 2020 2050 7954 6f72 6368 2069 6e69 7469     PyTorch initi
+000166e0: 616c 697a 6174 696f 6e20 746f 2075 7365  alization to use
+000166f0: 2066 6f72 2057 2e0a 2020 2020 2020 2020   for W..        
+00016700: 696e 6e65 725f 696e 6974 5f66 6e3a 2073  inner_init_fn: s
+00016710: 7472 0a20 2020 2020 2020 2020 2020 2050  tr.            P
+00016720: 7954 6f72 6368 2069 6e69 7469 616c 697a  yTorch initializ
+00016730: 6174 696f 6e20 746f 2075 7365 2066 6f72  ation to use for
+00016740: 2055 2e0a 2020 2020 2020 2020 6163 7469   U..        acti
+00016750: 7661 7469 6f6e 5f66 6e3a 2073 7472 0a20  vation_fn: str. 
+00016760: 2020 2020 2020 2020 2020 2050 7954 6f72             PyTor
+00016770: 6368 2061 6374 6976 6174 696f 6e20 746f  ch activation to
+00016780: 2075 7365 2066 6f72 206f 7574 7075 742e   use for output.
+00016790: 0a20 2020 2020 2020 2069 6e6e 6572 5f61  .        inner_a
+000167a0: 6374 6976 6174 696f 6e5f 666e 3a20 7374  ctivation_fn: st
+000167b0: 720a 2020 2020 2020 2020 2020 2020 5079  r.            Py
+000167c0: 546f 7263 6820 6163 7469 7661 7469 6f6e  Torch activation
+000167d0: 2074 6f20 7573 6520 666f 7220 696e 6e65   to use for inne
+000167e0: 7220 7374 6570 732e 0a20 2020 2020 2020  r steps..       
+000167f0: 2022 2222 0a0a 2020 2020 2020 2020 7375   """..        su
+00016800: 7065 7228 4c53 544d 5374 6570 2c20 7365  per(LSTMStep, se
+00016810: 6c66 292e 5f5f 696e 6974 5f5f 282a 2a6b  lf).__init__(**k
+00016820: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
+00016830: 656c 662e 696e 6974 203d 2069 6e69 745f  elf.init = init_
+00016840: 666e 0a20 2020 2020 2020 2073 656c 662e  fn.        self.
+00016850: 696e 6e65 725f 696e 6974 203d 2069 6e6e  inner_init = inn
+00016860: 6572 5f69 6e69 745f 666e 0a20 2020 2020  er_init_fn.     
+00016870: 2020 2073 656c 662e 6f75 7470 7574 5f64     self.output_d
+00016880: 696d 203d 206f 7574 7075 745f 6469 6d0a  im = output_dim.
+00016890: 2020 2020 2020 2020 2320 4e6f 206f 7468          # No oth
+000168a0: 6572 2066 6f72 6765 7420 6269 6173 6573  er forget biases
+000168b0: 2073 7570 706f 7274 6564 2072 6967 6874   supported right
+000168c0: 206e 6f77 2e0a 2020 2020 2020 2020 7365   now..        se
+000168d0: 6c66 2e61 6374 6976 6174 696f 6e20 3d20  lf.activation = 
+000168e0: 6163 7469 7661 7469 6f6e 5f66 6e0a 2020  activation_fn.  
+000168f0: 2020 2020 2020 7365 6c66 2e69 6e6e 6572        self.inner
+00016900: 5f61 6374 6976 6174 696f 6e20 3d20 696e  _activation = in
+00016910: 6e65 725f 6163 7469 7661 7469 6f6e 5f66  ner_activation_f
+00016920: 6e0a 2020 2020 2020 2020 7365 6c66 2e61  n.        self.a
+00016930: 6374 6976 6174 696f 6e5f 666e 203d 2067  ctivation_fn = g
+00016940: 6574 5f61 6374 6976 6174 696f 6e28 6163  et_activation(ac
+00016950: 7469 7661 7469 6f6e 5f66 6e29 0a20 2020  tivation_fn).   
+00016960: 2020 2020 2073 656c 662e 696e 6e65 725f       self.inner_
+00016970: 6163 7469 7661 7469 6f6e 5f66 6e20 3d20  activation_fn = 
+00016980: 6765 745f 6163 7469 7661 7469 6f6e 2869  get_activation(i
+00016990: 6e6e 6572 5f61 6374 6976 6174 696f 6e5f  nner_activation_
+000169a0: 666e 290a 2020 2020 2020 2020 7365 6c66  fn).        self
+000169b0: 2e69 6e70 7574 5f64 696d 203d 2069 6e70  .input_dim = inp
+000169c0: 7574 5f64 696d 0a20 2020 2020 2020 2073  ut_dim.        s
+000169d0: 656c 662e 6275 696c 6428 290a 0a20 2020  elf.build()..   
+000169e0: 2064 6566 2067 6574 5f63 6f6e 6669 6728   def get_config(
+000169f0: 7365 6c66 293a 0a20 2020 2020 2020 2063  self):.        c
+00016a00: 6f6e 6669 6720 3d20 7375 7065 7228 4c53  onfig = super(LS
+00016a10: 544d 5374 6570 2c20 7365 6c66 292e 6765  TMStep, self).ge
+00016a20: 745f 636f 6e66 6967 2829 0a20 2020 2020  t_config().     
+00016a30: 2020 2063 6f6e 6669 675b 276f 7574 7075     config['outpu
+00016a40: 745f 6469 6d27 5d20 3d20 7365 6c66 2e6f  t_dim'] = self.o
+00016a50: 7574 7075 745f 6469 6d0a 2020 2020 2020  utput_dim.      
+00016a60: 2020 636f 6e66 6967 5b27 696e 7075 745f    config['input_
+00016a70: 6469 6d27 5d20 3d20 7365 6c66 2e69 6e70  dim'] = self.inp
+00016a80: 7574 5f64 696d 0a20 2020 2020 2020 2063  ut_dim.        c
+00016a90: 6f6e 6669 675b 2769 6e69 745f 666e 275d  onfig['init_fn']
+00016aa0: 203d 2073 656c 662e 696e 6974 0a20 2020   = self.init.   
+00016ab0: 2020 2020 2063 6f6e 6669 675b 2769 6e6e       config['inn
+00016ac0: 6572 5f69 6e69 745f 666e 275d 203d 2073  er_init_fn'] = s
+00016ad0: 656c 662e 696e 6e65 725f 696e 6974 0a20  elf.inner_init. 
+00016ae0: 2020 2020 2020 2063 6f6e 6669 675b 2761         config['a
+00016af0: 6374 6976 6174 696f 6e5f 666e 275d 203d  ctivation_fn'] =
+00016b00: 2073 656c 662e 6163 7469 7661 7469 6f6e   self.activation
+00016b10: 0a20 2020 2020 2020 2063 6f6e 6669 675b  .        config[
+00016b20: 2769 6e6e 6572 5f61 6374 6976 6174 696f  'inner_activatio
+00016b30: 6e5f 666e 275d 203d 2073 656c 662e 696e  n_fn'] = self.in
+00016b40: 6e65 725f 6163 7469 7661 7469 6f6e 0a20  ner_activation. 
+00016b50: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+00016b60: 6e66 6967 0a0a 2020 2020 6465 6620 6765  nfig..    def ge
+00016b70: 745f 696e 6974 6961 6c5f 7374 6174 6573  t_initial_states
+00016b80: 2873 656c 662c 2069 6e70 7574 5f73 6861  (self, input_sha
+00016b90: 7065 293a 0a20 2020 2020 2020 2072 6574  pe):.        ret
+00016ba0: 7572 6e20 5b74 6f72 6368 2e7a 6572 6f73  urn [torch.zeros
+00016bb0: 2869 6e70 7574 5f73 6861 7065 292c 2074  (input_shape), t
+00016bc0: 6f72 6368 2e7a 6572 6f73 2869 6e70 7574  orch.zeros(input
+00016bd0: 5f73 6861 7065 295d 0a0a 2020 2020 6465  _shape)]..    de
+00016be0: 6620 6275 696c 6428 7365 6c66 293a 0a20  f build(self):. 
+00016bf0: 2020 2020 2020 2022 2222 436f 6e73 7472         """Constr
+00016c00: 7563 7473 206c 6561 726e 6162 6c65 2077  ucts learnable w
+00016c10: 6569 6768 7473 2066 6f72 2074 6869 7320  eights for this 
+00016c20: 6c61 7965 722e 2222 220a 2020 2020 2020  layer.""".      
+00016c30: 2020 696e 6974 203d 2067 6574 6174 7472    init = getattr
+00016c40: 2869 6e69 7469 616c 697a 6572 732c 2073  (initializers, s
+00016c50: 656c 662e 696e 6974 290a 2020 2020 2020  elf.init).      
+00016c60: 2020 696e 6e65 725f 696e 6974 203d 2067    inner_init = g
+00016c70: 6574 6174 7472 2869 6e69 7469 616c 697a  etattr(initializ
+00016c80: 6572 732c 2073 656c 662e 696e 6e65 725f  ers, self.inner_
+00016c90: 696e 6974 290a 2020 2020 2020 2020 7365  init).        se
+00016ca0: 6c66 2e57 203d 2069 6e69 7428 746f 7263  lf.W = init(torc
+00016cb0: 682e 656d 7074 7928 7365 6c66 2e69 6e70  h.empty(self.inp
+00016cc0: 7574 5f64 696d 2c20 3420 2a20 7365 6c66  ut_dim, 4 * self
+00016cd0: 2e6f 7574 7075 745f 6469 6d29 290a 2020  .output_dim)).  
+00016ce0: 2020 2020 2020 7365 6c66 2e55 203d 2069        self.U = i
+00016cf0: 6e6e 6572 5f69 6e69 7428 746f 7263 682e  nner_init(torch.
+00016d00: 656d 7074 7928 7365 6c66 2e6f 7574 7075  empty(self.outpu
+00016d10: 745f 6469 6d2c 2034 202a 2073 656c 662e  t_dim, 4 * self.
+00016d20: 6f75 7470 7574 5f64 696d 2929 0a0a 2020  output_dim))..  
+00016d30: 2020 2020 2020 7365 6c66 2e62 203d 2074        self.b = t
+00016d40: 6f72 6368 2e74 656e 736f 7228 6e70 2e68  orch.tensor(np.h
+00016d50: 7374 6163 6b28 0a20 2020 2020 2020 2020  stack(.         
+00016d60: 2020 2028 6e70 2e7a 6572 6f73 2873 656c     (np.zeros(sel
+00016d70: 662e 6f75 7470 7574 5f64 696d 292c 206e  f.output_dim), n
+00016d80: 702e 6f6e 6573 2873 656c 662e 6f75 7470  p.ones(self.outp
+00016d90: 7574 5f64 696d 292c 0a20 2020 2020 2020  ut_dim),.       
+00016da0: 2020 2020 2020 6e70 2e7a 6572 6f73 2873        np.zeros(s
+00016db0: 656c 662e 6f75 7470 7574 5f64 696d 292c  elf.output_dim),
+00016dc0: 206e 702e 7a65 726f 7328 7365 6c66 2e6f   np.zeros(self.o
+00016dd0: 7574 7075 745f 6469 6d29 2929 2c0a 2020  utput_dim))),.  
 00016de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016df0: 2020 2020 2020 6474 7970 653d 746f 7263        dtype=torc
-00016e00: 682e 666c 6f61 7433 3229 0a0a 2020 2020  h.float32)..    
-00016e10: 6465 6620 666f 7277 6172 6428 7365 6c66  def forward(self
-00016e20: 2c20 696e 7075 7473 293a 0a20 2020 2020  , inputs):.     
-00016e30: 2020 2022 2222 4578 6563 7574 6520 7468     """Execute th
-00016e40: 6973 206c 6179 6572 206f 6e20 696e 7075  is layer on inpu
-00016e50: 7420 7465 6e73 6f72 732e 0a0a 2020 2020  t tensors...    
-00016e60: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00016e70: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00016e80: 2d0a 2020 2020 2020 2020 696e 7075 7473  -.        inputs
-00016e90: 3a20 6c69 7374 0a20 2020 2020 2020 2020  : list.         
-00016ea0: 2020 204c 6973 7420 6f66 2074 6872 6565     List of three
-00016eb0: 2074 656e 736f 7273 2028 782c 2068 5f74   tensors (x, h_t
-00016ec0: 6d31 2c20 635f 746d 3129 2e20 685f 746d  m1, c_tm1). h_tm
-00016ed0: 3120 6d65 616e 7320 2268 2c20 742d 3122  1 means "h, t-1"
-00016ee0: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-00016ef0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-00016f00: 2d2d 0a20 2020 2020 2020 206c 6973 740a  --.        list.
-00016f10: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
-00016f20: 726e 7320 682c 205b 682c 2063 5d0a 2020  rns h, [h, c].  
-00016f30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016f40: 2020 782c 2068 5f74 6d31 2c20 635f 746d    x, h_tm1, c_tm
-00016f50: 3120 3d20 696e 7075 7473 0a20 2020 2020  1 = inputs.     
-00016f60: 2020 2078 2c20 685f 746d 312c 2063 5f74     x, h_tm1, c_t
-00016f70: 6d31 203d 2074 6f72 6368 2e74 656e 736f  m1 = torch.tenso
-00016f80: 7228 7829 2c20 746f 7263 682e 7465 6e73  r(x), torch.tens
-00016f90: 6f72 2868 5f74 6d31 292c 2074 6f72 6368  or(h_tm1), torch
-00016fa0: 2e74 656e 736f 7228 0a20 2020 2020 2020  .tensor(.       
-00016fb0: 2020 2020 2063 5f74 6d31 290a 0a20 2020       c_tm1)..   
-00016fc0: 2020 2020 207a 203d 2074 6f72 6368 2e6d       z = torch.m
-00016fd0: 6174 6d75 6c28 782c 2073 656c 662e 5729  atmul(x, self.W)
-00016fe0: 202b 2074 6f72 6368 2e6d 6174 6d75 6c28   + torch.matmul(
-00016ff0: 685f 746d 312c 2073 656c 662e 5529 202b  h_tm1, self.U) +
-00017000: 2073 656c 662e 620a 0a20 2020 2020 2020   self.b..       
-00017010: 207a 3020 3d20 7a5b 3a2c 203a 7365 6c66   z0 = z[:, :self
-00017020: 2e6f 7574 7075 745f 6469 6d5d 0a20 2020  .output_dim].   
-00017030: 2020 2020 207a 3120 3d20 7a5b 3a2c 2073       z1 = z[:, s
-00017040: 656c 662e 6f75 7470 7574 5f64 696d 3a32  elf.output_dim:2
-00017050: 202a 2073 656c 662e 6f75 7470 7574 5f64   * self.output_d
-00017060: 696d 5d0a 2020 2020 2020 2020 7a32 203d  im].        z2 =
-00017070: 207a 5b3a 2c20 3220 2a20 7365 6c66 2e6f   z[:, 2 * self.o
-00017080: 7574 7075 745f 6469 6d3a 3320 2a20 7365  utput_dim:3 * se
-00017090: 6c66 2e6f 7574 7075 745f 6469 6d5d 0a20  lf.output_dim]. 
-000170a0: 2020 2020 2020 207a 3320 3d20 7a5b 3a2c         z3 = z[:,
-000170b0: 2033 202a 2073 656c 662e 6f75 7470 7574   3 * self.output
-000170c0: 5f64 696d 3a5d 0a0a 2020 2020 2020 2020  _dim:]..        
-000170d0: 6920 3d20 7365 6c66 2e69 6e6e 6572 5f61  i = self.inner_a
-000170e0: 6374 6976 6174 696f 6e5f 666e 287a 3029  ctivation_fn(z0)
-000170f0: 0a20 2020 2020 2020 2066 203d 2073 656c  .        f = sel
-00017100: 662e 696e 6e65 725f 6163 7469 7661 7469  f.inner_activati
-00017110: 6f6e 5f66 6e28 7a31 290a 2020 2020 2020  on_fn(z1).      
-00017120: 2020 6320 3d20 6620 2a20 635f 746d 3120    c = f * c_tm1 
-00017130: 2b20 6920 2a20 7365 6c66 2e61 6374 6976  + i * self.activ
-00017140: 6174 696f 6e5f 666e 287a 3229 0a20 2020  ation_fn(z2).   
-00017150: 2020 2020 206f 203d 2073 656c 662e 696e       o = self.in
-00017160: 6e65 725f 6163 7469 7661 7469 6f6e 5f66  ner_activation_f
-00017170: 6e28 7a33 290a 0a20 2020 2020 2020 2068  n(z3)..        h
-00017180: 203d 206f 202a 2073 656c 662e 6163 7469   = o * self.acti
-00017190: 7661 7469 6f6e 5f66 6e28 6329 0a20 2020  vation_fn(c).   
-000171a0: 2020 2020 2072 6574 7572 6e20 682c 205b       return h, [
-000171b0: 682c 2063 5d0a 0a0a 636c 6173 7320 4174  h, c]...class At
-000171c0: 6f6d 6963 436f 6e76 6f6c 7574 696f 6e28  omicConvolution(
-000171d0: 6e6e 2e4d 6f64 756c 6529 3a0a 2020 2020  nn.Module):.    
-000171e0: 2222 2249 6d70 6c65 6d65 6e74 7320 7468  """Implements th
-000171f0: 6520 4174 6f6d 6963 2043 6f6e 766f 6c75  e Atomic Convolu
-00017200: 7469 6f6e 616c 2074 7261 6e73 666f 726d  tional transform
-00017210: 2c20 696e 7472 6f64 7563 6564 2069 6e0a  , introduced in.
-00017220: 0a20 2020 2047 6f6d 6573 2c20 4a6f 7365  .    Gomes, Jose
-00017230: 7068 2c20 6574 2061 6c2e 2022 4174 6f6d  ph, et al. "Atom
-00017240: 6963 2063 6f6e 766f 6c75 7469 6f6e 616c  ic convolutional
-00017250: 206e 6574 776f 726b 7320 666f 7220 7072   networks for pr
-00017260: 6564 6963 7469 6e67 0a20 2020 2070 726f  edicting.    pro
-00017270: 7465 696e 2d6c 6967 616e 6420 6269 6e64  tein-ligand bind
-00017280: 696e 6720 6166 6669 6e69 7479 2e22 2061  ing affinity." a
-00017290: 7258 6976 2070 7265 7072 696e 7420 6172  rXiv preprint ar
-000172a0: 5869 763a 3137 3033 2e31 3036 3033 0a20  Xiv:1703.10603. 
-000172b0: 2020 2028 3230 3137 292e 0a0a 2020 2020     (2017)...    
-000172c0: 4174 2061 2068 6967 6820 6c65 7665 6c2c  At a high level,
-000172d0: 2074 6869 7320 7472 616e 7366 6f72 6d20   this transform 
-000172e0: 7065 7266 6f72 6d73 2061 2067 7261 7068  performs a graph
-000172f0: 2063 6f6e 766f 6c75 7469 6f6e 0a20 2020   convolution.   
-00017300: 206f 6e20 7468 6520 6e65 6172 6573 7420   on the nearest 
-00017310: 6e65 6967 6862 6f72 7320 6772 6170 6820  neighbors graph 
-00017320: 696e 2033 4420 7370 6163 652e 0a0a 2020  in 3D space...  
-00017330: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
-00017340: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
-00017350: 6261 7463 685f 7369 7a65 203d 2034 0a20  batch_size = 4. 
-00017360: 2020 203e 3e3e 206d 6178 5f61 746f 6d73     >>> max_atoms
-00017370: 203d 2035 0a20 2020 203e 3e3e 206d 6178   = 5.    >>> max
-00017380: 5f6e 6569 6768 626f 7273 203d 2032 0a20  _neighbors = 2. 
-00017390: 2020 203e 3e3e 2064 696d 656e 7369 6f6e     >>> dimension
-000173a0: 7320 3d20 330a 2020 2020 3e3e 3e20 7261  s = 3.    >>> ra
-000173b0: 6469 616c 5f70 6172 616d 7320 3d20 746f  dial_params = to
-000173c0: 7263 682e 7465 6e73 6f72 285b 5b35 2e30  rch.tensor([[5.0
-000173d0: 2c20 322e 302c 2030 2e35 5d2c 205b 3130  , 2.0, 0.5], [10
-000173e0: 2e30 2c20 322e 302c 2030 2e35 5d2c 0a20  .0, 2.0, 0.5],. 
-000173f0: 2020 202e 2e2e 2020 2020 2020 2020 2020     ...          
+00016df0: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
+00016e00: 653d 746f 7263 682e 666c 6f61 7433 3229  e=torch.float32)
+00016e10: 0a0a 2020 2020 6465 6620 666f 7277 6172  ..    def forwar
+00016e20: 6428 7365 6c66 2c20 696e 7075 7473 293a  d(self, inputs):
+00016e30: 0a20 2020 2020 2020 2022 2222 4578 6563  .        """Exec
+00016e40: 7574 6520 7468 6973 206c 6179 6572 206f  ute this layer o
+00016e50: 6e20 696e 7075 7420 7465 6e73 6f72 732e  n input tensors.
+00016e60: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+00016e70: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+00016e80: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00016e90: 696e 7075 7473 3a20 6c69 7374 0a20 2020  inputs: list.   
+00016ea0: 2020 2020 2020 2020 204c 6973 7420 6f66           List of
+00016eb0: 2074 6872 6565 2074 656e 736f 7273 2028   three tensors (
+00016ec0: 782c 2068 5f74 6d31 2c20 635f 746d 3129  x, h_tm1, c_tm1)
+00016ed0: 2e20 685f 746d 3120 6d65 616e 7320 2268  . h_tm1 means "h
+00016ee0: 2c20 742d 3122 2e0a 0a20 2020 2020 2020  , t-1"...       
+00016ef0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+00016f00: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+00016f10: 206c 6973 740a 2020 2020 2020 2020 2020   list.          
+00016f20: 2020 5265 7475 726e 7320 682c 205b 682c    Returns h, [h,
+00016f30: 2063 5d0a 2020 2020 2020 2020 2222 220a   c].        """.
+00016f40: 2020 2020 2020 2020 782c 2068 5f74 6d31          x, h_tm1
+00016f50: 2c20 635f 746d 3120 3d20 696e 7075 7473  , c_tm1 = inputs
+00016f60: 0a20 2020 2020 2020 2078 2c20 685f 746d  .        x, h_tm
+00016f70: 312c 2063 5f74 6d31 203d 2074 6f72 6368  1, c_tm1 = torch
+00016f80: 2e74 656e 736f 7228 7829 2c20 746f 7263  .tensor(x), torc
+00016f90: 682e 7465 6e73 6f72 2868 5f74 6d31 292c  h.tensor(h_tm1),
+00016fa0: 2074 6f72 6368 2e74 656e 736f 7228 0a20   torch.tensor(. 
+00016fb0: 2020 2020 2020 2020 2020 2063 5f74 6d31             c_tm1
+00016fc0: 290a 0a20 2020 2020 2020 207a 203d 2074  )..        z = t
+00016fd0: 6f72 6368 2e6d 6174 6d75 6c28 782c 2073  orch.matmul(x, s
+00016fe0: 656c 662e 5729 202b 2074 6f72 6368 2e6d  elf.W) + torch.m
+00016ff0: 6174 6d75 6c28 685f 746d 312c 2073 656c  atmul(h_tm1, sel
+00017000: 662e 5529 202b 2073 656c 662e 620a 0a20  f.U) + self.b.. 
+00017010: 2020 2020 2020 207a 3020 3d20 7a5b 3a2c         z0 = z[:,
+00017020: 203a 7365 6c66 2e6f 7574 7075 745f 6469   :self.output_di
+00017030: 6d5d 0a20 2020 2020 2020 207a 3120 3d20  m].        z1 = 
+00017040: 7a5b 3a2c 2073 656c 662e 6f75 7470 7574  z[:, self.output
+00017050: 5f64 696d 3a32 202a 2073 656c 662e 6f75  _dim:2 * self.ou
+00017060: 7470 7574 5f64 696d 5d0a 2020 2020 2020  tput_dim].      
+00017070: 2020 7a32 203d 207a 5b3a 2c20 3220 2a20    z2 = z[:, 2 * 
+00017080: 7365 6c66 2e6f 7574 7075 745f 6469 6d3a  self.output_dim:
+00017090: 3320 2a20 7365 6c66 2e6f 7574 7075 745f  3 * self.output_
+000170a0: 6469 6d5d 0a20 2020 2020 2020 207a 3320  dim].        z3 
+000170b0: 3d20 7a5b 3a2c 2033 202a 2073 656c 662e  = z[:, 3 * self.
+000170c0: 6f75 7470 7574 5f64 696d 3a5d 0a0a 2020  output_dim:]..  
+000170d0: 2020 2020 2020 6920 3d20 7365 6c66 2e69        i = self.i
+000170e0: 6e6e 6572 5f61 6374 6976 6174 696f 6e5f  nner_activation_
+000170f0: 666e 287a 3029 0a20 2020 2020 2020 2066  fn(z0).        f
+00017100: 203d 2073 656c 662e 696e 6e65 725f 6163   = self.inner_ac
+00017110: 7469 7661 7469 6f6e 5f66 6e28 7a31 290a  tivation_fn(z1).
+00017120: 2020 2020 2020 2020 6320 3d20 6620 2a20          c = f * 
+00017130: 635f 746d 3120 2b20 6920 2a20 7365 6c66  c_tm1 + i * self
+00017140: 2e61 6374 6976 6174 696f 6e5f 666e 287a  .activation_fn(z
+00017150: 3229 0a20 2020 2020 2020 206f 203d 2073  2).        o = s
+00017160: 656c 662e 696e 6e65 725f 6163 7469 7661  elf.inner_activa
+00017170: 7469 6f6e 5f66 6e28 7a33 290a 0a20 2020  tion_fn(z3)..   
+00017180: 2020 2020 2068 203d 206f 202a 2073 656c       h = o * sel
+00017190: 662e 6163 7469 7661 7469 6f6e 5f66 6e28  f.activation_fn(
+000171a0: 6329 0a20 2020 2020 2020 2072 6574 7572  c).        retur
+000171b0: 6e20 682c 205b 682c 2063 5d0a 0a0a 636c  n h, [h, c]...cl
+000171c0: 6173 7320 4174 6f6d 6963 436f 6e76 6f6c  ass AtomicConvol
+000171d0: 7574 696f 6e28 6e6e 2e4d 6f64 756c 6529  ution(nn.Module)
+000171e0: 3a0a 2020 2020 2222 2249 6d70 6c65 6d65  :.    """Impleme
+000171f0: 6e74 7320 7468 6520 4174 6f6d 6963 2043  nts the Atomic C
+00017200: 6f6e 766f 6c75 7469 6f6e 616c 2074 7261  onvolutional tra
+00017210: 6e73 666f 726d 2c20 696e 7472 6f64 7563  nsform, introduc
+00017220: 6564 2069 6e0a 0a20 2020 2047 6f6d 6573  ed in..    Gomes
+00017230: 2c20 4a6f 7365 7068 2c20 6574 2061 6c2e  , Joseph, et al.
+00017240: 2022 4174 6f6d 6963 2063 6f6e 766f 6c75   "Atomic convolu
+00017250: 7469 6f6e 616c 206e 6574 776f 726b 7320  tional networks 
+00017260: 666f 7220 7072 6564 6963 7469 6e67 0a20  for predicting. 
+00017270: 2020 2070 726f 7465 696e 2d6c 6967 616e     protein-ligan
+00017280: 6420 6269 6e64 696e 6720 6166 6669 6e69  d binding affini
+00017290: 7479 2e22 2061 7258 6976 2070 7265 7072  ty." arXiv prepr
+000172a0: 696e 7420 6172 5869 763a 3137 3033 2e31  int arXiv:1703.1
+000172b0: 3036 3033 0a20 2020 2028 3230 3137 292e  0603.    (2017).
+000172c0: 0a0a 2020 2020 4174 2061 2068 6967 6820  ..    At a high 
+000172d0: 6c65 7665 6c2c 2074 6869 7320 7472 616e  level, this tran
+000172e0: 7366 6f72 6d20 7065 7266 6f72 6d73 2061  sform performs a
+000172f0: 2067 7261 7068 2063 6f6e 766f 6c75 7469   graph convoluti
+00017300: 6f6e 0a20 2020 206f 6e20 7468 6520 6e65  on.    on the ne
+00017310: 6172 6573 7420 6e65 6967 6862 6f72 7320  arest neighbors 
+00017320: 6772 6170 6820 696e 2033 4420 7370 6163  graph in 3D spac
+00017330: 652e 0a0a 2020 2020 4578 616d 706c 6573  e...    Examples
+00017340: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+00017350: 2020 3e3e 3e20 6261 7463 685f 7369 7a65    >>> batch_size
+00017360: 203d 2034 0a20 2020 203e 3e3e 206d 6178   = 4.    >>> max
+00017370: 5f61 746f 6d73 203d 2035 0a20 2020 203e  _atoms = 5.    >
+00017380: 3e3e 206d 6178 5f6e 6569 6768 626f 7273  >> max_neighbors
+00017390: 203d 2032 0a20 2020 203e 3e3e 2064 696d   = 2.    >>> dim
+000173a0: 656e 7369 6f6e 7320 3d20 330a 2020 2020  ensions = 3.    
+000173b0: 3e3e 3e20 7261 6469 616c 5f70 6172 616d  >>> radial_param
+000173c0: 7320 3d20 746f 7263 682e 7465 6e73 6f72  s = torch.tensor
+000173d0: 285b 5b35 2e30 2c20 322e 302c 2030 2e35  ([[5.0, 2.0, 0.5
+000173e0: 5d2c 205b 3130 2e30 2c20 322e 302c 2030  ], [10.0, 2.0, 0
+000173f0: 2e35 5d2c 0a20 2020 202e 2e2e 2020 2020  .5],.    ...    
 00017400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017410: 2020 2020 205b 352e 302c 2031 2e30 2c20       [5.0, 1.0, 
-00017420: 302e 325d 5d29 0a20 2020 203e 3e3e 2069  0.2]]).    >>> i
-00017430: 6e70 7574 3120 3d20 6e70 2e72 616e 646f  nput1 = np.rando
-00017440: 6d2e 7261 6e64 2862 6174 6368 5f73 697a  m.rand(batch_siz
-00017450: 652c 206d 6178 5f61 746f 6d73 2c20 6469  e, max_atoms, di
-00017460: 6d65 6e73 696f 6e73 292e 6173 7479 7065  mensions).astype
-00017470: 286e 702e 666c 6f61 7433 3229 0a20 2020  (np.float32).   
-00017480: 203e 3e3e 2069 6e70 7574 3220 3d20 6e70   >>> input2 = np
-00017490: 2e72 616e 646f 6d2e 7261 6e64 696e 7428  .random.randint(
-000174a0: 6d61 785f 6174 6f6d 732c 0a20 2020 202e  max_atoms,.    .
-000174b0: 2e2e 2020 2020 2020 2020 2020 2020 2020  ..              
-000174c0: 2020 2020 2020 2020 2020 2020 2020 7369                si
-000174d0: 7a65 3d28 6261 7463 685f 7369 7a65 2c20  ze=(batch_size, 
-000174e0: 6d61 785f 6174 6f6d 732c 206d 6178 5f6e  max_atoms, max_n
-000174f0: 6569 6768 626f 7273 2929 0a20 2020 203e  eighbors)).    >
-00017500: 3e3e 2069 6e70 7574 3320 3d20 6e70 2e72  >> input3 = np.r
-00017510: 616e 646f 6d2e 7261 6e64 696e 7428 312c  andom.randint(1,
-00017520: 2031 302c 2073 697a 653d 2862 6174 6368   10, size=(batch
-00017530: 5f73 697a 652c 206d 6178 5f61 746f 6d73  _size, max_atoms
-00017540: 2c20 6d61 785f 6e65 6967 6862 6f72 7329  , max_neighbors)
-00017550: 290a 2020 2020 3e3e 3e20 6c61 7965 7220  ).    >>> layer 
-00017560: 3d20 4174 6f6d 6963 436f 6e76 6f6c 7574  = AtomicConvolut
-00017570: 696f 6e28 7261 6469 616c 5f70 6172 616d  ion(radial_param
-00017580: 733d 7261 6469 616c 5f70 6172 616d 7329  s=radial_params)
-00017590: 0a20 2020 203e 3e3e 2072 6573 756c 7420  .    >>> result 
-000175a0: 3d20 6c61 7965 7228 5b69 6e70 7574 312c  = layer([input1,
-000175b0: 2069 6e70 7574 322c 2069 6e70 7574 335d   input2, input3]
-000175c0: 290a 2020 2020 3e3e 3e20 7265 7375 6c74  ).    >>> result
-000175d0: 2e73 6861 7065 0a20 2020 2074 6f72 6368  .shape.    torch
-000175e0: 2e53 697a 6528 5b34 2c20 352c 2033 5d29  .Size([4, 5, 3])
-000175f0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-00017600: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00017610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017620: 2020 6174 6f6d 5f74 7970 6573 3a20 4f70    atom_types: Op
-00017630: 7469 6f6e 616c 5b55 6e69 6f6e 5b41 7272  tional[Union[Arr
-00017640: 6179 4c69 6b65 2c20 746f 7263 682e 5465  ayLike, torch.Te
-00017650: 6e73 6f72 5d5d 203d 204e 6f6e 652c 0a20  nsor]] = None,. 
-00017660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017670: 7261 6469 616c 5f70 6172 616d 733a 2055  radial_params: U
-00017680: 6e69 6f6e 5b41 7272 6179 4c69 6b65 2c20  nion[ArrayLike, 
-00017690: 746f 7263 682e 5465 6e73 6f72 5d20 3d20  torch.Tensor] = 
-000176a0: 6c69 7374 2829 2c0a 2020 2020 2020 2020  list(),.        
-000176b0: 2020 2020 2020 2020 2062 6f78 5f73 697a           box_siz
-000176c0: 653a 204f 7074 696f 6e61 6c5b 556e 696f  e: Optional[Unio
-000176d0: 6e5b 4172 7261 794c 696b 652c 2074 6f72  n[ArrayLike, tor
-000176e0: 6368 2e54 656e 736f 725d 5d20 3d20 4e6f  ch.Tensor]] = No
-000176f0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00017700: 2020 2020 202a 2a6b 7761 7267 7329 3a0a       **kwargs):.
-00017710: 2020 2020 2020 2020 2222 2249 6e69 7469          """Initi
-00017720: 616c 697a 6520 7468 6973 206c 6179 6572  alize this layer
-00017730: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00017740: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00017750: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00017760: 2061 746f 6d5f 7479 7065 7320 3a20 556e   atom_types : Un
-00017770: 696f 6e5b 4172 7261 794c 696b 652c 2074  ion[ArrayLike, t
-00017780: 6f72 6368 2e54 656e 736f 725d 2c20 6f70  orch.Tensor], op
-00017790: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-000177a0: 2020 204c 6973 7420 6f66 2061 746f 6d20     List of atom 
-000177b0: 7479 7065 732e 0a20 2020 2020 2020 2072  types..        r
-000177c0: 6164 6961 6c5f 7061 7261 6d73 203a 2055  adial_params : U
-000177d0: 6e69 6f6e 5b41 7272 6179 4c69 6b65 2c20  nion[ArrayLike, 
-000177e0: 746f 7263 682e 5465 6e73 6f72 5d2c 206f  torch.Tensor], o
-000177f0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00017800: 2020 2020 4c69 7374 206f 6620 7261 6469      List of radi
-00017810: 616c 2070 6172 616d 732e 0a20 2020 2020  al params..     
-00017820: 2020 2062 6f78 5f73 697a 6520 3a20 556e     box_size : Un
-00017830: 696f 6e5b 4172 7261 794c 696b 652c 2074  ion[ArrayLike, t
-00017840: 6f72 6368 2e54 656e 736f 725d 2c20 6f70  orch.Tensor], op
-00017850: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00017860: 2020 204c 656e 6774 6820 6d75 7374 2062     Length must b
-00017870: 6520 6571 7561 6c20 746f 2074 6865 206e  e equal to the n
-00017880: 756d 6265 7220 6f66 2066 6561 7475 7265  umber of feature
-00017890: 732e 0a20 2020 2020 2020 2022 2222 0a0a  s..        """..
-000178a0: 2020 2020 2020 2020 7375 7065 7228 4174          super(At
-000178b0: 6f6d 6963 436f 6e76 6f6c 7574 696f 6e2c  omicConvolution,
-000178c0: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
-000178d0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-000178e0: 2020 7365 6c66 2e61 746f 6d5f 7479 7065    self.atom_type
-000178f0: 7320 3d20 6174 6f6d 5f74 7970 6573 0a20  s = atom_types. 
-00017900: 2020 2020 2020 2073 656c 662e 7261 6469         self.radi
-00017910: 616c 5f70 6172 616d 7320 3d20 7261 6469  al_params = radi
-00017920: 616c 5f70 6172 616d 730a 0a20 2020 2020  al_params..     
-00017930: 2020 2069 6620 626f 785f 7369 7a65 2069     if box_size i
-00017940: 7320 4e6f 6e65 206f 7220 6973 696e 7374  s None or isinst
-00017950: 616e 6365 2862 6f78 5f73 697a 652c 2074  ance(box_size, t
-00017960: 6f72 6368 2e54 656e 736f 7229 3a0a 2020  orch.Tensor):.  
-00017970: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
-00017980: 6f78 5f73 697a 6520 3d20 626f 785f 7369  ox_size = box_si
-00017990: 7a65 0a20 2020 2020 2020 2065 6c73 653a  ze.        else:
-000179a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000179b0: 662e 626f 785f 7369 7a65 203d 2074 6f72  f.box_size = tor
-000179c0: 6368 2e74 656e 736f 7228 626f 785f 7369  ch.tensor(box_si
-000179d0: 7a65 290a 0a20 2020 2020 2020 2076 6172  ze)..        var
-000179e0: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
-000179f0: 6f72 2069 2069 6e20 7261 6e67 6528 3329  or i in range(3)
-00017a00: 3a0a 2020 2020 2020 2020 2020 2020 7661  :.            va
-00017a10: 6c20 3d20 6e70 2e61 7272 6179 285b 705b  l = np.array([p[
-00017a20: 695d 2066 6f72 2070 2069 6e20 7365 6c66  i] for p in self
-00017a30: 2e72 6164 6961 6c5f 7061 7261 6d73 5d29  .radial_params])
-00017a40: 2e72 6573 6861 7065 280a 2020 2020 2020  .reshape(.      
-00017a50: 2020 2020 2020 2020 2020 282d 312c 2031            (-1, 1
-00017a60: 2c20 312c 2031 2929 0a20 2020 2020 2020  , 1, 1)).       
-00017a70: 2020 2020 2076 6172 732e 6170 7065 6e64       vars.append
-00017a80: 2874 6f72 6368 2e74 656e 736f 7228 7661  (torch.tensor(va
-00017a90: 6c2c 2064 7479 7065 3d74 6f72 6368 2e66  l, dtype=torch.f
-00017aa0: 6c6f 6174 2929 0a20 2020 2020 2020 2073  loat)).        s
-00017ab0: 656c 662e 7263 203d 206e 6e2e 5061 7261  elf.rc = nn.Para
-00017ac0: 6d65 7465 7228 7661 7273 5b30 5d29 0a20  meter(vars[0]). 
-00017ad0: 2020 2020 2020 2073 656c 662e 7273 203d         self.rs =
-00017ae0: 206e 6e2e 5061 7261 6d65 7465 7228 7661   nn.Parameter(va
-00017af0: 7273 5b31 5d29 0a20 2020 2020 2020 2073  rs[1]).        s
-00017b00: 656c 662e 7265 203d 206e 6e2e 5061 7261  elf.re = nn.Para
-00017b10: 6d65 7465 7228 7661 7273 5b32 5d29 0a0a  meter(vars[2])..
-00017b20: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
-00017b30: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00017b40: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-00017b50: 2020 2020 2066 277b 7365 6c66 2e5f 5f63       f'{self.__c
-00017b60: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-00017b70: 2861 746f 6d5f 7479 7065 733d 7b73 656c  (atom_types={sel
-00017b80: 662e 6174 6f6d 5f74 7970 6573 7d2c 2072  f.atom_types}, r
-00017b90: 6164 6961 6c5f 7061 7261 6d73 3d7b 7365  adial_params={se
-00017ba0: 6c66 2e72 6164 6961 6c5f 7061 7261 6d73  lf.radial_params
-00017bb0: 7d2c 2062 6f78 5f73 697a 653d 7b73 656c  }, box_size={sel
-00017bc0: 662e 626f 785f 7369 7a65 7d2c 2072 633d  f.box_size}, rc=
-00017bd0: 7b73 656c 662e 7263 7d2c 2072 733d 7b73  {self.rc}, rs={s
-00017be0: 656c 662e 7273 7d2c 2072 653d 7b73 656c  elf.rs}, re={sel
-00017bf0: 662e 7265 7d29 270a 2020 2020 2020 2020  f.re})'.        
-00017c00: 290a 0a20 2020 2064 6566 2066 6f72 7761  )..    def forwa
-00017c10: 7264 280a 2020 2020 2020 2020 2020 2020  rd(.            
-00017c20: 7365 6c66 2c20 696e 7075 7473 3a20 5365  self, inputs: Se
-00017c30: 7175 656e 6365 5b55 6e69 6f6e 5b41 7272  quence[Union[Arr
-00017c40: 6179 4c69 6b65 2c0a 2020 2020 2020 2020  ayLike,.        
+00017410: 2020 2020 2020 2020 2020 205b 352e 302c             [5.0,
+00017420: 2031 2e30 2c20 302e 325d 5d29 0a20 2020   1.0, 0.2]]).   
+00017430: 203e 3e3e 2069 6e70 7574 3120 3d20 6e70   >>> input1 = np
+00017440: 2e72 616e 646f 6d2e 7261 6e64 2862 6174  .random.rand(bat
+00017450: 6368 5f73 697a 652c 206d 6178 5f61 746f  ch_size, max_ato
+00017460: 6d73 2c20 6469 6d65 6e73 696f 6e73 292e  ms, dimensions).
+00017470: 6173 7479 7065 286e 702e 666c 6f61 7433  astype(np.float3
+00017480: 3229 0a20 2020 203e 3e3e 2069 6e70 7574  2).    >>> input
+00017490: 3220 3d20 6e70 2e72 616e 646f 6d2e 7261  2 = np.random.ra
+000174a0: 6e64 696e 7428 6d61 785f 6174 6f6d 732c  ndint(max_atoms,
+000174b0: 0a20 2020 202e 2e2e 2020 2020 2020 2020  .    ...        
+000174c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174d0: 2020 2020 7369 7a65 3d28 6261 7463 685f      size=(batch_
+000174e0: 7369 7a65 2c20 6d61 785f 6174 6f6d 732c  size, max_atoms,
+000174f0: 206d 6178 5f6e 6569 6768 626f 7273 2929   max_neighbors))
+00017500: 0a20 2020 203e 3e3e 2069 6e70 7574 3320  .    >>> input3 
+00017510: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
+00017520: 696e 7428 312c 2031 302c 2073 697a 653d  int(1, 10, size=
+00017530: 2862 6174 6368 5f73 697a 652c 206d 6178  (batch_size, max
+00017540: 5f61 746f 6d73 2c20 6d61 785f 6e65 6967  _atoms, max_neig
+00017550: 6862 6f72 7329 290a 2020 2020 3e3e 3e20  hbors)).    >>> 
+00017560: 6c61 7965 7220 3d20 4174 6f6d 6963 436f  layer = AtomicCo
+00017570: 6e76 6f6c 7574 696f 6e28 7261 6469 616c  nvolution(radial
+00017580: 5f70 6172 616d 733d 7261 6469 616c 5f70  _params=radial_p
+00017590: 6172 616d 7329 0a20 2020 203e 3e3e 2072  arams).    >>> r
+000175a0: 6573 756c 7420 3d20 6c61 7965 7228 5b69  esult = layer([i
+000175b0: 6e70 7574 312c 2069 6e70 7574 322c 2069  nput1, input2, i
+000175c0: 6e70 7574 335d 290a 2020 2020 3e3e 3e20  nput3]).    >>> 
+000175d0: 7265 7375 6c74 2e73 6861 7065 0a20 2020  result.shape.   
+000175e0: 2074 6f72 6368 2e53 697a 6528 5b34 2c20   torch.Size([4, 
+000175f0: 352c 2033 5d29 0a20 2020 2022 2222 0a0a  5, 3]).    """..
+00017600: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00017610: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
+00017620: 2020 2020 2020 2020 6174 6f6d 5f74 7970          atom_typ
+00017630: 6573 3a20 4f70 7469 6f6e 616c 5b55 6e69  es: Optional[Uni
+00017640: 6f6e 5b41 7272 6179 4c69 6b65 2c20 746f  on[ArrayLike, to
+00017650: 7263 682e 5465 6e73 6f72 5d5d 203d 204e  rch.Tensor]] = N
+00017660: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00017670: 2020 2020 2020 7261 6469 616c 5f70 6172        radial_par
+00017680: 616d 733a 2055 6e69 6f6e 5b41 7272 6179  ams: Union[Array
+00017690: 4c69 6b65 2c20 746f 7263 682e 5465 6e73  Like, torch.Tens
+000176a0: 6f72 5d20 3d20 6c69 7374 2829 2c0a 2020  or] = list(),.  
+000176b0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000176c0: 6f78 5f73 697a 653a 204f 7074 696f 6e61  ox_size: Optiona
+000176d0: 6c5b 556e 696f 6e5b 4172 7261 794c 696b  l[Union[ArrayLik
+000176e0: 652c 2074 6f72 6368 2e54 656e 736f 725d  e, torch.Tensor]
+000176f0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00017700: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
+00017710: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+00017720: 2249 6e69 7469 616c 697a 6520 7468 6973  "Initialize this
+00017730: 206c 6179 6572 2e0a 0a20 2020 2020 2020   layer...       
+00017740: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+00017750: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00017760: 2020 2020 2020 2061 746f 6d5f 7479 7065         atom_type
+00017770: 7320 3a20 556e 696f 6e5b 4172 7261 794c  s : Union[ArrayL
+00017780: 696b 652c 2074 6f72 6368 2e54 656e 736f  ike, torch.Tenso
+00017790: 725d 2c20 6f70 7469 6f6e 616c 0a20 2020  r], optional.   
+000177a0: 2020 2020 2020 2020 204c 6973 7420 6f66           List of
+000177b0: 2061 746f 6d20 7479 7065 732e 0a20 2020   atom types..   
+000177c0: 2020 2020 2072 6164 6961 6c5f 7061 7261       radial_para
+000177d0: 6d73 203a 2055 6e69 6f6e 5b41 7272 6179  ms : Union[Array
+000177e0: 4c69 6b65 2c20 746f 7263 682e 5465 6e73  Like, torch.Tens
+000177f0: 6f72 5d2c 206f 7074 696f 6e61 6c0a 2020  or], optional.  
+00017800: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
+00017810: 6620 7261 6469 616c 2070 6172 616d 732e  f radial params.
+00017820: 0a20 2020 2020 2020 2062 6f78 5f73 697a  .        box_siz
+00017830: 6520 3a20 556e 696f 6e5b 4172 7261 794c  e : Union[ArrayL
+00017840: 696b 652c 2074 6f72 6368 2e54 656e 736f  ike, torch.Tenso
+00017850: 725d 2c20 6f70 7469 6f6e 616c 0a20 2020  r], optional.   
+00017860: 2020 2020 2020 2020 204c 656e 6774 6820           Length 
+00017870: 6d75 7374 2062 6520 6571 7561 6c20 746f  must be equal to
+00017880: 2074 6865 206e 756d 6265 7220 6f66 2066   the number of f
+00017890: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
+000178a0: 2022 2222 0a0a 2020 2020 2020 2020 7375   """..        su
+000178b0: 7065 7228 4174 6f6d 6963 436f 6e76 6f6c  per(AtomicConvol
+000178c0: 7574 696f 6e2c 2073 656c 6629 2e5f 5f69  ution, self).__i
+000178d0: 6e69 745f 5f28 2a2a 6b77 6172 6773 290a  nit__(**kwargs).
+000178e0: 2020 2020 2020 2020 7365 6c66 2e61 746f          self.ato
+000178f0: 6d5f 7479 7065 7320 3d20 6174 6f6d 5f74  m_types = atom_t
+00017900: 7970 6573 0a20 2020 2020 2020 2073 656c  ypes.        sel
+00017910: 662e 7261 6469 616c 5f70 6172 616d 7320  f.radial_params 
+00017920: 3d20 7261 6469 616c 5f70 6172 616d 730a  = radial_params.
+00017930: 0a20 2020 2020 2020 2069 6620 626f 785f  .        if box_
+00017940: 7369 7a65 2069 7320 4e6f 6e65 206f 7220  size is None or 
+00017950: 6973 696e 7374 616e 6365 2862 6f78 5f73  isinstance(box_s
+00017960: 697a 652c 2074 6f72 6368 2e54 656e 736f  ize, torch.Tenso
+00017970: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00017980: 7365 6c66 2e62 6f78 5f73 697a 6520 3d20  self.box_size = 
+00017990: 626f 785f 7369 7a65 0a20 2020 2020 2020  box_size.       
+000179a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000179b0: 2020 2073 656c 662e 626f 785f 7369 7a65     self.box_size
+000179c0: 203d 2074 6f72 6368 2e74 656e 736f 7228   = torch.tensor(
+000179d0: 626f 785f 7369 7a65 290a 0a20 2020 2020  box_size)..     
+000179e0: 2020 2076 6172 7320 3d20 5b5d 0a20 2020     vars = [].   
+000179f0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00017a00: 6e67 6528 3329 3a0a 2020 2020 2020 2020  nge(3):.        
+00017a10: 2020 2020 7661 6c20 3d20 6e70 2e61 7272      val = np.arr
+00017a20: 6179 285b 705b 695d 2066 6f72 2070 2069  ay([p[i] for p i
+00017a30: 6e20 7365 6c66 2e72 6164 6961 6c5f 7061  n self.radial_pa
+00017a40: 7261 6d73 5d29 2e72 6573 6861 7065 280a  rams]).reshape(.
+00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a60: 282d 312c 2031 2c20 312c 2031 2929 0a20  (-1, 1, 1, 1)). 
+00017a70: 2020 2020 2020 2020 2020 2076 6172 732e             vars.
+00017a80: 6170 7065 6e64 2874 6f72 6368 2e74 656e  append(torch.ten
+00017a90: 736f 7228 7661 6c2c 2064 7479 7065 3d74  sor(val, dtype=t
+00017aa0: 6f72 6368 2e66 6c6f 6174 2929 0a20 2020  orch.float)).   
+00017ab0: 2020 2020 2073 656c 662e 7263 203d 206e       self.rc = n
+00017ac0: 6e2e 5061 7261 6d65 7465 7228 7661 7273  n.Parameter(vars
+00017ad0: 5b30 5d29 0a20 2020 2020 2020 2073 656c  [0]).        sel
+00017ae0: 662e 7273 203d 206e 6e2e 5061 7261 6d65  f.rs = nn.Parame
+00017af0: 7465 7228 7661 7273 5b31 5d29 0a20 2020  ter(vars[1]).   
+00017b00: 2020 2020 2073 656c 662e 7265 203d 206e       self.re = n
+00017b10: 6e2e 5061 7261 6d65 7465 7228 7661 7273  n.Parameter(vars
+00017b20: 5b32 5d29 0a0a 2020 2020 6465 6620 5f5f  [2])..    def __
+00017b30: 7265 7072 5f5f 2873 656c 6629 3a0a 2020  repr__(self):.  
+00017b40: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
+00017b50: 2020 2020 2020 2020 2020 2066 277b 7365             f'{se
+00017b60: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
+00017b70: 616d 655f 5f7d 2861 746f 6d5f 7479 7065  ame__}(atom_type
+00017b80: 733d 7b73 656c 662e 6174 6f6d 5f74 7970  s={self.atom_typ
+00017b90: 6573 7d2c 2072 6164 6961 6c5f 7061 7261  es}, radial_para
+00017ba0: 6d73 3d7b 7365 6c66 2e72 6164 6961 6c5f  ms={self.radial_
+00017bb0: 7061 7261 6d73 7d2c 2062 6f78 5f73 697a  params}, box_siz
+00017bc0: 653d 7b73 656c 662e 626f 785f 7369 7a65  e={self.box_size
+00017bd0: 7d2c 2072 633d 7b73 656c 662e 7263 7d2c  }, rc={self.rc},
+00017be0: 2072 733d 7b73 656c 662e 7273 7d2c 2072   rs={self.rs}, r
+00017bf0: 653d 7b73 656c 662e 7265 7d29 270a 2020  e={self.re})'.  
+00017c00: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00017c10: 2066 6f72 7761 7264 280a 2020 2020 2020   forward(.      
+00017c20: 2020 2020 2020 7365 6c66 2c20 696e 7075        self, inpu
+00017c30: 7473 3a20 5365 7175 656e 6365 5b55 6e69  ts: Sequence[Uni
+00017c40: 6f6e 5b41 7272 6179 4c69 6b65 2c0a 2020  on[ArrayLike,.  
 00017c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00017c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c70: 2074 6f72 6368 2e54 656e 736f 725d 5d29   torch.Tensor]])
-00017c80: 202d 3e20 746f 7263 682e 5465 6e73 6f72   -> torch.Tensor
-00017c90: 3a0a 2020 2020 2020 2020 2222 2249 6e76  :.        """Inv
-00017ca0: 6f6b 6520 7468 6973 206c 6179 6572 2e0a  oke this layer..
-00017cb0: 0a20 2020 2020 2020 2042 2c20 4e2c 204d  .        B, N, M
-00017cc0: 2c20 642c 206c 203d 2062 6174 6368 5f73  , d, l = batch_s
-00017cd0: 697a 652c 206d 6178 5f6e 756d 5f61 746f  ize, max_num_ato
-00017ce0: 6d73 2c20 6d61 785f 6e75 6d5f 6e65 6967  ms, max_num_neig
-00017cf0: 6862 6f72 732c 206e 756d 5f66 6561 7475  hbors, num_featu
-00017d00: 7265 732c 206c 656e 2872 6164 6961 6c5f  res, len(radial_
-00017d10: 7061 7261 6d73 2920 2a20 6c65 6e28 6174  params) * len(at
-00017d20: 6f6d 5f74 7970 6573 290a 0a20 2020 2020  om_types)..     
-00017d30: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00017d40: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00017d50: 0a20 2020 2020 2020 2069 6e70 7574 733a  .        inputs:
-00017d60: 2053 6571 7565 6e63 655b 556e 696f 6e5b   Sequence[Union[
-00017d70: 4172 7261 794c 696b 652c 2074 6f72 6368  ArrayLike, torch
-00017d80: 2e54 656e 736f 725d 5d0a 2020 2020 2020  .Tensor]].      
-00017d90: 2020 2020 2020 4669 7273 7420 696e 7075        First inpu
-00017da0: 7420 6172 6520 7468 6520 636f 6f72 6469  t are the coordi
-00017db0: 6e61 7465 732f 6665 6174 7572 6573 2c20  nates/features, 
-00017dc0: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
-00017dd0: 6429 0a20 2020 2020 2020 2020 2020 2053  d).            S
-00017de0: 6563 6f6e 6420 696e 7075 7420 6973 2074  econd input is t
-00017df0: 6865 206e 6569 6768 626f 7220 6c69 7374  he neighbor list
-00017e00: 2c20 6f66 2073 6861 7065 2028 422c 204e  , of shape (B, N
-00017e10: 2c20 4d29 0a20 2020 2020 2020 2020 2020  , M).           
-00017e20: 2054 6869 7264 2069 6e70 7574 2061 7265   Third input are
-00017e30: 2074 6865 2061 746f 6d69 6320 6e75 6d62   the atomic numb
-00017e40: 6572 7320 6f66 206e 6569 6768 626f 7220  ers of neighbor 
-00017e50: 6174 6f6d 732c 206f 6620 7368 6170 6520  atoms, of shape 
-00017e60: 2842 2c20 4e2c 204d 290a 0a20 2020 2020  (B, N, M)..     
-00017e70: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-00017e80: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-00017e90: 2020 2074 6f72 6368 2e54 656e 736f 7220     torch.Tensor 
-00017ea0: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
-00017eb0: 6c29 0a20 2020 2020 2020 2020 2020 204f  l).            O
-00017ec0: 7574 7075 7420 6f66 2061 746f 6d69 6320  utput of atomic 
-00017ed0: 636f 6e76 6f6c 7574 696f 6e20 6c61 7965  convolution laye
-00017ee0: 722e 0a0a 2020 2020 2020 2020 5261 6973  r...        Rais
-00017ef0: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
-00017f00: 2d0a 2020 2020 2020 2020 5661 6c75 6545  -.        ValueE
-00017f10: 7272 6f72 0a20 2020 2020 2020 2020 2020  rror.           
-00017f20: 2057 6865 6e20 7468 6520 6c65 6e67 7468   When the length
-00017f30: 206f 6620 6069 6e70 7574 7360 2069 7320   of `inputs` is 
-00017f40: 6e6f 7420 6571 7561 6c20 746f 2033 2e0a  not equal to 3..
-00017f50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00017f60: 2020 2020 6966 206c 656e 2869 6e70 7574      if len(input
-00017f70: 7329 2021 3d20 333a 0a20 2020 2020 2020  s) != 3:.       
-00017f80: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00017f90: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00017fa0: 2020 2020 2020 2066 2260 696e 7075 7473         f"`inputs
-00017fb0: 6020 6861 7320 746f 2062 6520 6f66 206c  ` has to be of l
-00017fc0: 656e 6774 6820 332c 2067 6f74 3a20 7b6c  ength 3, got: {l
-00017fd0: 656e 2869 6e70 7574 7329 7d22 290a 0a20  en(inputs)}").. 
-00017fe0: 2020 2020 2020 2058 203d 2074 6f72 6368         X = torch
-00017ff0: 2e74 656e 736f 7228 696e 7075 7473 5b30  .tensor(inputs[0
-00018000: 5d29 0a20 2020 2020 2020 204e 6272 7320  ]).        Nbrs 
-00018010: 3d20 746f 7263 682e 7465 6e73 6f72 2869  = torch.tensor(i
-00018020: 6e70 7574 735b 315d 2c20 6474 7970 653d  nputs[1], dtype=
-00018030: 746f 7263 682e 696e 7436 3429 0a20 2020  torch.int64).   
-00018040: 2020 2020 204e 6272 735f 5a20 3d20 746f       Nbrs_Z = to
-00018050: 7263 682e 7465 6e73 6f72 2869 6e70 7574  rch.tensor(input
-00018060: 735b 325d 290a 0a20 2020 2020 2020 2042  s[2])..        B
-00018070: 2c20 4e2c 2064 203d 2058 2e73 6861 7065  , N, d = X.shape
-00018080: 0a20 2020 2020 2020 204d 203d 204e 6272  .        M = Nbr
-00018090: 732e 7368 6170 655b 2d31 5d0a 0a20 2020  s.shape[-1]..   
-000180a0: 2020 2020 2044 203d 2073 656c 662e 6469       D = self.di
-000180b0: 7374 616e 6365 5f74 656e 736f 7228 582c  stance_tensor(X,
-000180c0: 204e 6272 732c 2073 656c 662e 626f 785f   Nbrs, self.box_
-000180d0: 7369 7a65 2c20 422c 204e 2c20 4d2c 2064  size, B, N, M, d
-000180e0: 290a 2020 2020 2020 2020 5220 3d20 7365  ).        R = se
-000180f0: 6c66 2e64 6973 7461 6e63 655f 6d61 7472  lf.distance_matr
-00018100: 6978 2844 290a 2020 2020 2020 2020 5220  ix(D).        R 
-00018110: 3d20 746f 7263 682e 756e 7371 7565 657a  = torch.unsqueez
-00018120: 6528 522c 2030 290a 2020 2020 2020 2020  e(R, 0).        
-00018130: 7273 6620 3d20 7365 6c66 2e72 6164 6961  rsf = self.radia
-00018140: 6c5f 7379 6d6d 6574 7279 5f66 756e 6374  l_symmetry_funct
-00018150: 696f 6e28 522c 2073 656c 662e 7263 2c20  ion(R, self.rc, 
-00018160: 7365 6c66 2e72 732c 2073 656c 662e 7265  self.rs, self.re
-00018170: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00018180: 7420 7365 6c66 2e61 746f 6d5f 7479 7065  t self.atom_type
-00018190: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-000181a0: 6f6e 6420 3d20 746f 7263 682e 6e6f 745f  ond = torch.not_
-000181b0: 6571 7561 6c28 4e62 7273 5f5a 2c20 3029  equal(Nbrs_Z, 0)
-000181c0: 2e74 6f28 746f 7263 682e 666c 6f61 7429  .to(torch.float)
-000181d0: 2e72 6573 6861 7065 280a 2020 2020 2020  .reshape(.      
-000181e0: 2020 2020 2020 2020 2020 2831 2c20 2d31            (1, -1
-000181f0: 2c20 4e2c 204d 2929 0a20 2020 2020 2020  , N, M)).       
-00018200: 2020 2020 206c 6179 6572 203d 2074 6f72       layer = tor
-00018210: 6368 2e73 756d 2863 6f6e 6420 2a20 7273  ch.sum(cond * rs
-00018220: 662c 2033 290a 2020 2020 2020 2020 656c  f, 3).        el
-00018230: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00018240: 2320 5375 6d20 7468 6520 7061 6972 7769  # Sum the pairwi
-00018250: 7365 2d69 6e74 6572 6163 7469 6f6e 7320  se-interactions 
-00018260: 6265 7477 6565 6e20 6174 6f6d 7320 7468  between atoms th
-00018270: 6174 2061 7265 206f 6620 6061 746f 6d5f  at are of `atom_
-00018280: 7479 7065 6020 616e 6420 6974 7320 6e65  type` and its ne
-00018290: 6967 6862 6f72 7320 666f 7220 6561 6368  ighbors for each
-000182a0: 2061 746f 6d20 7479 7065 2069 6e20 6061   atom type in `a
-000182b0: 746f 6d5f 7479 7065 7360 2e0a 2020 2020  tom_types`..    
-000182c0: 2020 2020 2020 2020 7379 6d6d 6574 7269          symmetri
-000182d0: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
-000182e0: 2020 2020 666f 7220 6174 6f6d 5f74 7970      for atom_typ
-000182f0: 6520 696e 2073 656c 662e 6174 6f6d 5f74  e in self.atom_t
-00018300: 7970 6573 3a0a 2020 2020 2020 2020 2020  ypes:.          
-00018310: 2020 2020 2020 636f 6e64 203d 2074 6f72        cond = tor
-00018320: 6368 2e65 7128 4e62 7273 5f5a 2c20 6174  ch.eq(Nbrs_Z, at
-00018330: 6f6d 5f74 7970 6529 2e74 6f28 746f 7263  om_type).to(torc
-00018340: 682e 666c 6f61 7429 2e72 6573 6861 7065  h.float).reshape
-00018350: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00018360: 2020 2020 2020 2831 2c20 2d31 2c20 4e2c        (1, -1, N,
-00018370: 204d 2929 0a20 2020 2020 2020 2020 2020   M)).           
-00018380: 2020 2020 2073 796d 6d65 7472 6965 732e       symmetries.
-00018390: 6170 7065 6e64 2874 6f72 6368 2e73 756d  append(torch.sum
-000183a0: 2863 6f6e 6420 2a20 7273 662c 2033 2929  (cond * rsf, 3))
-000183b0: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-000183c0: 6572 203d 2074 6f72 6368 2e63 6f6e 6361  er = torch.conca
-000183d0: 7428 7379 6d6d 6574 7269 6573 2c20 3029  t(symmetries, 0)
-000183e0: 0a0a 2020 2020 2020 2020 6c61 7965 7220  ..        layer 
-000183f0: 3d20 746f 7263 682e 7065 726d 7574 6528  = torch.permute(
-00018400: 6c61 7965 722c 205b 312c 2032 2c20 305d  layer, [1, 2, 0]
-00018410: 290a 2020 2020 2020 2020 7661 722c 206d  ).        var, m
-00018420: 6561 6e20 3d20 746f 7263 682e 7661 725f  ean = torch.var_
-00018430: 6d65 616e 286c 6179 6572 2c20 5b30 2c20  mean(layer, [0, 
-00018440: 325d 290a 2020 2020 2020 2020 7661 722c  2]).        var,
-00018450: 206d 6561 6e20 3d20 7661 722e 6465 7461   mean = var.deta
-00018460: 6368 2829 2c20 6d65 616e 2e64 6574 6163  ch(), mean.detac
-00018470: 6828 290a 0a20 2020 2020 2020 2072 6574  h()..        ret
-00018480: 7572 6e20 462e 6261 7463 685f 6e6f 726d  urn F.batch_norm
-00018490: 286c 6179 6572 2c20 6d65 616e 2c20 7661  (layer, mean, va
-000184a0: 7229 0a0a 2020 2020 6465 6620 6469 7374  r)..    def dist
-000184b0: 616e 6365 5f74 656e 736f 7228 7365 6c66  ance_tensor(self
-000184c0: 2c20 583a 2074 6f72 6368 2e54 656e 736f  , X: torch.Tenso
-000184d0: 722c 204e 6272 733a 2074 6f72 6368 2e54  r, Nbrs: torch.T
-000184e0: 656e 736f 722c 0a20 2020 2020 2020 2020  ensor,.         
-000184f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00018500: 6f78 5f73 697a 653a 2055 6e69 6f6e 5b74  ox_size: Union[t
-00018510: 6f72 6368 2e54 656e 736f 722c 204e 6f6e  orch.Tensor, Non
-00018520: 655d 2c20 423a 2069 6e74 2c20 4e3a 2069  e], B: int, N: i
-00018530: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-00018540: 2020 2020 2020 2020 2020 2020 4d3a 2069              M: i
-00018550: 6e74 2c20 643a 2069 6e74 2920 2d3e 2074  nt, d: int) -> t
-00018560: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
-00018570: 2020 2020 2022 2222 4361 6c63 756c 6174       """Calculat
-00018580: 6520 6469 7374 616e 6365 2074 656e 736f  e distance tenso
-00018590: 7220 666f 7220 6120 6261 7463 6820 6f66  r for a batch of
-000185a0: 206d 6f6c 6563 756c 6573 2e0a 0a20 2020   molecules...   
-000185b0: 2020 2020 2042 2c20 4e2c 204d 2c20 6420       B, N, M, d 
-000185c0: 3d20 6261 7463 685f 7369 7a65 2c20 6d61  = batch_size, ma
-000185d0: 785f 6e75 6d5f 6174 6f6d 732c 206d 6178  x_num_atoms, max
-000185e0: 5f6e 756d 5f6e 6569 6768 626f 7273 2c20  _num_neighbors, 
-000185f0: 6e75 6d5f 6665 6174 7572 6573 0a0a 2020  num_features..  
-00018600: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00018610: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00018620: 2d2d 2d0a 2020 2020 2020 2020 5820 3a20  ---.        X : 
-00018630: 746f 7263 682e 5465 6e73 6f72 206f 6620  torch.Tensor of 
-00018640: 7368 6170 6520 2842 2c20 4e2c 2064 290a  shape (B, N, d).
-00018650: 2020 2020 2020 2020 2020 2020 436f 6f72              Coor
-00018660: 6469 6e61 7465 732f 6665 6174 7572 6573  dinates/features
-00018670: 2e0a 2020 2020 2020 2020 4e62 7273 203a  ..        Nbrs :
-00018680: 2074 6f72 6368 2e54 656e 736f 7220 6f66   torch.Tensor of
-00018690: 2073 6861 7065 2028 422c 204e 2c20 4d29   shape (B, N, M)
-000186a0: 0a20 2020 2020 2020 2020 2020 204e 6569  .            Nei
-000186b0: 6768 626f 7220 6c69 7374 2e0a 2020 2020  ghbor list..    
-000186c0: 2020 2020 626f 785f 7369 7a65 203a 2074      box_size : t
-000186d0: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
-000186e0: 2020 2020 2020 2020 4c65 6e67 7468 206d          Length m
-000186f0: 7573 7420 6265 2065 7175 616c 2074 6f20  ust be equal to 
-00018700: 6064 602e 0a20 2020 2020 2020 2042 203a  `d`..        B :
-00018710: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-00018720: 2042 6174 6368 2073 697a 650a 2020 2020   Batch size.    
-00018730: 2020 2020 4e20 3a20 696e 740a 2020 2020      N : int.    
-00018740: 2020 2020 2020 2020 4d61 7869 6d75 6d20          Maximum 
-00018750: 6e75 6d62 6572 206f 6620 6174 6f6d 730a  number of atoms.
-00018760: 2020 2020 2020 2020 4d20 3a20 696e 740a          M : int.
-00018770: 2020 2020 2020 2020 2020 2020 4d61 7869              Maxi
-00018780: 6d75 6d20 6e75 6d62 6572 206f 6620 6e65  mum number of ne
-00018790: 6967 6862 6f72 730a 2020 2020 2020 2020  ighbors.        
-000187a0: 6420 3a20 696e 740a 2020 2020 2020 2020  d : int.        
-000187b0: 2020 2020 4e75 6d62 6572 206f 6620 6665      Number of fe
-000187c0: 6174 7572 6573 0a0a 2020 2020 2020 2020  atures..        
-000187d0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-000187e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-000187f0: 746f 7263 682e 5465 6e73 6f72 206f 6620  torch.Tensor of 
-00018800: 7368 6170 6520 2842 2c20 4e2c 204d 2c20  shape (B, N, M, 
-00018810: 6429 0a20 2020 2020 2020 2020 2020 2043  d).            C
-00018820: 6f6f 7264 696e 6174 6573 2f66 6561 7475  oordinates/featu
-00018830: 7265 7320 6469 7374 616e 6365 2074 656e  res distance ten
-00018840: 736f 722e 0a0a 2020 2020 2020 2020 5261  sor...        Ra
-00018850: 6973 6573 0a20 2020 2020 2020 202d 2d2d  ises.        ---
-00018860: 2d2d 2d0a 2020 2020 2020 2020 5661 6c75  ---.        Valu
-00018870: 6545 7272 6f72 0a20 2020 2020 2020 2020  eError.         
-00018880: 2020 2057 6865 6e20 7468 6520 6c65 6e67     When the leng
-00018890: 7468 206f 6620 6062 6f78 5f73 697a 6560  th of `box_size`
-000188a0: 2069 7320 6e6f 7420 6571 7561 6c20 746f   is not equal to
-000188b0: 2060 6460 2e0a 2020 2020 2020 2020 2222   `d`..        ""
-000188c0: 220a 2020 2020 2020 2020 6966 2062 6f78  ".        if box
-000188d0: 5f73 697a 6520 6973 206e 6f74 204e 6f6e  _size is not Non
-000188e0: 6520 616e 6420 6c65 6e28 626f 785f 7369  e and len(box_si
-000188f0: 7a65 2920 213d 2064 3a0a 2020 2020 2020  ze) != d:.      
-00018900: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00018910: 6545 7272 6f72 2822 4c65 6e67 7468 206f  eError("Length o
-00018920: 6620 6062 6f78 5f73 697a 6560 206d 7573  f `box_size` mus
-00018930: 7420 6265 2065 7175 616c 2074 6f20 6064  t be equal to `d
-00018940: 6022 290a 0a20 2020 2020 2020 2066 6c61  `")..        fla
-00018950: 745f 6e65 6967 6862 6f72 7320 3d20 746f  t_neighbors = to
-00018960: 7263 682e 7265 7368 6170 6528 4e62 7273  rch.reshape(Nbrs
-00018970: 2c20 282d 312c 204e 202a 204d 2929 0a20  , (-1, N * M)). 
-00018980: 2020 2020 2020 206e 6569 6768 626f 725f         neighbor_
-00018990: 636f 6f72 6473 203d 2074 6f72 6368 2e73  coords = torch.s
-000189a0: 7461 636b 280a 2020 2020 2020 2020 2020  tack(.          
-000189b0: 2020 5b58 5b62 2c20 666c 6174 5f6e 6569    [X[b, flat_nei
-000189c0: 6768 626f 7273 5b62 5d5d 2066 6f72 2062  ghbors[b]] for b
-000189d0: 2069 6e20 7261 6e67 6528 4229 5d29 0a20   in range(B)]). 
-000189e0: 2020 2020 2020 206e 6569 6768 626f 725f         neighbor_
-000189f0: 636f 6f72 6473 203d 2074 6f72 6368 2e72  coords = torch.r
-00018a00: 6573 6861 7065 286e 6569 6768 626f 725f  eshape(neighbor_
-00018a10: 636f 6f72 6473 2c20 282d 312c 204e 2c20  coords, (-1, N, 
-00018a20: 4d2c 2064 2929 0a20 2020 2020 2020 2044  M, d)).        D
-00018a30: 203d 206e 6569 6768 626f 725f 636f 6f72   = neighbor_coor
-00018a40: 6473 202d 2074 6f72 6368 2e75 6e73 7175  ds - torch.unsqu
-00018a50: 6565 7a65 2858 2c20 3229 0a20 2020 2020  eeze(X, 2).     
-00018a60: 2020 2069 6620 626f 785f 7369 7a65 2069     if box_size i
-00018a70: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00018a80: 2020 2020 2020 2020 626f 785f 7369 7a65          box_size
-00018a90: 203d 2074 6f72 6368 2e72 6573 6861 7065   = torch.reshape
-00018aa0: 2862 6f78 5f73 697a 652c 2028 312c 2031  (box_size, (1, 1
-00018ab0: 2c20 312c 2064 2929 0a20 2020 2020 2020  , 1, d)).       
-00018ac0: 2020 2020 2044 202d 3d20 746f 7263 682e       D -= torch.
-00018ad0: 726f 756e 6428 4420 2f20 626f 785f 7369  round(D / box_si
-00018ae0: 7a65 2920 2a20 626f 785f 7369 7a65 0a0a  ze) * box_size..
-00018af0: 2020 2020 2020 2020 7265 7475 726e 2044          return D
-00018b00: 0a0a 2020 2020 6465 6620 6469 7374 616e  ..    def distan
-00018b10: 6365 5f6d 6174 7269 7828 7365 6c66 2c20  ce_matrix(self, 
-00018b20: 443a 2074 6f72 6368 2e54 656e 736f 7229  D: torch.Tensor)
-00018b30: 202d 3e20 746f 7263 682e 5465 6e73 6f72   -> torch.Tensor
-00018b40: 3a0a 2020 2020 2020 2020 2222 2243 616c  :.        """Cal
-00018b50: 6375 6c61 7465 2061 2064 6973 7461 6e63  culate a distanc
-00018b60: 6520 6d61 7472 6978 2c20 6769 7665 6e20  e matrix, given 
-00018b70: 6120 6469 7374 616e 6365 2074 656e 736f  a distance tenso
-00018b80: 722e 0a0a 2020 2020 2020 2020 422c 204e  r...        B, N
-00018b90: 2c20 4d2c 2064 203d 2062 6174 6368 5f73  , M, d = batch_s
-00018ba0: 697a 652c 206d 6178 5f6e 756d 5f61 746f  ize, max_num_ato
-00018bb0: 6d73 2c20 6d61 785f 6e75 6d5f 6e65 6967  ms, max_num_neig
-00018bc0: 6862 6f72 732c 206e 756d 5f66 6561 7475  hbors, num_featu
-00018bd0: 7265 730a 0a20 2020 2020 2020 2050 6172  res..        Par
-00018be0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00018bf0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00018c00: 2020 2044 203a 2074 6f72 6368 2e54 656e     D : torch.Ten
-00018c10: 736f 7220 6f66 2073 6861 7065 2028 422c  sor of shape (B,
-00018c20: 204e 2c20 4d2c 2064 290a 2020 2020 2020   N, M, d).      
-00018c30: 2020 2020 2020 4469 7374 616e 6365 2074        Distance t
-00018c40: 656e 736f 720a 0a20 2020 2020 2020 2052  ensor..        R
-00018c50: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-00018c60: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2074  ------.        t
-00018c70: 6f72 6368 2e54 656e 736f 7220 6f66 2073  orch.Tensor of s
-00018c80: 6861 7065 2028 422c 204e 2c20 4d29 0a20  hape (B, N, M). 
-00018c90: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
-00018ca0: 6e63 6520 6d61 7472 6978 2e0a 2020 2020  nce matrix..    
-00018cb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00018cc0: 7265 7475 726e 2074 6f72 6368 2e73 7172  return torch.sqr
-00018cd0: 7428 746f 7263 682e 7375 6d28 746f 7263  t(torch.sum(torc
-00018ce0: 682e 6d75 6c28 442c 2044 292c 2033 2929  h.mul(D, D), 3))
-00018cf0: 0a0a 2020 2020 6465 6620 6761 7573 7369  ..    def gaussi
-00018d00: 616e 5f64 6973 7461 6e63 655f 6d61 7472  an_distance_matr
-00018d10: 6978 2873 656c 662c 2052 3a20 746f 7263  ix(self, R: torc
-00018d20: 682e 5465 6e73 6f72 2c20 7273 3a20 746f  h.Tensor, rs: to
-00018d30: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
-00018d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d50: 2020 2020 2020 2020 2020 2020 2072 653a               re:
-00018d60: 2074 6f72 6368 2e54 656e 736f 7229 202d   torch.Tensor) -
-00018d70: 3e20 746f 7263 682e 5465 6e73 6f72 3a0a  > torch.Tensor:.
-00018d80: 2020 2020 2020 2020 2222 2243 616c 6375          """Calcu
-00018d90: 6c61 7465 2061 2047 6175 7373 6961 6e20  late a Gaussian 
-00018da0: 6469 7374 616e 6365 206d 6174 7269 782e  distance matrix.
-00018db0: 0a0a 2020 2020 2020 2020 422c 204e 2c20  ..        B, N, 
-00018dc0: 4d2c 206c 203d 2062 6174 6368 5f73 697a  M, l = batch_siz
-00018dd0: 652c 206d 6178 5f6e 756d 5f61 746f 6d73  e, max_num_atoms
-00018de0: 2c20 6d61 785f 6e75 6d5f 6e65 6967 6862  , max_num_neighb
-00018df0: 6f72 732c 206c 656e 2872 6164 6961 6c5f  ors, len(radial_
-00018e00: 7061 7261 6d73 290a 0a20 2020 2020 2020  params)..       
-00018e10: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00018e20: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00018e30: 2020 2020 2020 2052 203a 2074 6f72 6368         R : torch
-00018e40: 2e54 656e 736f 7220 6f66 2073 6861 7065  .Tensor of shape
-00018e50: 2028 422c 204e 2c20 4d29 0a20 2020 2020   (B, N, M).     
-00018e60: 2020 2020 2020 2044 6973 7461 6e63 6520         Distance 
-00018e70: 6d61 7472 6978 2e0a 2020 2020 2020 2020  matrix..        
-00018e80: 7273 203a 2074 6f72 6368 2e54 656e 736f  rs : torch.Tenso
-00018e90: 7220 6f66 2073 6861 7065 2028 6c2c 2031  r of shape (l, 1
-00018ea0: 2c20 312c 2031 290a 2020 2020 2020 2020  , 1, 1).        
-00018eb0: 2020 2020 4761 7573 7369 616e 2064 6973      Gaussian dis
-00018ec0: 7461 6e63 6520 6d61 7472 6978 206d 6561  tance matrix mea
-00018ed0: 6e2e 0a20 2020 2020 2020 2072 6520 3a20  n..        re : 
-00018ee0: 746f 7263 682e 5465 6e73 6f72 206f 6620  torch.Tensor of 
-00018ef0: 7368 6170 6520 286c 2c20 312c 2031 2c20  shape (l, 1, 1, 
-00018f00: 3129 0a20 2020 2020 2020 2020 2020 2047  1).            G
-00018f10: 6175 7373 6961 6e20 6469 7374 616e 6365  aussian distance
-00018f20: 206d 6174 7269 7820 7769 6474 682e 0a0a   matrix width...
-00018f30: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-00018f40: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00018f50: 2020 2020 2020 2020 746f 7263 682e 5465          torch.Te
-00018f60: 6e73 6f72 206f 6620 7368 6170 6520 2842  nsor of shape (B
-00018f70: 2c20 4e2c 204d 290a 2020 2020 2020 2020  , N, M).        
-00018f80: 2020 2020 4761 7573 7369 616e 2064 6973      Gaussian dis
-00018f90: 7461 6e63 6520 6d61 7472 6978 2e0a 2020  tance matrix..  
-00018fa0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00018fb0: 2020 7265 7475 726e 2074 6f72 6368 2e65    return torch.e
-00018fc0: 7870 282d 7265 202a 2028 5220 2d20 7273  xp(-re * (R - rs
-00018fd0: 292a 2a32 290a 0a20 2020 2064 6566 2072  )**2)..    def r
-00018fe0: 6164 6961 6c5f 6375 746f 6666 2873 656c  adial_cutoff(sel
-00018ff0: 662c 2052 3a20 746f 7263 682e 5465 6e73  f, R: torch.Tens
-00019000: 6f72 2c20 7263 3a20 746f 7263 682e 5465  or, rc: torch.Te
-00019010: 6e73 6f72 2920 2d3e 2074 6f72 6368 2e54  nsor) -> torch.T
-00019020: 656e 736f 723a 0a20 2020 2020 2020 2022  ensor:.        "
-00019030: 2222 4361 6c63 756c 6174 6520 6120 7261  ""Calculate a ra
-00019040: 6469 616c 2063 7574 2d6f 6666 206d 6174  dial cut-off mat
-00019050: 7269 782e 0a0a 2020 2020 2020 2020 422c  rix...        B,
-00019060: 204e 2c20 4d2c 206c 203d 2062 6174 6368   N, M, l = batch
-00019070: 5f73 697a 652c 206d 6178 5f6e 756d 5f61  _size, max_num_a
-00019080: 746f 6d73 2c20 6d61 785f 6e75 6d5f 6e65  toms, max_num_ne
-00019090: 6967 6862 6f72 732c 206c 656e 2872 6164  ighbors, len(rad
-000190a0: 6961 6c5f 7061 7261 6d73 290a 0a20 2020  ial_params)..   
-000190b0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-000190c0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000190d0: 2d2d 0a20 2020 2020 2020 2052 203a 2074  --.        R : t
-000190e0: 6f72 6368 2e54 656e 736f 7220 6f66 2073  orch.Tensor of s
-000190f0: 6861 7065 2028 422c 204e 2c20 4d29 0a20  hape (B, N, M). 
-00019100: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
-00019110: 6e63 6520 6d61 7472 6978 2e0a 2020 2020  nce matrix..    
-00019120: 2020 2020 7263 203a 2074 6f72 6368 2e54      rc : torch.T
-00019130: 656e 736f 7220 6f66 2073 6861 7065 2028  ensor of shape (
-00019140: 6c2c 2031 2c20 312c 2031 290a 2020 2020  l, 1, 1, 1).    
-00019150: 2020 2020 2020 2020 496e 7465 7261 6374          Interact
-00019160: 696f 6e20 6375 746f 6666 2028 696e 2061  ion cutoff (in a
-00019170: 6e67 7374 726f 6d29 2e0a 0a20 2020 2020  ngstrom)...     
-00019180: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-00019190: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-000191a0: 2020 2074 6f72 6368 2e54 656e 736f 7220     torch.Tensor 
-000191b0: 6f66 2073 6861 7065 2028 422c 204e 2c20  of shape (B, N, 
-000191c0: 4d29 0a20 2020 2020 2020 2020 2020 2052  M).            R
-000191d0: 6164 6961 6c20 6375 746f 6666 206d 6174  adial cutoff mat
-000191e0: 7269 782e 0a20 2020 2020 2020 2022 2222  rix..        """
-000191f0: 0a20 2020 2020 2020 2054 203d 2030 2e35  .        T = 0.5
-00019200: 202a 2028 746f 7263 682e 636f 7328 6e70   * (torch.cos(np
-00019210: 2e70 6920 2a20 5220 2f20 7263 2920 2b20  .pi * R / rc) + 
-00019220: 3129 0a20 2020 2020 2020 2045 203d 2074  1).        E = t
-00019230: 6f72 6368 2e7a 6572 6f73 5f6c 696b 6528  orch.zeros_like(
-00019240: 5429 0a20 2020 2020 2020 2063 6f6e 6420  T).        cond 
-00019250: 3d20 746f 7263 682e 6c65 7373 5f65 7175  = torch.less_equ
-00019260: 616c 2852 2c20 7263 290a 2020 2020 2020  al(R, rc).      
-00019270: 2020 4643 203d 2074 6f72 6368 2e77 6865    FC = torch.whe
-00019280: 7265 2863 6f6e 642c 2054 2c20 4529 0a0a  re(cond, T, E)..
-00019290: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000192a0: 430a 0a20 2020 2064 6566 2072 6164 6961  C..    def radia
-000192b0: 6c5f 7379 6d6d 6574 7279 5f66 756e 6374  l_symmetry_funct
-000192c0: 696f 6e28 7365 6c66 2c20 523a 2074 6f72  ion(self, R: tor
-000192d0: 6368 2e54 656e 736f 722c 2072 633a 2074  ch.Tensor, rc: t
-000192e0: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
-000192f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019300: 2020 2020 2020 2020 2020 2020 2020 7273                rs
-00019310: 3a20 746f 7263 682e 5465 6e73 6f72 2c0a  : torch.Tensor,.
-00019320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c70: 2020 2020 2020 2074 6f72 6368 2e54 656e         torch.Ten
+00017c80: 736f 725d 5d29 202d 3e20 746f 7263 682e  sor]]) -> torch.
+00017c90: 5465 6e73 6f72 3a0a 2020 2020 2020 2020  Tensor:.        
+00017ca0: 2222 2249 6e76 6f6b 6520 7468 6973 206c  """Invoke this l
+00017cb0: 6179 6572 2e0a 0a20 2020 2020 2020 2042  ayer...        B
+00017cc0: 2c20 4e2c 204d 2c20 642c 206c 203d 2062  , N, M, d, l = b
+00017cd0: 6174 6368 5f73 697a 652c 206d 6178 5f6e  atch_size, max_n
+00017ce0: 756d 5f61 746f 6d73 2c20 6d61 785f 6e75  um_atoms, max_nu
+00017cf0: 6d5f 6e65 6967 6862 6f72 732c 206e 756d  m_neighbors, num
+00017d00: 5f66 6561 7475 7265 732c 206c 656e 2872  _features, len(r
+00017d10: 6164 6961 6c5f 7061 7261 6d73 2920 2a20  adial_params) * 
+00017d20: 6c65 6e28 6174 6f6d 5f74 7970 6573 290a  len(atom_types).
+00017d30: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00017d40: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00017d50: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2069  ------.        i
+00017d60: 6e70 7574 733a 2053 6571 7565 6e63 655b  nputs: Sequence[
+00017d70: 556e 696f 6e5b 4172 7261 794c 696b 652c  Union[ArrayLike,
+00017d80: 2074 6f72 6368 2e54 656e 736f 725d 5d0a   torch.Tensor]].
+00017d90: 2020 2020 2020 2020 2020 2020 4669 7273              Firs
+00017da0: 7420 696e 7075 7420 6172 6520 7468 6520  t input are the 
+00017db0: 636f 6f72 6469 6e61 7465 732f 6665 6174  coordinates/feat
+00017dc0: 7572 6573 2c20 6f66 2073 6861 7065 2028  ures, of shape (
+00017dd0: 422c 204e 2c20 6429 0a20 2020 2020 2020  B, N, d).       
+00017de0: 2020 2020 2053 6563 6f6e 6420 696e 7075       Second inpu
+00017df0: 7420 6973 2074 6865 206e 6569 6768 626f  t is the neighbo
+00017e00: 7220 6c69 7374 2c20 6f66 2073 6861 7065  r list, of shape
+00017e10: 2028 422c 204e 2c20 4d29 0a20 2020 2020   (B, N, M).     
+00017e20: 2020 2020 2020 2054 6869 7264 2069 6e70         Third inp
+00017e30: 7574 2061 7265 2074 6865 2061 746f 6d69  ut are the atomi
+00017e40: 6320 6e75 6d62 6572 7320 6f66 206e 6569  c numbers of nei
+00017e50: 6768 626f 7220 6174 6f6d 732c 206f 6620  ghbor atoms, of 
+00017e60: 7368 6170 6520 2842 2c20 4e2c 204d 290a  shape (B, N, M).
+00017e70: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00017e80: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00017e90: 0a20 2020 2020 2020 2074 6f72 6368 2e54  .        torch.T
+00017ea0: 656e 736f 7220 6f66 2073 6861 7065 2028  ensor of shape (
+00017eb0: 422c 204e 2c20 6c29 0a20 2020 2020 2020  B, N, l).       
+00017ec0: 2020 2020 204f 7574 7075 7420 6f66 2061       Output of a
+00017ed0: 746f 6d69 6320 636f 6e76 6f6c 7574 696f  tomic convolutio
+00017ee0: 6e20 6c61 7965 722e 0a0a 2020 2020 2020  n layer...      
+00017ef0: 2020 5261 6973 6573 0a20 2020 2020 2020    Raises.       
+00017f00: 202d 2d2d 2d2d 2d0a 2020 2020 2020 2020   ------.        
+00017f10: 5661 6c75 6545 7272 6f72 0a20 2020 2020  ValueError.     
+00017f20: 2020 2020 2020 2057 6865 6e20 7468 6520         When the 
+00017f30: 6c65 6e67 7468 206f 6620 6069 6e70 7574  length of `input
+00017f40: 7360 2069 7320 6e6f 7420 6571 7561 6c20  s` is not equal 
+00017f50: 746f 2033 2e0a 2020 2020 2020 2020 2222  to 3..        ""
+00017f60: 220a 2020 2020 2020 2020 6966 206c 656e  ".        if len
+00017f70: 2869 6e70 7574 7329 2021 3d20 333a 0a20  (inputs) != 3:. 
+00017f80: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00017f90: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00017fa0: 2020 2020 2020 2020 2020 2020 2066 2260               f"`
+00017fb0: 696e 7075 7473 6020 6861 7320 746f 2062  inputs` has to b
+00017fc0: 6520 6f66 206c 656e 6774 6820 332c 2067  e of length 3, g
+00017fd0: 6f74 3a20 7b6c 656e 2869 6e70 7574 7329  ot: {len(inputs)
+00017fe0: 7d22 290a 0a20 2020 2020 2020 2058 203d  }")..        X =
+00017ff0: 2074 6f72 6368 2e74 656e 736f 7228 696e   torch.tensor(in
+00018000: 7075 7473 5b30 5d29 0a20 2020 2020 2020  puts[0]).       
+00018010: 204e 6272 7320 3d20 746f 7263 682e 7465   Nbrs = torch.te
+00018020: 6e73 6f72 2869 6e70 7574 735b 315d 2c20  nsor(inputs[1], 
+00018030: 6474 7970 653d 746f 7263 682e 696e 7436  dtype=torch.int6
+00018040: 3429 0a20 2020 2020 2020 204e 6272 735f  4).        Nbrs_
+00018050: 5a20 3d20 746f 7263 682e 7465 6e73 6f72  Z = torch.tensor
+00018060: 2869 6e70 7574 735b 325d 290a 0a20 2020  (inputs[2])..   
+00018070: 2020 2020 2042 2c20 4e2c 2064 203d 2058       B, N, d = X
+00018080: 2e73 6861 7065 0a20 2020 2020 2020 204d  .shape.        M
+00018090: 203d 204e 6272 732e 7368 6170 655b 2d31   = Nbrs.shape[-1
+000180a0: 5d0a 0a20 2020 2020 2020 2044 203d 2073  ]..        D = s
+000180b0: 656c 662e 6469 7374 616e 6365 5f74 656e  elf.distance_ten
+000180c0: 736f 7228 582c 204e 6272 732c 2073 656c  sor(X, Nbrs, sel
+000180d0: 662e 626f 785f 7369 7a65 2c20 422c 204e  f.box_size, B, N
+000180e0: 2c20 4d2c 2064 290a 2020 2020 2020 2020  , M, d).        
+000180f0: 5220 3d20 7365 6c66 2e64 6973 7461 6e63  R = self.distanc
+00018100: 655f 6d61 7472 6978 2844 290a 2020 2020  e_matrix(D).    
+00018110: 2020 2020 5220 3d20 746f 7263 682e 756e      R = torch.un
+00018120: 7371 7565 657a 6528 522c 2030 290a 2020  squeeze(R, 0).  
+00018130: 2020 2020 2020 7273 6620 3d20 7365 6c66        rsf = self
+00018140: 2e72 6164 6961 6c5f 7379 6d6d 6574 7279  .radial_symmetry
+00018150: 5f66 756e 6374 696f 6e28 522c 2073 656c  _function(R, sel
+00018160: 662e 7263 2c20 7365 6c66 2e72 732c 2073  f.rc, self.rs, s
+00018170: 656c 662e 7265 290a 0a20 2020 2020 2020  elf.re)..       
+00018180: 2069 6620 6e6f 7420 7365 6c66 2e61 746f   if not self.ato
+00018190: 6d5f 7479 7065 733a 0a20 2020 2020 2020  m_types:.       
+000181a0: 2020 2020 2063 6f6e 6420 3d20 746f 7263       cond = torc
+000181b0: 682e 6e6f 745f 6571 7561 6c28 4e62 7273  h.not_equal(Nbrs
+000181c0: 5f5a 2c20 3029 2e74 6f28 746f 7263 682e  _Z, 0).to(torch.
+000181d0: 666c 6f61 7429 2e72 6573 6861 7065 280a  float).reshape(.
+000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181f0: 2831 2c20 2d31 2c20 4e2c 204d 2929 0a20  (1, -1, N, M)). 
+00018200: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00018210: 203d 2074 6f72 6368 2e73 756d 2863 6f6e   = torch.sum(con
+00018220: 6420 2a20 7273 662c 2033 290a 2020 2020  d * rsf, 3).    
+00018230: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00018240: 2020 2020 2020 2320 5375 6d20 7468 6520        # Sum the 
+00018250: 7061 6972 7769 7365 2d69 6e74 6572 6163  pairwise-interac
+00018260: 7469 6f6e 7320 6265 7477 6565 6e20 6174  tions between at
+00018270: 6f6d 7320 7468 6174 2061 7265 206f 6620  oms that are of 
+00018280: 6061 746f 6d5f 7479 7065 6020 616e 6420  `atom_type` and 
+00018290: 6974 7320 6e65 6967 6862 6f72 7320 666f  its neighbors fo
+000182a0: 7220 6561 6368 2061 746f 6d20 7479 7065  r each atom type
+000182b0: 2069 6e20 6061 746f 6d5f 7479 7065 7360   in `atom_types`
+000182c0: 2e0a 2020 2020 2020 2020 2020 2020 7379  ..            sy
+000182d0: 6d6d 6574 7269 6573 203d 205b 5d0a 2020  mmetries = [].  
+000182e0: 2020 2020 2020 2020 2020 666f 7220 6174            for at
+000182f0: 6f6d 5f74 7970 6520 696e 2073 656c 662e  om_type in self.
+00018300: 6174 6f6d 5f74 7970 6573 3a0a 2020 2020  atom_types:.    
+00018310: 2020 2020 2020 2020 2020 2020 636f 6e64              cond
+00018320: 203d 2074 6f72 6368 2e65 7128 4e62 7273   = torch.eq(Nbrs
+00018330: 5f5a 2c20 6174 6f6d 5f74 7970 6529 2e74  _Z, atom_type).t
+00018340: 6f28 746f 7263 682e 666c 6f61 7429 2e72  o(torch.float).r
+00018350: 6573 6861 7065 280a 2020 2020 2020 2020  eshape(.        
+00018360: 2020 2020 2020 2020 2020 2020 2831 2c20              (1, 
+00018370: 2d31 2c20 4e2c 204d 2929 0a20 2020 2020  -1, N, M)).     
+00018380: 2020 2020 2020 2020 2020 2073 796d 6d65             symme
+00018390: 7472 6965 732e 6170 7065 6e64 2874 6f72  tries.append(tor
+000183a0: 6368 2e73 756d 2863 6f6e 6420 2a20 7273  ch.sum(cond * rs
+000183b0: 662c 2033 2929 0a20 2020 2020 2020 2020  f, 3)).         
+000183c0: 2020 206c 6179 6572 203d 2074 6f72 6368     layer = torch
+000183d0: 2e63 6f6e 6361 7428 7379 6d6d 6574 7269  .concat(symmetri
+000183e0: 6573 2c20 3029 0a0a 2020 2020 2020 2020  es, 0)..        
+000183f0: 6c61 7965 7220 3d20 746f 7263 682e 7065  layer = torch.pe
+00018400: 726d 7574 6528 6c61 7965 722c 205b 312c  rmute(layer, [1,
+00018410: 2032 2c20 305d 290a 2020 2020 2020 2020   2, 0]).        
+00018420: 7661 722c 206d 6561 6e20 3d20 746f 7263  var, mean = torc
+00018430: 682e 7661 725f 6d65 616e 286c 6179 6572  h.var_mean(layer
+00018440: 2c20 5b30 2c20 325d 290a 2020 2020 2020  , [0, 2]).      
+00018450: 2020 7661 722c 206d 6561 6e20 3d20 7661    var, mean = va
+00018460: 722e 6465 7461 6368 2829 2c20 6d65 616e  r.detach(), mean
+00018470: 2e64 6574 6163 6828 290a 0a20 2020 2020  .detach()..     
+00018480: 2020 2072 6574 7572 6e20 462e 6261 7463     return F.batc
+00018490: 685f 6e6f 726d 286c 6179 6572 2c20 6d65  h_norm(layer, me
+000184a0: 616e 2c20 7661 7229 0a0a 2020 2020 6465  an, var)..    de
+000184b0: 6620 6469 7374 616e 6365 5f74 656e 736f  f distance_tenso
+000184c0: 7228 7365 6c66 2c20 583a 2074 6f72 6368  r(self, X: torch
+000184d0: 2e54 656e 736f 722c 204e 6272 733a 2074  .Tensor, Nbrs: t
+000184e0: 6f72 6368 2e54 656e 736f 722c 0a20 2020  orch.Tensor,.   
+000184f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018500: 2020 2020 2062 6f78 5f73 697a 653a 2055       box_size: U
+00018510: 6e69 6f6e 5b74 6f72 6368 2e54 656e 736f  nion[torch.Tenso
+00018520: 722c 204e 6f6e 655d 2c20 423a 2069 6e74  r, None], B: int
+00018530: 2c20 4e3a 2069 6e74 2c0a 2020 2020 2020  , N: int,.      
+00018540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018550: 2020 4d3a 2069 6e74 2c20 643a 2069 6e74    M: int, d: int
+00018560: 2920 2d3e 2074 6f72 6368 2e54 656e 736f  ) -> torch.Tenso
+00018570: 723a 0a20 2020 2020 2020 2022 2222 4361  r:.        """Ca
+00018580: 6c63 756c 6174 6520 6469 7374 616e 6365  lculate distance
+00018590: 2074 656e 736f 7220 666f 7220 6120 6261   tensor for a ba
+000185a0: 7463 6820 6f66 206d 6f6c 6563 756c 6573  tch of molecules
+000185b0: 2e0a 0a20 2020 2020 2020 2042 2c20 4e2c  ...        B, N,
+000185c0: 204d 2c20 6420 3d20 6261 7463 685f 7369   M, d = batch_si
+000185d0: 7a65 2c20 6d61 785f 6e75 6d5f 6174 6f6d  ze, max_num_atom
+000185e0: 732c 206d 6178 5f6e 756d 5f6e 6569 6768  s, max_num_neigh
+000185f0: 626f 7273 2c20 6e75 6d5f 6665 6174 7572  bors, num_featur
+00018600: 6573 0a0a 2020 2020 2020 2020 5061 7261  es..        Para
+00018610: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+00018620: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00018630: 2020 5820 3a20 746f 7263 682e 5465 6e73    X : torch.Tens
+00018640: 6f72 206f 6620 7368 6170 6520 2842 2c20  or of shape (B, 
+00018650: 4e2c 2064 290a 2020 2020 2020 2020 2020  N, d).          
+00018660: 2020 436f 6f72 6469 6e61 7465 732f 6665    Coordinates/fe
+00018670: 6174 7572 6573 2e0a 2020 2020 2020 2020  atures..        
+00018680: 4e62 7273 203a 2074 6f72 6368 2e54 656e  Nbrs : torch.Ten
+00018690: 736f 7220 6f66 2073 6861 7065 2028 422c  sor of shape (B,
+000186a0: 204e 2c20 4d29 0a20 2020 2020 2020 2020   N, M).         
+000186b0: 2020 204e 6569 6768 626f 7220 6c69 7374     Neighbor list
+000186c0: 2e0a 2020 2020 2020 2020 626f 785f 7369  ..        box_si
+000186d0: 7a65 203a 2074 6f72 6368 2e54 656e 736f  ze : torch.Tenso
+000186e0: 720a 2020 2020 2020 2020 2020 2020 4c65  r.            Le
+000186f0: 6e67 7468 206d 7573 7420 6265 2065 7175  ngth must be equ
+00018700: 616c 2074 6f20 6064 602e 0a20 2020 2020  al to `d`..     
+00018710: 2020 2042 203a 2069 6e74 0a20 2020 2020     B : int.     
+00018720: 2020 2020 2020 2042 6174 6368 2073 697a         Batch siz
+00018730: 650a 2020 2020 2020 2020 4e20 3a20 696e  e.        N : in
+00018740: 740a 2020 2020 2020 2020 2020 2020 4d61  t.            Ma
+00018750: 7869 6d75 6d20 6e75 6d62 6572 206f 6620  ximum number of 
+00018760: 6174 6f6d 730a 2020 2020 2020 2020 4d20  atoms.        M 
+00018770: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
+00018780: 2020 4d61 7869 6d75 6d20 6e75 6d62 6572    Maximum number
+00018790: 206f 6620 6e65 6967 6862 6f72 730a 2020   of neighbors.  
+000187a0: 2020 2020 2020 6420 3a20 696e 740a 2020        d : int.  
+000187b0: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
+000187c0: 206f 6620 6665 6174 7572 6573 0a0a 2020   of features..  
+000187d0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+000187e0: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
+000187f0: 2020 2020 2020 746f 7263 682e 5465 6e73        torch.Tens
+00018800: 6f72 206f 6620 7368 6170 6520 2842 2c20  or of shape (B, 
+00018810: 4e2c 204d 2c20 6429 0a20 2020 2020 2020  N, M, d).       
+00018820: 2020 2020 2043 6f6f 7264 696e 6174 6573       Coordinates
+00018830: 2f66 6561 7475 7265 7320 6469 7374 616e  /features distan
+00018840: 6365 2074 656e 736f 722e 0a0a 2020 2020  ce tensor...    
+00018850: 2020 2020 5261 6973 6573 0a20 2020 2020      Raises.     
+00018860: 2020 202d 2d2d 2d2d 2d0a 2020 2020 2020     ------.      
+00018870: 2020 5661 6c75 6545 7272 6f72 0a20 2020    ValueError.   
+00018880: 2020 2020 2020 2020 2057 6865 6e20 7468           When th
+00018890: 6520 6c65 6e67 7468 206f 6620 6062 6f78  e length of `box
+000188a0: 5f73 697a 6560 2069 7320 6e6f 7420 6571  _size` is not eq
+000188b0: 7561 6c20 746f 2060 6460 2e0a 2020 2020  ual to `d`..    
+000188c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000188d0: 6966 2062 6f78 5f73 697a 6520 6973 206e  if box_size is n
+000188e0: 6f74 204e 6f6e 6520 616e 6420 6c65 6e28  ot None and len(
+000188f0: 626f 785f 7369 7a65 2920 213d 2064 3a0a  box_size) != d:.
+00018900: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00018910: 6520 5661 6c75 6545 7272 6f72 2822 4c65  e ValueError("Le
+00018920: 6e67 7468 206f 6620 6062 6f78 5f73 697a  ngth of `box_siz
+00018930: 6560 206d 7573 7420 6265 2065 7175 616c  e` must be equal
+00018940: 2074 6f20 6064 6022 290a 0a20 2020 2020   to `d`")..     
+00018950: 2020 2066 6c61 745f 6e65 6967 6862 6f72     flat_neighbor
+00018960: 7320 3d20 746f 7263 682e 7265 7368 6170  s = torch.reshap
+00018970: 6528 4e62 7273 2c20 282d 312c 204e 202a  e(Nbrs, (-1, N *
+00018980: 204d 2929 0a20 2020 2020 2020 206e 6569   M)).        nei
+00018990: 6768 626f 725f 636f 6f72 6473 203d 2074  ghbor_coords = t
+000189a0: 6f72 6368 2e73 7461 636b 280a 2020 2020  orch.stack(.    
+000189b0: 2020 2020 2020 2020 5b58 5b62 2c20 666c          [X[b, fl
+000189c0: 6174 5f6e 6569 6768 626f 7273 5b62 5d5d  at_neighbors[b]]
+000189d0: 2066 6f72 2062 2069 6e20 7261 6e67 6528   for b in range(
+000189e0: 4229 5d29 0a20 2020 2020 2020 206e 6569  B)]).        nei
+000189f0: 6768 626f 725f 636f 6f72 6473 203d 2074  ghbor_coords = t
+00018a00: 6f72 6368 2e72 6573 6861 7065 286e 6569  orch.reshape(nei
+00018a10: 6768 626f 725f 636f 6f72 6473 2c20 282d  ghbor_coords, (-
+00018a20: 312c 204e 2c20 4d2c 2064 2929 0a20 2020  1, N, M, d)).   
+00018a30: 2020 2020 2044 203d 206e 6569 6768 626f       D = neighbo
+00018a40: 725f 636f 6f72 6473 202d 2074 6f72 6368  r_coords - torch
+00018a50: 2e75 6e73 7175 6565 7a65 2858 2c20 3229  .unsqueeze(X, 2)
+00018a60: 0a20 2020 2020 2020 2069 6620 626f 785f  .        if box_
+00018a70: 7369 7a65 2069 7320 6e6f 7420 4e6f 6e65  size is not None
+00018a80: 3a0a 2020 2020 2020 2020 2020 2020 626f  :.            bo
+00018a90: 785f 7369 7a65 203d 2074 6f72 6368 2e72  x_size = torch.r
+00018aa0: 6573 6861 7065 2862 6f78 5f73 697a 652c  eshape(box_size,
+00018ab0: 2028 312c 2031 2c20 312c 2064 2929 0a20   (1, 1, 1, d)). 
+00018ac0: 2020 2020 2020 2020 2020 2044 202d 3d20             D -= 
+00018ad0: 746f 7263 682e 726f 756e 6428 4420 2f20  torch.round(D / 
+00018ae0: 626f 785f 7369 7a65 2920 2a20 626f 785f  box_size) * box_
+00018af0: 7369 7a65 0a0a 2020 2020 2020 2020 7265  size..        re
+00018b00: 7475 726e 2044 0a0a 2020 2020 6465 6620  turn D..    def 
+00018b10: 6469 7374 616e 6365 5f6d 6174 7269 7828  distance_matrix(
+00018b20: 7365 6c66 2c20 443a 2074 6f72 6368 2e54  self, D: torch.T
+00018b30: 656e 736f 7229 202d 3e20 746f 7263 682e  ensor) -> torch.
+00018b40: 5465 6e73 6f72 3a0a 2020 2020 2020 2020  Tensor:.        
+00018b50: 2222 2243 616c 6375 6c61 7465 2061 2064  """Calculate a d
+00018b60: 6973 7461 6e63 6520 6d61 7472 6978 2c20  istance matrix, 
+00018b70: 6769 7665 6e20 6120 6469 7374 616e 6365  given a distance
+00018b80: 2074 656e 736f 722e 0a0a 2020 2020 2020   tensor...      
+00018b90: 2020 422c 204e 2c20 4d2c 2064 203d 2062    B, N, M, d = b
+00018ba0: 6174 6368 5f73 697a 652c 206d 6178 5f6e  atch_size, max_n
+00018bb0: 756d 5f61 746f 6d73 2c20 6d61 785f 6e75  um_atoms, max_nu
+00018bc0: 6d5f 6e65 6967 6862 6f72 732c 206e 756d  m_neighbors, num
+00018bd0: 5f66 6561 7475 7265 730a 0a20 2020 2020  _features..     
+00018be0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00018bf0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00018c00: 0a20 2020 2020 2020 2044 203a 2074 6f72  .        D : tor
+00018c10: 6368 2e54 656e 736f 7220 6f66 2073 6861  ch.Tensor of sha
+00018c20: 7065 2028 422c 204e 2c20 4d2c 2064 290a  pe (B, N, M, d).
+00018c30: 2020 2020 2020 2020 2020 2020 4469 7374              Dist
+00018c40: 616e 6365 2074 656e 736f 720a 0a20 2020  ance tensor..   
+00018c50: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00018c60: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00018c70: 2020 2020 2074 6f72 6368 2e54 656e 736f       torch.Tenso
+00018c80: 7220 6f66 2073 6861 7065 2028 422c 204e  r of shape (B, N
+00018c90: 2c20 4d29 0a20 2020 2020 2020 2020 2020  , M).           
+00018ca0: 2044 6973 7461 6e63 6520 6d61 7472 6978   Distance matrix
+00018cb0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00018cc0: 2020 2020 2020 7265 7475 726e 2074 6f72        return tor
+00018cd0: 6368 2e73 7172 7428 746f 7263 682e 7375  ch.sqrt(torch.su
+00018ce0: 6d28 746f 7263 682e 6d75 6c28 442c 2044  m(torch.mul(D, D
+00018cf0: 292c 2033 2929 0a0a 2020 2020 6465 6620  ), 3))..    def 
+00018d00: 6761 7573 7369 616e 5f64 6973 7461 6e63  gaussian_distanc
+00018d10: 655f 6d61 7472 6978 2873 656c 662c 2052  e_matrix(self, R
+00018d20: 3a20 746f 7263 682e 5465 6e73 6f72 2c20  : torch.Tensor, 
+00018d30: 7273 3a20 746f 7263 682e 5465 6e73 6f72  rs: torch.Tensor
+00018d40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d60: 2020 2072 653a 2074 6f72 6368 2e54 656e     re: torch.Ten
+00018d70: 736f 7229 202d 3e20 746f 7263 682e 5465  sor) -> torch.Te
+00018d80: 6e73 6f72 3a0a 2020 2020 2020 2020 2222  nsor:.        ""
+00018d90: 2243 616c 6375 6c61 7465 2061 2047 6175  "Calculate a Gau
+00018da0: 7373 6961 6e20 6469 7374 616e 6365 206d  ssian distance m
+00018db0: 6174 7269 782e 0a0a 2020 2020 2020 2020  atrix...        
+00018dc0: 422c 204e 2c20 4d2c 206c 203d 2062 6174  B, N, M, l = bat
+00018dd0: 6368 5f73 697a 652c 206d 6178 5f6e 756d  ch_size, max_num
+00018de0: 5f61 746f 6d73 2c20 6d61 785f 6e75 6d5f  _atoms, max_num_
+00018df0: 6e65 6967 6862 6f72 732c 206c 656e 2872  neighbors, len(r
+00018e00: 6164 6961 6c5f 7061 7261 6d73 290a 0a20  adial_params).. 
+00018e10: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00018e20: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00018e30: 2d2d 2d2d 0a20 2020 2020 2020 2052 203a  ----.        R :
+00018e40: 2074 6f72 6368 2e54 656e 736f 7220 6f66   torch.Tensor of
+00018e50: 2073 6861 7065 2028 422c 204e 2c20 4d29   shape (B, N, M)
+00018e60: 0a20 2020 2020 2020 2020 2020 2044 6973  .            Dis
+00018e70: 7461 6e63 6520 6d61 7472 6978 2e0a 2020  tance matrix..  
+00018e80: 2020 2020 2020 7273 203a 2074 6f72 6368        rs : torch
+00018e90: 2e54 656e 736f 7220 6f66 2073 6861 7065  .Tensor of shape
+00018ea0: 2028 6c2c 2031 2c20 312c 2031 290a 2020   (l, 1, 1, 1).  
+00018eb0: 2020 2020 2020 2020 2020 4761 7573 7369            Gaussi
+00018ec0: 616e 2064 6973 7461 6e63 6520 6d61 7472  an distance matr
+00018ed0: 6978 206d 6561 6e2e 0a20 2020 2020 2020  ix mean..       
+00018ee0: 2072 6520 3a20 746f 7263 682e 5465 6e73   re : torch.Tens
+00018ef0: 6f72 206f 6620 7368 6170 6520 286c 2c20  or of shape (l, 
+00018f00: 312c 2031 2c20 3129 0a20 2020 2020 2020  1, 1, 1).       
+00018f10: 2020 2020 2047 6175 7373 6961 6e20 6469       Gaussian di
+00018f20: 7374 616e 6365 206d 6174 7269 7820 7769  stance matrix wi
+00018f30: 6474 682e 0a0a 2020 2020 2020 2020 5265  dth...        Re
+00018f40: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+00018f50: 2d2d 2d2d 2d0a 2020 2020 2020 2020 746f  -----.        to
+00018f60: 7263 682e 5465 6e73 6f72 206f 6620 7368  rch.Tensor of sh
+00018f70: 6170 6520 2842 2c20 4e2c 204d 290a 2020  ape (B, N, M).  
+00018f80: 2020 2020 2020 2020 2020 4761 7573 7369            Gaussi
+00018f90: 616e 2064 6973 7461 6e63 6520 6d61 7472  an distance matr
+00018fa0: 6978 2e0a 2020 2020 2020 2020 2222 220a  ix..        """.
+00018fb0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00018fc0: 6f72 6368 2e65 7870 282d 7265 202a 2028  orch.exp(-re * (
+00018fd0: 5220 2d20 7273 292a 2a32 290a 0a20 2020  R - rs)**2)..   
+00018fe0: 2064 6566 2072 6164 6961 6c5f 6375 746f   def radial_cuto
+00018ff0: 6666 2873 656c 662c 2052 3a20 746f 7263  ff(self, R: torc
+00019000: 682e 5465 6e73 6f72 2c20 7263 3a20 746f  h.Tensor, rc: to
+00019010: 7263 682e 5465 6e73 6f72 2920 2d3e 2074  rch.Tensor) -> t
+00019020: 6f72 6368 2e54 656e 736f 723a 0a20 2020  orch.Tensor:.   
+00019030: 2020 2020 2022 2222 4361 6c63 756c 6174       """Calculat
+00019040: 6520 6120 7261 6469 616c 2063 7574 2d6f  e a radial cut-o
+00019050: 6666 206d 6174 7269 782e 0a0a 2020 2020  ff matrix...    
+00019060: 2020 2020 422c 204e 2c20 4d2c 206c 203d      B, N, M, l =
+00019070: 2062 6174 6368 5f73 697a 652c 206d 6178   batch_size, max
+00019080: 5f6e 756d 5f61 746f 6d73 2c20 6d61 785f  _num_atoms, max_
+00019090: 6e75 6d5f 6e65 6967 6862 6f72 732c 206c  num_neighbors, l
+000190a0: 656e 2872 6164 6961 6c5f 7061 7261 6d73  en(radial_params
+000190b0: 290a 0a20 2020 2020 2020 2050 6172 616d  )..        Param
+000190c0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+000190d0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+000190e0: 2052 203a 2074 6f72 6368 2e54 656e 736f   R : torch.Tenso
+000190f0: 7220 6f66 2073 6861 7065 2028 422c 204e  r of shape (B, N
+00019100: 2c20 4d29 0a20 2020 2020 2020 2020 2020  , M).           
+00019110: 2044 6973 7461 6e63 6520 6d61 7472 6978   Distance matrix
+00019120: 2e0a 2020 2020 2020 2020 7263 203a 2074  ..        rc : t
+00019130: 6f72 6368 2e54 656e 736f 7220 6f66 2073  orch.Tensor of s
+00019140: 6861 7065 2028 6c2c 2031 2c20 312c 2031  hape (l, 1, 1, 1
+00019150: 290a 2020 2020 2020 2020 2020 2020 496e  ).            In
+00019160: 7465 7261 6374 696f 6e20 6375 746f 6666  teraction cutoff
+00019170: 2028 696e 2061 6e67 7374 726f 6d29 2e0a   (in angstrom)..
+00019180: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00019190: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000191a0: 0a20 2020 2020 2020 2074 6f72 6368 2e54  .        torch.T
+000191b0: 656e 736f 7220 6f66 2073 6861 7065 2028  ensor of shape (
+000191c0: 422c 204e 2c20 4d29 0a20 2020 2020 2020  B, N, M).       
+000191d0: 2020 2020 2052 6164 6961 6c20 6375 746f       Radial cuto
+000191e0: 6666 206d 6174 7269 782e 0a20 2020 2020  ff matrix..     
+000191f0: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+00019200: 203d 2030 2e35 202a 2028 746f 7263 682e   = 0.5 * (torch.
+00019210: 636f 7328 6e70 2e70 6920 2a20 5220 2f20  cos(np.pi * R / 
+00019220: 7263 2920 2b20 3129 0a20 2020 2020 2020  rc) + 1).       
+00019230: 2045 203d 2074 6f72 6368 2e7a 6572 6f73   E = torch.zeros
+00019240: 5f6c 696b 6528 5429 0a20 2020 2020 2020  _like(T).       
+00019250: 2063 6f6e 6420 3d20 746f 7263 682e 6c65   cond = torch.le
+00019260: 7373 5f65 7175 616c 2852 2c20 7263 290a  ss_equal(R, rc).
+00019270: 2020 2020 2020 2020 4643 203d 2074 6f72          FC = tor
+00019280: 6368 2e77 6865 7265 2863 6f6e 642c 2054  ch.where(cond, T
+00019290: 2c20 4529 0a0a 2020 2020 2020 2020 7265  , E)..        re
+000192a0: 7475 726e 2046 430a 0a20 2020 2064 6566  turn FC..    def
+000192b0: 2072 6164 6961 6c5f 7379 6d6d 6574 7279   radial_symmetry
+000192c0: 5f66 756e 6374 696f 6e28 7365 6c66 2c20  _function(self, 
+000192d0: 523a 2074 6f72 6368 2e54 656e 736f 722c  R: torch.Tensor,
+000192e0: 2072 633a 2074 6f72 6368 2e54 656e 736f   rc: torch.Tenso
+000192f0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00019300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019310: 2020 2020 7273 3a20 746f 7263 682e 5465      rs: torch.Te
+00019320: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
 00019330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019340: 2072 653a 2074 6f72 6368 2e54 656e 736f   re: torch.Tenso
-00019350: 7229 202d 3e20 746f 7263 682e 5465 6e73  r) -> torch.Tens
-00019360: 6f72 3a0a 2020 2020 2020 2020 2222 2243  or:.        """C
-00019370: 616c 6375 6c61 7465 2061 2072 6164 6961  alculate a radia
-00019380: 6c20 7379 6d6d 6574 7279 2066 756e 6374  l symmetry funct
-00019390: 696f 6e2e 0a0a 2020 2020 2020 2020 422c  ion...        B,
-000193a0: 204e 2c20 4d2c 206c 203d 2062 6174 6368   N, M, l = batch
-000193b0: 5f73 697a 652c 206d 6178 5f6e 756d 5f61  _size, max_num_a
-000193c0: 746f 6d73 2c20 6d61 785f 6e75 6d5f 6e65  toms, max_num_ne
-000193d0: 6967 6862 6f72 732c 206c 656e 2872 6164  ighbors, len(rad
-000193e0: 6961 6c5f 7061 7261 6d73 290a 0a20 2020  ial_params)..   
-000193f0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00019400: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00019410: 2d2d 0a20 2020 2020 2020 2052 203a 2074  --.        R : t
-00019420: 6f72 6368 2e54 656e 736f 7220 6f66 2073  orch.Tensor of s
-00019430: 6861 7065 2028 422c 204e 2c20 4d29 0a20  hape (B, N, M). 
-00019440: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
-00019450: 6e63 6520 6d61 7472 6978 2e0a 2020 2020  nce matrix..    
-00019460: 2020 2020 7263 203a 2074 6f72 6368 2e54      rc : torch.T
-00019470: 656e 736f 7220 6f66 2073 6861 7065 2028  ensor of shape (
-00019480: 6c2c 2031 2c20 312c 2031 290a 2020 2020  l, 1, 1, 1).    
-00019490: 2020 2020 2020 2020 496e 7465 7261 6374          Interact
-000194a0: 696f 6e20 6375 746f 6666 2028 696e 2061  ion cutoff (in a
-000194b0: 6e67 7374 726f 6d29 2e0a 2020 2020 2020  ngstrom)..      
-000194c0: 2020 7273 203a 2074 6f72 6368 2e54 656e    rs : torch.Ten
-000194d0: 736f 7220 6f66 2073 6861 7065 2028 6c2c  sor of shape (l,
-000194e0: 2031 2c20 312c 2031 290a 2020 2020 2020   1, 1, 1).      
-000194f0: 2020 2020 2020 4761 7573 7369 616e 2064        Gaussian d
-00019500: 6973 7461 6e63 6520 6d61 7472 6978 206d  istance matrix m
-00019510: 6561 6e2e 0a20 2020 2020 2020 2072 6520  ean..        re 
-00019520: 3a20 746f 7263 682e 5465 6e73 6f72 206f  : torch.Tensor o
-00019530: 6620 7368 6170 6520 286c 2c20 312c 2031  f shape (l, 1, 1
-00019540: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
-00019550: 2047 6175 7373 6961 6e20 6469 7374 616e   Gaussian distan
-00019560: 6365 206d 6174 7269 7820 7769 6474 682e  ce matrix width.
-00019570: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00019580: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00019590: 0a20 2020 2020 2020 2074 6f72 6368 2e54  .        torch.T
-000195a0: 656e 736f 7220 6f66 2073 6861 7065 2028  ensor of shape (
-000195b0: 422c 204e 2c20 4d29 0a20 2020 2020 2020  B, N, M).       
-000195c0: 2020 2020 2050 7265 2d73 756d 6d61 7469       Pre-summati
-000195d0: 6f6e 2072 6164 6961 6c20 7379 6d6d 6574  on radial symmet
-000195e0: 7279 2066 756e 6374 696f 6e2e 0a20 2020  ry function..   
-000195f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00019600: 204b 203d 2073 656c 662e 6761 7573 7369   K = self.gaussi
-00019610: 616e 5f64 6973 7461 6e63 655f 6d61 7472  an_distance_matr
-00019620: 6978 2852 2c20 7273 2c20 7265 290a 2020  ix(R, rs, re).  
-00019630: 2020 2020 2020 4643 203d 2073 656c 662e        FC = self.
-00019640: 7261 6469 616c 5f63 7574 6f66 6628 522c  radial_cutoff(R,
-00019650: 2072 6329 0a0a 2020 2020 2020 2020 7265   rc)..        re
-00019660: 7475 726e 2074 6f72 6368 2e6d 756c 284b  turn torch.mul(K
-00019670: 2c20 4643 290a 0a0a 636c 6173 7320 436f  , FC)...class Co
-00019680: 6d62 696e 654d 6561 6e53 7464 286e 6e2e  mbineMeanStd(nn.
-00019690: 4d6f 6475 6c65 293a 0a20 2020 2022 2222  Module):.    """
-000196a0: 4765 6e65 7261 7465 2047 6175 7373 6961  Generate Gaussia
-000196b0: 6e20 6e6f 6973 652e 0a0a 2020 2020 5468  n noise...    Th
-000196c0: 6973 2069 7320 7468 6520 546f 7263 6820  is is the Torch 
-000196d0: 6571 7569 7661 6c65 6e74 206f 6620 7468  equivalent of th
-000196e0: 6520 6f72 6967 696e 616c 2069 6d70 6c65  e original imple
-000196f0: 6d65 6e74 6174 696f 6e20 7573 696e 6720  mentation using 
-00019700: 4b65 7261 732e 0a20 2020 2022 2222 0a0a  Keras..    """..
-00019710: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00019720: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
-00019730: 2020 2020 2020 2020 7472 6169 6e69 6e67          training
-00019740: 5f6f 6e6c 793a 2062 6f6f 6c20 3d20 4661  _only: bool = Fa
-00019750: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00019760: 2020 2020 2020 6e6f 6973 655f 6570 7369        noise_epsi
-00019770: 6c6f 6e3a 2066 6c6f 6174 203d 2031 2e30  lon: float = 1.0
-00019780: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019790: 2020 202a 2a6b 7761 7267 7329 3a0a 2020     **kwargs):.  
-000197a0: 2020 2020 2020 2222 2243 7265 6174 6520        """Create 
-000197b0: 6120 436f 6d62 696e 654d 6561 6e53 7464  a CombineMeanStd
-000197c0: 206c 6179 6572 2e0a 0a20 2020 2020 2020   layer...       
-000197d0: 2054 6869 7320 6c61 7965 7220 7368 6f75   This layer shou
-000197e0: 6c64 2068 6176 6520 7477 6f20 696e 7075  ld have two inpu
-000197f0: 7473 2077 6974 6820 7468 6520 7361 6d65  ts with the same
-00019800: 2073 6861 7065 2c20 616e 6420 6974 730a   shape, and its.
-00019810: 2020 2020 2020 2020 6f75 7470 7574 2061          output a
-00019820: 6c73 6f20 6861 7320 7468 6520 7361 6d65  lso has the same
-00019830: 2073 6861 7065 2e20 2045 6163 6820 656c   shape.  Each el
-00019840: 656d 656e 7420 6f66 2074 6865 206f 7574  ement of the out
-00019850: 7075 7420 6973 2061 0a20 2020 2020 2020  put is a.       
-00019860: 2047 6175 7373 6961 6e20 6469 7374 7269   Gaussian distri
-00019870: 6275 7465 6420 7261 6e64 6f6d 206e 756d  buted random num
-00019880: 6265 7220 7768 6f73 6520 6d65 616e 2069  ber whose mean i
-00019890: 7320 7468 6520 636f 7272 6573 706f 6e64  s the correspond
-000198a0: 696e 670a 2020 2020 2020 2020 656c 656d  ing.        elem
-000198b0: 656e 7420 6f66 2074 6865 2066 6972 7374  ent of the first
-000198c0: 2069 6e70 7574 2c20 616e 6420 7768 6f73   input, and whos
-000198d0: 6520 7374 616e 6461 7264 2064 6576 6961  e standard devia
-000198e0: 7469 6f6e 2069 7320 7468 650a 2020 2020  tion is the.    
-000198f0: 2020 2020 636f 7272 6573 706f 6e64 696e      correspondin
-00019900: 6720 656c 656d 656e 7420 6f66 2074 6865  g element of the
-00019910: 2073 6563 6f6e 6420 696e 7075 742e 0a0a   second input...
-00019920: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00019930: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00019940: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7472  -----.        tr
-00019950: 6169 6e69 6e67 5f6f 6e6c 793a 2062 6f6f  aining_only: boo
-00019960: 6c2c 206f 7074 696f 6e61 6c20 2864 6566  l, optional (def
-00019970: 6175 6c74 2046 616c 7365 292e 0a20 2020  ault False)..   
-00019980: 2020 2020 2020 2020 2069 6620 5472 7565           if True
-00019990: 2c20 6e6f 6973 6520 6973 206f 6e6c 7920  , noise is only 
-000199a0: 6765 6e65 7261 7465 6420 6475 7269 6e67  generated during
-000199b0: 2074 7261 696e 696e 672e 2020 4475 7269   training.  Duri
-000199c0: 6e67 0a20 2020 2020 2020 2020 2020 2070  ng.            p
-000199d0: 7265 6469 6374 696f 6e2c 2074 6865 206f  rediction, the o
-000199e0: 7574 7075 7420 6973 2073 696d 706c 7920  utput is simply 
-000199f0: 6571 7561 6c20 746f 2074 6865 2066 6972  equal to the fir
-00019a00: 7374 2069 6e70 7574 2028 7468 6174 0a20  st input (that. 
-00019a10: 2020 2020 2020 2020 2020 2069 732c 2074             is, t
-00019a20: 6865 206d 6561 6e20 6f66 2074 6865 2064  he mean of the d
-00019a30: 6973 7472 6962 7574 696f 6e20 7573 6564  istribution used
-00019a40: 2064 7572 696e 6720 7472 6169 6e69 6e67   during training
-00019a50: 292e 0a20 2020 2020 2020 206e 6f69 7365  )..        noise
-00019a60: 5f65 7073 696c 6f6e 3a20 666c 6f61 742c  _epsilon: float,
-00019a70: 206f 7074 696f 6e61 6c20 2864 6566 6175   optional (defau
-00019a80: 6c74 2031 2e30 292e 0a20 2020 2020 2020  lt 1.0)..       
-00019a90: 2020 2020 2054 6865 206e 6f69 7365 2069       The noise i
-00019aa0: 7320 7363 616c 6564 2062 7920 7468 6973  s scaled by this
-00019ab0: 2066 6163 746f 720a 2020 2020 2020 2020   factor.        
-00019ac0: 2222 220a 2020 2020 2020 2020 7375 7065  """.        supe
-00019ad0: 7228 436f 6d62 696e 654d 6561 6e53 7464  r(CombineMeanStd
-00019ae0: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
-00019af0: 282a 2a6b 7761 7267 7329 0a20 2020 2020  (**kwargs).     
-00019b00: 2020 2073 656c 662e 7472 6169 6e69 6e67     self.training
-00019b10: 5f6f 6e6c 7920 3d20 7472 6169 6e69 6e67  _only = training
-00019b20: 5f6f 6e6c 790a 2020 2020 2020 2020 7365  _only.        se
-00019b30: 6c66 2e6e 6f69 7365 5f65 7073 696c 6f6e  lf.noise_epsilon
-00019b40: 203d 206e 6f69 7365 5f65 7073 696c 6f6e   = noise_epsilon
-00019b50: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
-00019b60: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
-00019b70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00019b80: 280a 2020 2020 2020 2020 2020 2020 6627  (.            f'
-00019b90: 7b73 656c 662e 5f5f 636c 6173 735f 5f2e  {self.__class__.
-00019ba0: 5f5f 6e61 6d65 5f5f 7d28 7472 6169 6e69  __name__}(traini
-00019bb0: 6e67 5f6f 6e6c 793d 7b73 656c 662e 7472  ng_only={self.tr
-00019bc0: 6169 6e69 6e67 5f6f 6e6c 797d 2c20 6e6f  aining_only}, no
-00019bd0: 6973 655f 6570 7369 6c6f 6e3d 7b73 656c  ise_epsilon={sel
-00019be0: 662e 6e6f 6973 655f 6570 7369 6c6f 6e7d  f.noise_epsilon}
-00019bf0: 2927 0a20 2020 2020 2020 2029 0a0a 2020  )'.        )..  
-00019c00: 2020 6465 6620 666f 7277 6172 6428 7365    def forward(se
-00019c10: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00019c20: 2020 2020 696e 7075 7473 3a20 5365 7175      inputs: Sequ
-00019c30: 656e 6365 5b41 7272 6179 4c69 6b65 5d2c  ence[ArrayLike],
-00019c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019c50: 2074 7261 696e 696e 673a 2062 6f6f 6c20   training: bool 
-00019c60: 3d20 5472 7565 2920 2d3e 2074 6f72 6368  = True) -> torch
-00019c70: 2e54 656e 736f 723a 0a20 2020 2020 2020  .Tensor:.       
-00019c80: 2022 2222 496e 766f 6b65 2074 6869 7320   """Invoke this 
-00019c90: 6c61 7965 722e 0a0a 2020 2020 2020 2020  layer...        
-00019ca0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00019cb0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00019cc0: 2020 2020 2020 696e 7075 7473 3a20 5365        inputs: Se
-00019cd0: 7175 656e 6365 5b41 7272 6179 4c69 6b65  quence[ArrayLike
-00019ce0: 5d0a 2020 2020 2020 2020 2020 2020 4669  ].            Fi
-00019cf0: 7273 7420 656c 656d 656e 7420 6172 6520  rst element are 
-00019d00: 7468 6520 6d65 616e 7320 666f 7220 7468  the means for th
-00019d10: 6520 7261 6e64 6f6d 2067 656e 6572 6174  e random generat
-00019d20: 6564 206e 756d 6265 7273 2e0a 2020 2020  ed numbers..    
-00019d30: 2020 2020 2020 2020 5365 636f 6e64 2065          Second e
-00019d40: 6c65 6d65 6e74 2061 7265 2074 6865 2073  lement are the s
-00019d50: 7461 6e64 6172 6420 6465 7669 6174 696f  tandard deviatio
-00019d60: 6e73 2066 6f72 2074 6865 2072 616e 646f  ns for the rando
-00019d70: 6d20 6765 6e65 7261 7465 6420 6e75 6d62  m generated numb
-00019d80: 6572 732e 0a20 2020 2020 2020 2074 7261  ers..        tra
-00019d90: 696e 696e 673a 2062 6f6f 6c2c 206f 7074  ining: bool, opt
-00019da0: 696f 6e61 6c20 2864 6566 6175 6c74 2054  ional (default T
-00019db0: 7275 6529 2e0a 2020 2020 2020 2020 2020  rue)..          
-00019dc0: 2020 5370 6563 6966 6965 7320 7768 6574    Specifies whet
-00019dd0: 6865 7220 746f 2067 656e 6572 6174 6520  her to generate 
-00019de0: 6e6f 6973 652e 0a20 2020 2020 2020 2020  noise..         
-00019df0: 2020 204e 6f69 7365 2069 7320 6f6e 6c79     Noise is only
-00019e00: 2061 6464 6564 2077 6865 6e20 7472 6169   added when trai
-00019e10: 6e69 6e67 2e0a 0a20 2020 2020 2020 2052  ning...        R
-00019e20: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-00019e30: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2054  ------.        T
-00019e40: 656e 736f 7220 6f66 2047 6175 7373 6961  ensor of Gaussia
-00019e50: 6e20 6469 7374 7269 6275 7465 6420 7261  n distributed ra
-00019e60: 6e64 6f6d 206e 756d 6265 7273 3a20 746f  ndom numbers: to
-00019e70: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
-00019e80: 2020 2020 2020 2053 616d 6520 7368 6170         Same shap
-00019e90: 6520 6173 2074 6865 206d 6561 6e73 2061  e as the means a
-00019ea0: 6e64 2073 7461 6e64 6172 6420 6465 7669  nd standard devi
-00019eb0: 6174 696f 6e73 2066 726f 6d20 6069 6e70  ations from `inp
-00019ec0: 7574 7360 2e0a 2020 2020 2020 2020 2222  uts`..        ""
-00019ed0: 220a 2020 2020 2020 2020 6966 206c 656e  ".        if len
-00019ee0: 2869 6e70 7574 7329 2021 3d20 323a 0a20  (inputs) != 2:. 
-00019ef0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00019f00: 2056 616c 7565 4572 726f 7228 224d 7573   ValueError("Mus
-00019f10: 7420 6861 7665 2074 776f 2069 6e5f 6c61  t have two in_la
-00019f20: 7965 7273 2229 0a0a 2020 2020 2020 2020  yers")..        
-00019f30: 6d65 616e 5f70 6172 656e 742c 2073 7464  mean_parent, std
-00019f40: 5f70 6172 656e 7420 3d20 746f 7263 682e  _parent = torch.
-00019f50: 7465 6e73 6f72 2869 6e70 7574 735b 305d  tensor(inputs[0]
-00019f60: 292c 2074 6f72 6368 2e74 656e 736f 7228  ), torch.tensor(
-00019f70: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-00019f80: 7574 735b 315d 290a 2020 2020 2020 2020  uts[1]).        
-00019f90: 6e6f 6973 655f 7363 616c 6520 3d20 746f  noise_scale = to
-00019fa0: 7263 682e 7465 6e73 6f72 2874 7261 696e  rch.tensor(train
-00019fb0: 696e 6720 6f72 0a20 2020 2020 2020 2020  ing or.         
+00019340: 2020 2020 2020 2072 653a 2074 6f72 6368         re: torch
+00019350: 2e54 656e 736f 7229 202d 3e20 746f 7263  .Tensor) -> torc
+00019360: 682e 5465 6e73 6f72 3a0a 2020 2020 2020  h.Tensor:.      
+00019370: 2020 2222 2243 616c 6375 6c61 7465 2061    """Calculate a
+00019380: 2072 6164 6961 6c20 7379 6d6d 6574 7279   radial symmetry
+00019390: 2066 756e 6374 696f 6e2e 0a0a 2020 2020   function...    
+000193a0: 2020 2020 422c 204e 2c20 4d2c 206c 203d      B, N, M, l =
+000193b0: 2062 6174 6368 5f73 697a 652c 206d 6178   batch_size, max
+000193c0: 5f6e 756d 5f61 746f 6d73 2c20 6d61 785f  _num_atoms, max_
+000193d0: 6e75 6d5f 6e65 6967 6862 6f72 732c 206c  num_neighbors, l
+000193e0: 656e 2872 6164 6961 6c5f 7061 7261 6d73  en(radial_params
+000193f0: 290a 0a20 2020 2020 2020 2050 6172 616d  )..        Param
+00019400: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00019410: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00019420: 2052 203a 2074 6f72 6368 2e54 656e 736f   R : torch.Tenso
+00019430: 7220 6f66 2073 6861 7065 2028 422c 204e  r of shape (B, N
+00019440: 2c20 4d29 0a20 2020 2020 2020 2020 2020  , M).           
+00019450: 2044 6973 7461 6e63 6520 6d61 7472 6978   Distance matrix
+00019460: 2e0a 2020 2020 2020 2020 7263 203a 2074  ..        rc : t
+00019470: 6f72 6368 2e54 656e 736f 7220 6f66 2073  orch.Tensor of s
+00019480: 6861 7065 2028 6c2c 2031 2c20 312c 2031  hape (l, 1, 1, 1
+00019490: 290a 2020 2020 2020 2020 2020 2020 496e  ).            In
+000194a0: 7465 7261 6374 696f 6e20 6375 746f 6666  teraction cutoff
+000194b0: 2028 696e 2061 6e67 7374 726f 6d29 2e0a   (in angstrom)..
+000194c0: 2020 2020 2020 2020 7273 203a 2074 6f72          rs : tor
+000194d0: 6368 2e54 656e 736f 7220 6f66 2073 6861  ch.Tensor of sha
+000194e0: 7065 2028 6c2c 2031 2c20 312c 2031 290a  pe (l, 1, 1, 1).
+000194f0: 2020 2020 2020 2020 2020 2020 4761 7573              Gaus
+00019500: 7369 616e 2064 6973 7461 6e63 6520 6d61  sian distance ma
+00019510: 7472 6978 206d 6561 6e2e 0a20 2020 2020  trix mean..     
+00019520: 2020 2072 6520 3a20 746f 7263 682e 5465     re : torch.Te
+00019530: 6e73 6f72 206f 6620 7368 6170 6520 286c  nsor of shape (l
+00019540: 2c20 312c 2031 2c20 3129 0a20 2020 2020  , 1, 1, 1).     
+00019550: 2020 2020 2020 2047 6175 7373 6961 6e20         Gaussian 
+00019560: 6469 7374 616e 6365 206d 6174 7269 7820  distance matrix 
+00019570: 7769 6474 682e 0a20 2020 2020 2020 2052  width..        R
+00019580: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+00019590: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2074  ------.        t
+000195a0: 6f72 6368 2e54 656e 736f 7220 6f66 2073  orch.Tensor of s
+000195b0: 6861 7065 2028 422c 204e 2c20 4d29 0a20  hape (B, N, M). 
+000195c0: 2020 2020 2020 2020 2020 2050 7265 2d73             Pre-s
+000195d0: 756d 6d61 7469 6f6e 2072 6164 6961 6c20  ummation radial 
+000195e0: 7379 6d6d 6574 7279 2066 756e 6374 696f  symmetry functio
+000195f0: 6e2e 0a20 2020 2020 2020 2022 2222 0a20  n..        """. 
+00019600: 2020 2020 2020 204b 203d 2073 656c 662e         K = self.
+00019610: 6761 7573 7369 616e 5f64 6973 7461 6e63  gaussian_distanc
+00019620: 655f 6d61 7472 6978 2852 2c20 7273 2c20  e_matrix(R, rs, 
+00019630: 7265 290a 2020 2020 2020 2020 4643 203d  re).        FC =
+00019640: 2073 656c 662e 7261 6469 616c 5f63 7574   self.radial_cut
+00019650: 6f66 6628 522c 2072 6329 0a0a 2020 2020  off(R, rc)..    
+00019660: 2020 2020 7265 7475 726e 2074 6f72 6368      return torch
+00019670: 2e6d 756c 284b 2c20 4643 290a 0a0a 636c  .mul(K, FC)...cl
+00019680: 6173 7320 436f 6d62 696e 654d 6561 6e53  ass CombineMeanS
+00019690: 7464 286e 6e2e 4d6f 6475 6c65 293a 0a20  td(nn.Module):. 
+000196a0: 2020 2022 2222 4765 6e65 7261 7465 2047     """Generate G
+000196b0: 6175 7373 6961 6e20 6e6f 6973 652e 0a0a  aussian noise...
+000196c0: 2020 2020 5468 6973 2069 7320 7468 6520      This is the 
+000196d0: 546f 7263 6820 6571 7569 7661 6c65 6e74  Torch equivalent
+000196e0: 206f 6620 7468 6520 6f72 6967 696e 616c   of the original
+000196f0: 2069 6d70 6c65 6d65 6e74 6174 696f 6e20   implementation 
+00019700: 7573 696e 6720 4b65 7261 732e 0a20 2020  using Keras..   
+00019710: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+00019720: 696e 6974 5f5f 2873 656c 662c 0a20 2020  init__(self,.   
+00019730: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00019740: 6169 6e69 6e67 5f6f 6e6c 793a 2062 6f6f  aining_only: boo
+00019750: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+00019760: 2020 2020 2020 2020 2020 2020 6e6f 6973              nois
+00019770: 655f 6570 7369 6c6f 6e3a 2066 6c6f 6174  e_epsilon: float
+00019780: 203d 2031 2e30 2c0a 2020 2020 2020 2020   = 1.0,.        
+00019790: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+000197a0: 7329 3a0a 2020 2020 2020 2020 2222 2243  s):.        """C
+000197b0: 7265 6174 6520 6120 436f 6d62 696e 654d  reate a CombineM
+000197c0: 6561 6e53 7464 206c 6179 6572 2e0a 0a20  eanStd layer... 
+000197d0: 2020 2020 2020 2054 6869 7320 6c61 7965         This laye
+000197e0: 7220 7368 6f75 6c64 2068 6176 6520 7477  r should have tw
+000197f0: 6f20 696e 7075 7473 2077 6974 6820 7468  o inputs with th
+00019800: 6520 7361 6d65 2073 6861 7065 2c20 616e  e same shape, an
+00019810: 6420 6974 730a 2020 2020 2020 2020 6f75  d its.        ou
+00019820: 7470 7574 2061 6c73 6f20 6861 7320 7468  tput also has th
+00019830: 6520 7361 6d65 2073 6861 7065 2e20 2045  e same shape.  E
+00019840: 6163 6820 656c 656d 656e 7420 6f66 2074  ach element of t
+00019850: 6865 206f 7574 7075 7420 6973 2061 0a20  he output is a. 
+00019860: 2020 2020 2020 2047 6175 7373 6961 6e20         Gaussian 
+00019870: 6469 7374 7269 6275 7465 6420 7261 6e64  distributed rand
+00019880: 6f6d 206e 756d 6265 7220 7768 6f73 6520  om number whose 
+00019890: 6d65 616e 2069 7320 7468 6520 636f 7272  mean is the corr
+000198a0: 6573 706f 6e64 696e 670a 2020 2020 2020  esponding.      
+000198b0: 2020 656c 656d 656e 7420 6f66 2074 6865    element of the
+000198c0: 2066 6972 7374 2069 6e70 7574 2c20 616e   first input, an
+000198d0: 6420 7768 6f73 6520 7374 616e 6461 7264  d whose standard
+000198e0: 2064 6576 6961 7469 6f6e 2069 7320 7468   deviation is th
+000198f0: 650a 2020 2020 2020 2020 636f 7272 6573  e.        corres
+00019900: 706f 6e64 696e 6720 656c 656d 656e 7420  ponding element 
+00019910: 6f66 2074 6865 2073 6563 6f6e 6420 696e  of the second in
+00019920: 7075 742e 0a0a 2020 2020 2020 2020 5061  put...        Pa
+00019930: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00019940: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00019950: 2020 2020 7472 6169 6e69 6e67 5f6f 6e6c      training_onl
+00019960: 793a 2062 6f6f 6c2c 206f 7074 696f 6e61  y: bool, optiona
+00019970: 6c20 2864 6566 6175 6c74 2046 616c 7365  l (default False
+00019980: 292e 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00019990: 6620 5472 7565 2c20 6e6f 6973 6520 6973  f True, noise is
+000199a0: 206f 6e6c 7920 6765 6e65 7261 7465 6420   only generated 
+000199b0: 6475 7269 6e67 2074 7261 696e 696e 672e  during training.
+000199c0: 2020 4475 7269 6e67 0a20 2020 2020 2020    During.       
+000199d0: 2020 2020 2070 7265 6469 6374 696f 6e2c       prediction,
+000199e0: 2074 6865 206f 7574 7075 7420 6973 2073   the output is s
+000199f0: 696d 706c 7920 6571 7561 6c20 746f 2074  imply equal to t
+00019a00: 6865 2066 6972 7374 2069 6e70 7574 2028  he first input (
+00019a10: 7468 6174 0a20 2020 2020 2020 2020 2020  that.           
+00019a20: 2069 732c 2074 6865 206d 6561 6e20 6f66   is, the mean of
+00019a30: 2074 6865 2064 6973 7472 6962 7574 696f   the distributio
+00019a40: 6e20 7573 6564 2064 7572 696e 6720 7472  n used during tr
+00019a50: 6169 6e69 6e67 292e 0a20 2020 2020 2020  aining)..       
+00019a60: 206e 6f69 7365 5f65 7073 696c 6f6e 3a20   noise_epsilon: 
+00019a70: 666c 6f61 742c 206f 7074 696f 6e61 6c20  float, optional 
+00019a80: 2864 6566 6175 6c74 2031 2e30 292e 0a20  (default 1.0).. 
+00019a90: 2020 2020 2020 2020 2020 2054 6865 206e             The n
+00019aa0: 6f69 7365 2069 7320 7363 616c 6564 2062  oise is scaled b
+00019ab0: 7920 7468 6973 2066 6163 746f 720a 2020  y this factor.  
+00019ac0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00019ad0: 2020 7375 7065 7228 436f 6d62 696e 654d    super(CombineM
+00019ae0: 6561 6e53 7464 2c20 7365 6c66 292e 5f5f  eanStd, self).__
+00019af0: 696e 6974 5f5f 282a 2a6b 7761 7267 7329  init__(**kwargs)
+00019b00: 0a20 2020 2020 2020 2073 656c 662e 7472  .        self.tr
+00019b10: 6169 6e69 6e67 5f6f 6e6c 7920 3d20 7472  aining_only = tr
+00019b20: 6169 6e69 6e67 5f6f 6e6c 790a 2020 2020  aining_only.    
+00019b30: 2020 2020 7365 6c66 2e6e 6f69 7365 5f65      self.noise_e
+00019b40: 7073 696c 6f6e 203d 206e 6f69 7365 5f65  psilon = noise_e
+00019b50: 7073 696c 6f6e 0a0a 2020 2020 6465 6620  psilon..    def 
+00019b60: 5f5f 7265 7072 5f5f 2873 656c 6629 202d  __repr__(self) -
+00019b70: 3e20 7374 723a 0a20 2020 2020 2020 2072  > str:.        r
+00019b80: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+00019b90: 2020 2020 6627 7b73 656c 662e 5f5f 636c      f'{self.__cl
+00019ba0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d28  ass__.__name__}(
+00019bb0: 7472 6169 6e69 6e67 5f6f 6e6c 793d 7b73  training_only={s
+00019bc0: 656c 662e 7472 6169 6e69 6e67 5f6f 6e6c  elf.training_onl
+00019bd0: 797d 2c20 6e6f 6973 655f 6570 7369 6c6f  y}, noise_epsilo
+00019be0: 6e3d 7b73 656c 662e 6e6f 6973 655f 6570  n={self.noise_ep
+00019bf0: 7369 6c6f 6e7d 2927 0a20 2020 2020 2020  silon})'.       
+00019c00: 2029 0a0a 2020 2020 6465 6620 666f 7277   )..    def forw
+00019c10: 6172 6428 7365 6c66 2c0a 2020 2020 2020  ard(self,.      
+00019c20: 2020 2020 2020 2020 2020 696e 7075 7473            inputs
+00019c30: 3a20 5365 7175 656e 6365 5b41 7272 6179  : Sequence[Array
+00019c40: 4c69 6b65 5d2c 0a20 2020 2020 2020 2020  Like],.         
+00019c50: 2020 2020 2020 2074 7261 696e 696e 673a         training:
+00019c60: 2062 6f6f 6c20 3d20 5472 7565 2920 2d3e   bool = True) ->
+00019c70: 2074 6f72 6368 2e54 656e 736f 723a 0a20   torch.Tensor:. 
+00019c80: 2020 2020 2020 2022 2222 496e 766f 6b65         """Invoke
+00019c90: 2074 6869 7320 6c61 7965 722e 0a0a 2020   this layer...  
+00019ca0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00019cb0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00019cc0: 2d2d 2d0a 2020 2020 2020 2020 696e 7075  ---.        inpu
+00019cd0: 7473 3a20 5365 7175 656e 6365 5b41 7272  ts: Sequence[Arr
+00019ce0: 6179 4c69 6b65 5d0a 2020 2020 2020 2020  ayLike].        
+00019cf0: 2020 2020 4669 7273 7420 656c 656d 656e      First elemen
+00019d00: 7420 6172 6520 7468 6520 6d65 616e 7320  t are the means 
+00019d10: 666f 7220 7468 6520 7261 6e64 6f6d 2067  for the random g
+00019d20: 656e 6572 6174 6564 206e 756d 6265 7273  enerated numbers
+00019d30: 2e0a 2020 2020 2020 2020 2020 2020 5365  ..            Se
+00019d40: 636f 6e64 2065 6c65 6d65 6e74 2061 7265  cond element are
+00019d50: 2074 6865 2073 7461 6e64 6172 6420 6465   the standard de
+00019d60: 7669 6174 696f 6e73 2066 6f72 2074 6865  viations for the
+00019d70: 2072 616e 646f 6d20 6765 6e65 7261 7465   random generate
+00019d80: 6420 6e75 6d62 6572 732e 0a20 2020 2020  d numbers..     
+00019d90: 2020 2074 7261 696e 696e 673a 2062 6f6f     training: boo
+00019da0: 6c2c 206f 7074 696f 6e61 6c20 2864 6566  l, optional (def
+00019db0: 6175 6c74 2054 7275 6529 2e0a 2020 2020  ault True)..    
+00019dc0: 2020 2020 2020 2020 5370 6563 6966 6965          Specifie
+00019dd0: 7320 7768 6574 6865 7220 746f 2067 656e  s whether to gen
+00019de0: 6572 6174 6520 6e6f 6973 652e 0a20 2020  erate noise..   
+00019df0: 2020 2020 2020 2020 204e 6f69 7365 2069           Noise i
+00019e00: 7320 6f6e 6c79 2061 6464 6564 2077 6865  s only added whe
+00019e10: 6e20 7472 6169 6e69 6e67 2e0a 0a20 2020  n training...   
+00019e20: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00019e30: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00019e40: 2020 2020 2054 656e 736f 7220 6f66 2047       Tensor of G
+00019e50: 6175 7373 6961 6e20 6469 7374 7269 6275  aussian distribu
+00019e60: 7465 6420 7261 6e64 6f6d 206e 756d 6265  ted random numbe
+00019e70: 7273 3a20 746f 7263 682e 5465 6e73 6f72  rs: torch.Tensor
+00019e80: 0a20 2020 2020 2020 2020 2020 2053 616d  .            Sam
+00019e90: 6520 7368 6170 6520 6173 2074 6865 206d  e shape as the m
+00019ea0: 6561 6e73 2061 6e64 2073 7461 6e64 6172  eans and standar
+00019eb0: 6420 6465 7669 6174 696f 6e73 2066 726f  d deviations fro
+00019ec0: 6d20 6069 6e70 7574 7360 2e0a 2020 2020  m `inputs`..    
+00019ed0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00019ee0: 6966 206c 656e 2869 6e70 7574 7329 2021  if len(inputs) !
+00019ef0: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
+00019f00: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00019f10: 7228 224d 7573 7420 6861 7665 2074 776f  r("Must have two
+00019f20: 2069 6e5f 6c61 7965 7273 2229 0a0a 2020   in_layers")..  
+00019f30: 2020 2020 2020 6d65 616e 5f70 6172 656e        mean_paren
+00019f40: 742c 2073 7464 5f70 6172 656e 7420 3d20  t, std_parent = 
+00019f50: 746f 7263 682e 7465 6e73 6f72 2869 6e70  torch.tensor(inp
+00019f60: 7574 735b 305d 292c 2074 6f72 6368 2e74  uts[0]), torch.t
+00019f70: 656e 736f 7228 0a20 2020 2020 2020 2020  ensor(.         
+00019f80: 2020 2069 6e70 7574 735b 315d 290a 2020     inputs[1]).  
+00019f90: 2020 2020 2020 6e6f 6973 655f 7363 616c        noise_scal
+00019fa0: 6520 3d20 746f 7263 682e 7465 6e73 6f72  e = torch.tensor
+00019fb0: 2874 7261 696e 696e 6720 6f72 0a20 2020  (training or.   
 00019fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fd0: 2020 2020 2020 2020 2020 6e6f 7420 7365            not se
-00019fe0: 6c66 2e74 7261 696e 696e 675f 6f6e 6c79  lf.training_only
-00019ff0: 292e 746f 2874 6f72 6368 2e66 6c6f 6174  ).to(torch.float
-0001a000: 290a 2020 2020 2020 2020 7361 6d70 6c65  ).        sample
-0001a010: 5f6e 6f69 7365 203d 2074 6f72 6368 2e6e  _noise = torch.n
-0001a020: 6f72 6d61 6c28 302e 302c 2073 656c 662e  ormal(0.0, self.
-0001a030: 6e6f 6973 655f 6570 7369 6c6f 6e2c 206d  noise_epsilon, m
-0001a040: 6561 6e5f 7061 7265 6e74 2e73 6861 7065  ean_parent.shape
-0001a050: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0001a060: 206d 6561 6e5f 7061 7265 6e74 202b 206e   mean_parent + n
-0001a070: 6f69 7365 5f73 6361 6c65 202a 2073 7464  oise_scale * std
-0001a080: 5f70 6172 656e 7420 2a20 7361 6d70 6c65  _parent * sample
-0001a090: 5f6e 6f69 7365 0a0a 0a63 6c61 7373 2047  _noise...class G
-0001a0a0: 6174 6564 5265 6375 7272 656e 7455 6e69  atedRecurrentUni
-0001a0b0: 7428 6e6e 2e4d 6f64 756c 6529 3a0a 2020  t(nn.Module):.  
-0001a0c0: 2020 2222 2220 5375 626d 6f64 756c 6520    """ Submodule 
-0001a0d0: 666f 7220 4d65 7373 6167 6520 5061 7373  for Message Pass
-0001a0e0: 696e 6720 2222 220a 0a20 2020 2064 6566  ing """..    def
-0001a0f0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0001a100: 6e5f 6869 6464 656e 3d31 3030 2c20 696e  n_hidden=100, in
-0001a110: 6974 3d27 7861 7669 6572 5f75 6e69 666f  it='xavier_unifo
-0001a120: 726d 5f27 2c20 2a2a 6b77 6172 6773 293a  rm_', **kwargs):
-0001a130: 0a20 2020 2020 2020 2073 7570 6572 2847  .        super(G
-0001a140: 6174 6564 5265 6375 7272 656e 7455 6e69  atedRecurrentUni
-0001a150: 742c 2073 656c 6629 2e5f 5f69 6e69 745f  t, self).__init_
-0001a160: 5f28 2a2a 6b77 6172 6773 290a 2020 2020  _(**kwargs).    
-0001a170: 2020 2020 7365 6c66 2e6e 5f68 6964 6465      self.n_hidde
-0001a180: 6e20 3d20 6e5f 6869 6464 656e 0a20 2020  n = n_hidden.   
-0001a190: 2020 2020 2073 656c 662e 696e 6974 203d       self.init =
-0001a1a0: 2069 6e69 740a 2020 2020 2020 2020 696e   init.        in
-0001a1b0: 6974 203d 2067 6574 6174 7472 2869 6e69  it = getattr(ini
-0001a1c0: 7469 616c 697a 6572 732c 2073 656c 662e  tializers, self.
-0001a1d0: 696e 6974 290a 2020 2020 2020 2020 7365  init).        se
-0001a1e0: 6c66 2e57 7a20 3d20 696e 6974 2874 6f72  lf.Wz = init(tor
-0001a1f0: 6368 2e65 6d70 7479 286e 5f68 6964 6465  ch.empty(n_hidde
-0001a200: 6e2c 206e 5f68 6964 6465 6e29 290a 2020  n, n_hidden)).  
-0001a210: 2020 2020 2020 7365 6c66 2e57 7220 3d20        self.Wr = 
-0001a220: 696e 6974 2874 6f72 6368 2e65 6d70 7479  init(torch.empty
-0001a230: 286e 5f68 6964 6465 6e2c 206e 5f68 6964  (n_hidden, n_hid
-0001a240: 6465 6e29 290a 2020 2020 2020 2020 7365  den)).        se
-0001a250: 6c66 2e57 6820 3d20 696e 6974 2874 6f72  lf.Wh = init(tor
-0001a260: 6368 2e65 6d70 7479 286e 5f68 6964 6465  ch.empty(n_hidde
-0001a270: 6e2c 206e 5f68 6964 6465 6e29 290a 2020  n, n_hidden)).  
-0001a280: 2020 2020 2020 7365 6c66 2e55 7a20 3d20        self.Uz = 
-0001a290: 696e 6974 2874 6f72 6368 2e65 6d70 7479  init(torch.empty
-0001a2a0: 286e 5f68 6964 6465 6e2c 206e 5f68 6964  (n_hidden, n_hid
-0001a2b0: 6465 6e29 290a 2020 2020 2020 2020 7365  den)).        se
-0001a2c0: 6c66 2e55 7220 3d20 696e 6974 2874 6f72  lf.Ur = init(tor
-0001a2d0: 6368 2e65 6d70 7479 286e 5f68 6964 6465  ch.empty(n_hidde
-0001a2e0: 6e2c 206e 5f68 6964 6465 6e29 290a 2020  n, n_hidden)).  
-0001a2f0: 2020 2020 2020 7365 6c66 2e55 6820 3d20        self.Uh = 
-0001a300: 696e 6974 2874 6f72 6368 2e65 6d70 7479  init(torch.empty
-0001a310: 286e 5f68 6964 6465 6e2c 206e 5f68 6964  (n_hidden, n_hid
-0001a320: 6465 6e29 290a 2020 2020 2020 2020 7365  den)).        se
-0001a330: 6c66 2e62 7a20 3d20 746f 7263 682e 7a65  lf.bz = torch.ze
-0001a340: 726f 7328 286e 5f68 6964 6465 6e2c 2929  ros((n_hidden,))
-0001a350: 0a20 2020 2020 2020 2073 656c 662e 6272  .        self.br
-0001a360: 203d 2074 6f72 6368 2e7a 6572 6f73 2828   = torch.zeros((
-0001a370: 6e5f 6869 6464 656e 2c29 290a 2020 2020  n_hidden,)).    
-0001a380: 2020 2020 7365 6c66 2e62 6820 3d20 746f      self.bh = to
-0001a390: 7263 682e 7a65 726f 7328 286e 5f68 6964  rch.zeros((n_hid
-0001a3a0: 6465 6e2c 2929 0a0a 2020 2020 6465 6620  den,))..    def 
-0001a3b0: 666f 7277 6172 6428 7365 6c66 2c20 696e  forward(self, in
-0001a3c0: 7075 7473 293a 0a20 2020 2020 2020 2073  puts):.        s
-0001a3d0: 6967 6d6f 6964 203d 2067 6574 5f61 6374  igmoid = get_act
-0001a3e0: 6976 6174 696f 6e28 2773 6967 6d6f 6964  ivation('sigmoid
-0001a3f0: 2729 0a20 2020 2020 2020 2074 616e 6820  ').        tanh 
-0001a400: 3d20 6765 745f 6163 7469 7661 7469 6f6e  = get_activation
-0001a410: 2827 7461 6e68 2729 0a20 2020 2020 2020  ('tanh').       
-0001a420: 2068 5f74 6d31 2c20 7820 3d20 696e 7075   h_tm1, x = inpu
-0001a430: 7473 0a20 2020 2020 2020 207a 203d 2073  ts.        z = s
-0001a440: 6967 6d6f 6964 280a 2020 2020 2020 2020  igmoid(.        
-0001a450: 2020 2020 746f 7263 682e 6d61 746d 756c      torch.matmul
-0001a460: 2878 2c20 7365 6c66 2e57 7a29 202b 2074  (x, self.Wz) + t
-0001a470: 6f72 6368 2e6d 6174 6d75 6c28 685f 746d  orch.matmul(h_tm
-0001a480: 312c 2073 656c 662e 557a 2920 2b20 7365  1, self.Uz) + se
-0001a490: 6c66 2e62 7a29 0a20 2020 2020 2020 2072  lf.bz).        r
-0001a4a0: 203d 2073 6967 6d6f 6964 280a 2020 2020   = sigmoid(.    
-0001a4b0: 2020 2020 2020 2020 746f 7263 682e 6d61          torch.ma
-0001a4c0: 746d 756c 2878 2c20 7365 6c66 2e57 7229  tmul(x, self.Wr)
-0001a4d0: 202b 2074 6f72 6368 2e6d 6174 6d75 6c28   + torch.matmul(
-0001a4e0: 685f 746d 312c 2073 656c 662e 5572 2920  h_tm1, self.Ur) 
-0001a4f0: 2b20 7365 6c66 2e62 7229 0a20 2020 2020  + self.br).     
-0001a500: 2020 2068 203d 2028 3120 2d20 7a29 202a     h = (1 - z) *
-0001a510: 2074 616e 6828 0a20 2020 2020 2020 2020   tanh(.         
-0001a520: 2020 2074 6f72 6368 2e6d 6174 6d75 6c28     torch.matmul(
-0001a530: 782c 2073 656c 662e 5768 2920 2b20 746f  x, self.Wh) + to
-0001a540: 7263 682e 6d61 746d 756c 2868 5f74 6d31  rch.matmul(h_tm1
-0001a550: 202a 2072 2c20 7365 6c66 2e55 6829 202b   * r, self.Uh) +
-0001a560: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001a570: 662e 6268 2920 2b20 7a20 2a20 780a 2020  f.bh) + z * x.  
-0001a580: 2020 2020 2020 7265 7475 726e 2068 0a0a        return h..
-0001a590: 0a63 6c61 7373 2057 6569 6768 7465 644c  .class WeightedL
-0001a5a0: 696e 6561 7243 6f6d 626f 286e 6e2e 4d6f  inearCombo(nn.Mo
-0001a5b0: 6475 6c65 293a 0a20 2020 2022 2222 436f  dule):.    """Co
-0001a5c0: 6d70 7574 6520 6120 7765 6967 6874 6564  mpute a weighted
-0001a5d0: 206c 696e 6561 7220 636f 6d62 696e 6174   linear combinat
-0001a5e0: 696f 6e20 6f66 2069 6e70 7574 206c 6179  ion of input lay
-0001a5f0: 6572 732c 2077 6865 7265 2074 6865 2077  ers, where the w
-0001a600: 6569 6768 7420 7661 7269 6162 6c65 7320  eight variables 
-0001a610: 6172 6520 7472 6169 6e65 642e 0a0a 2020  are trained...  
-0001a620: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
-0001a630: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
-0001a640: 696e 7075 7431 203d 206e 702e 7261 6e64  input1 = np.rand
-0001a650: 6f6d 2e72 616e 6428 352c 2031 3029 2e61  om.rand(5, 10).a
-0001a660: 7374 7970 6528 6e70 2e66 6c6f 6174 3332  stype(np.float32
-0001a670: 290a 2020 2020 3e3e 3e20 696e 7075 7432  ).    >>> input2
-0001a680: 203d 206e 702e 7261 6e64 6f6d 2e72 616e   = np.random.ran
-0001a690: 6428 352c 2031 3029 2e61 7374 7970 6528  d(5, 10).astype(
-0001a6a0: 6e70 2e66 6c6f 6174 3332 290a 2020 2020  np.float32).    
-0001a6b0: 3e3e 3e20 6c61 7965 7220 3d20 5765 6967  >>> layer = Weig
-0001a6c0: 6874 6564 4c69 6e65 6172 436f 6d62 6f28  htedLinearCombo(
-0001a6d0: 6c65 6e28 5b69 6e70 7574 312c 2069 6e70  len([input1, inp
-0001a6e0: 7574 325d 2929 0a20 2020 203e 3e3e 2072  ut2])).    >>> r
-0001a6f0: 6573 756c 7420 3d20 6c61 7965 7228 5b69  esult = layer([i
-0001a700: 6e70 7574 312c 2069 6e70 7574 325d 290a  nput1, input2]).
-0001a710: 2020 2020 3e3e 3e20 7265 7375 6c74 2e73      >>> result.s
-0001a720: 6861 7065 0a20 2020 2074 6f72 6368 2e53  hape.    torch.S
-0001a730: 697a 6528 5b35 2c20 3130 5d29 0a20 2020  ize([5, 10]).   
-0001a740: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
-0001a750: 696e 6974 5f5f 2873 656c 662c 206e 756d  init__(self, num
-0001a760: 5f69 6e70 7574 733a 2069 6e74 2c20 7374  _inputs: int, st
-0001a770: 643a 2066 6c6f 6174 203d 2030 2e33 2c20  d: float = 0.3, 
-0001a780: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0001a790: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-0001a7a0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0001a7b0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0001a7c0: 2020 2020 2020 6e75 6d5f 696e 7075 7473        num_inputs
-0001a7d0: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
-0001a7e0: 2020 4e75 6d62 6572 206f 6620 696e 7075    Number of inpu
-0001a7f0: 7473 2067 6976 656e 2074 6f20 6073 656c  ts given to `sel
-0001a800: 662e 666f 7277 6172 6428 2960 0a20 2020  f.forward()`.   
-0001a810: 2020 2020 2020 2020 2054 6869 7320 6973           This is
-0001a820: 2075 7365 6420 746f 2069 6e69 7469 616c   used to initial
-0001a830: 697a 6520 7468 6520 636f 7272 6563 7420  ize the correct 
-0001a840: 616d 6f75 6e74 206f 6620 7765 6967 6874  amount of weight
-0001a850: 2076 6172 6961 626c 6573 2074 6f20 6265   variables to be
-0001a860: 2074 7261 696e 6564 2e0a 2020 2020 2020   trained..      
-0001a870: 2020 7374 643a 2066 6c6f 6174 0a20 2020    std: float.   
-0001a880: 2020 2020 2020 2020 2054 6865 2073 7461           The sta
-0001a890: 6e64 6172 6420 6465 7669 6174 696f 6e20  ndard deviation 
-0001a8a0: 666f 7220 7468 6520 6e6f 726d 616c 2064  for the normal d
-0001a8b0: 6973 7472 6962 7574 696f 6e20 7468 6174  istribution that
-0001a8c0: 2069 7320 7573 6564 2074 6f20 696e 6974   is used to init
-0001a8d0: 6961 6c69 7a65 2074 6865 2074 7261 696e  ialize the train
-0001a8e0: 6162 6c65 2077 6569 6768 7473 2e0a 2020  able weights..  
-0001a8f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001a900: 2020 7375 7065 7228 5765 6967 6874 6564    super(Weighted
-0001a910: 4c69 6e65 6172 436f 6d62 6f2c 2073 656c  LinearCombo, sel
-0001a920: 6629 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  f).__init__(**kw
-0001a930: 6172 6773 290a 2020 2020 2020 2020 7365  args).        se
-0001a940: 6c66 2e6e 756d 5f69 6e70 7574 7320 3d20  lf.num_inputs = 
-0001a950: 6e75 6d5f 696e 7075 7473 0a20 2020 2020  num_inputs.     
-0001a960: 2020 2073 656c 662e 7374 6420 3d20 7374     self.std = st
-0001a970: 640a 2020 2020 2020 2020 7365 6c66 2e69  d.        self.i
-0001a980: 6e70 7574 5f77 6569 6768 7473 203d 206e  nput_weights = n
-0001a990: 6e2e 5061 7261 6d65 7465 7228 746f 7263  n.Parameter(torc
-0001a9a0: 682e 656d 7074 7928 7365 6c66 2e6e 756d  h.empty(self.num
-0001a9b0: 5f69 6e70 7574 7329 290a 2020 2020 2020  _inputs)).      
-0001a9c0: 2020 6e6e 2e69 6e69 742e 6e6f 726d 616c    nn.init.normal
-0001a9d0: 5f28 7365 6c66 2e69 6e70 7574 5f77 6569  _(self.input_wei
-0001a9e0: 6768 7473 2c20 7374 643d 7374 6429 0a0a  ghts, std=std)..
-0001a9f0: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
-0001aa00: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001aa10: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-0001aa20: 2020 2020 2066 277b 7365 6c66 2e5f 5f63       f'{self.__c
-0001aa30: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-0001aa40: 286e 756d 5f69 6e70 7574 733d 7b73 656c  (num_inputs={sel
-0001aa50: 662e 6e75 6d5f 696e 7075 7473 7d2c 2073  f.num_inputs}, s
-0001aa60: 7464 3d7b 7365 6c66 2e73 7464 7d2c 2069  td={self.std}, i
-0001aa70: 6e70 7574 5f77 6569 6768 7473 3d7b 7365  nput_weights={se
-0001aa80: 6c66 2e69 6e70 7574 5f77 6569 6768 7473  lf.input_weights
-0001aa90: 7d29 270a 2020 2020 2020 2020 290a 0a20  })'.        ).. 
-0001aaa0: 2020 2064 6566 2066 6f72 7761 7264 280a     def forward(.
-0001aab0: 2020 2020 2020 2020 7365 6c66 2c20 696e          self, in
-0001aac0: 7075 7473 3a20 5365 7175 656e 6365 5b55  puts: Sequence[U
-0001aad0: 6e69 6f6e 5b41 7272 6179 4c69 6b65 2c0a  nion[ArrayLike,.
-0001aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fe0: 6e6f 7420 7365 6c66 2e74 7261 696e 696e  not self.trainin
+00019ff0: 675f 6f6e 6c79 292e 746f 2874 6f72 6368  g_only).to(torch
+0001a000: 2e66 6c6f 6174 290a 2020 2020 2020 2020  .float).        
+0001a010: 7361 6d70 6c65 5f6e 6f69 7365 203d 2074  sample_noise = t
+0001a020: 6f72 6368 2e6e 6f72 6d61 6c28 302e 302c  orch.normal(0.0,
+0001a030: 2073 656c 662e 6e6f 6973 655f 6570 7369   self.noise_epsi
+0001a040: 6c6f 6e2c 206d 6561 6e5f 7061 7265 6e74  lon, mean_parent
+0001a050: 2e73 6861 7065 290a 2020 2020 2020 2020  .shape).        
+0001a060: 7265 7475 726e 206d 6561 6e5f 7061 7265  return mean_pare
+0001a070: 6e74 202b 206e 6f69 7365 5f73 6361 6c65  nt + noise_scale
+0001a080: 202a 2073 7464 5f70 6172 656e 7420 2a20   * std_parent * 
+0001a090: 7361 6d70 6c65 5f6e 6f69 7365 0a0a 0a63  sample_noise...c
+0001a0a0: 6c61 7373 2047 6174 6564 5265 6375 7272  lass GatedRecurr
+0001a0b0: 656e 7455 6e69 7428 6e6e 2e4d 6f64 756c  entUnit(nn.Modul
+0001a0c0: 6529 3a0a 2020 2020 2222 2220 5375 626d  e):.    """ Subm
+0001a0d0: 6f64 756c 6520 666f 7220 4d65 7373 6167  odule for Messag
+0001a0e0: 6520 5061 7373 696e 6720 2222 220a 0a20  e Passing """.. 
+0001a0f0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0001a100: 7365 6c66 2c20 6e5f 6869 6464 656e 3d31  self, n_hidden=1
+0001a110: 3030 2c20 696e 6974 3d27 7861 7669 6572  00, init='xavier
+0001a120: 5f75 6e69 666f 726d 5f27 2c20 2a2a 6b77  _uniform_', **kw
+0001a130: 6172 6773 293a 0a20 2020 2020 2020 2073  args):.        s
+0001a140: 7570 6572 2847 6174 6564 5265 6375 7272  uper(GatedRecurr
+0001a150: 656e 7455 6e69 742c 2073 656c 6629 2e5f  entUnit, self)._
+0001a160: 5f69 6e69 745f 5f28 2a2a 6b77 6172 6773  _init__(**kwargs
+0001a170: 290a 2020 2020 2020 2020 7365 6c66 2e6e  ).        self.n
+0001a180: 5f68 6964 6465 6e20 3d20 6e5f 6869 6464  _hidden = n_hidd
+0001a190: 656e 0a20 2020 2020 2020 2073 656c 662e  en.        self.
+0001a1a0: 696e 6974 203d 2069 6e69 740a 2020 2020  init = init.    
+0001a1b0: 2020 2020 696e 6974 203d 2067 6574 6174      init = getat
+0001a1c0: 7472 2869 6e69 7469 616c 697a 6572 732c  tr(initializers,
+0001a1d0: 2073 656c 662e 696e 6974 290a 2020 2020   self.init).    
+0001a1e0: 2020 2020 7365 6c66 2e57 7a20 3d20 696e      self.Wz = in
+0001a1f0: 6974 2874 6f72 6368 2e65 6d70 7479 286e  it(torch.empty(n
+0001a200: 5f68 6964 6465 6e2c 206e 5f68 6964 6465  _hidden, n_hidde
+0001a210: 6e29 290a 2020 2020 2020 2020 7365 6c66  n)).        self
+0001a220: 2e57 7220 3d20 696e 6974 2874 6f72 6368  .Wr = init(torch
+0001a230: 2e65 6d70 7479 286e 5f68 6964 6465 6e2c  .empty(n_hidden,
+0001a240: 206e 5f68 6964 6465 6e29 290a 2020 2020   n_hidden)).    
+0001a250: 2020 2020 7365 6c66 2e57 6820 3d20 696e      self.Wh = in
+0001a260: 6974 2874 6f72 6368 2e65 6d70 7479 286e  it(torch.empty(n
+0001a270: 5f68 6964 6465 6e2c 206e 5f68 6964 6465  _hidden, n_hidde
+0001a280: 6e29 290a 2020 2020 2020 2020 7365 6c66  n)).        self
+0001a290: 2e55 7a20 3d20 696e 6974 2874 6f72 6368  .Uz = init(torch
+0001a2a0: 2e65 6d70 7479 286e 5f68 6964 6465 6e2c  .empty(n_hidden,
+0001a2b0: 206e 5f68 6964 6465 6e29 290a 2020 2020   n_hidden)).    
+0001a2c0: 2020 2020 7365 6c66 2e55 7220 3d20 696e      self.Ur = in
+0001a2d0: 6974 2874 6f72 6368 2e65 6d70 7479 286e  it(torch.empty(n
+0001a2e0: 5f68 6964 6465 6e2c 206e 5f68 6964 6465  _hidden, n_hidde
+0001a2f0: 6e29 290a 2020 2020 2020 2020 7365 6c66  n)).        self
+0001a300: 2e55 6820 3d20 696e 6974 2874 6f72 6368  .Uh = init(torch
+0001a310: 2e65 6d70 7479 286e 5f68 6964 6465 6e2c  .empty(n_hidden,
+0001a320: 206e 5f68 6964 6465 6e29 290a 2020 2020   n_hidden)).    
+0001a330: 2020 2020 7365 6c66 2e62 7a20 3d20 746f      self.bz = to
+0001a340: 7263 682e 7a65 726f 7328 286e 5f68 6964  rch.zeros((n_hid
+0001a350: 6465 6e2c 2929 0a20 2020 2020 2020 2073  den,)).        s
+0001a360: 656c 662e 6272 203d 2074 6f72 6368 2e7a  elf.br = torch.z
+0001a370: 6572 6f73 2828 6e5f 6869 6464 656e 2c29  eros((n_hidden,)
+0001a380: 290a 2020 2020 2020 2020 7365 6c66 2e62  ).        self.b
+0001a390: 6820 3d20 746f 7263 682e 7a65 726f 7328  h = torch.zeros(
+0001a3a0: 286e 5f68 6964 6465 6e2c 2929 0a0a 2020  (n_hidden,))..  
+0001a3b0: 2020 6465 6620 666f 7277 6172 6428 7365    def forward(se
+0001a3c0: 6c66 2c20 696e 7075 7473 293a 0a20 2020  lf, inputs):.   
+0001a3d0: 2020 2020 2073 6967 6d6f 6964 203d 2067       sigmoid = g
+0001a3e0: 6574 5f61 6374 6976 6174 696f 6e28 2773  et_activation('s
+0001a3f0: 6967 6d6f 6964 2729 0a20 2020 2020 2020  igmoid').       
+0001a400: 2074 616e 6820 3d20 6765 745f 6163 7469   tanh = get_acti
+0001a410: 7661 7469 6f6e 2827 7461 6e68 2729 0a20  vation('tanh'). 
+0001a420: 2020 2020 2020 2068 5f74 6d31 2c20 7820         h_tm1, x 
+0001a430: 3d20 696e 7075 7473 0a20 2020 2020 2020  = inputs.       
+0001a440: 207a 203d 2073 6967 6d6f 6964 280a 2020   z = sigmoid(.  
+0001a450: 2020 2020 2020 2020 2020 746f 7263 682e            torch.
+0001a460: 6d61 746d 756c 2878 2c20 7365 6c66 2e57  matmul(x, self.W
+0001a470: 7a29 202b 2074 6f72 6368 2e6d 6174 6d75  z) + torch.matmu
+0001a480: 6c28 685f 746d 312c 2073 656c 662e 557a  l(h_tm1, self.Uz
+0001a490: 2920 2b20 7365 6c66 2e62 7a29 0a20 2020  ) + self.bz).   
+0001a4a0: 2020 2020 2072 203d 2073 6967 6d6f 6964       r = sigmoid
+0001a4b0: 280a 2020 2020 2020 2020 2020 2020 746f  (.            to
+0001a4c0: 7263 682e 6d61 746d 756c 2878 2c20 7365  rch.matmul(x, se
+0001a4d0: 6c66 2e57 7229 202b 2074 6f72 6368 2e6d  lf.Wr) + torch.m
+0001a4e0: 6174 6d75 6c28 685f 746d 312c 2073 656c  atmul(h_tm1, sel
+0001a4f0: 662e 5572 2920 2b20 7365 6c66 2e62 7229  f.Ur) + self.br)
+0001a500: 0a20 2020 2020 2020 2068 203d 2028 3120  .        h = (1 
+0001a510: 2d20 7a29 202a 2074 616e 6828 0a20 2020  - z) * tanh(.   
+0001a520: 2020 2020 2020 2020 2074 6f72 6368 2e6d           torch.m
+0001a530: 6174 6d75 6c28 782c 2073 656c 662e 5768  atmul(x, self.Wh
+0001a540: 2920 2b20 746f 7263 682e 6d61 746d 756c  ) + torch.matmul
+0001a550: 2868 5f74 6d31 202a 2072 2c20 7365 6c66  (h_tm1 * r, self
+0001a560: 2e55 6829 202b 0a20 2020 2020 2020 2020  .Uh) +.         
+0001a570: 2020 2073 656c 662e 6268 2920 2b20 7a20     self.bh) + z 
+0001a580: 2a20 780a 2020 2020 2020 2020 7265 7475  * x.        retu
+0001a590: 726e 2068 0a0a 0a63 6c61 7373 2057 6569  rn h...class Wei
+0001a5a0: 6768 7465 644c 696e 6561 7243 6f6d 626f  ghtedLinearCombo
+0001a5b0: 286e 6e2e 4d6f 6475 6c65 293a 0a20 2020  (nn.Module):.   
+0001a5c0: 2022 2222 436f 6d70 7574 6520 6120 7765   """Compute a we
+0001a5d0: 6967 6874 6564 206c 696e 6561 7220 636f  ighted linear co
+0001a5e0: 6d62 696e 6174 696f 6e20 6f66 2069 6e70  mbination of inp
+0001a5f0: 7574 206c 6179 6572 732c 2077 6865 7265  ut layers, where
+0001a600: 2074 6865 2077 6569 6768 7420 7661 7269   the weight vari
+0001a610: 6162 6c65 7320 6172 6520 7472 6169 6e65  ables are traine
+0001a620: 642e 0a0a 2020 2020 4578 616d 706c 6573  d...    Examples
+0001a630: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+0001a640: 2020 3e3e 3e20 696e 7075 7431 203d 206e    >>> input1 = n
+0001a650: 702e 7261 6e64 6f6d 2e72 616e 6428 352c  p.random.rand(5,
+0001a660: 2031 3029 2e61 7374 7970 6528 6e70 2e66   10).astype(np.f
+0001a670: 6c6f 6174 3332 290a 2020 2020 3e3e 3e20  loat32).    >>> 
+0001a680: 696e 7075 7432 203d 206e 702e 7261 6e64  input2 = np.rand
+0001a690: 6f6d 2e72 616e 6428 352c 2031 3029 2e61  om.rand(5, 10).a
+0001a6a0: 7374 7970 6528 6e70 2e66 6c6f 6174 3332  stype(np.float32
+0001a6b0: 290a 2020 2020 3e3e 3e20 6c61 7965 7220  ).    >>> layer 
+0001a6c0: 3d20 5765 6967 6874 6564 4c69 6e65 6172  = WeightedLinear
+0001a6d0: 436f 6d62 6f28 6c65 6e28 5b69 6e70 7574  Combo(len([input
+0001a6e0: 312c 2069 6e70 7574 325d 2929 0a20 2020  1, input2])).   
+0001a6f0: 203e 3e3e 2072 6573 756c 7420 3d20 6c61   >>> result = la
+0001a700: 7965 7228 5b69 6e70 7574 312c 2069 6e70  yer([input1, inp
+0001a710: 7574 325d 290a 2020 2020 3e3e 3e20 7265  ut2]).    >>> re
+0001a720: 7375 6c74 2e73 6861 7065 0a20 2020 2074  sult.shape.    t
+0001a730: 6f72 6368 2e53 697a 6528 5b35 2c20 3130  orch.Size([5, 10
+0001a740: 5d29 0a20 2020 2022 2222 0a0a 2020 2020  ]).    """..    
+0001a750: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0001a760: 662c 206e 756d 5f69 6e70 7574 733a 2069  f, num_inputs: i
+0001a770: 6e74 2c20 7374 643a 2066 6c6f 6174 203d  nt, std: float =
+0001a780: 2030 2e33 2c20 2a2a 6b77 6172 6773 293a   0.3, **kwargs):
+0001a790: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0001a7a0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+0001a7b0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0001a7c0: 2d2d 2d0a 2020 2020 2020 2020 6e75 6d5f  ---.        num_
+0001a7d0: 696e 7075 7473 3a20 696e 740a 2020 2020  inputs: int.    
+0001a7e0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+0001a7f0: 6620 696e 7075 7473 2067 6976 656e 2074  f inputs given t
+0001a800: 6f20 6073 656c 662e 666f 7277 6172 6428  o `self.forward(
+0001a810: 2960 0a20 2020 2020 2020 2020 2020 2054  )`.            T
+0001a820: 6869 7320 6973 2075 7365 6420 746f 2069  his is used to i
+0001a830: 6e69 7469 616c 697a 6520 7468 6520 636f  nitialize the co
+0001a840: 7272 6563 7420 616d 6f75 6e74 206f 6620  rrect amount of 
+0001a850: 7765 6967 6874 2076 6172 6961 626c 6573  weight variables
+0001a860: 2074 6f20 6265 2074 7261 696e 6564 2e0a   to be trained..
+0001a870: 2020 2020 2020 2020 7374 643a 2066 6c6f          std: flo
+0001a880: 6174 0a20 2020 2020 2020 2020 2020 2054  at.            T
+0001a890: 6865 2073 7461 6e64 6172 6420 6465 7669  he standard devi
+0001a8a0: 6174 696f 6e20 666f 7220 7468 6520 6e6f  ation for the no
+0001a8b0: 726d 616c 2064 6973 7472 6962 7574 696f  rmal distributio
+0001a8c0: 6e20 7468 6174 2069 7320 7573 6564 2074  n that is used t
+0001a8d0: 6f20 696e 6974 6961 6c69 7a65 2074 6865  o initialize the
+0001a8e0: 2074 7261 696e 6162 6c65 2077 6569 6768   trainable weigh
+0001a8f0: 7473 2e0a 2020 2020 2020 2020 2222 220a  ts..        """.
+0001a900: 2020 2020 2020 2020 7375 7065 7228 5765          super(We
+0001a910: 6967 6874 6564 4c69 6e65 6172 436f 6d62  ightedLinearComb
+0001a920: 6f2c 2073 656c 6629 2e5f 5f69 6e69 745f  o, self).__init_
+0001a930: 5f28 2a2a 6b77 6172 6773 290a 2020 2020  _(**kwargs).    
+0001a940: 2020 2020 7365 6c66 2e6e 756d 5f69 6e70      self.num_inp
+0001a950: 7574 7320 3d20 6e75 6d5f 696e 7075 7473  uts = num_inputs
+0001a960: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+0001a970: 6420 3d20 7374 640a 2020 2020 2020 2020  d = std.        
+0001a980: 7365 6c66 2e69 6e70 7574 5f77 6569 6768  self.input_weigh
+0001a990: 7473 203d 206e 6e2e 5061 7261 6d65 7465  ts = nn.Paramete
+0001a9a0: 7228 746f 7263 682e 656d 7074 7928 7365  r(torch.empty(se
+0001a9b0: 6c66 2e6e 756d 5f69 6e70 7574 7329 290a  lf.num_inputs)).
+0001a9c0: 2020 2020 2020 2020 6e6e 2e69 6e69 742e          nn.init.
+0001a9d0: 6e6f 726d 616c 5f28 7365 6c66 2e69 6e70  normal_(self.inp
+0001a9e0: 7574 5f77 6569 6768 7473 2c20 7374 643d  ut_weights, std=
+0001a9f0: 7374 6429 0a0a 2020 2020 6465 6620 5f5f  std)..    def __
+0001aa00: 7265 7072 5f5f 2873 656c 6629 3a0a 2020  repr__(self):.  
+0001aa10: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
+0001aa20: 2020 2020 2020 2020 2020 2066 277b 7365             f'{se
+0001aa30: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
+0001aa40: 616d 655f 5f7d 286e 756d 5f69 6e70 7574  ame__}(num_input
+0001aa50: 733d 7b73 656c 662e 6e75 6d5f 696e 7075  s={self.num_inpu
+0001aa60: 7473 7d2c 2073 7464 3d7b 7365 6c66 2e73  ts}, std={self.s
+0001aa70: 7464 7d2c 2069 6e70 7574 5f77 6569 6768  td}, input_weigh
+0001aa80: 7473 3d7b 7365 6c66 2e69 6e70 7574 5f77  ts={self.input_w
+0001aa90: 6569 6768 7473 7d29 270a 2020 2020 2020  eights})'.      
+0001aaa0: 2020 290a 0a20 2020 2064 6566 2066 6f72    )..    def for
+0001aab0: 7761 7264 280a 2020 2020 2020 2020 7365  ward(.        se
+0001aac0: 6c66 2c20 696e 7075 7473 3a20 5365 7175  lf, inputs: Sequ
+0001aad0: 656e 6365 5b55 6e69 6f6e 5b41 7272 6179  ence[Union[Array
+0001aae0: 4c69 6b65 2c0a 2020 2020 2020 2020 2020  Like,.          
 0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab00: 2020 2020 2074 6f72 6368 2e54 656e 736f       torch.Tenso
-0001ab10: 725d 5d29 202d 3e20 4f70 7469 6f6e 616c  r]]) -> Optional
-0001ab20: 5b74 6f72 6368 2e54 656e 736f 725d 3a0a  [torch.Tensor]:.
-0001ab30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001ab40: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0001ab50: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0001ab60: 2d0a 2020 2020 2020 2020 696e 7075 7473  -.        inputs
-0001ab70: 3a20 5365 7175 656e 6365 5b55 6e69 6f6e  : Sequence[Union
-0001ab80: 5b41 7272 6179 4c69 6b65 2c20 746f 7263  [ArrayLike, torc
-0001ab90: 682e 5465 6e73 6f72 5d5d 0a20 2020 2020  h.Tensor]].     
-0001aba0: 2020 2020 2020 2054 6865 2069 6e69 7469         The initi
-0001abb0: 616c 2069 6e70 7574 206c 6179 6572 732e  al input layers.
-0001abc0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-0001abd0: 206c 656e 6774 6820 6d75 7374 2062 6520   length must be 
-0001abe0: 7468 6520 7361 6d65 2061 7320 6073 656c  the same as `sel
-0001abf0: 662e 6e75 6d5f 696e 7075 7473 602e 0a0a  f.num_inputs`...
-0001ac00: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-0001ac10: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-0001ac20: 2020 2020 2020 2020 6f75 745f 7465 6e73          out_tens
-0001ac30: 6f72 3a20 746f 7263 682e 5465 6e73 6f72  or: torch.Tensor
-0001ac40: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
-0001ac50: 2020 2020 2054 6865 2074 656e 736f 7220       The tensor 
-0001ac60: 636f 6e74 6169 6e69 6e67 2074 6865 2077  containing the w
-0001ac70: 6569 6768 7465 6420 6c69 6e65 6172 2063  eighted linear c
-0001ac80: 6f6d 6269 6e61 7469 6f6e 2e0a 2020 2020  ombination..    
-0001ac90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001aca0: 6f75 745f 7465 6e73 6f72 203d 204e 6f6e  out_tensor = Non
-0001acb0: 650a 2020 2020 2020 2020 666f 7220 696e  e.        for in
-0001acc0: 5f74 656e 736f 722c 2077 2069 6e20 7a69  _tensor, w in zi
-0001acd0: 7028 696e 7075 7473 2c20 7365 6c66 2e69  p(inputs, self.i
-0001ace0: 6e70 7574 5f77 6569 6768 7473 293a 0a20  nput_weights):. 
-0001acf0: 2020 2020 2020 2020 2020 2069 6e5f 7465             in_te
-0001ad00: 6e73 6f72 203d 2074 6f72 6368 2e46 6c6f  nsor = torch.Flo
-0001ad10: 6174 5465 6e73 6f72 2869 6e5f 7465 6e73  atTensor(in_tens
-0001ad20: 6f72 290a 2020 2020 2020 2020 2020 2020  or).            
-0001ad30: 6966 206f 7574 5f74 656e 736f 7220 6973  if out_tensor is
-0001ad40: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001ad50: 2020 2020 2020 206f 7574 5f74 656e 736f         out_tenso
-0001ad60: 7220 3d20 7720 2a20 696e 5f74 656e 736f  r = w * in_tenso
-0001ad70: 720a 2020 2020 2020 2020 2020 2020 656c  r.            el
-0001ad80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001ad90: 2020 2020 6f75 745f 7465 6e73 6f72 202b      out_tensor +
-0001ada0: 3d20 7720 2a20 696e 5f74 656e 736f 720a  = w * in_tensor.
-0001adb0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0001adc0: 7574 5f74 656e 736f 720a 0a0a 636c 6173  ut_tensor...clas
-0001add0: 7320 5365 7447 6174 6865 7228 6e6e 2e4d  s SetGather(nn.M
-0001ade0: 6f64 756c 6529 3a0a 2020 2020 2222 2273  odule):.    """s
-0001adf0: 6574 3273 6574 2067 6174 6865 7220 6c61  et2set gather la
-0001ae00: 7965 7220 666f 7220 6772 6170 682d 6261  yer for graph-ba
-0001ae10: 7365 6420 6d6f 6465 6c0a 0a20 2020 204d  sed model..    M
-0001ae20: 6f64 656c 7320 7573 696e 6720 7468 6973  odels using this
-0001ae30: 206c 6179 6572 206d 7573 7420 7365 7420   layer must set 
-0001ae40: 6070 6164 5f62 6174 6368 6573 3d54 7275  `pad_batches=Tru
-0001ae50: 6560 0a0a 2020 2020 546f 7263 6820 4571  e`..    Torch Eq
-0001ae60: 7569 7661 6c65 6e74 206f 6620 4b65 7261  uivalent of Kera
-0001ae70: 7320 5365 7447 6174 6865 7220 6c61 7965  s SetGather laye
-0001ae80: 720a 0a20 2020 2050 6172 616d 6574 6572  r..    Parameter
-0001ae90: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-0001aea0: 0a20 2020 204d 3a20 696e 740a 2020 2020  .    M: int.    
-0001aeb0: 2020 2020 4e75 6d62 6572 206f 6620 4c53      Number of LS
-0001aec0: 544d 2073 7465 7073 0a20 2020 2062 6174  TM steps.    bat
-0001aed0: 6368 5f73 697a 653a 2069 6e74 0a20 2020  ch_size: int.   
-0001aee0: 2020 2020 204e 756d 6265 7220 6f66 2073       Number of s
-0001aef0: 616d 706c 6573 2069 6e20 6120 6261 7463  amples in a batc
-0001af00: 6828 616c 6c20 6261 7463 6865 7320 6d75  h(all batches mu
-0001af10: 7374 2068 6176 6520 7361 6d65 2073 697a  st have same siz
-0001af20: 6529 0a20 2020 206e 5f68 6964 6465 6e3a  e).    n_hidden:
-0001af30: 2069 6e74 2c20 6f70 7469 6f6e 616c 0a20   int, optional. 
-0001af40: 2020 2020 2020 206e 756d 6265 7220 6f66         number of
-0001af50: 2068 6964 6465 6e20 756e 6974 7320 696e   hidden units in
-0001af60: 2074 6865 2070 6173 7369 6e67 2070 6861   the passing pha
-0001af70: 7365 0a0a 2020 2020 4578 616d 706c 6573  se..    Examples
-0001af80: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-0001af90: 2020 3e3e 3e20 696d 706f 7274 2064 6565    >>> import dee
-0001afa0: 7063 6865 6d20 6173 2064 630a 2020 2020  pchem as dc.    
-0001afb0: 3e3e 3e20 696d 706f 7274 206e 756d 7079  >>> import numpy
-0001afc0: 2061 7320 6e70 0a20 2020 203e 3e3e 2066   as np.    >>> f
-0001afd0: 726f 6d20 6465 6570 6368 656d 2e6d 6f64  rom deepchem.mod
-0001afe0: 656c 732e 746f 7263 685f 6d6f 6465 6c73  els.torch_models
-0001aff0: 2069 6d70 6f72 7420 6c61 7965 7273 0a20   import layers. 
-0001b000: 2020 203e 3e3e 2074 6f74 616c 5f6e 5f61     >>> total_n_a
-0001b010: 746f 6d73 203d 2034 0a20 2020 203e 3e3e  toms = 4.    >>>
-0001b020: 206e 5f61 746f 6d5f 6665 6174 203d 2034   n_atom_feat = 4
-0001b030: 0a20 2020 203e 3e3e 2061 746f 6d5f 6665  .    >>> atom_fe
-0001b040: 6174 203d 206e 702e 7261 6e64 6f6d 2e72  at = np.random.r
-0001b050: 616e 6428 746f 7461 6c5f 6e5f 6174 6f6d  and(total_n_atom
-0001b060: 732c 206e 5f61 746f 6d5f 6665 6174 290a  s, n_atom_feat).
-0001b070: 2020 2020 3e3e 3e20 6174 6f6d 5f73 706c      >>> atom_spl
-0001b080: 6974 203d 206e 702e 6172 7261 7928 5b30  it = np.array([0
-0001b090: 2c20 302c 2031 2c20 315d 2c20 6474 7970  , 0, 1, 1], dtyp
-0001b0a0: 653d 6e70 2e69 6e74 3332 290a 2020 2020  e=np.int32).    
-0001b0b0: 3e3e 3e20 6761 7468 6572 203d 206c 6179  >>> gather = lay
-0001b0c0: 6572 732e 5365 7447 6174 6865 7228 322c  ers.SetGather(2,
-0001b0d0: 2032 2c20 6e5f 6869 6464 656e 3d34 290a   2, n_hidden=4).
-0001b0e0: 2020 2020 3e3e 3e20 6f75 7470 7574 5f6d      >>> output_m
-0001b0f0: 6f6c 6563 756c 6573 203d 2067 6174 6865  olecules = gathe
-0001b100: 7228 5b61 746f 6d5f 6665 6174 2c20 6174  r([atom_feat, at
-0001b110: 6f6d 5f73 706c 6974 5d29 0a20 2020 203e  om_split]).    >
-0001b120: 3e3e 2070 7269 6e74 286f 7574 7075 745f  >> print(output_
-0001b130: 6d6f 6c65 6375 6c65 732e 7368 6170 6529  molecules.shape)
-0001b140: 0a20 2020 2074 6f72 6368 2e53 697a 6528  .    torch.Size(
-0001b150: 5b32 2c20 385d 290a 0a20 2020 2022 2222  [2, 8])..    """
-0001b160: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-0001b170: 5f5f 2873 656c 662c 0a20 2020 2020 2020  __(self,.       
-0001b180: 2020 2020 2020 2020 2020 4d3a 2069 6e74            M: int
-0001b190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001b1a0: 2020 2062 6174 6368 5f73 697a 653a 2069     batch_size: i
-0001b1b0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-0001b1c0: 2020 2020 206e 5f68 6964 6465 6e3a 2069       n_hidden: i
-0001b1d0: 6e74 203d 2031 3030 2c0a 2020 2020 2020  nt = 100,.      
-0001b1e0: 2020 2020 2020 2020 2020 2069 6e69 743d             init=
-0001b1f0: 276f 7274 686f 676f 6e61 6c27 2c0a 2020  'orthogonal',.  
-0001b200: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0001b210: 2a6b 7761 7267 7329 3a0a 0a20 2020 2020  *kwargs):..     
-0001b220: 2020 2073 7570 6572 2853 6574 4761 7468     super(SetGath
-0001b230: 6572 2c20 7365 6c66 292e 5f5f 696e 6974  er, self).__init
-0001b240: 5f5f 282a 2a6b 7761 7267 7329 0a20 2020  __(**kwargs).   
-0001b250: 2020 2020 2073 656c 662e 4d20 3d20 4d0a       self.M = M.
-0001b260: 2020 2020 2020 2020 7365 6c66 2e62 6174          self.bat
-0001b270: 6368 5f73 697a 6520 3d20 6261 7463 685f  ch_size = batch_
-0001b280: 7369 7a65 0a20 2020 2020 2020 2073 656c  size.        sel
-0001b290: 662e 6e5f 6869 6464 656e 203d 206e 5f68  f.n_hidden = n_h
-0001b2a0: 6964 6465 6e0a 2020 2020 2020 2020 7365  idden.        se
-0001b2b0: 6c66 2e69 6e69 7420 3d20 696e 6974 0a0a  lf.init = init..
-0001b2c0: 2020 2020 2020 2020 7365 6c66 2e55 203d          self.U =
-0001b2d0: 206e 6e2e 5061 7261 6d65 7465 7228 0a20   nn.Parameter(. 
-0001b2e0: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
-0001b2f0: 2e54 656e 736f 7228 3220 2a20 7365 6c66  .Tensor(2 * self
-0001b300: 2e6e 5f68 6964 6465 6e2c 2034 202a 2073  .n_hidden, 4 * s
-0001b310: 656c 662e 6e5f 6869 6464 656e 292e 6e6f  elf.n_hidden).no
-0001b320: 726d 616c 5f28 6d65 616e 3d30 2e30 2c0a  rmal_(mean=0.0,.
-0001b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab00: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
+0001ab10: 2e54 656e 736f 725d 5d29 202d 3e20 4f70  .Tensor]]) -> Op
+0001ab20: 7469 6f6e 616c 5b74 6f72 6368 2e54 656e  tional[torch.Ten
+0001ab30: 736f 725d 3a0a 2020 2020 2020 2020 2222  sor]:.        ""
+0001ab40: 220a 2020 2020 2020 2020 5061 7261 6d65  ".        Parame
+0001ab50: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+0001ab60: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0001ab70: 696e 7075 7473 3a20 5365 7175 656e 6365  inputs: Sequence
+0001ab80: 5b55 6e69 6f6e 5b41 7272 6179 4c69 6b65  [Union[ArrayLike
+0001ab90: 2c20 746f 7263 682e 5465 6e73 6f72 5d5d  , torch.Tensor]]
+0001aba0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+0001abb0: 2069 6e69 7469 616c 2069 6e70 7574 206c   initial input l
+0001abc0: 6179 6572 732e 0a20 2020 2020 2020 2020  ayers..         
+0001abd0: 2020 2054 6865 206c 656e 6774 6820 6d75     The length mu
+0001abe0: 7374 2062 6520 7468 6520 7361 6d65 2061  st be the same a
+0001abf0: 7320 6073 656c 662e 6e75 6d5f 696e 7075  s `self.num_inpu
+0001ac00: 7473 602e 0a0a 2020 2020 2020 2020 5265  ts`...        Re
+0001ac10: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+0001ac20: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6f75  -----.        ou
+0001ac30: 745f 7465 6e73 6f72 3a20 746f 7263 682e  t_tensor: torch.
+0001ac40: 5465 6e73 6f72 206f 7220 4e6f 6e65 0a20  Tensor or None. 
+0001ac50: 2020 2020 2020 2020 2020 2054 6865 2074             The t
+0001ac60: 656e 736f 7220 636f 6e74 6169 6e69 6e67  ensor containing
+0001ac70: 2074 6865 2077 6569 6768 7465 6420 6c69   the weighted li
+0001ac80: 6e65 6172 2063 6f6d 6269 6e61 7469 6f6e  near combination
+0001ac90: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0001aca0: 2020 2020 2020 6f75 745f 7465 6e73 6f72        out_tensor
+0001acb0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0001acc0: 666f 7220 696e 5f74 656e 736f 722c 2077  for in_tensor, w
+0001acd0: 2069 6e20 7a69 7028 696e 7075 7473 2c20   in zip(inputs, 
+0001ace0: 7365 6c66 2e69 6e70 7574 5f77 6569 6768  self.input_weigh
+0001acf0: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
+0001ad00: 2069 6e5f 7465 6e73 6f72 203d 2074 6f72   in_tensor = tor
+0001ad10: 6368 2e46 6c6f 6174 5465 6e73 6f72 2869  ch.FloatTensor(i
+0001ad20: 6e5f 7465 6e73 6f72 290a 2020 2020 2020  n_tensor).      
+0001ad30: 2020 2020 2020 6966 206f 7574 5f74 656e        if out_ten
+0001ad40: 736f 7220 6973 204e 6f6e 653a 0a20 2020  sor is None:.   
+0001ad50: 2020 2020 2020 2020 2020 2020 206f 7574               out
+0001ad60: 5f74 656e 736f 7220 3d20 7720 2a20 696e  _tensor = w * in
+0001ad70: 5f74 656e 736f 720a 2020 2020 2020 2020  _tensor.        
+0001ad80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001ad90: 2020 2020 2020 2020 2020 6f75 745f 7465            out_te
+0001ada0: 6e73 6f72 202b 3d20 7720 2a20 696e 5f74  nsor += w * in_t
+0001adb0: 656e 736f 720a 2020 2020 2020 2020 7265  ensor.        re
+0001adc0: 7475 726e 206f 7574 5f74 656e 736f 720a  turn out_tensor.
+0001add0: 0a0a 636c 6173 7320 5365 7447 6174 6865  ..class SetGathe
+0001ade0: 7228 6e6e 2e4d 6f64 756c 6529 3a0a 2020  r(nn.Module):.  
+0001adf0: 2020 2222 2273 6574 3273 6574 2067 6174    """set2set gat
+0001ae00: 6865 7220 6c61 7965 7220 666f 7220 6772  her layer for gr
+0001ae10: 6170 682d 6261 7365 6420 6d6f 6465 6c0a  aph-based model.
+0001ae20: 0a20 2020 204d 6f64 656c 7320 7573 696e  .    Models usin
+0001ae30: 6720 7468 6973 206c 6179 6572 206d 7573  g this layer mus
+0001ae40: 7420 7365 7420 6070 6164 5f62 6174 6368  t set `pad_batch
+0001ae50: 6573 3d54 7275 6560 0a0a 2020 2020 546f  es=True`..    To
+0001ae60: 7263 6820 4571 7569 7661 6c65 6e74 206f  rch Equivalent o
+0001ae70: 6620 4b65 7261 7320 5365 7447 6174 6865  f Keras SetGathe
+0001ae80: 7220 6c61 7965 720a 0a20 2020 2050 6172  r layer..    Par
+0001ae90: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+0001aea0: 2d2d 2d2d 2d2d 0a20 2020 204d 3a20 696e  ------.    M: in
+0001aeb0: 740a 2020 2020 2020 2020 4e75 6d62 6572  t.        Number
+0001aec0: 206f 6620 4c53 544d 2073 7465 7073 0a20   of LSTM steps. 
+0001aed0: 2020 2062 6174 6368 5f73 697a 653a 2069     batch_size: i
+0001aee0: 6e74 0a20 2020 2020 2020 204e 756d 6265  nt.        Numbe
+0001aef0: 7220 6f66 2073 616d 706c 6573 2069 6e20  r of samples in 
+0001af00: 6120 6261 7463 6828 616c 6c20 6261 7463  a batch(all batc
+0001af10: 6865 7320 6d75 7374 2068 6176 6520 7361  hes must have sa
+0001af20: 6d65 2073 697a 6529 0a20 2020 206e 5f68  me size).    n_h
+0001af30: 6964 6465 6e3a 2069 6e74 2c20 6f70 7469  idden: int, opti
+0001af40: 6f6e 616c 0a20 2020 2020 2020 206e 756d  onal.        num
+0001af50: 6265 7220 6f66 2068 6964 6465 6e20 756e  ber of hidden un
+0001af60: 6974 7320 696e 2074 6865 2070 6173 7369  its in the passi
+0001af70: 6e67 2070 6861 7365 0a0a 2020 2020 4578  ng phase..    Ex
+0001af80: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
+0001af90: 2d2d 2d0a 2020 2020 3e3e 3e20 696d 706f  ---.    >>> impo
+0001afa0: 7274 2064 6565 7063 6865 6d20 6173 2064  rt deepchem as d
+0001afb0: 630a 2020 2020 3e3e 3e20 696d 706f 7274  c.    >>> import
+0001afc0: 206e 756d 7079 2061 7320 6e70 0a20 2020   numpy as np.   
+0001afd0: 203e 3e3e 2066 726f 6d20 6465 6570 6368   >>> from deepch
+0001afe0: 656d 2e6d 6f64 656c 732e 746f 7263 685f  em.models.torch_
+0001aff0: 6d6f 6465 6c73 2069 6d70 6f72 7420 6c61  models import la
+0001b000: 7965 7273 0a20 2020 203e 3e3e 2074 6f74  yers.    >>> tot
+0001b010: 616c 5f6e 5f61 746f 6d73 203d 2034 0a20  al_n_atoms = 4. 
+0001b020: 2020 203e 3e3e 206e 5f61 746f 6d5f 6665     >>> n_atom_fe
+0001b030: 6174 203d 2034 0a20 2020 203e 3e3e 2061  at = 4.    >>> a
+0001b040: 746f 6d5f 6665 6174 203d 206e 702e 7261  tom_feat = np.ra
+0001b050: 6e64 6f6d 2e72 616e 6428 746f 7461 6c5f  ndom.rand(total_
+0001b060: 6e5f 6174 6f6d 732c 206e 5f61 746f 6d5f  n_atoms, n_atom_
+0001b070: 6665 6174 290a 2020 2020 3e3e 3e20 6174  feat).    >>> at
+0001b080: 6f6d 5f73 706c 6974 203d 206e 702e 6172  om_split = np.ar
+0001b090: 7261 7928 5b30 2c20 302c 2031 2c20 315d  ray([0, 0, 1, 1]
+0001b0a0: 2c20 6474 7970 653d 6e70 2e69 6e74 3332  , dtype=np.int32
+0001b0b0: 290a 2020 2020 3e3e 3e20 6761 7468 6572  ).    >>> gather
+0001b0c0: 203d 206c 6179 6572 732e 5365 7447 6174   = layers.SetGat
+0001b0d0: 6865 7228 322c 2032 2c20 6e5f 6869 6464  her(2, 2, n_hidd
+0001b0e0: 656e 3d34 290a 2020 2020 3e3e 3e20 6f75  en=4).    >>> ou
+0001b0f0: 7470 7574 5f6d 6f6c 6563 756c 6573 203d  tput_molecules =
+0001b100: 2067 6174 6865 7228 5b61 746f 6d5f 6665   gather([atom_fe
+0001b110: 6174 2c20 6174 6f6d 5f73 706c 6974 5d29  at, atom_split])
+0001b120: 0a20 2020 203e 3e3e 2070 7269 6e74 286f  .    >>> print(o
+0001b130: 7574 7075 745f 6d6f 6c65 6375 6c65 732e  utput_molecules.
+0001b140: 7368 6170 6529 0a20 2020 2074 6f72 6368  shape).    torch
+0001b150: 2e53 697a 6528 5b32 2c20 385d 290a 0a20  .Size([2, 8]).. 
+0001b160: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+0001b170: 5f5f 696e 6974 5f5f 2873 656c 662c 0a20  __init__(self,. 
+0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b190: 4d3a 2069 6e74 2c0a 2020 2020 2020 2020  M: int,.        
+0001b1a0: 2020 2020 2020 2020 2062 6174 6368 5f73           batch_s
+0001b1b0: 697a 653a 2069 6e74 2c0a 2020 2020 2020  ize: int,.      
+0001b1c0: 2020 2020 2020 2020 2020 206e 5f68 6964             n_hid
+0001b1d0: 6465 6e3a 2069 6e74 203d 2031 3030 2c0a  den: int = 100,.
+0001b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1f0: 2069 6e69 743d 276f 7274 686f 676f 6e61   init='orthogona
+0001b200: 6c27 2c0a 2020 2020 2020 2020 2020 2020  l',.            
+0001b210: 2020 2020 202a 2a6b 7761 7267 7329 3a0a       **kwargs):.
+0001b220: 0a20 2020 2020 2020 2073 7570 6572 2853  .        super(S
+0001b230: 6574 4761 7468 6572 2c20 7365 6c66 292e  etGather, self).
+0001b240: 5f5f 696e 6974 5f5f 282a 2a6b 7761 7267  __init__(**kwarg
+0001b250: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+0001b260: 4d20 3d20 4d0a 2020 2020 2020 2020 7365  M = M.        se
+0001b270: 6c66 2e62 6174 6368 5f73 697a 6520 3d20  lf.batch_size = 
+0001b280: 6261 7463 685f 7369 7a65 0a20 2020 2020  batch_size.     
+0001b290: 2020 2073 656c 662e 6e5f 6869 6464 656e     self.n_hidden
+0001b2a0: 203d 206e 5f68 6964 6465 6e0a 2020 2020   = n_hidden.    
+0001b2b0: 2020 2020 7365 6c66 2e69 6e69 7420 3d20      self.init = 
+0001b2c0: 696e 6974 0a0a 2020 2020 2020 2020 7365  init..        se
+0001b2d0: 6c66 2e55 203d 206e 6e2e 5061 7261 6d65  lf.U = nn.Parame
+0001b2e0: 7465 7228 0a20 2020 2020 2020 2020 2020  ter(.           
+0001b2f0: 2074 6f72 6368 2e54 656e 736f 7228 3220   torch.Tensor(2 
+0001b300: 2a20 7365 6c66 2e6e 5f68 6964 6465 6e2c  * self.n_hidden,
+0001b310: 2034 202a 2073 656c 662e 6e5f 6869 6464   4 * self.n_hidd
+0001b320: 656e 292e 6e6f 726d 616c 5f28 6d65 616e  en).normal_(mean
+0001b330: 3d30 2e30 2c0a 2020 2020 2020 2020 2020  =0.0,.          
 0001b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b370: 2020 2020 2020 2073 7464 3d30 2e31 2929         std=0.1))
-0001b380: 0a20 2020 2020 2020 2073 656c 662e 6220  .        self.b 
-0001b390: 3d20 6e6e 2e50 6172 616d 6574 6572 280a  = nn.Parameter(.
-0001b3a0: 2020 2020 2020 2020 2020 2020 746f 7263              torc
-0001b3b0: 682e 6361 7428 2874 6f72 6368 2e7a 6572  h.cat((torch.zer
-0001b3c0: 6f73 2873 656c 662e 6e5f 6869 6464 656e  os(self.n_hidden
-0001b3d0: 292c 2074 6f72 6368 2e6f 6e65 7328 7365  ), torch.ones(se
-0001b3e0: 6c66 2e6e 5f68 6964 6465 6e29 2c0a 2020  lf.n_hidden),.  
-0001b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b400: 2020 2020 2074 6f72 6368 2e7a 6572 6f73       torch.zeros
-0001b410: 2873 656c 662e 6e5f 6869 6464 656e 292c  (self.n_hidden),
-0001b420: 2074 6f72 6368 2e7a 6572 6f73 2873 656c   torch.zeros(sel
-0001b430: 662e 6e5f 6869 6464 656e 2929 2929 0a20  f.n_hidden)))). 
-0001b440: 2020 2020 2020 2073 656c 662e 6275 696c         self.buil
-0001b450: 7420 3d20 5472 7565 0a0a 2020 2020 6465  t = True..    de
-0001b460: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
-0001b470: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
-0001b480: 2072 6574 7572 6e20 280a 2020 2020 2020   return (.      
-0001b490: 2020 2020 2020 6627 7b73 656c 662e 5f5f        f'{self.__
-0001b4a0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-0001b4b0: 7d28 4d3d 7b73 656c 662e 4d7d 2c20 6261  }(M={self.M}, ba
-0001b4c0: 7463 685f 7369 7a65 3d7b 7365 6c66 2e62  tch_size={self.b
-0001b4d0: 6174 6368 5f73 697a 657d 2c20 6e5f 6869  atch_size}, n_hi
-0001b4e0: 6464 656e 3d7b 7365 6c66 2e6e 5f68 6964  dden={self.n_hid
-0001b4f0: 6465 6e7d 2c20 696e 6974 3d7b 7365 6c66  den}, init={self
-0001b500: 2e69 6e69 747d 2927 0a20 2020 2020 2020  .init})'.       
-0001b510: 2029 0a0a 2020 2020 6465 6620 666f 7277   )..    def forw
-0001b520: 6172 6428 7365 6c66 2c20 696e 7075 7473  ard(self, inputs
-0001b530: 3a20 4c69 7374 2920 2d3e 2074 6f72 6368  : List) -> torch
-0001b540: 2e54 656e 736f 723a 0a20 2020 2020 2020  .Tensor:.       
-0001b550: 2022 2222 5065 7266 6f72 6d20 4d20 7374   """Perform M st
-0001b560: 6570 7320 6f66 2073 6574 3273 6574 2067  eps of set2set g
-0001b570: 6174 6865 722c 0a0a 2020 2020 2020 2020  ather,..        
-0001b580: 4465 7461 696c 6564 2064 6573 6372 6970  Detailed descrip
-0001b590: 7469 6f6e 7320 696e 3a20 6874 7470 733a  tions in: https:
-0001b5a0: 2f2f 6172 7869 762e 6f72 672f 6162 732f  //arxiv.org/abs/
-0001b5b0: 3135 3131 2e30 3633 3931 0a0a 2020 2020  1511.06391..    
-0001b5c0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-0001b5d0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0001b5e0: 2d0a 2020 2020 2020 2020 696e 7075 7473  -.        inputs
-0001b5f0: 3a20 4c69 7374 0a20 2020 2020 2020 2020  : List.         
-0001b600: 2020 2054 6869 7320 636f 6e74 6169 6e73     This contains
-0001b610: 2074 776f 2065 6c65 6d65 6e74 732e 0a20   two elements.. 
-0001b620: 2020 2020 2020 2020 2020 2061 746f 6d5f             atom_
-0001b630: 6665 6174 7572 6573 3a20 6e70 2e6e 6461  features: np.nda
-0001b640: 7272 6179 0a20 2020 2020 2020 2020 2020  rray.           
-0001b650: 2061 746f 6d5f 7370 6c69 743a 206e 702e   atom_split: np.
-0001b660: 6e64 6172 7261 790a 0a20 2020 2020 2020  ndarray..       
-0001b670: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-0001b680: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
-0001b690: 2071 5f73 7461 723a 2074 6f72 6368 2e54   q_star: torch.T
-0001b6a0: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
-0001b6b0: 2020 4669 6e61 6c20 7374 6174 6520 6f66    Final state of
-0001b6c0: 2074 6865 206d 6f64 656c 2061 6674 6572   the model after
-0001b6d0: 2061 6c6c 204d 2073 7465 7073 2e0a 0a20   all M steps... 
-0001b6e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001b6f0: 2020 2061 746f 6d5f 6665 6174 7572 6573     atom_features
-0001b700: 2c20 6174 6f6d 5f73 706c 6974 203d 2069  , atom_split = i
-0001b710: 6e70 7574 730a 2020 2020 2020 2020 6320  nputs.        c 
-0001b720: 3d20 746f 7263 682e 7a65 726f 7328 2873  = torch.zeros((s
-0001b730: 656c 662e 6261 7463 685f 7369 7a65 2c20  elf.batch_size, 
-0001b740: 7365 6c66 2e6e 5f68 6964 6465 6e29 290a  self.n_hidden)).
-0001b750: 2020 2020 2020 2020 6820 3d20 746f 7263          h = torc
-0001b760: 682e 7a65 726f 7328 2873 656c 662e 6261  h.zeros((self.ba
-0001b770: 7463 685f 7369 7a65 2c20 7365 6c66 2e6e  tch_size, self.n
-0001b780: 5f68 6964 6465 6e29 290a 0a20 2020 2020  _hidden))..     
-0001b790: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0001b7a0: 6528 7365 6c66 2e4d 293a 0a20 2020 2020  e(self.M):.     
-0001b7b0: 2020 2020 2020 2071 5f65 7870 616e 6465         q_expande
-0001b7c0: 6420 3d20 685b 6174 6f6d 5f73 706c 6974  d = h[atom_split
-0001b7d0: 5d0a 2020 2020 2020 2020 2020 2020 6520  ].            e 
-0001b7e0: 3d20 2874 6f72 6368 2e66 726f 6d5f 6e75  = (torch.from_nu
-0001b7f0: 6d70 7928 6174 6f6d 5f66 6561 7475 7265  mpy(atom_feature
-0001b800: 7329 202a 2071 5f65 7870 616e 6465 6429  s) * q_expanded)
-0001b810: 2e73 756d 2864 696d 3d2d 3129 0a20 2020  .sum(dim=-1).   
-0001b820: 2020 2020 2020 2020 2065 5f6d 6f6c 7320           e_mols 
-0001b830: 3d20 7365 6c66 2e5f 6479 6e61 6d69 635f  = self._dynamic_
-0001b840: 7061 7274 6974 696f 6e28 652c 2061 746f  partition(e, ato
-0001b850: 6d5f 7370 6c69 742c 2073 656c 662e 6261  m_split, self.ba
-0001b860: 7463 685f 7369 7a65 290a 0a20 2020 2020  tch_size)..     
-0001b870: 2020 2020 2020 2023 2041 6464 2061 6e6f         # Add ano
-0001b880: 7468 6572 2076 616c 7565 287e 2d49 6e66  ther value(~-Inf
-0001b890: 2920 746f 2070 7265 7665 6e74 2065 7272  ) to prevent err
-0001b8a0: 6f72 2069 6e20 736f 6674 6d61 780a 2020  or in softmax.  
-0001b8b0: 2020 2020 2020 2020 2020 655f 6d6f 6c73            e_mols
-0001b8c0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-0001b8d0: 2020 2020 2074 6f72 6368 2e63 6174 285b       torch.cat([
-0001b8e0: 655f 6d6f 6c2c 2074 6f72 6368 2e74 656e  e_mol, torch.ten
-0001b8f0: 736f 7228 5b2d 3130 3030 2e5d 295d 2c20  sor([-1000.])], 
-0001b900: 6469 6d3d 3029 0a20 2020 2020 2020 2020  dim=0).         
-0001b910: 2020 2020 2020 2066 6f72 2065 5f6d 6f6c         for e_mol
-0001b920: 2069 6e20 655f 6d6f 6c73 0a20 2020 2020   in e_mols.     
-0001b930: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-0001b940: 2020 2020 2061 203d 2074 6f72 6368 2e63       a = torch.c
-0001b950: 6174 285b 0a20 2020 2020 2020 2020 2020  at([.           
-0001b960: 2020 2020 2074 6f72 6368 2e6e 6e2e 6675       torch.nn.fu
-0001b970: 6e63 7469 6f6e 616c 2e73 6f66 746d 6178  nctional.softmax
-0001b980: 2865 5f6d 6f6c 5b3a 2d31 5d2c 2064 696d  (e_mol[:-1], dim
-0001b990: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
-0001b9a0: 2020 2020 666f 7220 655f 6d6f 6c20 696e      for e_mol in
-0001b9b0: 2065 5f6d 6f6c 730a 2020 2020 2020 2020   e_mols.        
-0001b9c0: 2020 2020 5d2c 0a20 2020 2020 2020 2020      ],.         
+0001b370: 2020 2020 2020 2020 2020 2020 2073 7464               std
+0001b380: 3d30 2e31 2929 0a20 2020 2020 2020 2073  =0.1)).        s
+0001b390: 656c 662e 6220 3d20 6e6e 2e50 6172 616d  elf.b = nn.Param
+0001b3a0: 6574 6572 280a 2020 2020 2020 2020 2020  eter(.          
+0001b3b0: 2020 746f 7263 682e 6361 7428 2874 6f72    torch.cat((tor
+0001b3c0: 6368 2e7a 6572 6f73 2873 656c 662e 6e5f  ch.zeros(self.n_
+0001b3d0: 6869 6464 656e 292c 2074 6f72 6368 2e6f  hidden), torch.o
+0001b3e0: 6e65 7328 7365 6c66 2e6e 5f68 6964 6465  nes(self.n_hidde
+0001b3f0: 6e29 2c0a 2020 2020 2020 2020 2020 2020  n),.            
+0001b400: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
+0001b410: 2e7a 6572 6f73 2873 656c 662e 6e5f 6869  .zeros(self.n_hi
+0001b420: 6464 656e 292c 2074 6f72 6368 2e7a 6572  dden), torch.zer
+0001b430: 6f73 2873 656c 662e 6e5f 6869 6464 656e  os(self.n_hidden
+0001b440: 2929 2929 0a20 2020 2020 2020 2073 656c  )))).        sel
+0001b450: 662e 6275 696c 7420 3d20 5472 7565 0a0a  f.built = True..
+0001b460: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
+0001b470: 2873 656c 6629 202d 3e20 7374 723a 0a20  (self) -> str:. 
+0001b480: 2020 2020 2020 2072 6574 7572 6e20 280a         return (.
+0001b490: 2020 2020 2020 2020 2020 2020 6627 7b73              f'{s
+0001b4a0: 656c 662e 5f5f 636c 6173 735f 5f2e 5f5f  elf.__class__.__
+0001b4b0: 6e61 6d65 5f5f 7d28 4d3d 7b73 656c 662e  name__}(M={self.
+0001b4c0: 4d7d 2c20 6261 7463 685f 7369 7a65 3d7b  M}, batch_size={
+0001b4d0: 7365 6c66 2e62 6174 6368 5f73 697a 657d  self.batch_size}
+0001b4e0: 2c20 6e5f 6869 6464 656e 3d7b 7365 6c66  , n_hidden={self
+0001b4f0: 2e6e 5f68 6964 6465 6e7d 2c20 696e 6974  .n_hidden}, init
+0001b500: 3d7b 7365 6c66 2e69 6e69 747d 2927 0a20  ={self.init})'. 
+0001b510: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0001b520: 6620 666f 7277 6172 6428 7365 6c66 2c20  f forward(self, 
+0001b530: 696e 7075 7473 3a20 4c69 7374 2920 2d3e  inputs: List) ->
+0001b540: 2074 6f72 6368 2e54 656e 736f 723a 0a20   torch.Tensor:. 
+0001b550: 2020 2020 2020 2022 2222 5065 7266 6f72         """Perfor
+0001b560: 6d20 4d20 7374 6570 7320 6f66 2073 6574  m M steps of set
+0001b570: 3273 6574 2067 6174 6865 722c 0a0a 2020  2set gather,..  
+0001b580: 2020 2020 2020 4465 7461 696c 6564 2064        Detailed d
+0001b590: 6573 6372 6970 7469 6f6e 7320 696e 3a20  escriptions in: 
+0001b5a0: 6874 7470 733a 2f2f 6172 7869 762e 6f72  https://arxiv.or
+0001b5b0: 672f 6162 732f 3135 3131 2e30 3633 3931  g/abs/1511.06391
+0001b5c0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+0001b5d0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+0001b5e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0001b5f0: 696e 7075 7473 3a20 4c69 7374 0a20 2020  inputs: List.   
+0001b600: 2020 2020 2020 2020 2054 6869 7320 636f           This co
+0001b610: 6e74 6169 6e73 2074 776f 2065 6c65 6d65  ntains two eleme
+0001b620: 6e74 732e 0a20 2020 2020 2020 2020 2020  nts..           
+0001b630: 2061 746f 6d5f 6665 6174 7572 6573 3a20   atom_features: 
+0001b640: 6e70 2e6e 6461 7272 6179 0a20 2020 2020  np.ndarray.     
+0001b650: 2020 2020 2020 2061 746f 6d5f 7370 6c69         atom_spli
+0001b660: 743a 206e 702e 6e64 6172 7261 790a 0a20  t: np.ndarray.. 
+0001b670: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+0001b680: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+0001b690: 2020 2020 2020 2071 5f73 7461 723a 2074         q_star: t
+0001b6a0: 6f72 6368 2e54 656e 736f 720a 2020 2020  orch.Tensor.    
+0001b6b0: 2020 2020 2020 2020 4669 6e61 6c20 7374          Final st
+0001b6c0: 6174 6520 6f66 2074 6865 206d 6f64 656c  ate of the model
+0001b6d0: 2061 6674 6572 2061 6c6c 204d 2073 7465   after all M ste
+0001b6e0: 7073 2e0a 0a20 2020 2020 2020 2022 2222  ps...        """
+0001b6f0: 0a20 2020 2020 2020 2061 746f 6d5f 6665  .        atom_fe
+0001b700: 6174 7572 6573 2c20 6174 6f6d 5f73 706c  atures, atom_spl
+0001b710: 6974 203d 2069 6e70 7574 730a 2020 2020  it = inputs.    
+0001b720: 2020 2020 6320 3d20 746f 7263 682e 7a65      c = torch.ze
+0001b730: 726f 7328 2873 656c 662e 6261 7463 685f  ros((self.batch_
+0001b740: 7369 7a65 2c20 7365 6c66 2e6e 5f68 6964  size, self.n_hid
+0001b750: 6465 6e29 290a 2020 2020 2020 2020 6820  den)).        h 
+0001b760: 3d20 746f 7263 682e 7a65 726f 7328 2873  = torch.zeros((s
+0001b770: 656c 662e 6261 7463 685f 7369 7a65 2c20  elf.batch_size, 
+0001b780: 7365 6c66 2e6e 5f68 6964 6465 6e29 290a  self.n_hidden)).
+0001b790: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
+0001b7a0: 6e20 7261 6e67 6528 7365 6c66 2e4d 293a  n range(self.M):
+0001b7b0: 0a20 2020 2020 2020 2020 2020 2071 5f65  .            q_e
+0001b7c0: 7870 616e 6465 6420 3d20 685b 6174 6f6d  xpanded = h[atom
+0001b7d0: 5f73 706c 6974 5d0a 2020 2020 2020 2020  _split].        
+0001b7e0: 2020 2020 6520 3d20 2874 6f72 6368 2e66      e = (torch.f
+0001b7f0: 726f 6d5f 6e75 6d70 7928 6174 6f6d 5f66  rom_numpy(atom_f
+0001b800: 6561 7475 7265 7329 202a 2071 5f65 7870  eatures) * q_exp
+0001b810: 616e 6465 6429 2e73 756d 2864 696d 3d2d  anded).sum(dim=-
+0001b820: 3129 0a20 2020 2020 2020 2020 2020 2065  1).            e
+0001b830: 5f6d 6f6c 7320 3d20 7365 6c66 2e5f 6479  _mols = self._dy
+0001b840: 6e61 6d69 635f 7061 7274 6974 696f 6e28  namic_partition(
+0001b850: 652c 2061 746f 6d5f 7370 6c69 742c 2073  e, atom_split, s
+0001b860: 656c 662e 6261 7463 685f 7369 7a65 290a  elf.batch_size).
+0001b870: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
+0001b880: 6464 2061 6e6f 7468 6572 2076 616c 7565  dd another value
+0001b890: 287e 2d49 6e66 2920 746f 2070 7265 7665  (~-Inf) to preve
+0001b8a0: 6e74 2065 7272 6f72 2069 6e20 736f 6674  nt error in soft
+0001b8b0: 6d61 780a 2020 2020 2020 2020 2020 2020  max.            
+0001b8c0: 655f 6d6f 6c73 203d 205b 0a20 2020 2020  e_mols = [.     
+0001b8d0: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
+0001b8e0: 2e63 6174 285b 655f 6d6f 6c2c 2074 6f72  .cat([e_mol, tor
+0001b8f0: 6368 2e74 656e 736f 7228 5b2d 3130 3030  ch.tensor([-1000
+0001b900: 2e5d 295d 2c20 6469 6d3d 3029 0a20 2020  .])], dim=0).   
+0001b910: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001b920: 2065 5f6d 6f6c 2069 6e20 655f 6d6f 6c73   e_mol in e_mols
+0001b930: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
+0001b940: 2020 2020 2020 2020 2020 2061 203d 2074             a = t
+0001b950: 6f72 6368 2e63 6174 285b 0a20 2020 2020  orch.cat([.     
+0001b960: 2020 2020 2020 2020 2020 2074 6f72 6368             torch
+0001b970: 2e6e 6e2e 6675 6e63 7469 6f6e 616c 2e73  .nn.functional.s
+0001b980: 6f66 746d 6178 2865 5f6d 6f6c 5b3a 2d31  oftmax(e_mol[:-1
+0001b990: 5d2c 2064 696d 3d30 290a 2020 2020 2020  ], dim=0).      
+0001b9a0: 2020 2020 2020 2020 2020 666f 7220 655f            for e_
+0001b9b0: 6d6f 6c20 696e 2065 5f6d 6f6c 730a 2020  mol in e_mols.  
+0001b9c0: 2020 2020 2020 2020 2020 5d2c 0a20 2020            ],.   
 0001b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9e0: 2064 696d 3d30 290a 0a20 2020 2020 2020   dim=0)..       
-0001b9f0: 2020 2020 2072 203d 2073 6361 7474 6572       r = scatter
-0001ba00: 2874 6f72 6368 2e72 6573 6861 7065 2861  (torch.reshape(a
-0001ba10: 2c20 5b2d 312c 2031 5d29 202a 2061 746f  , [-1, 1]) * ato
-0001ba20: 6d5f 6665 6174 7572 6573 2c0a 2020 2020  m_features,.    
-0001ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba40: 2020 2020 746f 7263 682e 6672 6f6d 5f6e      torch.from_n
-0001ba50: 756d 7079 2861 746f 6d5f 7370 6c69 7429  umpy(atom_split)
-0001ba60: 2e6c 6f6e 6728 292c 0a20 2020 2020 2020  .long(),.       
+0001b9e0: 2020 2020 2020 2064 696d 3d30 290a 0a20         dim=0).. 
+0001b9f0: 2020 2020 2020 2020 2020 2072 203d 2073             r = s
+0001ba00: 6361 7474 6572 2874 6f72 6368 2e72 6573  catter(torch.res
+0001ba10: 6861 7065 2861 2c20 5b2d 312c 2031 5d29  hape(a, [-1, 1])
+0001ba20: 202a 2061 746f 6d5f 6665 6174 7572 6573   * atom_features
+0001ba30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001ba40: 2020 2020 2020 2020 2020 746f 7263 682e            torch.
+0001ba50: 6672 6f6d 5f6e 756d 7079 2861 746f 6d5f  from_numpy(atom_
+0001ba60: 7370 6c69 7429 2e6c 6f6e 6728 292c 0a20  split).long(),. 
 0001ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba80: 2064 696d 3d30 290a 2020 2020 2020 2020   dim=0).        
-0001ba90: 2020 2020 2320 4d6f 6465 6c20 7573 696e      # Model usin
-0001baa0: 6720 7468 6973 206c 6179 6572 206d 7573  g this layer mus
-0001bab0: 7420 7365 7420 6070 6164 5f62 6174 6368  t set `pad_batch
-0001bac0: 6573 3d54 7275 6560 0a20 2020 2020 2020  es=True`.       
-0001bad0: 2020 2020 2071 5f73 7461 7220 3d20 746f       q_star = to
-0001bae0: 7263 682e 6361 7428 5b68 2c20 725d 2c20  rch.cat([h, r], 
-0001baf0: 6469 6d3d 3129 0a20 2020 2020 2020 2020  dim=1).         
-0001bb00: 2020 2068 2c20 6320 3d20 7365 6c66 2e5f     h, c = self._
-0001bb10: 4c53 544d 5374 6570 2871 5f73 7461 722c  LSTMStep(q_star,
-0001bb20: 2063 290a 2020 2020 2020 2020 7265 7475   c).        retu
-0001bb30: 726e 2071 5f73 7461 720a 0a20 2020 2064  rn q_star..    d
-0001bb40: 6566 205f 4c53 544d 5374 6570 2873 656c  ef _LSTMStep(sel
-0001bb50: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-0001bb60: 2020 2020 2068 3a20 746f 7263 682e 5465       h: torch.Te
-0001bb70: 6e73 6f72 2c0a 2020 2020 2020 2020 2020  nsor,.          
-0001bb80: 2020 2020 2020 2020 633a 2074 6f72 6368          c: torch
-0001bb90: 2e54 656e 736f 722c 0a20 2020 2020 2020  .Tensor,.       
-0001bba0: 2020 2020 2020 2020 2020 2078 3d4e 6f6e             x=Non
-0001bbb0: 6529 202d 3e20 5475 706c 655b 746f 7263  e) -> Tuple[torc
-0001bbc0: 682e 5465 6e73 6f72 2c20 746f 7263 682e  h.Tensor, torch.
-0001bbd0: 5465 6e73 6f72 5d3a 0a20 2020 2020 2020  Tensor]:.       
-0001bbe0: 2022 2222 5468 6973 206d 6574 686f 7264   """This methord
-0001bbf0: 2070 6572 666f 726d 7320 6120 7369 6e67   performs a sing
-0001bc00: 6c65 2073 7465 7020 6f66 2061 204c 6f6e  le step of a Lon
-0001bc10: 6720 5368 6f72 742d 5465 726d 204d 656d  g Short-Term Mem
-0001bc20: 6f72 7920 284c 5354 4d29 2063 656c 6c2c  ory (LSTM) cell,
-0001bc30: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0001bc40: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-0001bc50: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0001bc60: 683a 2074 6f72 6368 2e54 656e 736f 720a  h: torch.Tensor.
-0001bc70: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-0001bc80: 6869 6464 656e 2073 7461 7465 206f 6620  hidden state of 
-0001bc90: 7468 6520 4c53 544d 2063 656c 6c2e 0a20  the LSTM cell.. 
-0001bca0: 2020 2020 2020 2063 3a20 746f 7263 682e         c: torch.
-0001bcb0: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
-0001bcc0: 2020 2054 6865 2063 656c 6c20 7374 6174     The cell stat
-0001bcd0: 6520 6f66 2074 6865 204c 5354 4d20 6365  e of the LSTM ce
-0001bce0: 6c6c 2e0a 0a20 2020 2020 2020 2052 6574  ll...        Ret
-0001bcf0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-0001bd00: 2d2d 2d2d 0a20 2020 2020 2020 2068 5f6f  ----.        h_o
-0001bd10: 7574 3a20 746f 7263 682e 5465 6e73 6f72  ut: torch.Tensor
-0001bd20: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-0001bd30: 2075 7064 6174 6564 2068 6964 6465 6e20   updated hidden 
-0001bd40: 7374 6174 6520 6f66 2074 6865 204c 5354  state of the LST
-0001bd50: 4d20 6365 6c6c 2e0a 2020 2020 2020 2020  M cell..        
-0001bd60: 635f 6f75 743a 2074 6f72 6368 2e54 656e  c_out: torch.Ten
-0001bd70: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-0001bd80: 5468 6520 7570 6461 7465 6420 6365 6c6c  The updated cell
-0001bd90: 2073 7461 7465 206f 6620 7468 6520 4c53   state of the LS
-0001bda0: 544d 2063 656c 6c2e 0a0a 2020 2020 2020  TM cell...      
-0001bdb0: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-0001bdc0: 7a20 3d20 746f 7263 682e 6d6d 2868 2c20  z = torch.mm(h, 
-0001bdd0: 7365 6c66 2e55 2920 2b20 7365 6c66 2e62  self.U) + self.b
-0001bde0: 0a20 2020 2020 2020 207a 203d 2046 2e6c  .        z = F.l
-0001bdf0: 696e 6561 7228 682e 666c 6f61 7428 292e  inear(h.float().
-0001be00: 6465 7461 6368 2829 2c0a 2020 2020 2020  detach(),.      
-0001be10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001be20: 656c 662e 552e 666c 6f61 7428 292e 542e  elf.U.float().T.
-0001be30: 6465 7461 6368 2829 2c20 7365 6c66 2e62  detach(), self.b
-0001be40: 2e64 6574 6163 6828 2929 0a20 2020 2020  .detach()).     
-0001be50: 2020 2069 203d 2074 6f72 6368 2e73 6967     i = torch.sig
-0001be60: 6d6f 6964 287a 5b3a 2c20 3a73 656c 662e  moid(z[:, :self.
-0001be70: 6e5f 6869 6464 656e 5d29 0a20 2020 2020  n_hidden]).     
-0001be80: 2020 2066 203d 2074 6f72 6368 2e73 6967     f = torch.sig
-0001be90: 6d6f 6964 287a 5b3a 2c20 7365 6c66 2e6e  moid(z[:, self.n
-0001bea0: 5f68 6964 6465 6e3a 3220 2a20 7365 6c66  _hidden:2 * self
-0001beb0: 2e6e 5f68 6964 6465 6e5d 290a 2020 2020  .n_hidden]).    
-0001bec0: 2020 2020 6f20 3d20 746f 7263 682e 7369      o = torch.si
-0001bed0: 676d 6f69 6428 7a5b 3a2c 2032 202a 2073  gmoid(z[:, 2 * s
-0001bee0: 656c 662e 6e5f 6869 6464 656e 3a33 202a  elf.n_hidden:3 *
-0001bef0: 2073 656c 662e 6e5f 6869 6464 656e 5d29   self.n_hidden])
-0001bf00: 0a20 2020 2020 2020 207a 3320 3d20 7a5b  .        z3 = z[
-0001bf10: 3a2c 2033 202a 2073 656c 662e 6e5f 6869  :, 3 * self.n_hi
-0001bf20: 6464 656e 3a5d 0a20 2020 2020 2020 2063  dden:].        c
-0001bf30: 5f6f 7574 203d 2066 202a 2063 202b 2069  _out = f * c + i
-0001bf40: 202a 2074 6f72 6368 2e74 616e 6828 7a33   * torch.tanh(z3
-0001bf50: 290a 2020 2020 2020 2020 685f 6f75 7420  ).        h_out 
-0001bf60: 3d20 6f20 2a20 746f 7263 682e 7461 6e68  = o * torch.tanh
-0001bf70: 2863 5f6f 7574 290a 2020 2020 2020 2020  (c_out).        
-0001bf80: 7265 7475 726e 2068 5f6f 7574 2c20 635f  return h_out, c_
-0001bf90: 6f75 740a 0a20 2020 2064 6566 205f 6479  out..    def _dy
-0001bfa0: 6e61 6d69 635f 7061 7274 6974 696f 6e28  namic_partition(
-0001bfb0: 7365 6c66 2c20 696e 7075 745f 7465 6e73  self, input_tens
-0001bfc0: 6f72 3a20 746f 7263 682e 5465 6e73 6f72  or: torch.Tensor
-0001bfd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001bfe0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0001bff0: 7469 7469 6f6e 5f74 656e 736f 723a 206e  tition_tensor: n
-0001c000: 702e 6e64 6172 7261 792c 0a20 2020 2020  p.ndarray,.     
-0001c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c020: 2020 2020 2020 6e75 6d5f 7061 7274 6974        num_partit
-0001c030: 696f 6e73 3a20 696e 7429 202d 3e20 4c69  ions: int) -> Li
-0001c040: 7374 5b74 6f72 6368 2e54 656e 736f 725d  st[torch.Tensor]
-0001c050: 3a0a 2020 2020 2020 2020 2222 2250 6172  :.        """Par
-0001c060: 7469 7469 6f6e 7320 6064 6174 6160 2069  titions `data` i
-0001c070: 6e74 6f20 606e 756d 5f70 6172 7469 7469  nto `num_partiti
-0001c080: 6f6e 7360 2074 656e 736f 7273 2075 7369  ons` tensors usi
-0001c090: 6e67 2069 6e64 6963 6573 2066 726f 6d20  ng indices from 
-0001c0a0: 6070 6172 7469 7469 6f6e 7360 2e0a 0a20  `partitions`... 
-0001c0b0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0001c0c0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0001c0d0: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e70  ----.        inp
-0001c0e0: 7574 5f74 656e 736f 723a 2074 6f72 6368  ut_tensor: torch
-0001c0f0: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-0001c100: 2020 2020 5468 6520 7465 6e73 6f72 2074      The tensor t
-0001c110: 6f20 6265 2070 6172 7469 7469 6f6e 6564  o be partitioned
-0001c120: 2e0a 2020 2020 2020 2020 7061 7274 6974  ..        partit
-0001c130: 696f 6e5f 7465 6e73 6f72 3a20 6e70 2e6e  ion_tensor: np.n
-0001c140: 6461 7272 6179 0a20 2020 2020 2020 2020  darray.         
-0001c150: 2020 2041 2031 2d44 2074 656e 736f 7220     A 1-D tensor 
-0001c160: 7768 6f73 6520 7369 7a65 2069 7320 6571  whose size is eq
-0001c170: 7561 6c20 746f 2074 6865 2066 6972 7374  ual to the first
-0001c180: 2064 696d 656e 7369 6f6e 206f 6620 6069   dimension of `i
-0001c190: 6e70 7574 5f74 656e 736f 7260 2e0a 2020  nput_tensor`..  
-0001c1a0: 2020 2020 2020 6e75 6d5f 7061 7274 6974        num_partit
-0001c1b0: 696f 6e73 3a20 696e 740a 2020 2020 2020  ions: int.      
-0001c1c0: 2020 2020 2020 5468 6520 6e75 6d62 6572        The number
-0001c1d0: 206f 6620 7061 7274 6974 696f 6e73 2074   of partitions t
-0001c1e0: 6f20 6f75 7470 7574 2e0a 0a20 2020 2020  o output...     
-0001c1f0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-0001c200: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-0001c210: 2020 2070 6172 7469 7469 6f6e 733a 204c     partitions: L
-0001c220: 6973 745b 746f 7263 682e 5465 6e73 6f72  ist[torch.Tensor
-0001c230: 5d0a 2020 2020 2020 2020 2020 2020 4120  ].            A 
-0001c240: 6c69 7374 206f 6620 606e 756d 5f70 6172  list of `num_par
-0001c250: 7469 7469 6f6e 7360 2060 5465 6e73 6f72  titions` `Tensor
-0001c260: 6020 6f62 6a65 6374 7320 7769 7468 2074  ` objects with t
-0001c270: 6865 2073 616d 6520 7479 7065 2061 7320  he same type as 
-0001c280: 6064 6174 6160 2e0a 0a20 2020 2020 2020  `data`...       
-0001c290: 2022 2222 0a20 2020 2020 2020 2023 2063   """.        # c
-0001c2a0: 7265 6174 6520 6120 626f 6f6c 6561 6e20  reate a boolean 
-0001c2b0: 6d61 736b 2066 6f72 2065 6163 6820 7061  mask for each pa
-0001c2c0: 7274 6974 696f 6e0a 2020 2020 2020 2020  rtition.        
-0001c2d0: 7061 7274 6974 696f 6e5f 6d61 736b 7320  partition_masks 
-0001c2e0: 3d20 5b70 6172 7469 7469 6f6e 5f74 656e  = [partition_ten
-0001c2f0: 736f 7220 3d3d 2069 2066 6f72 2069 2069  sor == i for i i
-0001c300: 6e20 7261 6e67 6528 6e75 6d5f 7061 7274  n range(num_part
-0001c310: 6974 696f 6e73 295d 0a0a 2020 2020 2020  itions)]..      
-0001c320: 2020 2320 7061 7274 6974 696f 6e20 7468    # partition th
-0001c330: 6520 696e 7075 7420 7465 6e73 6f72 2075  e input tensor u
-0001c340: 7369 6e67 2074 6865 206d 6173 6b73 0a20  sing the masks. 
-0001c350: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
-0001c360: 7320 3d20 5b69 6e70 7574 5f74 656e 736f  s = [input_tenso
-0001c370: 725b 6d61 736b 5d20 666f 7220 6d61 736b  r[mask] for mask
-0001c380: 2069 6e20 7061 7274 6974 696f 6e5f 6d61   in partition_ma
-0001c390: 736b 735d 0a0a 2020 2020 2020 2020 7265  sks]..        re
-0001c3a0: 7475 726e 2070 6172 7469 7469 6f6e 730a  turn partitions.
-0001c3b0: 0a0a 636c 6173 7320 4454 4e4e 456d 6265  ..class DTNNEmbe
-0001c3c0: 6464 696e 6728 6e6e 2e4d 6f64 756c 6529  dding(nn.Module)
-0001c3d0: 3a0a 2020 2020 2222 2244 544e 4e45 6d62  :.    """DTNNEmb
-0001c3e0: 6564 6469 6e67 206c 6179 6572 2066 6f72  edding layer for
-0001c3f0: 2044 544e 4e20 6d6f 6465 6c2e 0a0a 2020   DTNN model...  
-0001c400: 2020 4173 7369 676e 2069 6e69 7469 616c    Assign initial
-0001c410: 2061 746f 6d69 6320 6465 7363 7269 7074   atomic descript
-0001c420: 6f72 732e 205b 315d 5f0a 0a20 2020 2054  ors. [1]_..    T
-0001c430: 6869 7320 6c61 7965 7220 6372 6561 7465  his layer create
-0001c440: 7320 276e 2720 6e75 6d62 6572 206f 6620  s 'n' number of 
-0001c450: 656d 6265 6464 696e 6773 2061 7320 696e  embeddings as in
-0001c460: 6974 6961 6c20 6174 6f6d 6963 2064 6573  itial atomic des
-0001c470: 6372 6970 746f 7273 2e20 4163 636f 7264  criptors. Accord
-0001c480: 696e 6720 746f 2074 6865 2072 6571 7569  ing to the requi
-0001c490: 7265 6420 7765 6967 6874 2069 6e69 7469  red weight initi
-0001c4a0: 616c 697a 6572 2061 6e64 2070 6572 696f  alizer and perio
-0001c4b0: 6469 635f 7461 626c 655f 6c65 6e67 7468  dic_table_length
-0001c4c0: 2028 546f 7461 6c20 6e75 6d62 6572 206f   (Total number o
-0001c4d0: 6620 756e 6971 7565 2061 746f 6d73 292e  f unique atoms).
-0001c4e0: 0a0a 2020 2020 5265 6665 7265 6e63 6573  ..    References
-0001c4f0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-0001c500: 2020 2020 5b31 5d20 5363 68c3 bc74 742c      [1] Sch..tt,
-0001c510: 204b 7269 7374 6f66 2054 2e2c 2065 7420   Kristof T., et 
-0001c520: 616c 2e20 2251 7561 6e74 756d 2d63 6865  al. "Quantum-che
-0001c530: 6d69 6361 6c20 696e 7369 6768 7473 2066  mical insights f
-0001c540: 726f 6d20 6465 6570 0a20 2020 2020 2020  rom deep.       
-0001c550: 2074 656e 736f 7220 6e65 7572 616c 206e   tensor neural n
-0001c560: 6574 776f 726b 732e 2220 4e61 7475 7265  etworks." Nature
-0001c570: 2063 6f6d 6d75 6e69 6361 7469 6f6e 7320   communications 
-0001c580: 382e 3120 2832 3031 3729 3a20 312d 382e  8.1 (2017): 1-8.
-0001c590: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-0001c5a0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-0001c5b0: 2020 2020 6e5f 656d 6265 6464 696e 673a      n_embedding:
-0001c5c0: 2069 6e74 2c20 6f70 7469 6f6e 616c 0a20   int, optional. 
-0001c5d0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-0001c5e0: 2066 6561 7475 7265 7320 666f 7220 6561   features for ea
-0001c5f0: 6368 2061 746f 6d0a 2020 2020 7065 7269  ch atom.    peri
-0001c600: 6f64 6963 5f74 6162 6c65 5f6c 656e 6774  odic_table_lengt
-0001c610: 683a 2069 6e74 2c20 6f70 7469 6f6e 616c  h: int, optional
-0001c620: 0a20 2020 2020 2020 204c 656e 6774 6820  .        Length 
-0001c630: 6f66 2065 6d62 6564 6469 6e67 2c20 3833  of embedding, 83
-0001c640: 3d42 690a 2020 2020 696e 6974 616c 697a  =Bi.    initaliz
-0001c650: 6572 3a20 7374 722c 206f 7074 696f 6e61  er: str, optiona
-0001c660: 6c0a 2020 2020 2020 2020 5765 6967 6874  l.        Weight
-0001c670: 2069 6e69 7469 616c 697a 6174 696f 6e20   initialization 
-0001c680: 666f 7220 6669 6c74 6572 732e 0a20 2020  for filters..   
-0001c690: 2020 2020 204f 7074 696f 6e73 3a20 7b78       Options: {x
-0001c6a0: 6176 6965 725f 756e 6966 6f72 6d5f 2c20  avier_uniform_, 
-0001c6b0: 7861 7669 6572 5f6e 6f72 6d61 6c5f 2c20  xavier_normal_, 
-0001c6c0: 6b61 696d 696e 675f 756e 6966 6f72 6d5f  kaiming_uniform_
-0001c6d0: 2c20 6b61 696d 696e 675f 6e6f 726d 616c  , kaiming_normal
-0001c6e0: 5f2c 2074 7275 6e63 5f6e 6f72 6d61 6c5f  _, trunc_normal_
-0001c6f0: 7d0a 0a20 2020 2045 7861 6d70 6c65 730a  }..    Examples.
-0001c700: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-0001c710: 203e 3e3e 2066 726f 6d20 6465 6570 6368   >>> from deepch
-0001c720: 656d 2e6d 6f64 656c 732e 746f 7263 685f  em.models.torch_
-0001c730: 6d6f 6465 6c73 2069 6d70 6f72 7420 6c61  models import la
-0001c740: 7965 7273 0a20 2020 203e 3e3e 2069 6d70  yers.    >>> imp
-0001c750: 6f72 7420 746f 7263 680a 2020 2020 3e3e  ort torch.    >>
-0001c760: 3e20 6c61 7965 7220 3d20 6c61 7965 7273  > layer = layers
-0001c770: 2e44 544e 4e45 6d62 6564 6469 6e67 2833  .DTNNEmbedding(3
-0001c780: 302c 2033 302c 2027 7861 7669 6572 5f75  0, 30, 'xavier_u
-0001c790: 6e69 666f 726d 5f27 290a 2020 2020 3e3e  niform_').    >>
-0001c7a0: 3e20 6f75 7470 7574 203d 206c 6179 6572  > output = layer
-0001c7b0: 2874 6f72 6368 2e74 656e 736f 7228 5b30  (torch.tensor([0
-0001c7c0: 2c20 312c 2032 2c20 332c 2034 2c20 352c  , 1, 2, 3, 4, 5,
-0001c7d0: 2036 2c20 372c 2038 2c20 395d 2929 0a20   6, 7, 8, 9])). 
-0001c7e0: 2020 203e 3e3e 206f 7574 7075 742e 7368     >>> output.sh
-0001c7f0: 6170 650a 2020 2020 746f 7263 682e 5369  ape.    torch.Si
-0001c800: 7a65 285b 3130 2c20 3330 5d29 0a0a 2020  ze([10, 30])..  
-0001c810: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-0001c820: 5f69 6e69 745f 5f28 7365 6c66 2c0a 2020  _init__(self,.  
-0001c830: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001c840: 5f65 6d62 6564 6469 6e67 3a20 696e 7420  _embedding: int 
-0001c850: 3d20 3330 2c0a 2020 2020 2020 2020 2020  = 30,.          
-0001c860: 2020 2020 2020 2070 6572 696f 6469 635f         periodic_
-0001c870: 7461 626c 655f 6c65 6e67 7468 3a20 696e  table_length: in
-0001c880: 7420 3d20 3330 2c0a 2020 2020 2020 2020  t = 30,.        
-0001c890: 2020 2020 2020 2020 2069 6e69 7461 6c69           initali
-0001c8a0: 7a65 723a 2073 7472 203d 2027 7861 7669  zer: str = 'xavi
-0001c8b0: 6572 5f75 6e69 666f 726d 5f27 2c0a 2020  er_uniform_',.  
-0001c8c0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0001c8d0: 2a6b 7761 7267 7329 3a0a 0a20 2020 2020  *kwargs):..     
-0001c8e0: 2020 2073 7570 6572 2844 544e 4e45 6d62     super(DTNNEmb
-0001c8f0: 6564 6469 6e67 2c20 7365 6c66 292e 5f5f  edding, self).__
-0001c900: 696e 6974 5f5f 282a 2a6b 7761 7267 7329  init__(**kwargs)
-0001c910: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
-0001c920: 656d 6265 6464 696e 6720 3d20 6e5f 656d  embedding = n_em
-0001c930: 6265 6464 696e 670a 2020 2020 2020 2020  bedding.        
-0001c940: 7365 6c66 2e70 6572 696f 6469 635f 7461  self.periodic_ta
-0001c950: 626c 655f 6c65 6e67 7468 203d 2070 6572  ble_length = per
-0001c960: 696f 6469 635f 7461 626c 655f 6c65 6e67  iodic_table_leng
-0001c970: 7468 0a20 2020 2020 2020 2073 656c 662e  th.        self.
-0001c980: 696e 6974 616c 697a 6572 203d 2069 6e69  initalizer = ini
-0001c990: 7461 6c69 7a65 7220 2023 2053 6574 2077  talizer  # Set w
-0001c9a0: 6569 6768 7420 696e 6974 6961 6c69 7a61  eight initializa
-0001c9b0: 7469 6f6e 0a0a 2020 2020 2020 2020 696e  tion..        in
-0001c9c0: 6974 5f66 756e 633a 2043 616c 6c61 626c  it_func: Callabl
-0001c9d0: 6520 3d20 6765 7461 7474 7228 696e 6974  e = getattr(init
-0001c9e0: 6961 6c69 7a65 7273 2c20 7365 6c66 2e69  ializers, self.i
-0001c9f0: 6e69 7461 6c69 7a65 7229 0a20 2020 2020  nitalizer).     
-0001ca00: 2020 2073 656c 662e 656d 6265 6464 696e     self.embeddin
-0001ca10: 675f 6c69 7374 3a20 746f 7263 682e 5465  g_list: torch.Te
-0001ca20: 6e73 6f72 203d 2069 6e69 745f 6675 6e63  nsor = init_func
-0001ca30: 280a 2020 2020 2020 2020 2020 2020 746f  (.            to
-0001ca40: 7263 682e 656d 7074 7928 5b73 656c 662e  rch.empty([self.
-0001ca50: 7065 7269 6f64 6963 5f74 6162 6c65 5f6c  periodic_table_l
-0001ca60: 656e 6774 682c 2073 656c 662e 6e5f 656d  ength, self.n_em
-0001ca70: 6265 6464 696e 675d 2929 0a0a 2020 2020  bedding]))..    
-0001ca80: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
-0001ca90: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
-0001caa0: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-0001cab0: 7374 7269 6e67 2072 6570 7265 7365 6e74  string represent
-0001cac0: 696e 6720 7468 6520 636f 6e66 6967 7572  ing the configur
-0001cad0: 6174 696f 6e20 6f66 2074 6865 206c 6179  ation of the lay
-0001cae0: 6572 2e0a 0a20 2020 2020 2020 2052 6574  er...        Ret
-0001caf0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-0001cb00: 2d2d 2d2d 0a20 2020 2020 2020 206e 5f65  ----.        n_e
-0001cb10: 6d62 6564 6469 6e67 3a20 696e 742c 206f  mbedding: int, o
-0001cb20: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0001cb30: 2020 2020 4e75 6d62 6572 206f 6620 6665      Number of fe
-0001cb40: 6174 7572 6573 2066 6f72 2065 6163 6820  atures for each 
-0001cb50: 6174 6f6d 0a20 2020 2020 2020 2070 6572  atom.        per
-0001cb60: 696f 6469 635f 7461 626c 655f 6c65 6e67  iodic_table_leng
-0001cb70: 7468 3a20 696e 742c 206f 7074 696f 6e61  th: int, optiona
-0001cb80: 6c0a 2020 2020 2020 2020 2020 2020 4c65  l.            Le
-0001cb90: 6e67 7468 206f 6620 656d 6265 6464 696e  ngth of embeddin
-0001cba0: 672c 2038 333d 4269 0a20 2020 2020 2020  g, 83=Bi.       
-0001cbb0: 2069 6e69 7461 6c69 7a65 723a 2073 7472   initalizer: str
-0001cbc0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0001cbd0: 2020 2020 2020 2057 6569 6768 7420 696e         Weight in
-0001cbe0: 6974 6961 6c69 7a61 7469 6f6e 2066 6f72  itialization for
-0001cbf0: 2066 696c 7465 7273 2e0a 2020 2020 2020   filters..      
-0001cc00: 2020 2020 2020 4f70 7469 6f6e 733a 207b        Options: {
-0001cc10: 7861 7669 6572 5f75 6e69 666f 726d 5f2c  xavier_uniform_,
-0001cc20: 2078 6176 6965 725f 6e6f 726d 616c 5f2c   xavier_normal_,
-0001cc30: 206b 6169 6d69 6e67 5f75 6e69 666f 726d   kaiming_uniform
-0001cc40: 5f2c 206b 6169 6d69 6e67 5f6e 6f72 6d61  _, kaiming_norma
-0001cc50: 6c5f 2c20 7472 756e 635f 6e6f 726d 616c  l_, trunc_normal
-0001cc60: 5f7d 0a0a 2020 2020 2020 2020 2222 220a  _}..        """.
-0001cc70: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-0001cc80: 277b 7365 6c66 2e5f 5f63 6c61 7373 5f5f  '{self.__class__
-0001cc90: 2e5f 5f6e 616d 655f 5f7d 286e 5f65 6d62  .__name__}(n_emb
-0001cca0: 6564 6469 6e67 3d7b 7365 6c66 2e6e 5f65  edding={self.n_e
-0001ccb0: 6d62 6564 6469 6e67 7d2c 2070 6572 696f  mbedding}, perio
-0001ccc0: 6469 635f 7461 626c 655f 6c65 6e67 7468  dic_table_length
-0001ccd0: 3d7b 7365 6c66 2e70 6572 696f 6469 635f  ={self.periodic_
-0001cce0: 7461 626c 655f 6c65 6e67 7468 7d2c 2069  table_length}, i
-0001ccf0: 6e69 7461 6c69 7a65 723d 7b73 656c 662e  nitalizer={self.
-0001cd00: 696e 6974 616c 697a 6572 7d29 270a 0a20  initalizer})'.. 
-0001cd10: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
-0001cd20: 656c 662c 2069 6e70 7574 733a 2074 6f72  elf, inputs: tor
-0001cd30: 6368 2e54 656e 736f 7229 3a0a 2020 2020  ch.Tensor):.    
-0001cd40: 2020 2020 2222 2252 6574 7572 6e73 2045      """Returns E
-0001cd50: 6d62 6564 6469 6e67 7320 6163 636f 7264  mbeddings accord
-0001cd60: 696e 6720 746f 2069 6e64 6963 6573 2e0a  ing to indices..
-0001cd70: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-0001cd80: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-0001cd90: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2069  ------.        i
-0001cda0: 6e70 7574 733a 2074 6f72 6368 2e54 656e  nputs: torch.Ten
-0001cdb0: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
-0001cdc0: 496e 6469 6365 7320 6f66 2041 746f 6d73  Indices of Atoms
-0001cdd0: 2077 686f 7365 2065 6d62 6564 6469 6e67   whose embedding
-0001cde0: 7320 6172 6520 7265 7175 6573 7465 642e  s are requested.
-0001cdf0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0001ce00: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0001ce10: 2d0a 2020 2020 2020 2020 6174 6f6d 5f65  -.        atom_e
-0001ce20: 6d62 6564 6469 6e67 733a 2074 6f72 6368  mbeddings: torch
-0001ce30: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
-0001ce40: 2020 2020 456d 6265 6464 696e 6773 206f      Embeddings o
-0001ce50: 6620 6174 6f6d 7320 6163 636f 7264 696e  f atoms accordin
-0001ce60: 6773 2074 6f20 696e 6469 6365 732e 0a0a  gs to indices...
-0001ce70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001ce80: 2020 2020 6174 6f6d 5f6e 756d 6265 7220      atom_number 
-0001ce90: 3d20 696e 7075 7473 0a20 2020 2020 2020  = inputs.       
-0001cea0: 2061 746f 6d5f 656e 6265 6464 696e 6773   atom_enbeddings
-0001ceb0: 203d 2074 6f72 6368 2e6e 6e2e 6675 6e63   = torch.nn.func
-0001cec0: 7469 6f6e 616c 2e65 6d62 6564 6469 6e67  tional.embedding
-0001ced0: 2861 746f 6d5f 6e75 6d62 6572 2c0a 2020  (atom_number,.  
-0001cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba80: 2020 2020 2020 2064 696d 3d30 290a 2020         dim=0).  
+0001ba90: 2020 2020 2020 2020 2020 2320 4d6f 6465            # Mode
+0001baa0: 6c20 7573 696e 6720 7468 6973 206c 6179  l using this lay
+0001bab0: 6572 206d 7573 7420 7365 7420 6070 6164  er must set `pad
+0001bac0: 5f62 6174 6368 6573 3d54 7275 6560 0a20  _batches=True`. 
+0001bad0: 2020 2020 2020 2020 2020 2071 5f73 7461             q_sta
+0001bae0: 7220 3d20 746f 7263 682e 6361 7428 5b68  r = torch.cat([h
+0001baf0: 2c20 725d 2c20 6469 6d3d 3129 0a20 2020  , r], dim=1).   
+0001bb00: 2020 2020 2020 2020 2068 2c20 6320 3d20           h, c = 
+0001bb10: 7365 6c66 2e5f 4c53 544d 5374 6570 2871  self._LSTMStep(q
+0001bb20: 5f73 7461 722c 2063 290a 2020 2020 2020  _star, c).      
+0001bb30: 2020 7265 7475 726e 2071 5f73 7461 720a    return q_star.
+0001bb40: 0a20 2020 2064 6566 205f 4c53 544d 5374  .    def _LSTMSt
+0001bb50: 6570 2873 656c 662c 0a20 2020 2020 2020  ep(self,.       
+0001bb60: 2020 2020 2020 2020 2020 2068 3a20 746f             h: to
+0001bb70: 7263 682e 5465 6e73 6f72 2c0a 2020 2020  rch.Tensor,.    
+0001bb80: 2020 2020 2020 2020 2020 2020 2020 633a                c:
+0001bb90: 2074 6f72 6368 2e54 656e 736f 722c 0a20   torch.Tensor,. 
+0001bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbb0: 2078 3d4e 6f6e 6529 202d 3e20 5475 706c   x=None) -> Tupl
+0001bbc0: 655b 746f 7263 682e 5465 6e73 6f72 2c20  e[torch.Tensor, 
+0001bbd0: 746f 7263 682e 5465 6e73 6f72 5d3a 0a20  torch.Tensor]:. 
+0001bbe0: 2020 2020 2020 2022 2222 5468 6973 206d         """This m
+0001bbf0: 6574 686f 7264 2070 6572 666f 726d 7320  ethord performs 
+0001bc00: 6120 7369 6e67 6c65 2073 7465 7020 6f66  a single step of
+0001bc10: 2061 204c 6f6e 6720 5368 6f72 742d 5465   a Long Short-Te
+0001bc20: 726d 204d 656d 6f72 7920 284c 5354 4d29  rm Memory (LSTM)
+0001bc30: 2063 656c 6c2c 0a0a 2020 2020 2020 2020   cell,..        
+0001bc40: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0001bc50: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0001bc60: 2020 2020 2020 683a 2074 6f72 6368 2e54        h: torch.T
+0001bc70: 656e 736f 720a 2020 2020 2020 2020 2020  ensor.          
+0001bc80: 2020 5468 6520 6869 6464 656e 2073 7461    The hidden sta
+0001bc90: 7465 206f 6620 7468 6520 4c53 544d 2063  te of the LSTM c
+0001bca0: 656c 6c2e 0a20 2020 2020 2020 2063 3a20  ell..        c: 
+0001bcb0: 746f 7263 682e 5465 6e73 6f72 0a20 2020  torch.Tensor.   
+0001bcc0: 2020 2020 2020 2020 2054 6865 2063 656c           The cel
+0001bcd0: 6c20 7374 6174 6520 6f66 2074 6865 204c  l state of the L
+0001bce0: 5354 4d20 6365 6c6c 2e0a 0a20 2020 2020  STM cell...     
+0001bcf0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+0001bd00: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+0001bd10: 2020 2068 5f6f 7574 3a20 746f 7263 682e     h_out: torch.
+0001bd20: 5465 6e73 6f72 0a20 2020 2020 2020 2020  Tensor.         
+0001bd30: 2020 2054 6865 2075 7064 6174 6564 2068     The updated h
+0001bd40: 6964 6465 6e20 7374 6174 6520 6f66 2074  idden state of t
+0001bd50: 6865 204c 5354 4d20 6365 6c6c 2e0a 2020  he LSTM cell..  
+0001bd60: 2020 2020 2020 635f 6f75 743a 2074 6f72        c_out: tor
+0001bd70: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+0001bd80: 2020 2020 2020 5468 6520 7570 6461 7465        The update
+0001bd90: 6420 6365 6c6c 2073 7461 7465 206f 6620  d cell state of 
+0001bda0: 7468 6520 4c53 544d 2063 656c 6c2e 0a0a  the LSTM cell...
+0001bdb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001bdc0: 2020 2020 2320 7a20 3d20 746f 7263 682e      # z = torch.
+0001bdd0: 6d6d 2868 2c20 7365 6c66 2e55 2920 2b20  mm(h, self.U) + 
+0001bde0: 7365 6c66 2e62 0a20 2020 2020 2020 207a  self.b.        z
+0001bdf0: 203d 2046 2e6c 696e 6561 7228 682e 666c   = F.linear(h.fl
+0001be00: 6f61 7428 292e 6465 7461 6368 2829 2c0a  oat().detach(),.
+0001be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be20: 2020 2020 2073 656c 662e 552e 666c 6f61       self.U.floa
+0001be30: 7428 292e 542e 6465 7461 6368 2829 2c20  t().T.detach(), 
+0001be40: 7365 6c66 2e62 2e64 6574 6163 6828 2929  self.b.detach())
+0001be50: 0a20 2020 2020 2020 2069 203d 2074 6f72  .        i = tor
+0001be60: 6368 2e73 6967 6d6f 6964 287a 5b3a 2c20  ch.sigmoid(z[:, 
+0001be70: 3a73 656c 662e 6e5f 6869 6464 656e 5d29  :self.n_hidden])
+0001be80: 0a20 2020 2020 2020 2066 203d 2074 6f72  .        f = tor
+0001be90: 6368 2e73 6967 6d6f 6964 287a 5b3a 2c20  ch.sigmoid(z[:, 
+0001bea0: 7365 6c66 2e6e 5f68 6964 6465 6e3a 3220  self.n_hidden:2 
+0001beb0: 2a20 7365 6c66 2e6e 5f68 6964 6465 6e5d  * self.n_hidden]
+0001bec0: 290a 2020 2020 2020 2020 6f20 3d20 746f  ).        o = to
+0001bed0: 7263 682e 7369 676d 6f69 6428 7a5b 3a2c  rch.sigmoid(z[:,
+0001bee0: 2032 202a 2073 656c 662e 6e5f 6869 6464   2 * self.n_hidd
+0001bef0: 656e 3a33 202a 2073 656c 662e 6e5f 6869  en:3 * self.n_hi
+0001bf00: 6464 656e 5d29 0a20 2020 2020 2020 207a  dden]).        z
+0001bf10: 3320 3d20 7a5b 3a2c 2033 202a 2073 656c  3 = z[:, 3 * sel
+0001bf20: 662e 6e5f 6869 6464 656e 3a5d 0a20 2020  f.n_hidden:].   
+0001bf30: 2020 2020 2063 5f6f 7574 203d 2066 202a       c_out = f *
+0001bf40: 2063 202b 2069 202a 2074 6f72 6368 2e74   c + i * torch.t
+0001bf50: 616e 6828 7a33 290a 2020 2020 2020 2020  anh(z3).        
+0001bf60: 685f 6f75 7420 3d20 6f20 2a20 746f 7263  h_out = o * torc
+0001bf70: 682e 7461 6e68 2863 5f6f 7574 290a 2020  h.tanh(c_out).  
+0001bf80: 2020 2020 2020 7265 7475 726e 2068 5f6f        return h_o
+0001bf90: 7574 2c20 635f 6f75 740a 0a20 2020 2064  ut, c_out..    d
+0001bfa0: 6566 205f 6479 6e61 6d69 635f 7061 7274  ef _dynamic_part
+0001bfb0: 6974 696f 6e28 7365 6c66 2c20 696e 7075  ition(self, inpu
+0001bfc0: 745f 7465 6e73 6f72 3a20 746f 7263 682e  t_tensor: torch.
+0001bfd0: 5465 6e73 6f72 2c0a 2020 2020 2020 2020  Tensor,.        
+0001bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bff0: 2020 2070 6172 7469 7469 6f6e 5f74 656e     partition_ten
+0001c000: 736f 723a 206e 702e 6e64 6172 7261 792c  sor: np.ndarray,
+0001c010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c020: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+0001c030: 7061 7274 6974 696f 6e73 3a20 696e 7429  partitions: int)
+0001c040: 202d 3e20 4c69 7374 5b74 6f72 6368 2e54   -> List[torch.T
+0001c050: 656e 736f 725d 3a0a 2020 2020 2020 2020  ensor]:.        
+0001c060: 2222 2250 6172 7469 7469 6f6e 7320 6064  """Partitions `d
+0001c070: 6174 6160 2069 6e74 6f20 606e 756d 5f70  ata` into `num_p
+0001c080: 6172 7469 7469 6f6e 7360 2074 656e 736f  artitions` tenso
+0001c090: 7273 2075 7369 6e67 2069 6e64 6963 6573  rs using indices
+0001c0a0: 2066 726f 6d20 6070 6172 7469 7469 6f6e   from `partition
+0001c0b0: 7360 2e0a 0a20 2020 2020 2020 2050 6172  s`...        Par
+0001c0c0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+0001c0d0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+0001c0e0: 2020 2069 6e70 7574 5f74 656e 736f 723a     input_tensor:
+0001c0f0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+0001c100: 2020 2020 2020 2020 2020 5468 6520 7465            The te
+0001c110: 6e73 6f72 2074 6f20 6265 2070 6172 7469  nsor to be parti
+0001c120: 7469 6f6e 6564 2e0a 2020 2020 2020 2020  tioned..        
+0001c130: 7061 7274 6974 696f 6e5f 7465 6e73 6f72  partition_tensor
+0001c140: 3a20 6e70 2e6e 6461 7272 6179 0a20 2020  : np.ndarray.   
+0001c150: 2020 2020 2020 2020 2041 2031 2d44 2074           A 1-D t
+0001c160: 656e 736f 7220 7768 6f73 6520 7369 7a65  ensor whose size
+0001c170: 2069 7320 6571 7561 6c20 746f 2074 6865   is equal to the
+0001c180: 2066 6972 7374 2064 696d 656e 7369 6f6e   first dimension
+0001c190: 206f 6620 6069 6e70 7574 5f74 656e 736f   of `input_tenso
+0001c1a0: 7260 2e0a 2020 2020 2020 2020 6e75 6d5f  r`..        num_
+0001c1b0: 7061 7274 6974 696f 6e73 3a20 696e 740a  partitions: int.
+0001c1c0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0001c1d0: 6e75 6d62 6572 206f 6620 7061 7274 6974  number of partit
+0001c1e0: 696f 6e73 2074 6f20 6f75 7470 7574 2e0a  ions to output..
+0001c1f0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+0001c200: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0001c210: 0a20 2020 2020 2020 2070 6172 7469 7469  .        partiti
+0001c220: 6f6e 733a 204c 6973 745b 746f 7263 682e  ons: List[torch.
+0001c230: 5465 6e73 6f72 5d0a 2020 2020 2020 2020  Tensor].        
+0001c240: 2020 2020 4120 6c69 7374 206f 6620 606e      A list of `n
+0001c250: 756d 5f70 6172 7469 7469 6f6e 7360 2060  um_partitions` `
+0001c260: 5465 6e73 6f72 6020 6f62 6a65 6374 7320  Tensor` objects 
+0001c270: 7769 7468 2074 6865 2073 616d 6520 7479  with the same ty
+0001c280: 7065 2061 7320 6064 6174 6160 2e0a 0a20  pe as `data`... 
+0001c290: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001c2a0: 2020 2023 2063 7265 6174 6520 6120 626f     # create a bo
+0001c2b0: 6f6c 6561 6e20 6d61 736b 2066 6f72 2065  olean mask for e
+0001c2c0: 6163 6820 7061 7274 6974 696f 6e0a 2020  ach partition.  
+0001c2d0: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+0001c2e0: 6d61 736b 7320 3d20 5b70 6172 7469 7469  masks = [partiti
+0001c2f0: 6f6e 5f74 656e 736f 7220 3d3d 2069 2066  on_tensor == i f
+0001c300: 6f72 2069 2069 6e20 7261 6e67 6528 6e75  or i in range(nu
+0001c310: 6d5f 7061 7274 6974 696f 6e73 295d 0a0a  m_partitions)]..
+0001c320: 2020 2020 2020 2020 2320 7061 7274 6974          # partit
+0001c330: 696f 6e20 7468 6520 696e 7075 7420 7465  ion the input te
+0001c340: 6e73 6f72 2075 7369 6e67 2074 6865 206d  nsor using the m
+0001c350: 6173 6b73 0a20 2020 2020 2020 2070 6172  asks.        par
+0001c360: 7469 7469 6f6e 7320 3d20 5b69 6e70 7574  titions = [input
+0001c370: 5f74 656e 736f 725b 6d61 736b 5d20 666f  _tensor[mask] fo
+0001c380: 7220 6d61 736b 2069 6e20 7061 7274 6974  r mask in partit
+0001c390: 696f 6e5f 6d61 736b 735d 0a0a 2020 2020  ion_masks]..    
+0001c3a0: 2020 2020 7265 7475 726e 2070 6172 7469      return parti
+0001c3b0: 7469 6f6e 730a 0a0a 636c 6173 7320 4454  tions...class DT
+0001c3c0: 4e4e 456d 6265 6464 696e 6728 6e6e 2e4d  NNEmbedding(nn.M
+0001c3d0: 6f64 756c 6529 3a0a 2020 2020 2222 2244  odule):.    """D
+0001c3e0: 544e 4e45 6d62 6564 6469 6e67 206c 6179  TNNEmbedding lay
+0001c3f0: 6572 2066 6f72 2044 544e 4e20 6d6f 6465  er for DTNN mode
+0001c400: 6c2e 0a0a 2020 2020 4173 7369 676e 2069  l...    Assign i
+0001c410: 6e69 7469 616c 2061 746f 6d69 6320 6465  nitial atomic de
+0001c420: 7363 7269 7074 6f72 732e 205b 315d 5f0a  scriptors. [1]_.
+0001c430: 0a20 2020 2054 6869 7320 6c61 7965 7220  .    This layer 
+0001c440: 6372 6561 7465 7320 276e 2720 6e75 6d62  creates 'n' numb
+0001c450: 6572 206f 6620 656d 6265 6464 696e 6773  er of embeddings
+0001c460: 2061 7320 696e 6974 6961 6c20 6174 6f6d   as initial atom
+0001c470: 6963 2064 6573 6372 6970 746f 7273 2e20  ic descriptors. 
+0001c480: 4163 636f 7264 696e 6720 746f 2074 6865  According to the
+0001c490: 2072 6571 7569 7265 6420 7765 6967 6874   required weight
+0001c4a0: 2069 6e69 7469 616c 697a 6572 2061 6e64   initializer and
+0001c4b0: 2070 6572 696f 6469 635f 7461 626c 655f   periodic_table_
+0001c4c0: 6c65 6e67 7468 2028 546f 7461 6c20 6e75  length (Total nu
+0001c4d0: 6d62 6572 206f 6620 756e 6971 7565 2061  mber of unique a
+0001c4e0: 746f 6d73 292e 0a0a 2020 2020 5265 6665  toms)...    Refe
+0001c4f0: 7265 6e63 6573 0a20 2020 202d 2d2d 2d2d  rences.    -----
+0001c500: 2d2d 2d2d 2d0a 2020 2020 5b31 5d20 5363  -----.    [1] Sc
+0001c510: 68c3 bc74 742c 204b 7269 7374 6f66 2054  h..tt, Kristof T
+0001c520: 2e2c 2065 7420 616c 2e20 2251 7561 6e74  ., et al. "Quant
+0001c530: 756d 2d63 6865 6d69 6361 6c20 696e 7369  um-chemical insi
+0001c540: 6768 7473 2066 726f 6d20 6465 6570 0a20  ghts from deep. 
+0001c550: 2020 2020 2020 2074 656e 736f 7220 6e65         tensor ne
+0001c560: 7572 616c 206e 6574 776f 726b 732e 2220  ural networks." 
+0001c570: 4e61 7475 7265 2063 6f6d 6d75 6e69 6361  Nature communica
+0001c580: 7469 6f6e 7320 382e 3120 2832 3031 3729  tions 8.1 (2017)
+0001c590: 3a20 312d 382e 0a0a 2020 2020 5061 7261  : 1-8...    Para
+0001c5a0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+0001c5b0: 2d2d 2d2d 2d0a 2020 2020 6e5f 656d 6265  -----.    n_embe
+0001c5c0: 6464 696e 673a 2069 6e74 2c20 6f70 7469  dding: int, opti
+0001c5d0: 6f6e 616c 0a20 2020 2020 2020 204e 756d  onal.        Num
+0001c5e0: 6265 7220 6f66 2066 6561 7475 7265 7320  ber of features 
+0001c5f0: 666f 7220 6561 6368 2061 746f 6d0a 2020  for each atom.  
+0001c600: 2020 7065 7269 6f64 6963 5f74 6162 6c65    periodic_table
+0001c610: 5f6c 656e 6774 683a 2069 6e74 2c20 6f70  _length: int, op
+0001c620: 7469 6f6e 616c 0a20 2020 2020 2020 204c  tional.        L
+0001c630: 656e 6774 6820 6f66 2065 6d62 6564 6469  ength of embeddi
+0001c640: 6e67 2c20 3833 3d42 690a 2020 2020 696e  ng, 83=Bi.    in
+0001c650: 6974 616c 697a 6572 3a20 7374 722c 206f  italizer: str, o
+0001c660: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0001c670: 5765 6967 6874 2069 6e69 7469 616c 697a  Weight initializ
+0001c680: 6174 696f 6e20 666f 7220 6669 6c74 6572  ation for filter
+0001c690: 732e 0a20 2020 2020 2020 204f 7074 696f  s..        Optio
+0001c6a0: 6e73 3a20 7b78 6176 6965 725f 756e 6966  ns: {xavier_unif
+0001c6b0: 6f72 6d5f 2c20 7861 7669 6572 5f6e 6f72  orm_, xavier_nor
+0001c6c0: 6d61 6c5f 2c20 6b61 696d 696e 675f 756e  mal_, kaiming_un
+0001c6d0: 6966 6f72 6d5f 2c20 6b61 696d 696e 675f  iform_, kaiming_
+0001c6e0: 6e6f 726d 616c 5f2c 2074 7275 6e63 5f6e  normal_, trunc_n
+0001c6f0: 6f72 6d61 6c5f 7d0a 0a20 2020 2045 7861  ormal_}..    Exa
+0001c700: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
+0001c710: 2d2d 0a20 2020 203e 3e3e 2066 726f 6d20  --.    >>> from 
+0001c720: 6465 6570 6368 656d 2e6d 6f64 656c 732e  deepchem.models.
+0001c730: 746f 7263 685f 6d6f 6465 6c73 2069 6d70  torch_models imp
+0001c740: 6f72 7420 6c61 7965 7273 0a20 2020 203e  ort layers.    >
+0001c750: 3e3e 2069 6d70 6f72 7420 746f 7263 680a  >> import torch.
+0001c760: 2020 2020 3e3e 3e20 6c61 7965 7220 3d20      >>> layer = 
+0001c770: 6c61 7965 7273 2e44 544e 4e45 6d62 6564  layers.DTNNEmbed
+0001c780: 6469 6e67 2833 302c 2033 302c 2027 7861  ding(30, 30, 'xa
+0001c790: 7669 6572 5f75 6e69 666f 726d 5f27 290a  vier_uniform_').
+0001c7a0: 2020 2020 3e3e 3e20 6f75 7470 7574 203d      >>> output =
+0001c7b0: 206c 6179 6572 2874 6f72 6368 2e74 656e   layer(torch.ten
+0001c7c0: 736f 7228 5b30 2c20 312c 2032 2c20 332c  sor([0, 1, 2, 3,
+0001c7d0: 2034 2c20 352c 2036 2c20 372c 2038 2c20   4, 5, 6, 7, 8, 
+0001c7e0: 395d 2929 0a20 2020 203e 3e3e 206f 7574  9])).    >>> out
+0001c7f0: 7075 742e 7368 6170 650a 2020 2020 746f  put.shape.    to
+0001c800: 7263 682e 5369 7a65 285b 3130 2c20 3330  rch.Size([10, 30
+0001c810: 5d29 0a0a 2020 2020 2222 220a 0a20 2020  ])..    """..   
+0001c820: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+0001c830: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+0001c840: 2020 2020 206e 5f65 6d62 6564 6469 6e67       n_embedding
+0001c850: 3a20 696e 7420 3d20 3330 2c0a 2020 2020  : int = 30,.    
+0001c860: 2020 2020 2020 2020 2020 2020 2070 6572               per
+0001c870: 696f 6469 635f 7461 626c 655f 6c65 6e67  iodic_table_leng
+0001c880: 7468 3a20 696e 7420 3d20 3330 2c0a 2020  th: int = 30,.  
+0001c890: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001c8a0: 6e69 7461 6c69 7a65 723a 2073 7472 203d  nitalizer: str =
+0001c8b0: 2027 7861 7669 6572 5f75 6e69 666f 726d   'xavier_uniform
+0001c8c0: 5f27 2c0a 2020 2020 2020 2020 2020 2020  _',.            
+0001c8d0: 2020 2020 202a 2a6b 7761 7267 7329 3a0a       **kwargs):.
+0001c8e0: 0a20 2020 2020 2020 2073 7570 6572 2844  .        super(D
+0001c8f0: 544e 4e45 6d62 6564 6469 6e67 2c20 7365  TNNEmbedding, se
+0001c900: 6c66 292e 5f5f 696e 6974 5f5f 282a 2a6b  lf).__init__(**k
+0001c910: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
+0001c920: 656c 662e 6e5f 656d 6265 6464 696e 6720  elf.n_embedding 
+0001c930: 3d20 6e5f 656d 6265 6464 696e 670a 2020  = n_embedding.  
+0001c940: 2020 2020 2020 7365 6c66 2e70 6572 696f        self.perio
+0001c950: 6469 635f 7461 626c 655f 6c65 6e67 7468  dic_table_length
+0001c960: 203d 2070 6572 696f 6469 635f 7461 626c   = periodic_tabl
+0001c970: 655f 6c65 6e67 7468 0a20 2020 2020 2020  e_length.       
+0001c980: 2073 656c 662e 696e 6974 616c 697a 6572   self.initalizer
+0001c990: 203d 2069 6e69 7461 6c69 7a65 7220 2023   = initalizer  #
+0001c9a0: 2053 6574 2077 6569 6768 7420 696e 6974   Set weight init
+0001c9b0: 6961 6c69 7a61 7469 6f6e 0a0a 2020 2020  ialization..    
+0001c9c0: 2020 2020 696e 6974 5f66 756e 633a 2043      init_func: C
+0001c9d0: 616c 6c61 626c 6520 3d20 6765 7461 7474  allable = getatt
+0001c9e0: 7228 696e 6974 6961 6c69 7a65 7273 2c20  r(initializers, 
+0001c9f0: 7365 6c66 2e69 6e69 7461 6c69 7a65 7229  self.initalizer)
+0001ca00: 0a20 2020 2020 2020 2073 656c 662e 656d  .        self.em
+0001ca10: 6265 6464 696e 675f 6c69 7374 3a20 746f  bedding_list: to
+0001ca20: 7263 682e 5465 6e73 6f72 203d 2069 6e69  rch.Tensor = ini
+0001ca30: 745f 6675 6e63 280a 2020 2020 2020 2020  t_func(.        
+0001ca40: 2020 2020 746f 7263 682e 656d 7074 7928      torch.empty(
+0001ca50: 5b73 656c 662e 7065 7269 6f64 6963 5f74  [self.periodic_t
+0001ca60: 6162 6c65 5f6c 656e 6774 682c 2073 656c  able_length, sel
+0001ca70: 662e 6e5f 656d 6265 6464 696e 675d 2929  f.n_embedding]))
+0001ca80: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
+0001ca90: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
+0001caa0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+0001cab0: 726e 7320 6120 7374 7269 6e67 2072 6570  rns a string rep
+0001cac0: 7265 7365 6e74 696e 6720 7468 6520 636f  resenting the co
+0001cad0: 6e66 6967 7572 6174 696f 6e20 6f66 2074  nfiguration of t
+0001cae0: 6865 206c 6179 6572 2e0a 0a20 2020 2020  he layer...     
+0001caf0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+0001cb00: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+0001cb10: 2020 206e 5f65 6d62 6564 6469 6e67 3a20     n_embedding: 
+0001cb20: 696e 742c 206f 7074 696f 6e61 6c0a 2020  int, optional.  
+0001cb30: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
+0001cb40: 206f 6620 6665 6174 7572 6573 2066 6f72   of features for
+0001cb50: 2065 6163 6820 6174 6f6d 0a20 2020 2020   each atom.     
+0001cb60: 2020 2070 6572 696f 6469 635f 7461 626c     periodic_tabl
+0001cb70: 655f 6c65 6e67 7468 3a20 696e 742c 206f  e_length: int, o
+0001cb80: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0001cb90: 2020 2020 4c65 6e67 7468 206f 6620 656d      Length of em
+0001cba0: 6265 6464 696e 672c 2038 333d 4269 0a20  bedding, 83=Bi. 
+0001cbb0: 2020 2020 2020 2069 6e69 7461 6c69 7a65         initalize
+0001cbc0: 723a 2073 7472 2c20 6f70 7469 6f6e 616c  r: str, optional
+0001cbd0: 0a20 2020 2020 2020 2020 2020 2057 6569  .            Wei
+0001cbe0: 6768 7420 696e 6974 6961 6c69 7a61 7469  ght initializati
+0001cbf0: 6f6e 2066 6f72 2066 696c 7465 7273 2e0a  on for filters..
+0001cc00: 2020 2020 2020 2020 2020 2020 4f70 7469              Opti
+0001cc10: 6f6e 733a 207b 7861 7669 6572 5f75 6e69  ons: {xavier_uni
+0001cc20: 666f 726d 5f2c 2078 6176 6965 725f 6e6f  form_, xavier_no
+0001cc30: 726d 616c 5f2c 206b 6169 6d69 6e67 5f75  rmal_, kaiming_u
+0001cc40: 6e69 666f 726d 5f2c 206b 6169 6d69 6e67  niform_, kaiming
+0001cc50: 5f6e 6f72 6d61 6c5f 2c20 7472 756e 635f  _normal_, trunc_
+0001cc60: 6e6f 726d 616c 5f7d 0a0a 2020 2020 2020  normal_}..      
+0001cc70: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0001cc80: 7475 726e 2066 277b 7365 6c66 2e5f 5f63  turn f'{self.__c
+0001cc90: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+0001cca0: 286e 5f65 6d62 6564 6469 6e67 3d7b 7365  (n_embedding={se
+0001ccb0: 6c66 2e6e 5f65 6d62 6564 6469 6e67 7d2c  lf.n_embedding},
+0001ccc0: 2070 6572 696f 6469 635f 7461 626c 655f   periodic_table_
+0001ccd0: 6c65 6e67 7468 3d7b 7365 6c66 2e70 6572  length={self.per
+0001cce0: 696f 6469 635f 7461 626c 655f 6c65 6e67  iodic_table_leng
+0001ccf0: 7468 7d2c 2069 6e69 7461 6c69 7a65 723d  th}, initalizer=
+0001cd00: 7b73 656c 662e 696e 6974 616c 697a 6572  {self.initalizer
+0001cd10: 7d29 270a 0a20 2020 2064 6566 2066 6f72  })'..    def for
+0001cd20: 7761 7264 2873 656c 662c 2069 6e70 7574  ward(self, input
+0001cd30: 733a 2074 6f72 6368 2e54 656e 736f 7229  s: torch.Tensor)
+0001cd40: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0001cd50: 7572 6e73 2045 6d62 6564 6469 6e67 7320  urns Embeddings 
+0001cd60: 6163 636f 7264 696e 6720 746f 2069 6e64  according to ind
+0001cd70: 6963 6573 2e0a 0a20 2020 2020 2020 2050  ices...        P
+0001cd80: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0001cd90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0001cda0: 2020 2020 2069 6e70 7574 733a 2074 6f72       inputs: tor
+0001cdb0: 6368 2e54 656e 736f 720a 2020 2020 2020  ch.Tensor.      
+0001cdc0: 2020 2020 2020 496e 6469 6365 7320 6f66        Indices of
+0001cdd0: 2041 746f 6d73 2077 686f 7365 2065 6d62   Atoms whose emb
+0001cde0: 6564 6469 6e67 7320 6172 6520 7265 7175  eddings are requ
+0001cdf0: 6573 7465 642e 0a0a 2020 2020 2020 2020  ested...        
+0001ce00: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+0001ce10: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0001ce20: 6174 6f6d 5f65 6d62 6564 6469 6e67 733a  atom_embeddings:
+0001ce30: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
+0001ce40: 2020 2020 2020 2020 2020 456d 6265 6464            Embedd
+0001ce50: 696e 6773 206f 6620 6174 6f6d 7320 6163  ings of atoms ac
+0001ce60: 636f 7264 696e 6773 2074 6f20 696e 6469  cordings to indi
+0001ce70: 6365 732e 0a0a 2020 2020 2020 2020 2222  ces...        ""
+0001ce80: 220a 2020 2020 2020 2020 6174 6f6d 5f6e  ".        atom_n
+0001ce90: 756d 6265 7220 3d20 696e 7075 7473 0a20  umber = inputs. 
+0001cea0: 2020 2020 2020 2061 746f 6d5f 656e 6265         atom_enbe
+0001ceb0: 6464 696e 6773 203d 2074 6f72 6368 2e6e  ddings = torch.n
+0001cec0: 6e2e 6675 6e63 7469 6f6e 616c 2e65 6d62  n.functional.emb
+0001ced0: 6564 6469 6e67 2861 746f 6d5f 6e75 6d62  edding(atom_numb
+0001cee0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
 0001cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf10: 2020 2020 2020 7365 6c66 2e65 6d62 6564        self.embed
-0001cf20: 6469 6e67 5f6c 6973 7429 0a20 2020 2020  ding_list).     
-0001cf30: 2020 2072 6574 7572 6e20 6174 6f6d 5f65     return atom_e
-0001cf40: 6e62 6564 6469 6e67 730a 0a0a 636c 6173  nbeddings...clas
-0001cf50: 7320 4564 6765 4e65 7477 6f72 6b28 6e6e  s EdgeNetwork(nn
-0001cf60: 2e4d 6f64 756c 6529 3a0a 2020 2020 2222  .Module):.    ""
-0001cf70: 2254 6865 2045 6467 654e 6574 776f 726b  "The EdgeNetwork
-0001cf80: 206d 6f64 756c 6520 6973 2061 2050 7954   module is a PyT
-0001cf90: 6f72 6368 2073 7562 6d6f 6475 6c65 2064  orch submodule d
-0001cfa0: 6573 6967 6e65 6420 666f 7220 6d65 7373  esigned for mess
-0001cfb0: 6167 6520 7061 7373 696e 6720 696e 2067  age passing in g
-0001cfc0: 7261 7068 206e 6575 7261 6c20 6e65 7477  raph neural netw
-0001cfd0: 6f72 6b73 2e0a 0a20 2020 2045 7861 6d70  orks...    Examp
-0001cfe0: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
-0001cff0: 0a20 2020 203e 3e3e 2070 6169 725f 6665  .    >>> pair_fe
-0001d000: 6174 7572 6573 203d 2074 6f72 6368 2e72  atures = torch.r
-0001d010: 616e 6428 2834 2c20 3229 2c20 6474 7970  and((4, 2), dtyp
-0001d020: 653d 746f 7263 682e 666c 6f61 7433 3229  e=torch.float32)
-0001d030: 0a20 2020 203e 3e3e 2061 746f 6d5f 6665  .    >>> atom_fe
-0001d040: 6174 7572 6573 203d 2074 6f72 6368 2e72  atures = torch.r
-0001d050: 616e 6428 2835 2c20 3229 2c20 6474 7970  and((5, 2), dtyp
-0001d060: 653d 746f 7263 682e 666c 6f61 7433 3229  e=torch.float32)
-0001d070: 0a20 2020 203e 3e3e 2061 746f 6d5f 746f  .    >>> atom_to
-0001d080: 5f70 6169 7220 3d20 5b5d 0a20 2020 203e  _pair = [].    >
-0001d090: 3e3e 206e 5f61 746f 6d73 203d 2032 0a20  >> n_atoms = 2. 
-0001d0a0: 2020 203e 3e3e 2073 7461 7274 203d 2030     >>> start = 0
-0001d0b0: 0a20 2020 203e 3e3e 2043 302c 2043 3120  .    >>> C0, C1 
-0001d0c0: 3d20 6e70 2e6d 6573 6867 7269 6428 6e70  = np.meshgrid(np
-0001d0d0: 2e61 7261 6e67 6528 6e5f 6174 6f6d 7329  .arange(n_atoms)
-0001d0e0: 2c20 6e70 2e61 7261 6e67 6528 6e5f 6174  , np.arange(n_at
-0001d0f0: 6f6d 7329 290a 2020 2020 3e3e 3e20 6174  oms)).    >>> at
-0001d100: 6f6d 5f74 6f5f 7061 6972 2e61 7070 656e  om_to_pair.appen
-0001d110: 6428 6e70 2e74 7261 6e73 706f 7365 286e  d(np.transpose(n
-0001d120: 702e 6172 7261 7928 5b43 312e 666c 6174  p.array([C1.flat
-0001d130: 7465 6e28 2920 2b20 7374 6172 742c 2043  ten() + start, C
-0001d140: 302e 666c 6174 7465 6e28 2920 2b20 7374  0.flatten() + st
-0001d150: 6172 745d 2929 290a 2020 2020 3e3e 3e20  art]))).    >>> 
-0001d160: 6174 6f6d 5f74 6f5f 7061 6972 203d 2074  atom_to_pair = t
-0001d170: 6f72 6368 2e54 656e 736f 7228 6174 6f6d  orch.Tensor(atom
-0001d180: 5f74 6f5f 7061 6972 290a 2020 2020 3e3e  _to_pair).    >>
-0001d190: 3e20 6174 6f6d 5f74 6f5f 7061 6972 203d  > atom_to_pair =
-0001d1a0: 2074 6f72 6368 2e73 7175 6565 7a65 2861   torch.squeeze(a
-0001d1b0: 746f 6d5f 746f 5f70 6169 722e 746f 2874  tom_to_pair.to(t
-0001d1c0: 6f72 6368 2e69 6e74 3634 292c 2064 696d  orch.int64), dim
-0001d1d0: 3d30 290a 2020 2020 3e3e 3e20 696e 7075  =0).    >>> inpu
-0001d1e0: 7473 203d 205b 7061 6972 5f66 6561 7475  ts = [pair_featu
-0001d1f0: 7265 732c 2061 746f 6d5f 6665 6174 7572  res, atom_featur
-0001d200: 6573 2c20 6174 6f6d 5f74 6f5f 7061 6972  es, atom_to_pair
-0001d210: 5d0a 2020 2020 3e3e 3e20 6e5f 7061 6972  ].    >>> n_pair
-0001d220: 5f66 6561 7475 7265 7320 3d20 320a 2020  _features = 2.  
-0001d230: 2020 3e3e 3e20 6e5f 6869 6464 656e 203d    >>> n_hidden =
-0001d240: 2032 0a20 2020 203e 3e3e 2069 6e69 7420   2.    >>> init 
-0001d250: 3d20 2778 6176 6965 725f 756e 6966 6f72  = 'xavier_unifor
-0001d260: 6d5f 270a 2020 2020 3e3e 3e20 6c61 7965  m_'.    >>> laye
-0001d270: 7220 3d20 4564 6765 4e65 7477 6f72 6b28  r = EdgeNetwork(
-0001d280: 6e5f 7061 6972 5f66 6561 7475 7265 732c  n_pair_features,
-0001d290: 206e 5f68 6964 6465 6e2c 2069 6e69 7429   n_hidden, init)
-0001d2a0: 0a20 2020 203e 3e3e 2072 6573 756c 7420  .    >>> result 
-0001d2b0: 3d20 6c61 7965 7228 696e 7075 7473 290a  = layer(inputs).
-0001d2c0: 2020 2020 3e3e 3e20 7265 7375 6c74 2e73      >>> result.s
-0001d2d0: 6861 7065 5b31 5d0a 2020 2020 320a 2020  hape[1].    2.  
-0001d2e0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-0001d2f0: 5f69 6e69 745f 5f28 7365 6c66 2c0a 2020  _init__(self,.  
-0001d300: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001d310: 5f70 6169 725f 6665 6174 7572 6573 3a20  _pair_features: 
-0001d320: 696e 7420 3d20 382c 0a20 2020 2020 2020  int = 8,.       
-0001d330: 2020 2020 2020 2020 2020 6e5f 6869 6464            n_hidd
-0001d340: 656e 3a20 696e 7420 3d20 3130 302c 0a20  en: int = 100,. 
-0001d350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d360: 696e 6974 3a20 7374 7220 3d20 2778 6176  init: str = 'xav
-0001d370: 6965 725f 756e 6966 6f72 6d5f 272c 0a20  ier_uniform_',. 
-0001d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d390: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0001d3a0: 2020 2022 2222 496e 6974 616c 6973 6573     """Initalises
-0001d3b0: 2061 2045 6467 654e 6574 776f 726b 204c   a EdgeNetwork L
-0001d3c0: 6179 6572 0a0a 2020 2020 2020 2020 5061  ayer..        Pa
-0001d3d0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-0001d3e0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-0001d3f0: 2020 2020 6e5f 7061 6972 5f66 6561 7475      n_pair_featu
-0001d400: 7265 733a 2069 6e74 2c20 6f70 7469 6f6e  res: int, option
-0001d410: 616c 0a20 2020 2020 2020 2020 2020 2054  al.            T
-0001d420: 6865 206c 656e 6774 6820 6f66 2074 6865  he length of the
-0001d430: 2070 6169 7220 6665 6174 7572 6573 2076   pair features v
-0001d440: 6563 746f 722e 0a20 2020 2020 2020 206e  ector..        n
-0001d450: 5f68 6964 6465 6e3a 2069 6e74 2c20 6f70  _hidden: int, op
-0001d460: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-0001d470: 2020 206e 756d 6265 7220 6f66 2068 6964     number of hid
-0001d480: 6465 6e20 756e 6974 7320 696e 2074 6865  den units in the
-0001d490: 2070 6173 7369 6e67 2070 6861 7365 0a20   passing phase. 
-0001d4a0: 2020 2020 2020 2069 6e69 743a 2073 7472         init: str
-0001d4b0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0001d4c0: 2020 2020 2020 2049 6e69 7469 616c 697a         Initializ
-0001d4d0: 6174 696f 6e20 6675 6e63 7469 6f6e 2074  ation function t
-0001d4e0: 6f20 6265 2075 7365 6420 696e 2074 6865  o be used in the
-0001d4f0: 206d 6573 7361 6765 2070 6173 7369 6e67   message passing
-0001d500: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
-0001d510: 2222 220a 0a20 2020 2020 2020 2073 7570  """..        sup
-0001d520: 6572 2845 6467 654e 6574 776f 726b 2c20  er(EdgeNetwork, 
-0001d530: 7365 6c66 292e 5f5f 696e 6974 5f5f 282a  self).__init__(*
-0001d540: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-0001d550: 2073 656c 662e 6e5f 7061 6972 5f66 6561   self.n_pair_fea
-0001d560: 7475 7265 733a 2069 6e74 203d 206e 5f70  tures: int = n_p
-0001d570: 6169 725f 6665 6174 7572 6573 0a20 2020  air_features.   
-0001d580: 2020 2020 2073 656c 662e 6e5f 6869 6464       self.n_hidd
-0001d590: 656e 3a20 696e 7420 3d20 6e5f 6869 6464  en: int = n_hidd
-0001d5a0: 656e 0a20 2020 2020 2020 2073 656c 662e  en.        self.
-0001d5b0: 696e 6974 3a20 7374 7220 3d20 696e 6974  init: str = init
-0001d5c0: 0a0a 2020 2020 2020 2020 696e 6974 5f66  ..        init_f
-0001d5d0: 756e 633a 2043 616c 6c61 626c 6520 3d20  unc: Callable = 
-0001d5e0: 6765 7461 7474 7228 696e 6974 6961 6c69  getattr(initiali
-0001d5f0: 7a65 7273 2c20 7365 6c66 2e69 6e69 7429  zers, self.init)
-0001d600: 0a20 2020 2020 2020 2073 656c 662e 573a  .        self.W:
-0001d610: 2074 6f72 6368 2e54 656e 736f 7220 3d20   torch.Tensor = 
-0001d620: 696e 6974 5f66 756e 6328 0a20 2020 2020  init_func(.     
-0001d630: 2020 2020 2020 2074 6f72 6368 2e65 6d70         torch.emp
-0001d640: 7479 285b 7365 6c66 2e6e 5f70 6169 725f  ty([self.n_pair_
-0001d650: 6665 6174 7572 6573 2c20 7365 6c66 2e6e  features, self.n
-0001d660: 5f68 6964 6465 6e20 2a20 7365 6c66 2e6e  _hidden * self.n
-0001d670: 5f68 6964 6465 6e5d 2929 0a20 2020 2020  _hidden])).     
-0001d680: 2020 2073 656c 662e 623a 2074 6f72 6368     self.b: torch
-0001d690: 2e54 656e 736f 7220 3d20 746f 7263 682e  .Tensor = torch.
-0001d6a0: 7a65 726f 7328 2873 656c 662e 6e5f 6869  zeros((self.n_hi
-0001d6b0: 6464 656e 202a 2073 656c 662e 6e5f 6869  dden * self.n_hi
-0001d6c0: 6464 656e 2c29 290a 2020 2020 2020 2020  dden,)).        
-0001d6d0: 7365 6c66 2e62 7569 6c74 3a20 626f 6f6c  self.built: bool
-0001d6e0: 203d 2054 7275 650a 0a20 2020 2064 6566   = True..    def
-0001d6f0: 205f 5f72 6570 725f 5f28 7365 6c66 2920   __repr__(self) 
-0001d700: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
-0001d710: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-0001d720: 2020 2020 2066 277b 7365 6c66 2e5f 5f63       f'{self.__c
-0001d730: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-0001d740: 286e 5f70 6169 725f 6665 6174 7572 6573  (n_pair_features
-0001d750: 3a7b 7365 6c66 2e6e 5f70 6169 725f 6665  :{self.n_pair_fe
-0001d760: 6174 7572 6573 7d2c 6e5f 6869 6464 656e  atures},n_hidden
-0001d770: 3a7b 7365 6c66 2e6e 5f68 6964 6465 6e7d  :{self.n_hidden}
-0001d780: 2c69 6e69 743a 7b73 656c 662e 696e 6974  ,init:{self.init
-0001d790: 7d29 270a 2020 2020 2020 2020 290a 0a20  })'.        ).. 
-0001d7a0: 2020 2064 6566 2066 6f72 7761 7264 2873     def forward(s
-0001d7b0: 656c 662c 2069 6e70 7574 733a 204c 6973  elf, inputs: Lis
-0001d7c0: 745b 746f 7263 682e 5465 6e73 6f72 5d29  t[torch.Tensor])
-0001d7d0: 202d 3e20 746f 7263 682e 5465 6e73 6f72   -> torch.Tensor
-0001d7e0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001d7f0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0001d800: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0001d810: 2d2d 2d0a 2020 2020 2020 2020 696e 7075  ---.        inpu
-0001d820: 7473 3a20 4c69 7374 5b74 6f72 6368 2e54  ts: List[torch.T
-0001d830: 656e 736f 725d 0a20 2020 2020 2020 2020  ensor].         
-0001d840: 2020 2054 6865 206c 656e 6774 6820 6f66     The length of
-0001d850: 2061 746f 6d5f 746f 5f70 6169 7220 7368   atom_to_pair sh
-0001d860: 6f75 6c64 2062 6520 7361 6d65 2061 7320  ould be same as 
-0001d870: 6e5f 7061 6972 5f66 6561 7475 7265 732e  n_pair_features.
-0001d880: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-0001d890: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0001d8a0: 0a20 2020 2020 2020 2072 6573 756c 743a  .        result:
-0001d8b0: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-0001d8c0: 2020 2020 2020 2020 2020 5465 6e73 6f72            Tensor
-0001d8d0: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
-0001d8e0: 6d61 7070 696e 6720 6f66 2074 6865 2065  mapping of the e
-0001d8f0: 6467 6520 7665 6374 6f72 2074 6f20 6120  dge vector to a 
-0001d900: 6420 c397 2064 206d 6174 7269 782c 2077  d .. d matrix, w
-0001d910: 6865 7265 2064 2064 656e 6f74 6573 2074  here d denotes t
-0001d920: 6865 2064 696d 656e 7369 6f6e 206f 6620  he dimension of 
-0001d930: 7468 6520 696e 7465 726e 616c 2068 6964  the internal hid
-0001d940: 6465 6e20 7265 7072 6573 656e 7461 7469  den representati
-0001d950: 6f6e 206f 6620 6561 6368 206e 6f64 6520  on of each node 
-0001d960: 696e 2074 6865 2067 7261 7068 2e0a 2020  in the graph..  
-0001d970: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001d980: 2020 7061 6972 5f66 6561 7475 7265 733a    pair_features:
-0001d990: 2074 6f72 6368 2e54 656e 736f 720a 2020   torch.Tensor.  
-0001d9a0: 2020 2020 2020 6174 6f6d 5f66 6561 7475        atom_featu
-0001d9b0: 7265 733a 2074 6f72 6368 2e54 656e 736f  res: torch.Tenso
-0001d9c0: 720a 2020 2020 2020 2020 6174 6f6d 5f74  r.        atom_t
-0001d9d0: 6f5f 7061 6972 3a20 746f 7263 682e 5465  o_pair: torch.Te
-0001d9e0: 6e73 6f72 0a20 2020 2020 2020 2070 6169  nsor.        pai
-0001d9f0: 725f 6665 6174 7572 6573 2c20 6174 6f6d  r_features, atom
-0001da00: 5f66 6561 7475 7265 732c 2061 746f 6d5f  _features, atom_
-0001da10: 746f 5f70 6169 7220 3d20 696e 7075 7473  to_pair = inputs
-0001da20: 0a0a 2020 2020 2020 2020 413a 2074 6f72  ..        A: tor
-0001da30: 6368 2e54 656e 736f 7220 3d20 746f 7263  ch.Tensor = torc
-0001da40: 682e 6164 6428 746f 7263 682e 6d61 746d  h.add(torch.matm
-0001da50: 756c 2870 6169 725f 6665 6174 7572 6573  ul(pair_features
-0001da60: 2c20 7365 6c66 2e57 292c 2073 656c 662e  , self.W), self.
-0001da70: 6229 0a20 2020 2020 2020 2041 203d 2074  b).        A = t
-0001da80: 6f72 6368 2e72 6573 6861 7065 2841 2c20  orch.reshape(A, 
-0001da90: 282d 312c 2073 656c 662e 6e5f 6869 6464  (-1, self.n_hidd
-0001daa0: 656e 2c20 7365 6c66 2e6e 5f68 6964 6465  en, self.n_hidde
-0001dab0: 6e29 290a 2020 2020 2020 2020 6f75 743a  n)).        out:
-0001dac0: 2074 6f72 6368 2e54 656e 736f 7220 3d20   torch.Tensor = 
-0001dad0: 746f 7263 682e 756e 7371 7565 657a 6528  torch.unsqueeze(
-0001dae0: 6174 6f6d 5f66 6561 7475 7265 735b 6174  atom_features[at
-0001daf0: 6f6d 5f74 6f5f 7061 6972 5b3a 2c20 315d  om_to_pair[:, 1]
-0001db00: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0001cf10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001cf20: 2e65 6d62 6564 6469 6e67 5f6c 6973 7429  .embedding_list)
+0001cf30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001cf40: 6174 6f6d 5f65 6e62 6564 6469 6e67 730a  atom_enbeddings.
+0001cf50: 0a0a 636c 6173 7320 4564 6765 4e65 7477  ..class EdgeNetw
+0001cf60: 6f72 6b28 6e6e 2e4d 6f64 756c 6529 3a0a  ork(nn.Module):.
+0001cf70: 2020 2020 2222 2254 6865 2045 6467 654e      """The EdgeN
+0001cf80: 6574 776f 726b 206d 6f64 756c 6520 6973  etwork module is
+0001cf90: 2061 2050 7954 6f72 6368 2073 7562 6d6f   a PyTorch submo
+0001cfa0: 6475 6c65 2064 6573 6967 6e65 6420 666f  dule designed fo
+0001cfb0: 7220 6d65 7373 6167 6520 7061 7373 696e  r message passin
+0001cfc0: 6720 696e 2067 7261 7068 206e 6575 7261  g in graph neura
+0001cfd0: 6c20 6e65 7477 6f72 6b73 2e0a 0a20 2020  l networks...   
+0001cfe0: 2045 7861 6d70 6c65 730a 2020 2020 2d2d   Examples.    --
+0001cff0: 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e 2070  ------.    >>> p
+0001d000: 6169 725f 6665 6174 7572 6573 203d 2074  air_features = t
+0001d010: 6f72 6368 2e72 616e 6428 2834 2c20 3229  orch.rand((4, 2)
+0001d020: 2c20 6474 7970 653d 746f 7263 682e 666c  , dtype=torch.fl
+0001d030: 6f61 7433 3229 0a20 2020 203e 3e3e 2061  oat32).    >>> a
+0001d040: 746f 6d5f 6665 6174 7572 6573 203d 2074  tom_features = t
+0001d050: 6f72 6368 2e72 616e 6428 2835 2c20 3229  orch.rand((5, 2)
+0001d060: 2c20 6474 7970 653d 746f 7263 682e 666c  , dtype=torch.fl
+0001d070: 6f61 7433 3229 0a20 2020 203e 3e3e 2061  oat32).    >>> a
+0001d080: 746f 6d5f 746f 5f70 6169 7220 3d20 5b5d  tom_to_pair = []
+0001d090: 0a20 2020 203e 3e3e 206e 5f61 746f 6d73  .    >>> n_atoms
+0001d0a0: 203d 2032 0a20 2020 203e 3e3e 2073 7461   = 2.    >>> sta
+0001d0b0: 7274 203d 2030 0a20 2020 203e 3e3e 2043  rt = 0.    >>> C
+0001d0c0: 302c 2043 3120 3d20 6e70 2e6d 6573 6867  0, C1 = np.meshg
+0001d0d0: 7269 6428 6e70 2e61 7261 6e67 6528 6e5f  rid(np.arange(n_
+0001d0e0: 6174 6f6d 7329 2c20 6e70 2e61 7261 6e67  atoms), np.arang
+0001d0f0: 6528 6e5f 6174 6f6d 7329 290a 2020 2020  e(n_atoms)).    
+0001d100: 3e3e 3e20 6174 6f6d 5f74 6f5f 7061 6972  >>> atom_to_pair
+0001d110: 2e61 7070 656e 6428 6e70 2e74 7261 6e73  .append(np.trans
+0001d120: 706f 7365 286e 702e 6172 7261 7928 5b43  pose(np.array([C
+0001d130: 312e 666c 6174 7465 6e28 2920 2b20 7374  1.flatten() + st
+0001d140: 6172 742c 2043 302e 666c 6174 7465 6e28  art, C0.flatten(
+0001d150: 2920 2b20 7374 6172 745d 2929 290a 2020  ) + start]))).  
+0001d160: 2020 3e3e 3e20 6174 6f6d 5f74 6f5f 7061    >>> atom_to_pa
+0001d170: 6972 203d 2074 6f72 6368 2e54 656e 736f  ir = torch.Tenso
+0001d180: 7228 6174 6f6d 5f74 6f5f 7061 6972 290a  r(atom_to_pair).
+0001d190: 2020 2020 3e3e 3e20 6174 6f6d 5f74 6f5f      >>> atom_to_
+0001d1a0: 7061 6972 203d 2074 6f72 6368 2e73 7175  pair = torch.squ
+0001d1b0: 6565 7a65 2861 746f 6d5f 746f 5f70 6169  eeze(atom_to_pai
+0001d1c0: 722e 746f 2874 6f72 6368 2e69 6e74 3634  r.to(torch.int64
+0001d1d0: 292c 2064 696d 3d30 290a 2020 2020 3e3e  ), dim=0).    >>
+0001d1e0: 3e20 696e 7075 7473 203d 205b 7061 6972  > inputs = [pair
+0001d1f0: 5f66 6561 7475 7265 732c 2061 746f 6d5f  _features, atom_
+0001d200: 6665 6174 7572 6573 2c20 6174 6f6d 5f74  features, atom_t
+0001d210: 6f5f 7061 6972 5d0a 2020 2020 3e3e 3e20  o_pair].    >>> 
+0001d220: 6e5f 7061 6972 5f66 6561 7475 7265 7320  n_pair_features 
+0001d230: 3d20 320a 2020 2020 3e3e 3e20 6e5f 6869  = 2.    >>> n_hi
+0001d240: 6464 656e 203d 2032 0a20 2020 203e 3e3e  dden = 2.    >>>
+0001d250: 2069 6e69 7420 3d20 2778 6176 6965 725f   init = 'xavier_
+0001d260: 756e 6966 6f72 6d5f 270a 2020 2020 3e3e  uniform_'.    >>
+0001d270: 3e20 6c61 7965 7220 3d20 4564 6765 4e65  > layer = EdgeNe
+0001d280: 7477 6f72 6b28 6e5f 7061 6972 5f66 6561  twork(n_pair_fea
+0001d290: 7475 7265 732c 206e 5f68 6964 6465 6e2c  tures, n_hidden,
+0001d2a0: 2069 6e69 7429 0a20 2020 203e 3e3e 2072   init).    >>> r
+0001d2b0: 6573 756c 7420 3d20 6c61 7965 7228 696e  esult = layer(in
+0001d2c0: 7075 7473 290a 2020 2020 3e3e 3e20 7265  puts).    >>> re
+0001d2d0: 7375 6c74 2e73 6861 7065 5b31 5d0a 2020  sult.shape[1].  
+0001d2e0: 2020 320a 2020 2020 2222 220a 0a20 2020    2.    """..   
+0001d2f0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+0001d300: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+0001d310: 2020 2020 206e 5f70 6169 725f 6665 6174       n_pair_feat
+0001d320: 7572 6573 3a20 696e 7420 3d20 382c 0a20  ures: int = 8,. 
+0001d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d340: 6e5f 6869 6464 656e 3a20 696e 7420 3d20  n_hidden: int = 
+0001d350: 3130 302c 0a20 2020 2020 2020 2020 2020  100,.           
+0001d360: 2020 2020 2020 696e 6974 3a20 7374 7220        init: str 
+0001d370: 3d20 2778 6176 6965 725f 756e 6966 6f72  = 'xavier_unifor
+0001d380: 6d5f 272c 0a20 2020 2020 2020 2020 2020  m_',.           
+0001d390: 2020 2020 2020 2a2a 6b77 6172 6773 293a        **kwargs):
+0001d3a0: 0a20 2020 2020 2020 2022 2222 496e 6974  .        """Init
+0001d3b0: 616c 6973 6573 2061 2045 6467 654e 6574  alises a EdgeNet
+0001d3c0: 776f 726b 204c 6179 6572 0a0a 2020 2020  work Layer..    
+0001d3d0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0001d3e0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0001d3f0: 2d0a 2020 2020 2020 2020 6e5f 7061 6972  -.        n_pair
+0001d400: 5f66 6561 7475 7265 733a 2069 6e74 2c20  _features: int, 
+0001d410: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+0001d420: 2020 2020 2054 6865 206c 656e 6774 6820       The length 
+0001d430: 6f66 2074 6865 2070 6169 7220 6665 6174  of the pair feat
+0001d440: 7572 6573 2076 6563 746f 722e 0a20 2020  ures vector..   
+0001d450: 2020 2020 206e 5f68 6964 6465 6e3a 2069       n_hidden: i
+0001d460: 6e74 2c20 6f70 7469 6f6e 616c 0a20 2020  nt, optional.   
+0001d470: 2020 2020 2020 2020 206e 756d 6265 7220           number 
+0001d480: 6f66 2068 6964 6465 6e20 756e 6974 7320  of hidden units 
+0001d490: 696e 2074 6865 2070 6173 7369 6e67 2070  in the passing p
+0001d4a0: 6861 7365 0a20 2020 2020 2020 2069 6e69  hase.        ini
+0001d4b0: 743a 2073 7472 2c20 6f70 7469 6f6e 616c  t: str, optional
+0001d4c0: 0a20 2020 2020 2020 2020 2020 2049 6e69  .            Ini
+0001d4d0: 7469 616c 697a 6174 696f 6e20 6675 6e63  tialization func
+0001d4e0: 7469 6f6e 2074 6f20 6265 2075 7365 6420  tion to be used 
+0001d4f0: 696e 2074 6865 206d 6573 7361 6765 2070  in the message p
+0001d500: 6173 7369 6e67 206c 6179 6572 2e0a 2020  assing layer..  
+0001d510: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0001d520: 2020 2073 7570 6572 2845 6467 654e 6574     super(EdgeNet
+0001d530: 776f 726b 2c20 7365 6c66 292e 5f5f 696e  work, self).__in
+0001d540: 6974 5f5f 282a 2a6b 7761 7267 7329 0a20  it__(**kwargs). 
+0001d550: 2020 2020 2020 2073 656c 662e 6e5f 7061         self.n_pa
+0001d560: 6972 5f66 6561 7475 7265 733a 2069 6e74  ir_features: int
+0001d570: 203d 206e 5f70 6169 725f 6665 6174 7572   = n_pair_featur
+0001d580: 6573 0a20 2020 2020 2020 2073 656c 662e  es.        self.
+0001d590: 6e5f 6869 6464 656e 3a20 696e 7420 3d20  n_hidden: int = 
+0001d5a0: 6e5f 6869 6464 656e 0a20 2020 2020 2020  n_hidden.       
+0001d5b0: 2073 656c 662e 696e 6974 3a20 7374 7220   self.init: str 
+0001d5c0: 3d20 696e 6974 0a0a 2020 2020 2020 2020  = init..        
+0001d5d0: 696e 6974 5f66 756e 633a 2043 616c 6c61  init_func: Calla
+0001d5e0: 626c 6520 3d20 6765 7461 7474 7228 696e  ble = getattr(in
+0001d5f0: 6974 6961 6c69 7a65 7273 2c20 7365 6c66  itializers, self
+0001d600: 2e69 6e69 7429 0a20 2020 2020 2020 2073  .init).        s
+0001d610: 656c 662e 573a 2074 6f72 6368 2e54 656e  elf.W: torch.Ten
+0001d620: 736f 7220 3d20 696e 6974 5f66 756e 6328  sor = init_func(
+0001d630: 0a20 2020 2020 2020 2020 2020 2074 6f72  .            tor
+0001d640: 6368 2e65 6d70 7479 285b 7365 6c66 2e6e  ch.empty([self.n
+0001d650: 5f70 6169 725f 6665 6174 7572 6573 2c20  _pair_features, 
+0001d660: 7365 6c66 2e6e 5f68 6964 6465 6e20 2a20  self.n_hidden * 
+0001d670: 7365 6c66 2e6e 5f68 6964 6465 6e5d 2929  self.n_hidden]))
+0001d680: 0a20 2020 2020 2020 2073 656c 662e 623a  .        self.b:
+0001d690: 2074 6f72 6368 2e54 656e 736f 7220 3d20   torch.Tensor = 
+0001d6a0: 746f 7263 682e 7a65 726f 7328 2873 656c  torch.zeros((sel
+0001d6b0: 662e 6e5f 6869 6464 656e 202a 2073 656c  f.n_hidden * sel
+0001d6c0: 662e 6e5f 6869 6464 656e 2c29 290a 2020  f.n_hidden,)).  
+0001d6d0: 2020 2020 2020 7365 6c66 2e62 7569 6c74        self.built
+0001d6e0: 3a20 626f 6f6c 203d 2054 7275 650a 0a20  : bool = True.. 
+0001d6f0: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+0001d700: 7365 6c66 2920 2d3e 2073 7472 3a0a 2020  self) -> str:.  
+0001d710: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
+0001d720: 2020 2020 2020 2020 2020 2066 277b 7365             f'{se
+0001d730: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
+0001d740: 616d 655f 5f7d 286e 5f70 6169 725f 6665  ame__}(n_pair_fe
+0001d750: 6174 7572 6573 3a7b 7365 6c66 2e6e 5f70  atures:{self.n_p
+0001d760: 6169 725f 6665 6174 7572 6573 7d2c 6e5f  air_features},n_
+0001d770: 6869 6464 656e 3a7b 7365 6c66 2e6e 5f68  hidden:{self.n_h
+0001d780: 6964 6465 6e7d 2c69 6e69 743a 7b73 656c  idden},init:{sel
+0001d790: 662e 696e 6974 7d29 270a 2020 2020 2020  f.init})'.      
+0001d7a0: 2020 290a 0a20 2020 2064 6566 2066 6f72    )..    def for
+0001d7b0: 7761 7264 2873 656c 662c 2069 6e70 7574  ward(self, input
+0001d7c0: 733a 204c 6973 745b 746f 7263 682e 5465  s: List[torch.Te
+0001d7d0: 6e73 6f72 5d29 202d 3e20 746f 7263 682e  nsor]) -> torch.
+0001d7e0: 5465 6e73 6f72 3a0a 2020 2020 2020 2020  Tensor:.        
+0001d7f0: 2222 220a 2020 2020 2020 2020 5061 7261  """.        Para
+0001d800: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+0001d810: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+0001d820: 2020 696e 7075 7473 3a20 4c69 7374 5b74    inputs: List[t
+0001d830: 6f72 6368 2e54 656e 736f 725d 0a20 2020  orch.Tensor].   
+0001d840: 2020 2020 2020 2020 2054 6865 206c 656e           The len
+0001d850: 6774 6820 6f66 2061 746f 6d5f 746f 5f70  gth of atom_to_p
+0001d860: 6169 7220 7368 6f75 6c64 2062 6520 7361  air should be sa
+0001d870: 6d65 2061 7320 6e5f 7061 6972 5f66 6561  me as n_pair_fea
+0001d880: 7475 7265 732e 0a20 2020 2020 2020 2052  tures..        R
+0001d890: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
+0001d8a0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2072  ------.        r
+0001d8b0: 6573 756c 743a 2074 6f72 6368 2e54 656e  esult: torch.Ten
+0001d8c0: 736f 720a 2020 2020 2020 2020 2020 2020  sor.            
+0001d8d0: 5465 6e73 6f72 2063 6f6e 7461 696e 696e  Tensor containin
+0001d8e0: 6720 7468 6520 6d61 7070 696e 6720 6f66  g the mapping of
+0001d8f0: 2074 6865 2065 6467 6520 7665 6374 6f72   the edge vector
+0001d900: 2074 6f20 6120 6420 c397 2064 206d 6174   to a d .. d mat
+0001d910: 7269 782c 2077 6865 7265 2064 2064 656e  rix, where d den
+0001d920: 6f74 6573 2074 6865 2064 696d 656e 7369  otes the dimensi
+0001d930: 6f6e 206f 6620 7468 6520 696e 7465 726e  on of the intern
+0001d940: 616c 2068 6964 6465 6e20 7265 7072 6573  al hidden repres
+0001d950: 656e 7461 7469 6f6e 206f 6620 6561 6368  entation of each
+0001d960: 206e 6f64 6520 696e 2074 6865 2067 7261   node in the gra
+0001d970: 7068 2e0a 2020 2020 2020 2020 2222 220a  ph..        """.
+0001d980: 2020 2020 2020 2020 7061 6972 5f66 6561          pair_fea
+0001d990: 7475 7265 733a 2074 6f72 6368 2e54 656e  tures: torch.Ten
+0001d9a0: 736f 720a 2020 2020 2020 2020 6174 6f6d  sor.        atom
+0001d9b0: 5f66 6561 7475 7265 733a 2074 6f72 6368  _features: torch
+0001d9c0: 2e54 656e 736f 720a 2020 2020 2020 2020  .Tensor.        
+0001d9d0: 6174 6f6d 5f74 6f5f 7061 6972 3a20 746f  atom_to_pair: to
+0001d9e0: 7263 682e 5465 6e73 6f72 0a20 2020 2020  rch.Tensor.     
+0001d9f0: 2020 2070 6169 725f 6665 6174 7572 6573     pair_features
+0001da00: 2c20 6174 6f6d 5f66 6561 7475 7265 732c  , atom_features,
+0001da10: 2061 746f 6d5f 746f 5f70 6169 7220 3d20   atom_to_pair = 
+0001da20: 696e 7075 7473 0a0a 2020 2020 2020 2020  inputs..        
+0001da30: 413a 2074 6f72 6368 2e54 656e 736f 7220  A: torch.Tensor 
+0001da40: 3d20 746f 7263 682e 6164 6428 746f 7263  = torch.add(torc
+0001da50: 682e 6d61 746d 756c 2870 6169 725f 6665  h.matmul(pair_fe
+0001da60: 6174 7572 6573 2c20 7365 6c66 2e57 292c  atures, self.W),
+0001da70: 2073 656c 662e 6229 0a20 2020 2020 2020   self.b).       
+0001da80: 2041 203d 2074 6f72 6368 2e72 6573 6861   A = torch.resha
+0001da90: 7065 2841 2c20 282d 312c 2073 656c 662e  pe(A, (-1, self.
+0001daa0: 6e5f 6869 6464 656e 2c20 7365 6c66 2e6e  n_hidden, self.n
+0001dab0: 5f68 6964 6465 6e29 290a 2020 2020 2020  _hidden)).      
+0001dac0: 2020 6f75 743a 2074 6f72 6368 2e54 656e    out: torch.Ten
+0001dad0: 736f 7220 3d20 746f 7263 682e 756e 7371  sor = torch.unsq
+0001dae0: 7565 657a 6528 6174 6f6d 5f66 6561 7475  ueeze(atom_featu
+0001daf0: 7265 735b 6174 6f6d 5f74 6f5f 7061 6972  res[atom_to_pair
+0001db00: 5b3a 2c20 315d 5d2c 0a20 2020 2020 2020  [:, 1]],.       
 0001db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db20: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001db30: 696d 3d32 290a 2020 2020 2020 2020 6f75  im=2).        ou
-0001db40: 745f 7371 7565 657a 653a 2074 6f72 6368  t_squeeze: torch
-0001db50: 2e54 656e 736f 7220 3d20 746f 7263 682e  .Tensor = torch.
-0001db60: 7371 7565 657a 6528 746f 7263 682e 6d61  squeeze(torch.ma
-0001db70: 746d 756c 2841 2c20 6f75 7429 2c20 6469  tmul(A, out), di
-0001db80: 6d3d 3229 0a20 2020 2020 2020 2069 6e64  m=2).        ind
-0001db90: 3a20 746f 7263 682e 5465 6e73 6f72 203d  : torch.Tensor =
-0001dba0: 2061 746f 6d5f 746f 5f70 6169 725b 3a2c   atom_to_pair[:,
-0001dbb0: 2030 5d0a 0a20 2020 2020 2020 2072 6573   0]..        res
-0001dbc0: 756c 743a 2074 6f72 6368 2e54 656e 736f  ult: torch.Tenso
-0001dbd0: 7220 3d20 7365 676d 656e 745f 7375 6d28  r = segment_sum(
-0001dbe0: 6f75 745f 7371 7565 657a 652c 2069 6e64  out_squeeze, ind
-0001dbf0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0001dc00: 6e20 7265 7375 6c74 0a                   n result.
+0001db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db30: 2020 2020 2064 696d 3d32 290a 2020 2020       dim=2).    
+0001db40: 2020 2020 6f75 745f 7371 7565 657a 653a      out_squeeze:
+0001db50: 2074 6f72 6368 2e54 656e 736f 7220 3d20   torch.Tensor = 
+0001db60: 746f 7263 682e 7371 7565 657a 6528 746f  torch.squeeze(to
+0001db70: 7263 682e 6d61 746d 756c 2841 2c20 6f75  rch.matmul(A, ou
+0001db80: 7429 2c20 6469 6d3d 3229 0a20 2020 2020  t), dim=2).     
+0001db90: 2020 2069 6e64 3a20 746f 7263 682e 5465     ind: torch.Te
+0001dba0: 6e73 6f72 203d 2061 746f 6d5f 746f 5f70  nsor = atom_to_p
+0001dbb0: 6169 725b 3a2c 2030 5d0a 0a20 2020 2020  air[:, 0]..     
+0001dbc0: 2020 2072 6573 756c 743a 2074 6f72 6368     result: torch
+0001dbd0: 2e54 656e 736f 7220 3d20 7365 676d 656e  .Tensor = segmen
+0001dbe0: 745f 7375 6d28 6f75 745f 7371 7565 657a  t_sum(out_squeez
+0001dbf0: 652c 2069 6e64 290a 0a20 2020 2020 2020  e, ind)..       
+0001dc00: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
+0001dc10: 0a63 6c61 7373 2057 6561 7665 4c61 7965  .class WeaveLaye
+0001dc20: 7228 6e6e 2e4d 6f64 756c 6529 3a0a 2020  r(nn.Module):.  
+0001dc30: 2020 2222 2254 6869 7320 636c 6173 7320    """This class 
+0001dc40: 696d 706c 656d 656e 7473 2074 6865 2063  implements the c
+0001dc50: 6f72 6520 5765 6176 6520 636f 6e76 6f6c  ore Weave convol
+0001dc60: 7574 696f 6e20 6672 6f6d 2074 6865 2047  ution from the G
+0001dc70: 6f6f 676c 6520 6772 6170 6820 636f 6e76  oogle graph conv
+0001dc80: 6f6c 7574 696f 6e20 7061 7065 7220 5b31  olution paper [1
+0001dc90: 5d5f 0a20 2054 6869 7320 6973 2074 6865  ]_.  This is the
+0001dca0: 2054 6f72 6368 2065 7175 6976 616c 656e   Torch equivalen
+0001dcb0: 7420 6f66 2074 6865 206f 7269 6769 6e61  t of the origina
+0001dcc0: 6c20 696d 706c 656d 656e 7461 7469 6f6e  l implementation
+0001dcd0: 2075 7369 6e67 204b 6572 6173 2e0a 0a20   using Keras... 
+0001dce0: 2054 6869 7320 6d6f 6465 6c20 636f 6e74   This model cont
+0001dcf0: 6169 6e73 2061 746f 6d20 6665 6174 7572  ains atom featur
+0001dd00: 6573 2061 6e64 2062 6f6e 6420 6665 6174  es and bond feat
+0001dd10: 7572 6573 0a20 2073 6570 6172 6174 656c  ures.  separatel
+0001dd20: 792e 4865 7265 2c20 626f 6e64 2066 6561  y.Here, bond fea
+0001dd30: 7475 7265 7320 6172 6520 616c 736f 2063  tures are also c
+0001dd40: 616c 6c65 6420 7061 6972 2066 6561 7475  alled pair featu
+0001dd50: 7265 732e 0a20 2054 6865 7265 2061 7265  res..  There are
+0001dd60: 2032 2074 7970 6573 206f 6620 7472 616e   2 types of tran
+0001dd70: 7366 6f72 6d61 7469 6f6e 2c20 6174 6f6d  sformation, atom
+0001dd80: 2d3e 6174 6f6d 2c20 6174 6f6d 2d3e 7061  ->atom, atom->pa
+0001dd90: 6972 2c20 7061 6972 2d3e 6174 6f6d 2c20  ir, pair->atom, 
+0001dda0: 7061 6972 2d3e 7061 6972 2074 6861 7420  pair->pair that 
+0001ddb0: 7468 6973 206d 6f64 656c 2069 6d70 6c65  this model imple
+0001ddc0: 6d65 6e74 732e 0a0a 2020 4578 616d 706c  ments...  Exampl
+0001ddd0: 6573 0a20 202d 2d2d 2d2d 2d2d 2d0a 2020  es.  --------.  
+0001dde0: 5468 6973 206c 6179 6572 2065 7870 6563  This layer expec
+0001ddf0: 7473 2034 2069 6e70 7574 7320 696e 2061  ts 4 inputs in a
+0001de00: 206c 6973 7420 6f66 2074 6865 2066 6f72   list of the for
+0001de10: 6d20 605b 6174 6f6d 5f66 6561 7475 7265  m `[atom_feature
+0001de20: 732c 0a20 2070 6169 725f 6665 6174 7572  s,.  pair_featur
+0001de30: 6573 2c20 7061 6972 5f73 706c 6974 2c20  es, pair_split, 
+0001de40: 6174 6f6d 5f74 6f5f 7061 6972 5d60 2e20  atom_to_pair]`. 
+0001de50: 5765 276c 6c20 7761 6c6b 2074 6872 6f75  We'll walk throu
+0001de60: 6768 2074 6865 2073 7472 7563 7475 7265  gh the structure
+0001de70: 206f 6620 7468 6573 6520 696e 7075 7473   of these inputs
+0001de80: 2e20 4c65 7427 7320 7374 6172 7420 7769  . Let's start wi
+0001de90: 7468 2073 6f6d 6520 6261 7369 6320 6465  th some basic de
+0001dea0: 6669 6e69 7469 6f6e 732e 0a20 203e 3e3e  finitions..  >>>
+0001deb0: 2069 6d70 6f72 7420 6465 6570 6368 656d   import deepchem
+0001dec0: 2061 7320 6463 0a20 203e 3e3e 2069 6d70   as dc.  >>> imp
+0001ded0: 6f72 7420 6e75 6d70 7920 6173 206e 700a  ort numpy as np.
+0001dee0: 2020 3e3e 3e20 736d 696c 6573 203d 205b    >>> smiles = [
+0001def0: 2243 4343 222c 2022 4322 5d0a 0a20 204e  "CCC", "C"]..  N
+0001df00: 6f74 6520 7468 6174 2074 6865 7265 2061  ote that there a
+0001df10: 7265 2034 2061 746f 6d73 2069 6e20 746f  re 4 atoms in to
+0001df20: 7461 6c20 696e 2074 6869 7320 7379 7374  tal in this syst
+0001df30: 656d 2e20 5468 6973 206c 6179 6572 2065  em. This layer e
+0001df40: 7870 6563 7473 2069 7473 2069 6e70 7574  xpects its input
+0001df50: 206d 6f6c 6563 756c 6573 2074 6f20 6265   molecules to be
+0001df60: 2062 6174 6368 6564 2074 6f67 6574 6865   batched togethe
+0001df70: 722e 0a0a 2020 3e3e 3e20 746f 7461 6c5f  r...  >>> total_
+0001df80: 6e5f 6174 6f6d 7320 3d20 340a 0a20 204c  n_atoms = 4..  L
+0001df90: 6574 2773 2073 7570 706f 7365 2074 6861  et's suppose tha
+0001dfa0: 7420 7765 2068 6176 6520 6120 6665 6174  t we have a feat
+0001dfb0: 7572 697a 6572 2074 6861 7420 636f 6d70  urizer that comp
+0001dfc0: 7574 6573 2060 6e5f 6174 6f6d 5f66 6561  utes `n_atom_fea
+0001dfd0: 7460 2066 6561 7475 7265 7320 7065 7220  t` features per 
+0001dfe0: 6174 6f6d 2e0a 0a20 203e 3e3e 206e 5f61  atom...  >>> n_a
+0001dff0: 746f 6d5f 6665 6174 203d 2037 350a 0a20  tom_feat = 75.. 
+0001e000: 2054 6865 6e20 636f 6e63 6570 7475 616c   Then conceptual
+0001e010: 6c79 2c20 6061 746f 6d5f 6665 6174 6020  ly, `atom_feat` 
+0001e020: 6973 2074 6865 2061 7272 6179 206f 6620  is the array of 
+0001e030: 7368 6170 6520 6028 746f 7461 6c5f 6e5f  shape `(total_n_
+0001e040: 6174 6f6d 732c 0a20 206e 5f61 746f 6d5f  atoms,.  n_atom_
+0001e050: 6665 6174 2960 206f 6620 6174 6f6d 6963  feat)` of atomic
+0001e060: 2066 6561 7475 7265 732e 2046 6f72 2073   features. For s
+0001e070: 696d 706c 6963 6974 792c 206c 6574 2773  implicity, let's
+0001e080: 206a 7573 7420 676f 2077 6974 6820 610a   just go with a.
+0001e090: 2020 7261 6e64 6f6d 2073 7563 6820 6d61    random such ma
+0001e0a0: 7472 6978 2e0a 0a20 203e 3e3e 2061 746f  trix...  >>> ato
+0001e0b0: 6d5f 6665 6174 203d 206e 702e 7261 6e64  m_feat = np.rand
+0001e0c0: 6f6d 2e72 616e 6428 746f 7461 6c5f 6e5f  om.rand(total_n_
+0001e0d0: 6174 6f6d 732c 206e 5f61 746f 6d5f 6665  atoms, n_atom_fe
+0001e0e0: 6174 290a 0a20 204c 6574 2773 2073 7570  at)..  Let's sup
+0001e0f0: 706f 7365 2077 6520 6861 7665 2060 6e5f  pose we have `n_
+0001e100: 7061 6972 5f66 6561 7460 2070 6169 7277  pair_feat` pairw
+0001e110: 6973 6520 6665 6174 7572 6573 0a0a 2020  ise features..  
+0001e120: 3e3e 3e20 6e5f 7061 6972 5f66 6561 7420  >>> n_pair_feat 
+0001e130: 3d20 3134 0a0a 2020 466f 7220 6561 6368  = 14..  For each
+0001e140: 206d 6f6c 6563 756c 652c 2077 6520 636f   molecule, we co
+0001e150: 6d70 7574 6520 6120 6d61 7472 6978 206f  mpute a matrix o
+0001e160: 6620 7368 6170 6520 6028 6e5f 6174 6f6d  f shape `(n_atom
+0001e170: 732a 6e5f 6174 6f6d 732c 0a20 206e 5f70  s*n_atoms,.  n_p
+0001e180: 6169 725f 6665 6174 2960 206f 6620 7061  air_feat)` of pa
+0001e190: 6972 7769 7365 2066 6561 7475 7265 7320  irwise features 
+0001e1a0: 666f 7220 6561 6368 2070 6169 7220 6f66  for each pair of
+0001e1b0: 2061 746f 6d73 2069 6e20 7468 6520 6d6f   atoms in the mo
+0001e1c0: 6c65 6375 6c65 2e0a 2020 4c65 7427 7320  lecule..  Let's 
+0001e1d0: 636f 6e73 7472 7563 7420 7468 6973 2063  construct this c
+0001e1e0: 6f6e 6365 7074 7561 6c6c 7920 666f 7220  onceptually for 
+0001e1f0: 6f75 7220 6578 616d 706c 652e 0a0a 2020  our example...  
+0001e200: 3e3e 3e20 7061 6972 5f66 6561 7420 3d20  >>> pair_feat = 
+0001e210: 5b6e 702e 7261 6e64 6f6d 2e72 616e 6428  [np.random.rand(
+0001e220: 332a 332c 206e 5f70 6169 725f 6665 6174  3*3, n_pair_feat
+0001e230: 292c 206e 702e 7261 6e64 6f6d 2e72 616e  ), np.random.ran
+0001e240: 6428 312a 312c 6e5f 7061 6972 5f66 6561  d(1*1,n_pair_fea
+0001e250: 7429 5d0a 2020 3e3e 3e20 7061 6972 5f66  t)].  >>> pair_f
+0001e260: 6561 7420 3d20 6e70 2e63 6f6e 6361 7465  eat = np.concate
+0001e270: 6e61 7465 2870 6169 725f 6665 6174 2c20  nate(pair_feat, 
+0001e280: 6178 6973 3d30 290a 2020 3e3e 3e20 7061  axis=0).  >>> pa
+0001e290: 6972 5f66 6561 742e 7368 6170 650a 2020  ir_feat.shape.  
+0001e2a0: 2831 302c 2031 3429 0a0a 2020 6070 6169  (10, 14)..  `pai
+0001e2b0: 725f 7370 6c69 7460 2069 7320 616e 2069  r_split` is an i
+0001e2c0: 6e64 6578 2069 6e74 6f20 6070 6169 725f  ndex into `pair_
+0001e2d0: 6665 6174 6020 7768 6963 6820 7465 6c6c  feat` which tell
+0001e2e0: 7320 7573 2077 6869 6368 2061 746f 6d20  s us which atom 
+0001e2f0: 6561 6368 2072 6f77 2062 656c 6f6e 6773  each row belongs
+0001e300: 2074 6f2e 2049 6e20 6f75 7220 6361 7365   to. In our case
+0001e310: 2c20 7765 2068 7665 0a0a 2020 3e3e 3e20  , we hve..  >>> 
+0001e320: 7061 6972 5f73 706c 6974 203d 206e 702e  pair_split = np.
+0001e330: 6172 7261 7928 5b30 2c20 302c 2030 2c20  array([0, 0, 0, 
+0001e340: 312c 2031 2c20 312c 2032 2c20 322c 2032  1, 1, 1, 2, 2, 2
+0001e350: 2c20 335d 290a 0a20 2054 6861 7420 6973  , 3])..  That is
+0001e360: 2c20 7468 6520 6669 7273 7420 3920 656e  , the first 9 en
+0001e370: 7472 6965 7320 6265 6c6f 6e67 2074 6f20  tries belong to 
+0001e380: 2243 4343 2220 616e 6420 7468 6520 6c61  "CCC" and the la
+0001e390: 7374 2065 6e74 7279 2074 6f20 2243 222e  st entry to "C".
+0001e3a0: 2054 6865 0a20 2066 696e 616c 2065 6e74   The.  final ent
+0001e3b0: 7279 2060 6174 6f6d 5f74 6f5f 7061 6972  ry `atom_to_pair
+0001e3c0: 6020 676f 6573 2069 6e20 6120 6c69 7474  ` goes in a litt
+0001e3d0: 6c65 206d 6f72 6520 696e 2d64 6570 7468  le more in-depth
+0001e3e0: 2074 6861 6e20 6070 6169 725f 7370 6c69   than `pair_spli
+0001e3f0: 7460 0a20 2061 6e64 2074 656c 6c73 2075  t`.  and tells u
+0001e400: 7320 7468 6520 7072 6563 6973 6520 7061  s the precise pa
+0001e410: 6972 2065 6163 6820 7061 6972 2066 6561  ir each pair fea
+0001e420: 7475 7265 2062 656c 6f6e 6773 2074 6f2e  ture belongs to.
+0001e430: 2049 6e20 6f75 7220 6361 7365 0a0a 2020   In our case..  
+0001e440: 3e3e 3e20 6174 6f6d 5f74 6f5f 7061 6972  >>> atom_to_pair
+0001e450: 203d 206e 702e 6172 7261 7928 5b5b 302c   = np.array([[0,
+0001e460: 2030 5d2c 0a20 202e 2e2e 2020 2020 2020   0],.  ...      
+0001e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e480: 2020 2020 5b30 2c20 315d 2c0a 2020 2e2e      [0, 1],.  ..
+0001e490: 2e20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e4a0: 2020 2020 2020 2020 2020 205b 302c 2032             [0, 2
+0001e4b0: 5d2c 0a20 202e 2e2e 2020 2020 2020 2020  ],.  ...        
+0001e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4d0: 2020 5b31 2c20 305d 2c0a 2020 2e2e 2e20    [1, 0],.  ... 
+0001e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4f0: 2020 2020 2020 2020 205b 312c 2031 5d2c           [1, 1],
+0001e500: 0a20 202e 2e2e 2020 2020 2020 2020 2020  .  ...          
+0001e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e520: 5b31 2c20 325d 2c0a 2020 2e2e 2e20 2020  [1, 2],.  ...   
+0001e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e540: 2020 2020 2020 205b 322c 2030 5d2c 0a20         [2, 0],. 
+0001e550: 202e 2e2e 2020 2020 2020 2020 2020 2020   ...            
+0001e560: 2020 2020 2020 2020 2020 2020 2020 5b32                [2
+0001e570: 2c20 315d 2c0a 2020 2e2e 2e20 2020 2020  , 1],.  ...     
+0001e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e590: 2020 2020 205b 322c 2032 5d2c 0a20 202e       [2, 2],.  .
+0001e5a0: 2e2e 2020 2020 2020 2020 2020 2020 2020  ..              
+0001e5b0: 2020 2020 2020 2020 2020 2020 5b33 2c20              [3, 
+0001e5c0: 335d 5d29 0a0a 2020 4c65 7427 7320 6e6f  3]])..  Let's no
+0001e5d0: 7720 6465 6669 6e65 2074 6865 2061 6374  w define the act
+0001e5e0: 7561 6c20 6c61 7965 720a 0a20 203e 3e3e  ual layer..  >>>
+0001e5f0: 206c 6179 6572 203d 2057 6561 7665 4c61   layer = WeaveLa
+0001e600: 7965 7228 290a 0a20 2041 6e64 2069 6e76  yer()..  And inv
+0001e610: 6f6b 6520 6974 0a0a 2020 3e3e 3e20 5b41  oke it..  >>> [A
+0001e620: 2c20 505d 203d 206c 6179 6572 285b 6174  , P] = layer([at
+0001e630: 6f6d 5f66 6561 742c 2070 6169 725f 6665  om_feat, pair_fe
+0001e640: 6174 2c20 7061 6972 5f73 706c 6974 2c20  at, pair_split, 
+0001e650: 6174 6f6d 5f74 6f5f 7061 6972 5d29 0a0a  atom_to_pair])..
+0001e660: 2020 5468 6520 7765 6176 6520 6c61 7965    The weave laye
+0001e670: 7220 7072 6f64 7563 6573 206e 6577 2061  r produces new a
+0001e680: 746f 6d2f 7061 6972 2066 6561 7475 7265  tom/pair feature
+0001e690: 732e 204c 6574 2773 2063 6865 636b 2074  s. Let's check t
+0001e6a0: 6865 6972 2073 6861 7065 730a 0a20 203e  heir shapes..  >
+0001e6b0: 3e3e 2041 203d 2041 2e64 6574 6163 6828  >> A = A.detach(
+0001e6c0: 292e 6e75 6d70 7928 290a 2020 3e3e 3e20  ).numpy().  >>> 
+0001e6d0: 412e 7368 6170 650a 2020 2834 2c20 3530  A.shape.  (4, 50
+0001e6e0: 290a 2020 3e3e 3e20 5020 3d20 502e 6465  ).  >>> P = P.de
+0001e6f0: 7461 6368 2829 2e6e 756d 7079 2829 0a20  tach().numpy(). 
+0001e700: 203e 3e3e 2050 2e73 6861 7065 0a20 2028   >>> P.shape.  (
+0001e710: 3130 2c20 3530 290a 0a20 2054 6865 2034  10, 50)..  The 4
+0001e720: 2069 7320 6074 6f74 616c 5f6e 756d 5f61   is `total_num_a
+0001e730: 746f 6d73 6020 616e 6420 7468 6520 3130  toms` and the 10
+0001e740: 2069 7320 7468 6520 746f 7461 6c20 6e75   is the total nu
+0001e750: 6d62 6572 206f 6620 7061 6972 732e 2057  mber of pairs. W
+0001e760: 6865 7265 0a20 2064 6f65 7320 6035 3060  here.  does `50`
+0001e770: 2063 6f6d 6520 6672 6f6d 3f20 4974 2773   come from? It's
+0001e780: 2066 726f 6d20 7468 6520 6465 6661 756c   from the defaul
+0001e790: 7420 6172 6775 6d65 6e74 7320 606e 5f61  t arguments `n_a
+0001e7a0: 746f 6d5f 696e 7075 745f 6665 6174 6020  tom_input_feat` 
+0001e7b0: 616e 640a 2020 606e 5f70 6169 725f 696e  and.  `n_pair_in
+0001e7c0: 7075 745f 6665 6174 602e 0a0a 2020 5265  put_feat`...  Re
+0001e7d0: 6665 7265 6e63 6573 0a20 202d 2d2d 2d2d  ferences.  -----
+0001e7e0: 2d2d 2d2d 2d0a 2020 2e2e 205b 315d 204b  -----.  .. [1] K
+0001e7f0: 6561 726e 6573 2c20 5374 6576 656e 2c20  earnes, Steven, 
+0001e800: 6574 2061 6c2e 2022 4d6f 6c65 6375 6c61  et al. "Molecula
+0001e810: 7220 6772 6170 6820 636f 6e76 6f6c 7574  r graph convolut
+0001e820: 696f 6e73 3a20 6d6f 7669 6e67 2062 6579  ions: moving bey
+0001e830: 6f6e 640a 2020 2020 2020 2020 6669 6e67  ond.        fing
+0001e840: 6572 7072 696e 7473 2e22 204a 6f75 726e  erprints." Journ
+0001e850: 616c 206f 6620 636f 6d70 7574 6572 2d61  al of computer-a
+0001e860: 6964 6564 206d 6f6c 6563 756c 6172 2064  ided molecular d
+0001e870: 6573 6967 6e20 3330 2e38 2028 3230 3136  esign 30.8 (2016
+0001e880: 293a 0a20 2020 2020 2020 2035 3935 2d36  ):.        595-6
+0001e890: 3038 2e0a 2020 2222 220a 0a20 2020 2064  08..  """..    d
+0001e8a0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0001e8b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001e8c0: 2020 206e 5f61 746f 6d5f 696e 7075 745f     n_atom_input_
+0001e8d0: 6665 6174 3a20 696e 7420 3d20 3735 2c0a  feat: int = 75,.
+0001e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8f0: 206e 5f70 6169 725f 696e 7075 745f 6665   n_pair_input_fe
+0001e900: 6174 3a20 696e 7420 3d20 3134 2c0a 2020  at: int = 14,.  
+0001e910: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001e920: 5f61 746f 6d5f 6f75 7470 7574 5f66 6561  _atom_output_fea
+0001e930: 743a 2069 6e74 203d 2035 302c 0a20 2020  t: int = 50,.   
+0001e940: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
+0001e950: 7061 6972 5f6f 7574 7075 745f 6665 6174  pair_output_feat
+0001e960: 3a20 696e 7420 3d20 3530 2c0a 2020 2020  : int = 50,.    
+0001e970: 2020 2020 2020 2020 2020 2020 206e 5f68               n_h
+0001e980: 6964 6465 6e5f 4141 3a20 696e 7420 3d20  idden_AA: int = 
+0001e990: 3530 2c0a 2020 2020 2020 2020 2020 2020  50,.            
+0001e9a0: 2020 2020 206e 5f68 6964 6465 6e5f 5041       n_hidden_PA
+0001e9b0: 3a20 696e 7420 3d20 3530 2c0a 2020 2020  : int = 50,.    
+0001e9c0: 2020 2020 2020 2020 2020 2020 206e 5f68               n_h
+0001e9d0: 6964 6465 6e5f 4150 3a20 696e 7420 3d20  idden_AP: int = 
+0001e9e0: 3530 2c0a 2020 2020 2020 2020 2020 2020  50,.            
+0001e9f0: 2020 2020 206e 5f68 6964 6465 6e5f 5050       n_hidden_PP
+0001ea00: 3a20 696e 7420 3d20 3530 2c0a 2020 2020  : int = 50,.    
+0001ea10: 2020 2020 2020 2020 2020 2020 2075 7064               upd
+0001ea20: 6174 655f 7061 6972 3a20 626f 6f6c 203d  ate_pair: bool =
+0001ea30: 2054 7275 652c 0a20 2020 2020 2020 2020   True,.         
+0001ea40: 2020 2020 2020 2020 696e 6974 5f3a 2073          init_: s
+0001ea50: 7472 203d 2027 7861 7669 6572 5f75 6e69  tr = 'xavier_uni
+0001ea60: 666f 726d 5f27 2c0a 2020 2020 2020 2020  form_',.        
+0001ea70: 2020 2020 2020 2020 2061 6374 6976 6174           activat
+0001ea80: 696f 6e3a 2073 7472 203d 2027 7265 6c75  ion: str = 'relu
+0001ea90: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0001eaa0: 2020 2020 6261 7463 685f 6e6f 726d 616c      batch_normal
+0001eab0: 697a 653a 2062 6f6f 6c20 3d20 5472 7565  ize: bool = True
+0001eac0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001ead0: 2020 202a 2a6b 7761 7267 7329 3a0a 2020     **kwargs):.  
+0001eae0: 2020 2020 2020 2222 220a 2020 2020 5061        """.    Pa
+0001eaf0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+0001eb00: 2d2d 2d2d 2d2d 2d0a 2020 2020 6e5f 6174  -------.    n_at
+0001eb10: 6f6d 5f69 6e70 7574 5f66 6561 743a 2069  om_input_feat: i
+0001eb20: 6e74 2c20 6f70 7469 6f6e 616c 2028 6465  nt, optional (de
+0001eb30: 6661 756c 7420 3735 290a 2020 2020 2020  fault 75).      
+0001eb40: 4e75 6d62 6572 206f 6620 6665 6174 7572  Number of featur
+0001eb50: 6573 2066 6f72 2065 6163 6820 6174 6f6d  es for each atom
+0001eb60: 2069 6e20 696e 7075 742e 0a20 2020 206e   in input..    n
+0001eb70: 5f70 6169 725f 696e 7075 745f 6665 6174  _pair_input_feat
+0001eb80: 3a20 696e 742c 206f 7074 696f 6e61 6c20  : int, optional 
+0001eb90: 2864 6566 6175 6c74 2031 3429 0a20 2020  (default 14).   
+0001eba0: 2020 204e 756d 6265 7220 6f66 2066 6561     Number of fea
+0001ebb0: 7475 7265 7320 666f 7220 6561 6368 2070  tures for each p
+0001ebc0: 6169 7220 6f66 2061 746f 6d73 2069 6e20  air of atoms in 
+0001ebd0: 696e 7075 742e 0a20 2020 206e 5f61 746f  input..    n_ato
+0001ebe0: 6d5f 6f75 7470 7574 5f66 6561 743a 2069  m_output_feat: i
+0001ebf0: 6e74 2c20 6f70 7469 6f6e 616c 2028 6465  nt, optional (de
+0001ec00: 6661 756c 7420 3530 290a 2020 2020 2020  fault 50).      
+0001ec10: 4e75 6d62 6572 206f 6620 6665 6174 7572  Number of featur
+0001ec20: 6573 2066 6f72 2065 6163 6820 6174 6f6d  es for each atom
+0001ec30: 2069 6e20 6f75 7470 7574 2e0a 2020 2020   in output..    
+0001ec40: 6e5f 7061 6972 5f6f 7574 7075 745f 6665  n_pair_output_fe
+0001ec50: 6174 3a20 696e 742c 206f 7074 696f 6e61  at: int, optiona
+0001ec60: 6c20 2864 6566 6175 6c74 2035 3029 0a20  l (default 50). 
+0001ec70: 2020 2020 204e 756d 6265 7220 6f66 2066       Number of f
+0001ec80: 6561 7475 7265 7320 666f 7220 6561 6368  eatures for each
+0001ec90: 2070 6169 7220 6f66 2061 746f 6d73 2069   pair of atoms i
+0001eca0: 6e20 6f75 7470 7574 2e0a 2020 2020 6e5f  n output..    n_
+0001ecb0: 6869 6464 656e 5f41 413a 2069 6e74 2c20  hidden_AA: int, 
+0001ecc0: 6f70 7469 6f6e 616c 2028 6465 6661 756c  optional (defaul
+0001ecd0: 7420 3530 290a 2020 2020 2020 4e75 6d62  t 50).      Numb
+0001ece0: 6572 206f 6620 756e 6974 7328 636f 6e76  er of units(conv
+0001ecf0: 6f6c 7574 696f 6e20 6465 7074 6873 2920  olution depths) 
+0001ed00: 696e 2063 6f72 7265 7370 6f6e 6469 6e67  in corresponding
+0001ed10: 2068 6964 6465 6e20 6c61 7965 720a 2020   hidden layer.  
+0001ed20: 2020 6e5f 6869 6464 656e 5f50 413a 2069    n_hidden_PA: i
+0001ed30: 6e74 2c20 6f70 7469 6f6e 616c 2028 6465  nt, optional (de
+0001ed40: 6661 756c 7420 3530 290a 2020 2020 2020  fault 50).      
+0001ed50: 4e75 6d62 6572 206f 6620 756e 6974 7328  Number of units(
+0001ed60: 636f 6e76 6f6c 7574 696f 6e20 6465 7074  convolution dept
+0001ed70: 6873 2920 696e 2063 6f72 7265 7370 6f6e  hs) in correspon
+0001ed80: 6469 6e67 2068 6964 6465 6e20 6c61 7965  ding hidden laye
+0001ed90: 720a 2020 2020 6e5f 6869 6464 656e 5f41  r.    n_hidden_A
+0001eda0: 503a 2069 6e74 2c20 6f70 7469 6f6e 616c  P: int, optional
+0001edb0: 2028 6465 6661 756c 7420 3530 290a 2020   (default 50).  
+0001edc0: 2020 2020 4e75 6d62 6572 206f 6620 756e      Number of un
+0001edd0: 6974 7328 636f 6e76 6f6c 7574 696f 6e20  its(convolution 
+0001ede0: 6465 7074 6873 2920 696e 2063 6f72 7265  depths) in corre
+0001edf0: 7370 6f6e 6469 6e67 2068 6964 6465 6e20  sponding hidden 
+0001ee00: 6c61 7965 720a 2020 2020 6e5f 6869 6464  layer.    n_hidd
+0001ee10: 656e 5f50 503a 2069 6e74 2c20 6f70 7469  en_PP: int, opti
+0001ee20: 6f6e 616c 2028 6465 6661 756c 7420 3530  onal (default 50
+0001ee30: 290a 2020 2020 2020 4e75 6d62 6572 206f  ).      Number o
+0001ee40: 6620 756e 6974 7328 636f 6e76 6f6c 7574  f units(convolut
+0001ee50: 696f 6e20 6465 7074 6873 2920 696e 2063  ion depths) in c
+0001ee60: 6f72 7265 7370 6f6e 6469 6e67 2068 6964  orresponding hid
+0001ee70: 6465 6e20 6c61 7965 720a 2020 2020 7570  den layer.    up
+0001ee80: 6461 7465 5f70 6169 723a 2062 6f6f 6c2c  date_pair: bool,
+0001ee90: 206f 7074 696f 6e61 6c20 2864 6566 6175   optional (defau
+0001eea0: 6c74 2054 7275 6529 0a20 2020 2020 2057  lt True).      W
+0001eeb0: 6865 7468 6572 2074 6f20 6361 6c63 756c  hether to calcul
+0001eec0: 6174 6520 666f 7220 7061 6972 2066 6561  ate for pair fea
+0001eed0: 7475 7265 732c 0a20 2020 2020 2063 6f75  tures,.      cou
+0001eee0: 6c64 2062 6520 7475 726e 6564 206f 6666  ld be turned off
+0001eef0: 2066 6f72 206c 6173 7420 6c61 7965 720a   for last layer.
+0001ef00: 2020 2020 696e 6974 3a20 7374 722c 206f      init: str, o
+0001ef10: 7074 696f 6e61 6c20 2864 6566 6175 6c74  ptional (default
+0001ef20: 2027 7861 7669 6572 5f75 6e69 666f 726d   'xavier_uniform
+0001ef30: 5f27 290a 2020 2020 2020 5765 6967 6874  _').      Weight
+0001ef40: 2069 6e69 7469 616c 697a 6174 696f 6e20   initialization 
+0001ef50: 666f 7220 6669 6c74 6572 732e 0a20 2020  for filters..   
+0001ef60: 2061 6374 6976 6174 696f 6e3a 2073 7472   activation: str
+0001ef70: 2c20 6f70 7469 6f6e 616c 2028 6465 6661  , optional (defa
+0001ef80: 756c 7420 2772 656c 7527 290a 2020 2020  ult 'relu').    
+0001ef90: 2020 4163 7469 7661 7469 6f6e 2066 756e    Activation fun
+0001efa0: 6374 696f 6e20 6170 706c 6965 640a 2020  ction applied.  
+0001efb0: 2020 6261 7463 685f 6e6f 726d 616c 697a    batch_normaliz
+0001efc0: 653a 2062 6f6f 6c2c 206f 7074 696f 6e61  e: bool, optiona
+0001efd0: 6c20 2864 6566 6175 6c74 2054 7275 6529  l (default True)
+0001efe0: 0a20 2020 2020 2049 6620 7468 6973 2069  .      If this i
+0001eff0: 7320 7475 726e 6564 206f 6e2c 2061 7070  s turned on, app
+0001f000: 6c79 2062 6174 6368 206e 6f72 6d61 6c69  ly batch normali
+0001f010: 7a61 7469 6f6e 2062 6566 6f72 6520 6170  zation before ap
+0001f020: 706c 7969 6e67 0a20 2020 2020 2061 6374  plying.      act
+0001f030: 6976 6174 696f 6e20 6675 6e63 7469 6f6e  ivation function
+0001f040: 7320 6f6e 2063 6f6e 766f 6c75 7469 6f6e  s on convolution
+0001f050: 616c 206c 6179 6572 732e 0a20 2020 2022  al layers..    "
+0001f060: 2222 0a20 2020 2020 2020 2073 7570 6572  "".        super
+0001f070: 2857 6561 7665 4c61 7965 722c 2073 656c  (WeaveLayer, sel
+0001f080: 6629 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  f).__init__(**kw
+0001f090: 6172 6773 290a 2020 2020 2020 2020 7365  args).        se
+0001f0a0: 6c66 2e69 6e69 743a 2073 7472 203d 2069  lf.init: str = i
+0001f0b0: 6e69 745f 2020 2320 5365 7420 7765 6967  nit_  # Set weig
+0001f0c0: 6874 2069 6e69 7469 616c 697a 6174 696f  ht initializatio
+0001f0d0: 6e0a 2020 2020 2020 2020 7365 6c66 2e61  n.        self.a
+0001f0e0: 6374 6976 6174 696f 6e3a 2073 7472 203d  ctivation: str =
+0001f0f0: 2061 6374 6976 6174 696f 6e20 2023 2047   activation  # G
+0001f100: 6574 2061 6374 6976 6174 696f 6e73 0a20  et activations. 
+0001f110: 2020 2020 2020 2073 656c 662e 6163 7469         self.acti
+0001f120: 7661 7469 6f6e 5f66 6e3a 2074 6f72 6368  vation_fn: torch
+0001f130: 2e6e 6e2e 4d6f 6475 6c65 203d 2067 6574  .nn.Module = get
+0001f140: 5f61 6374 6976 6174 696f 6e28 6163 7469  _activation(acti
+0001f150: 7661 7469 6f6e 290a 2020 2020 2020 2020  vation).        
+0001f160: 7365 6c66 2e75 7064 6174 655f 7061 6972  self.update_pair
+0001f170: 3a20 626f 6f6c 203d 2075 7064 6174 655f  : bool = update_
+0001f180: 7061 6972 2020 2320 6c61 7374 2077 6561  pair  # last wea
+0001f190: 7665 206c 6179 6572 2064 6f65 7320 6e6f  ve layer does no
+0001f1a0: 7420 6e65 6564 2074 6f20 7570 6461 7465  t need to update
+0001f1b0: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
+0001f1c0: 6869 6464 656e 5f41 413a 2069 6e74 203d  hidden_AA: int =
+0001f1d0: 206e 5f68 6964 6465 6e5f 4141 0a20 2020   n_hidden_AA.   
+0001f1e0: 2020 2020 2073 656c 662e 6e5f 6869 6464       self.n_hidd
+0001f1f0: 656e 5f50 413a 2069 6e74 203d 206e 5f68  en_PA: int = n_h
+0001f200: 6964 6465 6e5f 5041 0a20 2020 2020 2020  idden_PA.       
+0001f210: 2073 656c 662e 6e5f 6869 6464 656e 5f41   self.n_hidden_A
+0001f220: 503a 2069 6e74 203d 206e 5f68 6964 6465  P: int = n_hidde
+0001f230: 6e5f 4150 0a20 2020 2020 2020 2073 656c  n_AP.        sel
+0001f240: 662e 6e5f 6869 6464 656e 5f50 503a 2069  f.n_hidden_PP: i
+0001f250: 6e74 203d 206e 5f68 6964 6465 6e5f 5050  nt = n_hidden_PP
+0001f260: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
+0001f270: 6869 6464 656e 5f41 3a20 696e 7420 3d20  hidden_A: int = 
+0001f280: 6e5f 6869 6464 656e 5f41 4120 2b20 6e5f  n_hidden_AA + n_
+0001f290: 6869 6464 656e 5f50 410a 2020 2020 2020  hidden_PA.      
+0001f2a0: 2020 7365 6c66 2e6e 5f68 6964 6465 6e5f    self.n_hidden_
+0001f2b0: 503a 2069 6e74 203d 206e 5f68 6964 6465  P: int = n_hidde
+0001f2c0: 6e5f 4150 202b 206e 5f68 6964 6465 6e5f  n_AP + n_hidden_
+0001f2d0: 5050 0a20 2020 2020 2020 2073 656c 662e  PP.        self.
+0001f2e0: 6261 7463 685f 6e6f 726d 616c 697a 653a  batch_normalize:
+0001f2f0: 2062 6f6f 6c20 3d20 6261 7463 685f 6e6f   bool = batch_no
+0001f300: 726d 616c 697a 650a 0a20 2020 2020 2020  rmalize..       
+0001f310: 2073 656c 662e 6e5f 6174 6f6d 5f69 6e70   self.n_atom_inp
+0001f320: 7574 5f66 6561 743a 2069 6e74 203d 206e  ut_feat: int = n
+0001f330: 5f61 746f 6d5f 696e 7075 745f 6665 6174  _atom_input_feat
+0001f340: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
+0001f350: 7061 6972 5f69 6e70 7574 5f66 6561 743a  pair_input_feat:
+0001f360: 2069 6e74 203d 206e 5f70 6169 725f 696e   int = n_pair_in
+0001f370: 7075 745f 6665 6174 0a20 2020 2020 2020  put_feat.       
+0001f380: 2073 656c 662e 6e5f 6174 6f6d 5f6f 7574   self.n_atom_out
+0001f390: 7075 745f 6665 6174 3a20 696e 7420 3d20  put_feat: int = 
+0001f3a0: 6e5f 6174 6f6d 5f6f 7574 7075 745f 6665  n_atom_output_fe
+0001f3b0: 6174 0a20 2020 2020 2020 2073 656c 662e  at.        self.
+0001f3c0: 6e5f 7061 6972 5f6f 7574 7075 745f 6665  n_pair_output_fe
+0001f3d0: 6174 3a20 696e 7420 3d20 6e5f 7061 6972  at: int = n_pair
+0001f3e0: 5f6f 7574 7075 745f 6665 6174 0a0a 2020  _output_feat..  
+0001f3f0: 2020 2020 2020 2320 436f 6e73 7472 7563        # Construc
+0001f400: 7420 696e 7465 726e 616c 2074 7261 696e  t internal train
+0001f410: 6162 6c65 2077 6569 6768 7473 0a20 2020  able weights.   
+0001f420: 2020 2020 2069 6e69 7420 3d20 6765 7461       init = geta
+0001f430: 7474 7228 696e 6974 6961 6c69 7a65 7273  ttr(initializers
+0001f440: 2c20 7365 6c66 2e69 6e69 7429 0a20 2020  , self.init).   
+0001f450: 2020 2020 2023 2057 6569 6768 7420 6d61       # Weight ma
+0001f460: 7472 6978 2061 6e64 2062 6961 7320 6d61  trix and bias ma
+0001f470: 7472 6978 2072 6571 7569 7265 6420 746f  trix required to
+0001f480: 2063 6f6d 7075 7465 206e 6577 2061 746f   compute new ato
+0001f490: 6d20 6c61 7965 7220 6672 6f6d 2074 6865  m layer from the
+0001f4a0: 2070 7265 7669 6f75 7320 6174 6f6d 206c   previous atom l
+0001f4b0: 6179 6572 0a20 2020 2020 2020 2073 656c  ayer.        sel
+0001f4c0: 662e 575f 4141 3a20 746f 7263 682e 5465  f.W_AA: torch.Te
+0001f4d0: 6e73 6f72 203d 2069 6e69 7428 0a20 2020  nsor = init(.   
+0001f4e0: 2020 2020 2020 2020 2074 6f72 6368 2e65           torch.e
+0001f4f0: 6d70 7479 2873 656c 662e 6e5f 6174 6f6d  mpty(self.n_atom
+0001f500: 5f69 6e70 7574 5f66 6561 742c 2073 656c  _input_feat, sel
+0001f510: 662e 6e5f 6869 6464 656e 5f41 4129 290a  f.n_hidden_AA)).
+0001f520: 2020 2020 2020 2020 7365 6c66 2e62 5f41          self.b_A
+0001f530: 413a 2074 6f72 6368 2e54 656e 736f 7220  A: torch.Tensor 
+0001f540: 3d20 746f 7263 682e 7a65 726f 7328 2873  = torch.zeros((s
+0001f550: 656c 662e 6e5f 6869 6464 656e 5f41 412c  elf.n_hidden_AA,
+0001f560: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+0001f570: 4141 5f62 6e3a 206e 6e2e 4261 7463 684e  AA_bn: nn.BatchN
+0001f580: 6f72 6d31 6420 3d20 6e6e 2e42 6174 6368  orm1d = nn.Batch
+0001f590: 4e6f 726d 3164 280a 2020 2020 2020 2020  Norm1d(.        
+0001f5a0: 2020 2020 6e75 6d5f 6665 6174 7572 6573      num_features
+0001f5b0: 3d73 656c 662e 6e5f 6869 6464 656e 5f41  =self.n_hidden_A
+0001f5c0: 412c 0a20 2020 2020 2020 2020 2020 2065  A,.            e
+0001f5d0: 7073 3d31 652d 332c 0a20 2020 2020 2020  ps=1e-3,.       
+0001f5e0: 2020 2020 206d 6f6d 656e 7475 6d3d 302e       momentum=0.
+0001f5f0: 3939 2c0a 2020 2020 2020 2020 2020 2020  99,.            
+0001f600: 6166 6669 6e65 3d54 7275 652c 0a20 2020  affine=True,.   
+0001f610: 2020 2020 2020 2020 2074 7261 636b 5f72           track_r
+0001f620: 756e 6e69 6e67 5f73 7461 7473 3d54 7275  unning_stats=Tru
+0001f630: 6529 0a0a 2020 2020 2020 2020 2320 5765  e)..        # We
+0001f640: 6967 6874 206d 6174 7269 7820 616e 6420  ight matrix and 
+0001f650: 6269 6173 206d 6174 7269 7820 7265 7175  bias matrix requ
+0001f660: 6972 6564 2074 6f20 636f 6d70 7574 6520  ired to compute 
+0001f670: 6e65 7720 6174 6f6d 206c 6179 6572 2066  new atom layer f
+0001f680: 726f 6d20 7468 6520 7072 6576 696f 7573  rom the previous
+0001f690: 2070 6169 7220 6c61 7965 720a 2020 2020   pair layer.    
+0001f6a0: 2020 2020 7365 6c66 2e57 5f50 413a 2074      self.W_PA: t
+0001f6b0: 6f72 6368 2e54 656e 736f 7220 3d20 696e  orch.Tensor = in
+0001f6c0: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
+0001f6d0: 746f 7263 682e 656d 7074 7928 7365 6c66  torch.empty(self
+0001f6e0: 2e6e 5f70 6169 725f 696e 7075 745f 6665  .n_pair_input_fe
+0001f6f0: 6174 2c20 7365 6c66 2e6e 5f68 6964 6465  at, self.n_hidde
+0001f700: 6e5f 5041 2929 0a20 2020 2020 2020 2073  n_PA)).        s
+0001f710: 656c 662e 625f 5041 3a20 746f 7263 682e  elf.b_PA: torch.
+0001f720: 5465 6e73 6f72 203d 2074 6f72 6368 2e7a  Tensor = torch.z
+0001f730: 6572 6f73 2828 7365 6c66 2e6e 5f68 6964  eros((self.n_hid
+0001f740: 6465 6e5f 5041 2c29 290a 2020 2020 2020  den_PA,)).      
+0001f750: 2020 7365 6c66 2e50 415f 626e 3a20 6e6e    self.PA_bn: nn
+0001f760: 2e42 6174 6368 4e6f 726d 3164 203d 206e  .BatchNorm1d = n
+0001f770: 6e2e 4261 7463 684e 6f72 6d31 6428 0a20  n.BatchNorm1d(. 
+0001f780: 2020 2020 2020 2020 2020 206e 756d 5f66             num_f
+0001f790: 6561 7475 7265 733d 7365 6c66 2e6e 5f68  eatures=self.n_h
+0001f7a0: 6964 6465 6e5f 5041 2c0a 2020 2020 2020  idden_PA,.      
+0001f7b0: 2020 2020 2020 6570 733d 3165 2d33 2c0a        eps=1e-3,.
+0001f7c0: 2020 2020 2020 2020 2020 2020 6d6f 6d65              mome
+0001f7d0: 6e74 756d 3d30 2e39 392c 0a20 2020 2020  ntum=0.99,.     
+0001f7e0: 2020 2020 2020 2061 6666 696e 653d 5472         affine=Tr
+0001f7f0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0001f800: 7472 6163 6b5f 7275 6e6e 696e 675f 7374  track_running_st
+0001f810: 6174 733d 5472 7565 290a 0a20 2020 2020  ats=True)..     
+0001f820: 2020 2073 656c 662e 575f 413a 2074 6f72     self.W_A: tor
+0001f830: 6368 2e54 656e 736f 7220 3d20 696e 6974  ch.Tensor = init
+0001f840: 280a 2020 2020 2020 2020 2020 2020 746f  (.            to
+0001f850: 7263 682e 656d 7074 7928 7365 6c66 2e6e  rch.empty(self.n
+0001f860: 5f68 6964 6465 6e5f 412c 2073 656c 662e  _hidden_A, self.
+0001f870: 6e5f 6174 6f6d 5f6f 7574 7075 745f 6665  n_atom_output_fe
+0001f880: 6174 2929 0a20 2020 2020 2020 2073 656c  at)).        sel
+0001f890: 662e 625f 413a 2074 6f72 6368 2e54 656e  f.b_A: torch.Ten
+0001f8a0: 736f 7220 3d20 746f 7263 682e 7a65 726f  sor = torch.zero
+0001f8b0: 7328 2873 656c 662e 6e5f 6174 6f6d 5f6f  s((self.n_atom_o
+0001f8c0: 7574 7075 745f 6665 6174 2c29 290a 2020  utput_feat,)).  
+0001f8d0: 2020 2020 2020 7365 6c66 2e41 5f62 6e3a        self.A_bn:
+0001f8e0: 206e 6e2e 4261 7463 684e 6f72 6d31 6420   nn.BatchNorm1d 
+0001f8f0: 3d20 6e6e 2e42 6174 6368 4e6f 726d 3164  = nn.BatchNorm1d
+0001f900: 280a 2020 2020 2020 2020 2020 2020 6e75  (.            nu
+0001f910: 6d5f 6665 6174 7572 6573 3d73 656c 662e  m_features=self.
+0001f920: 6e5f 6174 6f6d 5f6f 7574 7075 745f 6665  n_atom_output_fe
+0001f930: 6174 2c0a 2020 2020 2020 2020 2020 2020  at,.            
+0001f940: 6570 733d 3165 2d33 2c0a 2020 2020 2020  eps=1e-3,.      
+0001f950: 2020 2020 2020 6d6f 6d65 6e74 756d 3d30        momentum=0
+0001f960: 2e39 392c 0a20 2020 2020 2020 2020 2020  .99,.           
+0001f970: 2061 6666 696e 653d 5472 7565 2c0a 2020   affine=True,.  
+0001f980: 2020 2020 2020 2020 2020 7472 6163 6b5f            track_
+0001f990: 7275 6e6e 696e 675f 7374 6174 733d 5472  running_stats=Tr
+0001f9a0: 7565 290a 0a20 2020 2020 2020 2069 6620  ue)..        if 
+0001f9b0: 7365 6c66 2e75 7064 6174 655f 7061 6972  self.update_pair
+0001f9c0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001f9d0: 5765 6967 6874 206d 6174 7269 7820 616e  Weight matrix an
+0001f9e0: 6420 6269 6173 206d 6174 7269 7820 7265  d bias matrix re
+0001f9f0: 7175 6972 6564 2074 6f20 636f 6d70 7574  quired to comput
+0001fa00: 6520 6e65 7720 7061 6972 206c 6179 6572  e new pair layer
+0001fa10: 2066 726f 6d20 7468 6520 7072 6576 696f   from the previo
+0001fa20: 7573 2061 746f 6d20 6c61 7965 720a 2020  us atom layer.  
+0001fa30: 2020 2020 2020 2020 2020 7365 6c66 2e57            self.W
+0001fa40: 5f41 503a 2074 6f72 6368 2e54 656e 736f  _AP: torch.Tenso
+0001fa50: 7220 3d20 696e 6974 280a 2020 2020 2020  r = init(.      
+0001fa60: 2020 2020 2020 2020 2020 746f 7263 682e            torch.
+0001fa70: 656d 7074 7928 7365 6c66 2e6e 5f61 746f  empty(self.n_ato
+0001fa80: 6d5f 696e 7075 745f 6665 6174 202a 2032  m_input_feat * 2
+0001fa90: 2c20 7365 6c66 2e6e 5f68 6964 6465 6e5f  , self.n_hidden_
+0001faa0: 4150 2929 0a20 2020 2020 2020 2020 2020  AP)).           
+0001fab0: 2073 656c 662e 625f 4150 3a20 746f 7263   self.b_AP: torc
+0001fac0: 682e 5465 6e73 6f72 203d 2074 6f72 6368  h.Tensor = torch
+0001fad0: 2e7a 6572 6f73 2828 7365 6c66 2e6e 5f68  .zeros((self.n_h
+0001fae0: 6964 6465 6e5f 4150 2c29 290a 2020 2020  idden_AP,)).    
+0001faf0: 2020 2020 2020 2020 7365 6c66 2e41 505f          self.AP_
+0001fb00: 626e 3a20 6e6e 2e42 6174 6368 4e6f 726d  bn: nn.BatchNorm
+0001fb10: 3164 203d 206e 6e2e 4261 7463 684e 6f72  1d = nn.BatchNor
+0001fb20: 6d31 6428 0a20 2020 2020 2020 2020 2020  m1d(.           
+0001fb30: 2020 2020 206e 756d 5f66 6561 7475 7265       num_feature
+0001fb40: 733d 7365 6c66 2e6e 5f68 6964 6465 6e5f  s=self.n_hidden_
+0001fb50: 4150 2c0a 2020 2020 2020 2020 2020 2020  AP,.            
+0001fb60: 2020 2020 6570 733d 3165 2d33 2c0a 2020      eps=1e-3,.  
+0001fb70: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0001fb80: 6d65 6e74 756d 3d30 2e39 392c 0a20 2020  mentum=0.99,.   
+0001fb90: 2020 2020 2020 2020 2020 2020 2061 6666               aff
+0001fba0: 696e 653d 5472 7565 2c0a 2020 2020 2020  ine=True,.      
+0001fbb0: 2020 2020 2020 2020 2020 7472 6163 6b5f            track_
+0001fbc0: 7275 6e6e 696e 675f 7374 6174 733d 5472  running_stats=Tr
+0001fbd0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0001fbe0: 2320 5765 6967 6874 206d 6174 7269 7820  # Weight matrix 
+0001fbf0: 616e 6420 6269 6173 206d 6174 7269 7820  and bias matrix 
+0001fc00: 7265 7175 6972 6564 2074 6f20 636f 6d70  required to comp
+0001fc10: 7574 6520 6e65 7720 7061 6972 206c 6179  ute new pair lay
+0001fc20: 6572 2066 726f 6d20 7468 6520 7072 6576  er from the prev
+0001fc30: 696f 7573 2070 6169 7220 6c61 7965 720a  ious pair layer.
+0001fc40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001fc50: 2e57 5f50 503a 2074 6f72 6368 2e54 656e  .W_PP: torch.Ten
+0001fc60: 736f 7220 3d20 696e 6974 280a 2020 2020  sor = init(.    
+0001fc70: 2020 2020 2020 2020 2020 2020 746f 7263              torc
+0001fc80: 682e 656d 7074 7928 7365 6c66 2e6e 5f70  h.empty(self.n_p
+0001fc90: 6169 725f 696e 7075 745f 6665 6174 2c20  air_input_feat, 
+0001fca0: 7365 6c66 2e6e 5f68 6964 6465 6e5f 5050  self.n_hidden_PP
+0001fcb0: 2929 0a20 2020 2020 2020 2020 2020 2073  )).            s
+0001fcc0: 656c 662e 625f 5050 3a20 746f 7263 682e  elf.b_PP: torch.
+0001fcd0: 5465 6e73 6f72 203d 2074 6f72 6368 2e7a  Tensor = torch.z
+0001fce0: 6572 6f73 2828 7365 6c66 2e6e 5f68 6964  eros((self.n_hid
+0001fcf0: 6465 6e5f 5050 2c29 290a 2020 2020 2020  den_PP,)).      
+0001fd00: 2020 2020 2020 7365 6c66 2e50 505f 626e        self.PP_bn
+0001fd10: 3a20 6e6e 2e42 6174 6368 4e6f 726d 3164  : nn.BatchNorm1d
+0001fd20: 203d 206e 6e2e 4261 7463 684e 6f72 6d31   = nn.BatchNorm1
+0001fd30: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+0001fd40: 2020 206e 756d 5f66 6561 7475 7265 733d     num_features=
+0001fd50: 7365 6c66 2e6e 5f68 6964 6465 6e5f 5050  self.n_hidden_PP
+0001fd60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001fd70: 2020 6570 733d 3165 2d33 2c0a 2020 2020    eps=1e-3,.    
+0001fd80: 2020 2020 2020 2020 2020 2020 6d6f 6d65              mome
+0001fd90: 6e74 756d 3d30 2e39 392c 0a20 2020 2020  ntum=0.99,.     
+0001fda0: 2020 2020 2020 2020 2020 2061 6666 696e             affin
+0001fdb0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+0001fdc0: 2020 2020 2020 2020 7472 6163 6b5f 7275          track_ru
+0001fdd0: 6e6e 696e 675f 7374 6174 733d 5472 7565  nning_stats=True
+0001fde0: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0001fdf0: 656c 662e 575f 503a 2074 6f72 6368 2e54  elf.W_P: torch.T
+0001fe00: 656e 736f 7220 3d20 696e 6974 280a 2020  ensor = init(.  
+0001fe10: 2020 2020 2020 2020 2020 2020 2020 746f                to
+0001fe20: 7263 682e 656d 7074 7928 7365 6c66 2e6e  rch.empty(self.n
+0001fe30: 5f68 6964 6465 6e5f 502c 2073 656c 662e  _hidden_P, self.
+0001fe40: 6e5f 7061 6972 5f6f 7574 7075 745f 6665  n_pair_output_fe
+0001fe50: 6174 2929 0a20 2020 2020 2020 2020 2020  at)).           
+0001fe60: 2073 656c 662e 625f 503a 2074 6f72 6368   self.b_P: torch
+0001fe70: 2e54 656e 736f 7220 3d20 746f 7263 682e  .Tensor = torch.
+0001fe80: 7a65 726f 7328 2873 656c 662e 6e5f 7061  zeros((self.n_pa
+0001fe90: 6972 5f6f 7574 7075 745f 6665 6174 2c29  ir_output_feat,)
+0001fea0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0001feb0: 6c66 2e50 5f62 6e3a 206e 6e2e 4261 7463  lf.P_bn: nn.Batc
+0001fec0: 684e 6f72 6d31 6420 3d20 6e6e 2e42 6174  hNorm1d = nn.Bat
+0001fed0: 6368 4e6f 726d 3164 280a 2020 2020 2020  chNorm1d(.      
+0001fee0: 2020 2020 2020 2020 2020 6e75 6d5f 6665            num_fe
+0001fef0: 6174 7572 6573 3d73 656c 662e 6e5f 7061  atures=self.n_pa
+0001ff00: 6972 5f6f 7574 7075 745f 6665 6174 2c0a  ir_output_feat,.
+0001ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff20: 6570 733d 3165 2d33 2c0a 2020 2020 2020  eps=1e-3,.      
+0001ff30: 2020 2020 2020 2020 2020 6d6f 6d65 6e74            moment
+0001ff40: 756d 3d30 2e39 392c 0a20 2020 2020 2020  um=0.99,.       
+0001ff50: 2020 2020 2020 2020 2061 6666 696e 653d           affine=
+0001ff60: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0001ff70: 2020 2020 2020 7472 6163 6b5f 7275 6e6e        track_runn
+0001ff80: 696e 675f 7374 6174 733d 5472 7565 290a  ing_stats=True).
+0001ff90: 2020 2020 2020 2020 7365 6c66 2e62 7569          self.bui
+0001ffa0: 6c74 203d 2054 7275 650a 0a20 2020 2064  lt = True..    d
+0001ffb0: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
+0001ffc0: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
+0001ffd0: 2020 2222 220a 2020 2020 5265 7475 726e    """.    Return
+0001ffe0: 7320 6120 7374 7269 6e67 2072 6570 7265  s a string repre
+0001fff0: 7365 6e74 6174 696f 6e20 6f66 2074 6865  sentation of the
+00020000: 206f 626a 6563 742e 0a0a 2020 2020 5265   object...    Re
+00020010: 7475 726e 733a 0a20 2020 202d 2d2d 2d2d  turns:.    -----
+00020020: 2d2d 0a20 2020 2073 7472 3a20 4120 7374  --.    str: A st
+00020030: 7269 6e67 2074 6861 7420 636f 6e74 6169  ring that contai
+00020040: 6e73 2074 6865 2063 6c61 7373 206e 616d  ns the class nam
+00020050: 6520 666f 6c6c 6f77 6564 2062 7920 7468  e followed by th
+00020060: 6520 7661 6c75 6573 206f 6620 6974 7320  e values of its 
+00020070: 696e 7374 616e 6365 2076 6172 6961 626c  instance variabl
+00020080: 652e 0a20 2020 2022 2222 0a20 2020 2020  e..    """.     
+00020090: 2020 2023 2066 6c61 6b65 383a 206e 6f71     # flake8: noq
+000200a0: 610a 2020 2020 2020 2020 7265 7475 726e  a.        return
+000200b0: 2028 0a20 2020 2020 2020 2020 2020 2066   (.            f
+000200c0: 277b 7365 6c66 2e5f 5f63 6c61 7373 5f5f  '{self.__class__
+000200d0: 2e5f 5f6e 616d 655f 5f7d 286e 5f61 746f  .__name__}(n_ato
+000200e0: 6d5f 696e 7075 745f 6665 6174 3a7b 7365  m_input_feat:{se
+000200f0: 6c66 2e6e 5f61 746f 6d5f 696e 7075 745f  lf.n_atom_input_
+00020100: 6665 6174 7d2c 6e5f 7061 6972 5f69 6e70  feat},n_pair_inp
+00020110: 7574 5f66 6561 743a 7b73 656c 662e 6e5f  ut_feat:{self.n_
+00020120: 7061 6972 5f69 6e70 7574 5f66 6561 747d  pair_input_feat}
+00020130: 2c6e 5f61 746f 6d5f 6f75 7470 7574 5f66  ,n_atom_output_f
+00020140: 6561 743a 7b73 656c 662e 6e5f 6174 6f6d  eat:{self.n_atom
+00020150: 5f6f 7574 7075 745f 6665 6174 7d2c 6e5f  _output_feat},n_
+00020160: 7061 6972 5f6f 7574 7075 745f 6665 6174  pair_output_feat
+00020170: 3a7b 7365 6c66 2e6e 5f70 6169 725f 6f75  :{self.n_pair_ou
+00020180: 7470 7574 5f66 6561 747d 2c6e 5f68 6964  tput_feat},n_hid
+00020190: 6465 6e5f 4141 3a7b 7365 6c66 2e6e 5f68  den_AA:{self.n_h
+000201a0: 6964 6465 6e5f 4141 7d2c 6e5f 6869 6464  idden_AA},n_hidd
+000201b0: 656e 5f50 413a 7b73 656c 662e 6e5f 6869  en_PA:{self.n_hi
+000201c0: 6464 656e 5f50 417d 2c6e 5f68 6964 6465  dden_PA},n_hidde
+000201d0: 6e5f 4150 3a7b 7365 6c66 2e6e 5f68 6964  n_AP:{self.n_hid
+000201e0: 6465 6e5f 4150 7d2c 6e5f 6869 6464 656e  den_AP},n_hidden
+000201f0: 5f50 503a 7b73 656c 662e 6e5f 6869 6464  _PP:{self.n_hidd
+00020200: 656e 5f50 507d 2c62 6174 6368 5f6e 6f72  en_PP},batch_nor
+00020210: 6d61 6c69 7a65 3a7b 7365 6c66 2e62 6174  malize:{self.bat
+00020220: 6368 5f6e 6f72 6d61 6c69 7a65 7d2c 7570  ch_normalize},up
+00020230: 6461 7465 5f70 6169 723a 7b73 656c 662e  date_pair:{self.
+00020240: 7570 6461 7465 5f70 6169 727d 2c69 6e69  update_pair},ini
+00020250: 743a 7b73 656c 662e 696e 6974 7d2c 6163  t:{self.init},ac
+00020260: 7469 7661 7469 6f6e 3a7b 7365 6c66 2e61  tivation:{self.a
+00020270: 6374 6976 6174 696f 6e7d 2927 0a20 2020  ctivation})'.   
+00020280: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00020290: 666f 7277 6172 6428 0a20 2020 2020 2020  forward(.       
+000202a0: 2073 656c 662c 2069 6e70 7574 733a 204c   self, inputs: L
+000202b0: 6973 745b 556e 696f 6e5b 6e70 2e6e 6461  ist[Union[np.nda
+000202c0: 7272 6179 2c20 6e70 2e6e 6461 7272 6179  rray, np.ndarray
+000202d0: 2c20 6e70 2e6e 6461 7272 6179 2c0a 2020  , np.ndarray,.  
+000202e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000202f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00020300: 702e 6e64 6172 7261 795d 5d0a 2020 2020  p.ndarray]].    
+00020310: 2920 2d3e 204c 6973 745b 556e 696f 6e5b  ) -> List[Union[
+00020320: 746f 7263 682e 5465 6e73 6f72 2c20 746f  torch.Tensor, to
+00020330: 7263 682e 5465 6e73 6f72 5d5d 3a0a 2020  rch.Tensor]]:.  
+00020340: 2020 2020 2020 2222 220a 2020 2020 4372        """.    Cr
+00020350: 6561 7465 7320 7765 6176 6520 7465 6e73  eates weave tens
+00020360: 6f72 732e 0a0a 2020 2020 5061 7261 6d65  ors...    Parame
+00020370: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00020380: 2d2d 2d0a 2020 2020 696e 7075 7473 3a20  ---.    inputs: 
+00020390: 4c69 7374 5b55 6e69 6f6e 5b6e 702e 6e64  List[Union[np.nd
+000203a0: 6172 7261 792c 206e 702e 6e64 6172 7261  array, np.ndarra
+000203b0: 792c 206e 702e 6e64 6172 7261 792c 206e  y, np.ndarray, n
+000203c0: 702e 6e64 6172 7261 795d 5d0a 2020 2020  p.ndarray]].    
+000203d0: 5368 6f75 6c64 2063 6f6e 7461 696e 2034  Should contain 4
+000203e0: 2074 656e 736f 7273 205b 6174 6f6d 5f66   tensors [atom_f
+000203f0: 6561 7475 7265 732c 2070 6169 725f 6665  eatures, pair_fe
+00020400: 6174 7572 6573 2c20 7061 6972 5f73 706c  atures, pair_spl
+00020410: 6974 2c0a 2020 2020 6174 6f6d 5f74 6f5f  it,.    atom_to_
+00020420: 7061 6972 5d0a 0a20 2020 2052 6574 7572  pair]..    Retur
+00020430: 6e73 3a0a 2020 2020 2d2d 2d2d 2d2d 2d0a  ns:.    -------.
+00020440: 2020 2020 4c69 7374 5b55 6e69 6f6e 5b74      List[Union[t
+00020450: 6f72 6368 2e54 656e 736f 722c 2074 6f72  orch.Tensor, tor
+00020460: 6368 2e54 656e 736f 725d 5d0a 2020 2020  ch.Tensor]].    
+00020470: 2020 413a 2041 746f 6d20 6665 6174 7572    A: Atom featur
+00020480: 6573 2074 656e 736f 7220 7769 7468 2073  es tensor with s
+00020490: 6861 7065 5b74 6f74 616c 5f6e 756d 5f61  hape[total_num_a
+000204a0: 746f 6d73 2c61 746f 6d20 6665 6174 7572  toms,atom featur
+000204b0: 6520 7369 7a65 5d0a 2020 2020 2020 503a  e size].      P:
+000204c0: 2050 6169 7220 6665 6174 7572 6573 2074   Pair features t
+000204d0: 656e 736f 7220 7769 7468 2073 6861 7065  ensor with shape
+000204e0: 5b74 6f74 616c 206e 756d 206f 6620 7061  [total num of pa
+000204f0: 6972 732c 626f 6e64 2066 6561 7475 7265  irs,bond feature
+00020500: 2073 697a 655d 0a20 2020 2022 2222 0a20   size].    """. 
+00020510: 2020 2020 2020 2023 2043 6f6e 7665 7274         # Convert
+00020520: 696e 6720 7468 6520 696e 7075 7420 746f  ing the input to
+00020530: 2074 6f72 6368 2074 656e 736f 7273 0a20   torch tensors. 
+00020540: 2020 2020 2020 2061 746f 6d5f 6665 6174         atom_feat
+00020550: 7572 6573 3a20 746f 7263 682e 5465 6e73  ures: torch.Tens
+00020560: 6f72 203d 2074 6f72 6368 2e74 656e 736f  or = torch.tenso
+00020570: 7228 696e 7075 7473 5b30 5d29 0a20 2020  r(inputs[0]).   
+00020580: 2020 2020 2070 6169 725f 6665 6174 7572       pair_featur
+00020590: 6573 3a20 746f 7263 682e 5465 6e73 6f72  es: torch.Tensor
+000205a0: 203d 2074 6f72 6368 2e74 656e 736f 7228   = torch.tensor(
+000205b0: 696e 7075 7473 5b31 5d29 0a0a 2020 2020  inputs[1])..    
+000205c0: 2020 2020 7061 6972 5f73 706c 6974 3a20      pair_split: 
+000205d0: 746f 7263 682e 5465 6e73 6f72 203d 2074  torch.Tensor = t
+000205e0: 6f72 6368 2e74 656e 736f 7228 696e 7075  orch.tensor(inpu
+000205f0: 7473 5b32 5d29 0a20 2020 2020 2020 2061  ts[2]).        a
+00020600: 746f 6d5f 746f 5f70 6169 723a 2074 6f72  tom_to_pair: tor
+00020610: 6368 2e54 656e 736f 7220 3d20 746f 7263  ch.Tensor = torc
+00020620: 682e 7465 6e73 6f72 2869 6e70 7574 735b  h.tensor(inputs[
+00020630: 335d 290a 0a20 2020 2020 2020 2061 6374  3])..        act
+00020640: 6976 6174 696f 6e20 3d20 7365 6c66 2e61  ivation = self.a
+00020650: 6374 6976 6174 696f 6e5f 666e 0a0a 2020  ctivation_fn..  
+00020660: 2020 2020 2020 2320 4141 2069 7320 6120        # AA is a 
+00020670: 7465 6e73 6f72 2077 6974 6820 7368 6170  tensor with shap
+00020680: 655b 746f 7461 6c5f 6e75 6d5f 6174 6f6d  e[total_num_atom
+00020690: 732c 6e5f 6869 6464 656e 5f41 415d 0a20  s,n_hidden_AA]. 
+000206a0: 2020 2020 2020 2041 413a 2074 6f72 6368         AA: torch
+000206b0: 2e54 656e 736f 7220 3d20 746f 7263 682e  .Tensor = torch.
+000206c0: 6d61 746d 756c 2861 746f 6d5f 6665 6174  matmul(atom_feat
+000206d0: 7572 6573 2e74 7970 6528 746f 7263 682e  ures.type(torch.
+000206e0: 666c 6f61 7433 3229 2c0a 2020 2020 2020  float32),.      
+000206f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020710: 2020 7365 6c66 2e57 5f41 4129 202b 2073    self.W_AA) + s
+00020720: 656c 662e 625f 4141 0a20 2020 2020 2020  elf.b_AA.       
+00020730: 2069 6620 7365 6c66 2e62 6174 6368 5f6e   if self.batch_n
+00020740: 6f72 6d61 6c69 7a65 3a0a 2020 2020 2020  ormalize:.      
+00020750: 2020 2020 2020 7365 6c66 2e41 415f 626e        self.AA_bn
+00020760: 2e65 7661 6c28 290a 2020 2020 2020 2020  .eval().        
+00020770: 2020 2020 4141 203d 2073 656c 662e 4141      AA = self.AA
+00020780: 5f62 6e28 4141 290a 2020 2020 2020 2020  _bn(AA).        
+00020790: 4141 203d 2061 6374 6976 6174 696f 6e28  AA = activation(
+000207a0: 4141 290a 2020 2020 2020 2020 2320 5041  AA).        # PA
+000207b0: 2069 7320 6120 7465 6e73 6f72 2077 6974   is a tensor wit
+000207c0: 6820 7368 6170 655b 746f 7461 6c20 6e75  h shape[total nu
+000207d0: 6d62 6572 206f 6620 7061 6972 732c 6e5f  mber of pairs,n_
+000207e0: 6869 6464 656e 5f50 415d 0a20 2020 2020  hidden_PA].     
+000207f0: 2020 2050 413a 2074 6f72 6368 2e54 656e     PA: torch.Ten
+00020800: 736f 7220 3d20 746f 7263 682e 6d61 746d  sor = torch.matm
+00020810: 756c 2870 6169 725f 6665 6174 7572 6573  ul(pair_features
+00020820: 2e74 7970 6528 746f 7263 682e 666c 6f61  .type(torch.floa
+00020830: 7433 3229 2c0a 2020 2020 2020 2020 2020  t32),.          
+00020840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020850: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00020860: 6c66 2e57 5f50 4129 202b 2073 656c 662e  lf.W_PA) + self.
+00020870: 625f 5041 0a20 2020 2020 2020 2069 6620  b_PA.        if 
+00020880: 7365 6c66 2e62 6174 6368 5f6e 6f72 6d61  self.batch_norma
+00020890: 6c69 7a65 3a0a 2020 2020 2020 2020 2020  lize:.          
+000208a0: 2020 7365 6c66 2e50 415f 626e 2e65 7661    self.PA_bn.eva
+000208b0: 6c28 290a 2020 2020 2020 2020 2020 2020  l().            
+000208c0: 5041 203d 2073 656c 662e 5041 5f62 6e28  PA = self.PA_bn(
+000208d0: 5041 290a 2020 2020 2020 2020 5041 203d  PA).        PA =
+000208e0: 2061 6374 6976 6174 696f 6e28 5041 290a   activation(PA).
+000208f0: 0a20 2020 2020 2020 2023 2053 706c 6974  .        # Split
+00020900: 2074 6865 2050 4120 7465 6e73 6f72 2061   the PA tensor a
+00020910: 6363 6f72 6469 6e67 2074 6f20 7468 6520  ccording to the 
+00020920: 2770 6169 725f 7370 6c69 7427 2074 656e  'pair_split' ten
+00020930: 736f 720a 2020 2020 2020 2020 745f 6772  sor.        t_gr
+00020940: 703a 2044 6963 745b 5465 6e73 6f72 2c20  p: Dict[Tensor, 
+00020950: 5465 6e73 6f72 5d20 3d20 7b7d 0a20 2020  Tensor] = {}.   
+00020960: 2020 2020 2069 6478 3a20 696e 7420 3d20       idx: int = 
+00020970: 300a 2020 2020 2020 2020 666f 7220 692c  0.        for i,
+00020980: 2073 5f69 6420 696e 2065 6e75 6d65 7261   s_id in enumera
+00020990: 7465 2870 6169 725f 7370 6c69 7429 3a0a  te(pair_split):.
+000209a0: 2020 2020 2020 2020 2020 2020 735f 6964              s_id
+000209b0: 203d 2073 5f69 642e 6974 656d 2829 0a20   = s_id.item(). 
+000209c0: 2020 2020 2020 2020 2020 2069 6620 735f             if s_
+000209d0: 6964 2069 6e20 745f 6772 703a 0a20 2020  id in t_grp:.   
+000209e0: 2020 2020 2020 2020 2020 2020 2074 5f67               t_g
+000209f0: 7270 5b73 5f69 645d 203d 2074 5f67 7270  rp[s_id] = t_grp
+00020a00: 5b73 5f69 645d 202b 2050 415b 6964 785d  [s_id] + PA[idx]
+00020a10: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00020a20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00020a30: 2020 2074 5f67 7270 5b73 5f69 645d 203d     t_grp[s_id] =
+00020a40: 2050 415b 6964 785d 0a20 2020 2020 2020   PA[idx].       
+00020a50: 2020 2020 2069 6478 203d 2069 202b 2031       idx = i + 1
+00020a60: 0a0a 2020 2020 2020 2020 2020 2020 6c73  ..            ls
+00020a70: 7420 3d20 6c69 7374 2874 5f67 7270 2e76  t = list(t_grp.v
+00020a80: 616c 7565 7328 2929 0a20 2020 2020 2020  alues()).       
+00020a90: 2020 2020 2074 656e 736f 7220 3d20 746f       tensor = to
+00020aa0: 7263 682e 7374 6163 6b28 6c73 7429 0a20  rch.stack(lst). 
+00020ab0: 2020 2020 2020 2050 4120 3d20 7465 6e73         PA = tens
+00020ac0: 6f72 0a0a 2020 2020 2020 2020 413a 2074  or..        A: t
+00020ad0: 6f72 6368 2e54 656e 736f 7220 3d20 746f  orch.Tensor = to
+00020ae0: 7263 682e 6d61 746d 756c 2874 6f72 6368  rch.matmul(torch
+00020af0: 2e63 6f6e 6361 7428 5b41 412c 2050 415d  .concat([AA, PA]
+00020b00: 2c20 3129 2c0a 2020 2020 2020 2020 2020  , 1),.          
+00020b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00020b30: 662e 575f 4129 202b 2073 656c 662e 625f  f.W_A) + self.b_
+00020b40: 410a 2020 2020 2020 2020 6966 2073 656c  A.        if sel
+00020b50: 662e 6261 7463 685f 6e6f 726d 616c 697a  f.batch_normaliz
+00020b60: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00020b70: 656c 662e 415f 626e 2e65 7661 6c28 290a  elf.A_bn.eval().
+00020b80: 2020 2020 2020 2020 2020 2020 4120 3d20              A = 
+00020b90: 7365 6c66 2e41 5f62 6e28 4129 0a20 2020  self.A_bn(A).   
+00020ba0: 2020 2020 2041 203d 2061 6374 6976 6174       A = activat
+00020bb0: 696f 6e28 4129 0a0a 2020 2020 2020 2020  ion(A)..        
+00020bc0: 6966 2073 656c 662e 7570 6461 7465 5f70  if self.update_p
+00020bd0: 6169 723a 0a20 2020 2020 2020 2020 2020  air:.           
+00020be0: 2023 204e 6f74 6520 7468 6174 2041 505f   # Note that AP_
+00020bf0: 696a 2061 6e64 2041 505f 6a69 2073 6861  ij and AP_ji sha
+00020c00: 7265 2074 6865 2073 616d 6520 7365 6c66  re the same self
+00020c10: 2e41 505f 626e 2062 6174 6368 0a20 2020  .AP_bn batch.   
+00020c20: 2020 2020 2020 2020 2023 206e 6f72 6d61           # norma
+00020c30: 6c69 7a61 7469 6f6e 0a20 2020 2020 2020  lization.       
+00020c40: 2020 2020 2041 505f 696a 3a20 746f 7263       AP_ij: torc
+00020c50: 682e 5465 6e73 6f72 203d 2074 6f72 6368  h.Tensor = torch
+00020c60: 2e6d 6174 6d75 6c28 0a20 2020 2020 2020  .matmul(.       
+00020c70: 2020 2020 2020 2020 2074 6f72 6368 2e72           torch.r
+00020c80: 6573 6861 7065 2861 746f 6d5f 6665 6174  eshape(atom_feat
+00020c90: 7572 6573 5b61 746f 6d5f 746f 5f70 6169  ures[atom_to_pai
+00020ca0: 725d 2c0a 2020 2020 2020 2020 2020 2020  r],.            
+00020cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020cc0: 2020 5b2d 312c 2032 202a 2073 656c 662e    [-1, 2 * self.
+00020cd0: 6e5f 6174 6f6d 5f69 6e70 7574 5f66 6561  n_atom_input_fea
+00020ce0: 745d 292e 7479 7065 280a 2020 2020 2020  t]).type(.      
+00020cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d00: 2020 2020 2020 2020 2020 2020 746f 7263              torc
+00020d10: 682e 666c 6f61 7433 3229 2c20 7365 6c66  h.float32), self
+00020d20: 2e57 5f41 5029 202b 2073 656c 662e 625f  .W_AP) + self.b_
+00020d30: 4150 0a20 2020 2020 2020 2020 2020 2069  AP.            i
+00020d40: 6620 7365 6c66 2e62 6174 6368 5f6e 6f72  f self.batch_nor
+00020d50: 6d61 6c69 7a65 3a0a 2020 2020 2020 2020  malize:.        
+00020d60: 2020 2020 2020 2020 7365 6c66 2e41 505f          self.AP_
+00020d70: 626e 2e65 7661 6c28 290a 2020 2020 2020  bn.eval().      
+00020d80: 2020 2020 2020 2020 2020 4150 5f69 6a20            AP_ij 
+00020d90: 3d20 7365 6c66 2e41 505f 626e 2841 505f  = self.AP_bn(AP_
+00020da0: 696a 290a 2020 2020 2020 2020 2020 2020  ij).            
+00020db0: 4150 5f69 6a20 3d20 6163 7469 7661 7469  AP_ij = activati
+00020dc0: 6f6e 2841 505f 696a 290a 2020 2020 2020  on(AP_ij).      
+00020dd0: 2020 2020 2020 4150 5f6a 693a 2074 6f72        AP_ji: tor
+00020de0: 6368 2e54 656e 736f 7220 3d20 746f 7263  ch.Tensor = torc
+00020df0: 682e 6d61 746d 756c 280a 2020 2020 2020  h.matmul(.      
+00020e00: 2020 2020 2020 2020 2020 746f 7263 682e            torch.
+00020e10: 7265 7368 6170 6528 6174 6f6d 5f66 6561  reshape(atom_fea
+00020e20: 7475 7265 735b 746f 7263 682e 666c 6970  tures[torch.flip
+00020e30: 2861 746f 6d5f 746f 5f70 6169 722c 205b  (atom_to_pair, [
+00020e40: 315d 295d 2c0a 2020 2020 2020 2020 2020  1])],.          
+00020e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e60: 2020 2020 5b2d 312c 2032 202a 2073 656c      [-1, 2 * sel
+00020e70: 662e 6e5f 6174 6f6d 5f69 6e70 7574 5f66  f.n_atom_input_f
+00020e80: 6561 745d 292e 7479 7065 280a 2020 2020  eat]).type(.    
+00020e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ea0: 2020 2020 2020 2020 2020 2020 2020 746f                to
+00020eb0: 7263 682e 666c 6f61 7433 3229 2c20 7365  rch.float32), se
+00020ec0: 6c66 2e57 5f41 5029 202b 2073 656c 662e  lf.W_AP) + self.
+00020ed0: 625f 4150 0a20 2020 2020 2020 2020 2020  b_AP.           
+00020ee0: 2069 6620 7365 6c66 2e62 6174 6368 5f6e   if self.batch_n
+00020ef0: 6f72 6d61 6c69 7a65 3a0a 2020 2020 2020  ormalize:.      
+00020f00: 2020 2020 2020 2020 2020 7365 6c66 2e41            self.A
+00020f10: 505f 626e 2e65 7661 6c28 290a 2020 2020  P_bn.eval().    
+00020f20: 2020 2020 2020 2020 2020 2020 4150 5f6a              AP_j
+00020f30: 6920 3d20 7365 6c66 2e41 505f 626e 2841  i = self.AP_bn(A
+00020f40: 505f 6a69 290a 2020 2020 2020 2020 2020  P_ji).          
+00020f50: 2020 4150 5f6a 6920 3d20 6163 7469 7661    AP_ji = activa
+00020f60: 7469 6f6e 2841 505f 6a69 290a 2020 2020  tion(AP_ji).    
+00020f70: 2020 2020 2020 2020 2320 5050 2069 7320          # PP is 
+00020f80: 6120 7465 6e73 6f72 2077 6974 6820 7368  a tensor with sh
+00020f90: 6170 6520 5b74 6f74 616c 206e 756d 6265  ape [total numbe
+00020fa0: 7220 6f66 2070 6169 7273 2c6e 5f68 6964  r of pairs,n_hid
+00020fb0: 6465 6e5f 5050 5d0a 2020 2020 2020 2020  den_PP].        
+00020fc0: 2020 2020 5050 3a20 746f 7263 682e 5465      PP: torch.Te
+00020fd0: 6e73 6f72 203d 2074 6f72 6368 2e6d 6174  nsor = torch.mat
+00020fe0: 6d75 6c28 7061 6972 5f66 6561 7475 7265  mul(pair_feature
+00020ff0: 732e 7479 7065 2874 6f72 6368 2e66 6c6f  s.type(torch.flo
+00021000: 6174 3332 292c 0a20 2020 2020 2020 2020  at32),.         
+00021010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021030: 2020 2073 656c 662e 575f 5050 2920 2b20     self.W_PP) + 
+00021040: 7365 6c66 2e62 5f50 500a 2020 2020 2020  self.b_PP.      
+00021050: 2020 2020 2020 6966 2073 656c 662e 6261        if self.ba
+00021060: 7463 685f 6e6f 726d 616c 697a 653a 0a20  tch_normalize:. 
+00021070: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00021080: 656c 662e 5050 5f62 6e2e 6576 616c 2829  elf.PP_bn.eval()
+00021090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000210a0: 2050 5020 3d20 7365 6c66 2e50 505f 626e   PP = self.PP_bn
+000210b0: 2850 5029 0a20 2020 2020 2020 2020 2020  (PP).           
+000210c0: 2050 5020 3d20 6163 7469 7661 7469 6f6e   PP = activation
+000210d0: 2850 5029 0a20 2020 2020 2020 2020 2020  (PP).           
+000210e0: 2050 3a20 746f 7263 682e 5465 6e73 6f72   P: torch.Tensor
+000210f0: 203d 2074 6f72 6368 2e6d 6174 6d75 6c28   = torch.matmul(
+00021100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021110: 2074 6f72 6368 2e63 6f6e 6361 7428 5b41   torch.concat([A
+00021120: 505f 696a 202b 2041 505f 6a69 2c20 5050  P_ij + AP_ji, PP
+00021130: 5d2c 2031 292e 7479 7065 2874 6f72 6368  ], 1).type(torch
+00021140: 2e66 6c6f 6174 3332 292c 0a20 2020 2020  .float32),.     
+00021150: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00021160: 575f 5029 202b 2073 656c 662e 625f 500a  W_P) + self.b_P.
+00021170: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00021180: 656c 662e 6261 7463 685f 6e6f 726d 616c  elf.batch_normal
+00021190: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
+000211a0: 2020 2020 2073 656c 662e 505f 626e 2e65       self.P_bn.e
+000211b0: 7661 6c28 290a 2020 2020 2020 2020 2020  val().          
+000211c0: 2020 2020 2020 5020 3d20 7365 6c66 2e50        P = self.P
+000211d0: 5f62 6e28 5029 0a20 2020 2020 2020 2020  _bn(P).         
+000211e0: 2020 2050 203d 2061 6374 6976 6174 696f     P = activatio
+000211f0: 6e28 5029 0a20 2020 2020 2020 2065 6c73  n(P).        els
+00021200: 653a 0a20 2020 2020 2020 2020 2020 2050  e:.            P
+00021210: 203d 2070 6169 725f 6665 6174 7572 6573   = pair_features
+00021220: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00021230: 205b 412c 2050 5d0a                       [A, P].
```

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/lcnn.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/lcnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/mat.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/mat.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/megnet.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/megnet.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/modular.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/modular.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/mpnn.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/mpnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/normalizing_flows_pytorch.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/normalizing_flows_pytorch.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/pagtn.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/pagtn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/pna_gnn.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/pna_gnn.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/readout.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/readout.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/torch_models/torch_model.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/torch_models/torch_model.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/models/wandblogger.py` & `deepchem-2.7.2.dev20230627202443/deepchem/models/wandblogger.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/check_availability.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/check_availability.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/defaults.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/defaults.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/dnasim.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/dnasim.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/bace_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/bace_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/bace_features.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/bace_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/bbbc_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/bbbc_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/bbbp_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/bbbp_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/cell_counting_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/cell_counting_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/chembl25_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/chembl25_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/chembl_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/chembl_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/chembl_tasks.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/chembl_tasks.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/clearance_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/clearance_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/clintox_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/clintox_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/delaney_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/delaney_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/factors_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/factors_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/freesolv_dataset.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/freesolv_dataset.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/hiv_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/hiv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/hopv_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/hopv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/hppb_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/hppb_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/kaggle_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/kaggle_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/kaggle_features.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/kaggle_features.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/kinase_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/kinase_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/lipo_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/lipo_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/load_dataset_template.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/load_dataset_template.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/load_Pt_NO_surface_adsorbate_energy.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/load_bandgap.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/load_bandgap.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/load_mp_formation_energy.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/load_mp_metallicity.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/material_datasets/load_perovskite.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/material_datasets/load_perovskite.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/molnet_loader.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/molnet_loader.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/muv_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/muv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/nci_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/nci_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/pcba_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/pcba_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/pdbbind_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/pdbbind_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/ppb_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/ppb_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/qm7_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/qm7_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/qm8_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/qm8_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/qm9_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/qm9_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/sampl_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/sampl_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/sider_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/sider_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/sweetlead_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/sweetlead_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/thermosol_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/thermosol_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/tox21_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/tox21_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/toxcast_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/toxcast_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/uspto_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/uspto_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/uv_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/uv_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/uv_tasks.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/uv_tasks.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/load_function/zinc15_datasets.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/load_function/zinc15_datasets.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/preset_hyper_parameters.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/preset_hyper_parameters.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/run_benchmark.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/run_benchmark.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/run_benchmark_low_data.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/run_benchmark_low_data.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/molnet/run_benchmark_models.py` & `deepchem-2.7.2.dev20230627202443/deepchem/molnet/run_benchmark_models.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/rl/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/rl/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/rl/a2c.py` & `deepchem-2.7.2.dev20230627202443/deepchem/rl/a2c.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/rl/envs/test_tictactoe.py` & `deepchem-2.7.2.dev20230627202443/deepchem/rl/envs/test_tictactoe.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/rl/envs/tictactoe.py` & `deepchem-2.7.2.dev20230627202443/deepchem/rl/envs/tictactoe.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/rl/ppo.py` & `deepchem-2.7.2.dev20230627202443/deepchem/rl/ppo.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/splits/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/splits/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/splits/splitters.py` & `deepchem-2.7.2.dev20230627202443/deepchem/splits/splitters.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/splits/task_splitter.py` & `deepchem-2.7.2.dev20230627202443/deepchem/splits/task_splitter.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/trans/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/trans/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/trans/duplicate.py` & `deepchem-2.7.2.dev20230627202443/deepchem/trans/duplicate.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/trans/transformers.py` & `deepchem-2.7.2.dev20230627202443/deepchem/trans/transformers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/__init__.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/__init__.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/conformers.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/conformers.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/coordinate_box_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/coordinate_box_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/data_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/data_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/debug_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/debug_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/dftutils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/dftutils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/docking_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/docking_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/electron_sampler.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/electron_sampler.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/evaluate.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/evaluate.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/fake_data_generator.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/fake_data_generator.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/fragment_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/fragment_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/genomics_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/genomics_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/geometry_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/geometry_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/graph_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/graph_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/grover.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/grover.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/hash_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/hash_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/molecule_feature_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/molecule_feature_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/noncovalent_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/noncovalent_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/pdbqt_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/pdbqt_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/pytorch_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/pytorch_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/rdkit_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/rdkit_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/save.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/save.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/sequence_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/sequence_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_coordinate_box_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_coordinate_box_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_data_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_data_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_dftutils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_dftutils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_docking_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_docking_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_electron_sampler.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_electron_sampler.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_evaluate.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_evaluate.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_fake_data_generator.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_fake_data_generator.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_fragment_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_fragment_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_generator_evaluator.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_generator_evaluator.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_genomics_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_genomics_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_geometry_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_geometry_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_graph_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_graph_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_grover.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_grover.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_hash_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_hash_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_molecule_feature_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_molecule_feature_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_noncovalent_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_noncovalent_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_pdbqt_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_pdbqt_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_pytorch_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_pytorch_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_rdkit_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_rdkit_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_sequence_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_sequence_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/test/test_voxel_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/test/test_voxel_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/typing.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/typing.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/vina_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/vina_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem/utils/voxel_utils.py` & `deepchem-2.7.2.dev20230627202443/deepchem/utils/voxel_utils.py`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem.egg-info/PKG-INFO` & `deepchem-2.7.2.dev20230627202443/deepchem.egg-info/PKG-INFO`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: deepchem
-Version: 2.7.2.dev20230627173354
+Version: 2.7.2.dev20230627202443
 Summary: Deep learning models for drug discovery,         quantum chemistry, and the life sciences.
 Home-page: https://github.com/deepchem/deepchem
 Maintainer: DeepChem contributors
 License: MIT
 Project-URL: Documentation, https://deepchem.readthedocs.io/en/latest/
 Project-URL: Source, https://github.com/deepchem/deepchem
 Keywords: deepchem,chemistry,biology,materials-science,life-science,drug-discovery
```

### Comparing `deepchem-2.7.2.dev20230627173354/deepchem.egg-info/SOURCES.txt` & `deepchem-2.7.2.dev20230627202443/deepchem.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/setup.cfg` & `deepchem-2.7.2.dev20230627202443/setup.cfg`

 * *Files identical despite different names*

### Comparing `deepchem-2.7.2.dev20230627173354/setup.py` & `deepchem-2.7.2.dev20230627202443/setup.py`

 * *Files identical despite different names*

